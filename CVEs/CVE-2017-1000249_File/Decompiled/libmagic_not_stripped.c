typedef unsigned char   undefined;

typedef unsigned char    byte;
typedef unsigned char    dwfenc;
typedef unsigned int    dword;
typedef long double    longdouble;
typedef long long    longlong;
typedef unsigned long    qword;
typedef int    sdword;
typedef long    sqword;
typedef short    sword;
typedef unsigned char    uchar;
typedef unsigned int    uint;
typedef unsigned long long    uint16;
typedef unsigned long    ulong;
typedef unsigned long long    ulonglong;
typedef unsigned char    undefined1;
typedef unsigned int    undefined4;
typedef unsigned long    undefined5;
typedef unsigned long    undefined7;
typedef unsigned long    undefined8;
typedef unsigned short    ushort;
typedef int    wchar_t;
typedef unsigned short    word;
typedef struct eh_frame_hdr eh_frame_hdr, *Peh_frame_hdr;

struct eh_frame_hdr {
    byte eh_frame_hdr_version; // Exception Handler Frame Header Version
    dwfenc eh_frame_pointer_encoding; // Exception Handler Frame Pointer Encoding
    dwfenc eh_frame_desc_entry_count_encoding; // Encoding of # of Exception Handler FDEs
    dwfenc eh_frame_table_encoding; // Exception Handler Table Encoding
};

typedef struct NoteGnuPropertyElement_4 NoteGnuPropertyElement_4, *PNoteGnuPropertyElement_4;

struct NoteGnuPropertyElement_4 {
    dword prType;
    dword prDatasz;
    byte data[4];
};

typedef struct fde_table_entry fde_table_entry, *Pfde_table_entry;

struct fde_table_entry {
    dword initial_loc; // Initial Location
    dword data_loc; // Data location
};

typedef void _IO_lock_t;

typedef struct _IO_marker _IO_marker, *P_IO_marker;

typedef struct _IO_FILE _IO_FILE, *P_IO_FILE;

typedef long __off_t;

typedef long __off64_t;

typedef ulong size_t;

struct _IO_FILE {
    int _flags;
    char *_IO_read_ptr;
    char *_IO_read_end;
    char *_IO_read_base;
    char *_IO_write_base;
    char *_IO_write_ptr;
    char *_IO_write_end;
    char *_IO_buf_base;
    char *_IO_buf_end;
    char *_IO_save_base;
    char *_IO_backup_base;
    char *_IO_save_end;
    struct _IO_marker *_markers;
    struct _IO_FILE *_chain;
    int _fileno;
    int _flags2;
    __off_t _old_offset;
    ushort _cur_column;
    char _vtable_offset;
    char _shortbuf[1];
    _IO_lock_t *_lock;
    __off64_t _offset;
    void *__pad1;
    void *__pad2;
    void *__pad3;
    void *__pad4;
    size_t __pad5;
    int _mode;
    char _unused2[20];
};

struct _IO_marker {
    struct _IO_marker *_next;
    struct _IO_FILE *_sbuf;
    int _pos;
};

typedef struct stat stat, *Pstat;

typedef ulong __dev_t;

typedef ulong __ino_t;

typedef ulong __nlink_t;

typedef uint __mode_t;

typedef uint __uid_t;

typedef uint __gid_t;

typedef long __blksize_t;

typedef long __blkcnt_t;

typedef struct timespec timespec, *Ptimespec;

typedef long __time_t;

struct timespec {
    __time_t tv_sec;
    long tv_nsec;
};

struct stat {
    __dev_t st_dev;
    __ino_t st_ino;
    __nlink_t st_nlink;
    __mode_t st_mode;
    __uid_t st_uid;
    __gid_t st_gid;
    int __pad0;
    __dev_t st_rdev;
    __off_t st_size;
    __blksize_t st_blksize;
    __blkcnt_t st_blocks;
    struct timespec st_atim;
    struct timespec st_mtim;
    struct timespec st_ctim;
    long __unused[3];
};

typedef qword __uint64_t;

typedef ulong uLong;

typedef ulong unichar;

typedef long __syscall_slong_t;

typedef uint uInt;

typedef char __int8_t;


// WARNING! conflicting data type names: /DWARF/__off64_t - /types.h/__off64_t

typedef long intptr_t;

typedef ulong __uintmax_t;

typedef long __ssize_t;

typedef sqword __int64_t;

typedef ulong __re_long_size_t;

typedef long __fd_mask;

typedef dword __uint32_t;

typedef ulong reg_syntax_t;

typedef long __intmax_t;

typedef ulong uintptr_t;

typedef uchar __uint8_t;

typedef long __suseconds_t;

typedef sdword __int32_t;

typedef uchar Byte;

typedef word __uint16_t;

typedef sword __int16_t;

typedef int regoff_t;

typedef struct type_tbl_s type_tbl_s, *Ptype_tbl_s;

struct type_tbl_s {
    char name[16];
    size_t len;
    int type;
    int format;
};

typedef struct magic_entry magic_entry, *Pmagic_entry;

typedef struct magic magic, *Pmagic;

typedef __uint32_t uint32_t;

typedef __uint16_t uint16_t;

typedef __uint8_t uint8_t;

typedef __int32_t int32_t;

typedef union anon_union_8_2_893d9308_for__u anon_union_8_2_893d9308_for__u, *Panon_union_8_2_893d9308_for__u;

typedef union VALUETYPE VALUETYPE, *PVALUETYPE;

typedef __uint64_t uint64_t;

typedef struct anon_struct_8_2_bca1fa95_for__s anon_struct_8_2_bca1fa95_for__s, *Panon_struct_8_2_bca1fa95_for__s;

struct magic_entry {
    struct magic *mp;
    uint32_t cont_count;
    uint32_t max_count;
};

union VALUETYPE {
    uint8_t b;
    uint16_t h;
    uint32_t l;
    uint64_t q;
    uint8_t hs[2];
    uint8_t hl[4];
    uint8_t hq[8];
    char s[96];
    uchar us[96];
    float f;
    double d;
};

struct anon_struct_8_2_bca1fa95_for__s {
    uint32_t _count;
    uint32_t _flags;
};

union anon_union_8_2_893d9308_for__u {
    uint64_t _mask;
    struct anon_struct_8_2_bca1fa95_for__s _s;
};

struct magic {
    uint16_t cont_level;
    uint8_t flag;
    uint8_t factor;
    uint8_t reln;
    uint8_t vallen;
    uint8_t type;
    uint8_t in_type;
    uint8_t in_op;
    uint8_t mask_op;
    uint8_t cond;
    uint8_t factor_op;
    uint32_t offset;
    int32_t in_offset;
    uint32_t lineno;
    union anon_union_8_2_893d9308_for__u _u;
    union VALUETYPE value;
    char desc[64];
    char mimetype[80];
    char apple[8];
    char ext[64];
};

typedef struct anon_struct_24_3_b56a9d0a anon_struct_24_3_b56a9d0a, *Panon_struct_24_3_b56a9d0a;

typedef struct magic_set magic_set, *Pmagic_set;

typedef struct mlist mlist, *Pmlist;

typedef struct cont cont, *Pcont;

typedef struct out out, *Pout;

typedef struct anon_struct_32_4_73460ab5_for_search anon_struct_32_4_73460ab5_for_search, *Panon_struct_32_4_73460ab5_for_search;

typedef struct level_info level_info, *Plevel_info;

struct anon_struct_24_3_b56a9d0a {
    char *name;
    size_t len;
    int (*fun)(struct magic_set *, struct magic_entry *, char *);
};

struct out {
    char *buf;
    char *pbuf;
};

struct anon_struct_32_4_73460ab5_for_search {
    char *s;
    size_t s_len;
    size_t offset;
    size_t rm_len;
};

struct cont {
    size_t len;
    struct level_info *li;
};

struct magic_set {
    struct mlist *mlist[2];
    struct cont c;
    struct out o;
    uint32_t offset;
    int error;
    int flags;
    int event_flags;
    char *file;
    size_t line;
    struct anon_struct_32_4_73460ab5_for_search search;
    union VALUETYPE ms_value;
    uint16_t indir_max;
    uint16_t name_max;
    uint16_t elf_shnum_max;
    uint16_t elf_phnum_max;
    uint16_t elf_notes_max;
    uint16_t regex_max;
    size_t bytes_max;
};

struct mlist {
    struct magic *magic;
    uint32_t nmagic;
    void *map;
    struct mlist *next;
    struct mlist *prev;
};

struct level_info {
    int32_t off;
    int got_match;
    int last_match;
    int last_cond;
};

typedef struct magic_map magic_map, *Pmagic_map;

struct magic_map {
    void *p;
    size_t len;
    int type;
    struct magic *magic[2];
    uint32_t nmagic[2];
};

typedef struct magic_entry_set magic_entry_set, *Pmagic_entry_set;

struct magic_entry_set {
    struct magic_entry *me;
    uint32_t count;
    uint32_t max;
};

typedef union anon_union_344_2_947300e6 anon_union_344_2_947300e6, *Panon_union_344_2_947300e6;

union anon_union_344_2_947300e6 {
    struct magic m;
    uint32_t h[4];
};

typedef struct cond_tbl_s cond_tbl_s, *Pcond_tbl_s;

struct cond_tbl_s {
    char name[8];
    size_t len;
    int cond;
};


// WARNING! conflicting data type names: /DWARF/stat.h/stat - /stat.h/stat

typedef struct __locale_struct __locale_struct, *P__locale_struct;

typedef struct __locale_struct *__locale_t;

typedef __locale_t locale_t;

typedef struct __locale_data __locale_data, *P__locale_data;

struct __locale_data {
};

struct __locale_struct {
    struct __locale_data *__locales[13];
    ushort *__ctype_b;
    int *__ctype_tolower;
    int *__ctype_toupper;
    char *__names[13];
};


// WARNING! conflicting data type names: /DWARF/struct_timespec.h/timespec - /time.h/timespec

typedef struct cap_desc cap_desc, *Pcap_desc;

typedef struct cap_desc cap_desc_t;

struct cap_desc {
    uint64_t cd_mask;
    char *cd_name;
};

typedef union anon_union_4_2_9473004a anon_union_4_2_9473004a, *Panon_union_4_2_9473004a;

union anon_union_4_2_9473004a {
    int32_t l;
    char c[4];
};

typedef union anon_union_2_2_7f9ecf90 anon_union_2_2_7f9ecf90, *Panon_union_2_2_7f9ecf90;

union anon_union_2_2_7f9ecf90 {
    uint16_t ui;
    char c[2];
};

typedef union anon_union_8_2_7f9ecf90 anon_union_8_2_7f9ecf90, *Panon_union_8_2_7f9ecf90;

union anon_union_8_2_7f9ecf90 {
    uint64_t ui;
    char c[8];
};

typedef union anon_union_4_2_7f9ecf90 anon_union_4_2_7f9ecf90, *Panon_union_4_2_7f9ecf90;

union anon_union_4_2_7f9ecf90 {
    uint32_t ui;
    char c[4];
};

typedef struct header header, *Pheader;

struct header {
    char name[100];
    char mode[8];
    char uid[8];
    char gid[8];
    char size[12];
    char mtime[12];
    char chksum[8];
    char linkflag;
    char linkname[100];
    char magic[8];
    char uname[32];
    char gname[32];
    char devmajor[8];
    char devminor[8];
};

typedef union record record, *Precord;

union record {
    uchar charptr[512];
    struct header header;
};

typedef __time_t time_t;

typedef struct tm tm, *Ptm;

struct tm {
    int tm_sec;
    int tm_min;
    int tm_hour;
    int tm_mday;
    int tm_mon;
    int tm_year;
    int tm_wday;
    int tm_yday;
    int tm_isdst;
    long tm_gmtoff;
    char *tm_zone;
};

typedef enum anon_enum_32 {
    _REG_ENOSYS=-1,
    _REG_NOERROR=0,
    _ISblank=1,
    _REG_NOMATCH=1,
    _IScntrl=2,
    _REG_BADPAT=2,
    _REG_ECOLLATE=3,
    _ISpunct=4,
    _REG_ECTYPE=4,
    _REG_EESCAPE=5,
    _REG_ESUBREG=6,
    _REG_EBRACK=7,
    _ISalnum=8,
    _REG_EPAREN=8,
    _REG_EBRACE=9,
    _REG_BADBR=10,
    _REG_ERANGE=11,
    _REG_ESPACE=12,
    _REG_BADRPT=13,
    _REG_EEND=14,
    _REG_ESIZE=15,
    _REG_ERPAREN=16,
    _ISupper=256,
    _ISlower=512,
    _ISalpha=1024,
    _ISdigit=2048,
    _ISxdigit=4096,
    _ISspace=8192,
    _ISprint=16384,
    _ISgraph=32768
} anon_enum_32;

typedef struct __mbstate_t __mbstate_t, *P__mbstate_t;

typedef union anon_union_4_2_91654ee9_for___value anon_union_4_2_91654ee9_for___value, *Panon_union_4_2_91654ee9_for___value;

union anon_union_4_2_91654ee9_for___value {
    uint __wch;
    char __wchb[4];
};

struct __mbstate_t {
    int __count;
    union anon_union_4_2_91654ee9_for___value __value;
};

typedef __off_t off_t;

typedef struct __va_list_tag __va_list_tag, *P__va_list_tag;

struct __va_list_tag {
    uint gp_offset;
    uint fp_offset;
    void *overflow_arg_area;
    void *reg_save_area;
};

typedef struct __va_list_tag __builtin_va_list[1];

typedef __builtin_va_list __gnuc_va_list;

typedef __gnuc_va_list va_list;

typedef __ssize_t ssize_t;

typedef void *voidpf;

typedef voidpf (*alloc_func)(voidpf, uInt, uInt);

typedef struct z_stream_s z_stream_s, *Pz_stream_s;

typedef struct z_stream_s z_stream;

typedef Byte Bytef;

typedef struct internal_state internal_state, *Pinternal_state;

typedef void (*free_func)(voidpf, voidpf);

struct internal_state {
};

struct z_stream_s {
    Bytef *next_in;
    uInt avail_in;
    uLong total_in;
    Bytef *next_out;
    uInt avail_out;
    uLong total_out;
    char *msg;
    struct internal_state *state;
    alloc_func zalloc;
    free_func zfree;
    voidpf opaque;
    int data_type;
    uLong adler;
    uLong reserved;
};

typedef struct __dirstream __dirstream, *P__dirstream;

typedef struct __dirstream DIR;

struct __dirstream {
};

typedef struct dirent dirent, *Pdirent;

struct dirent {
    __ino_t d_ino;
    __off_t d_off;
    ushort d_reclen;
    uchar d_type;
    char d_name[256];
};

typedef struct nv nv, *Pnv;

struct nv {
    char *pattern;
    char *mime;
};

typedef struct sinfo sinfo, *Psinfo;

struct sinfo {
    char *name;
    char *mime;
    char *sections[5];
    int types[5];
};

typedef struct cv cv, *Pcv;

struct cv {
    uint64_t clsid[2];
    char *mime;
};

typedef struct timeval timeval, *Ptimeval;

struct timeval {
    __time_t tv_sec;
    __suseconds_t tv_usec;
};


// WARNING! conflicting data type names: /DWARF/_UNCATEGORIZED_/_IO_marker - /libio.h/_IO_marker

typedef struct re_dfa_t re_dfa_t, *Pre_dfa_t;

struct re_dfa_t {
};

typedef struct _IO_codecvt _IO_codecvt, *P_IO_codecvt;

struct _IO_codecvt {
};

typedef struct _IO_wide_data _IO_wide_data, *P_IO_wide_data;

struct _IO_wide_data {
};

typedef struct __mbstate_t mbstate_t;

typedef __mode_t mode_t;


// WARNING! conflicting data type names: /DWARF/struct_FILE.h/_IO_FILE - /stdio.h/_IO_FILE

typedef struct _IO_FILE FILE;

typedef struct anon_struct_24_3_ca1d61b4 anon_struct_24_3_ca1d61b4, *Panon_struct_24_3_ca1d61b4;

struct anon_struct_24_3_ca1d61b4 {
    void *magic;
    size_t maglen;
    char **argv;
};

typedef uint8_t Elf32_Char;

typedef uint8_t Elf64_Char;

typedef uint32_t Elf32_Off;

typedef struct Elf64_Shdr Elf64_Shdr, *PElf64_Shdr;

typedef uint32_t Elf64_Word;

typedef uint64_t Elf64_Off;

typedef uint64_t Elf64_Addr;

struct Elf64_Shdr {
    Elf64_Word sh_name;
    Elf64_Word sh_type;
    Elf64_Off sh_flags;
    Elf64_Addr sh_addr;
    Elf64_Off sh_offset;
    Elf64_Off sh_size;
    Elf64_Word sh_link;
    Elf64_Word sh_info;
    Elf64_Off sh_addralign;
    Elf64_Off sh_entsize;
};

typedef struct Elf32_Phdr Elf32_Phdr, *PElf32_Phdr;

typedef uint32_t Elf32_Word;

typedef uint32_t Elf32_Addr;

struct Elf32_Phdr {
    Elf32_Word p_type;
    Elf32_Off p_offset;
    Elf32_Addr p_vaddr;
    Elf32_Addr p_paddr;
    Elf32_Word p_filesz;
    Elf32_Word p_memsz;
    Elf32_Word p_flags;
    Elf32_Word p_align;
};

typedef struct Elf64_Ehdr Elf64_Ehdr, *PElf64_Ehdr;

typedef uint16_t Elf64_Half;

struct Elf64_Ehdr {
    Elf64_Char e_ident[16];
    Elf64_Half e_type;
    Elf64_Half e_machine;
    Elf64_Word e_version;
    Elf64_Addr e_entry;
    Elf64_Off e_phoff;
    Elf64_Off e_shoff;
    Elf64_Word e_flags;
    Elf64_Half e_ehsize;
    Elf64_Half e_phentsize;
    Elf64_Half e_phnum;
    Elf64_Half e_shentsize;
    Elf64_Half e_shnum;
    Elf64_Half e_shstrndx;
};

typedef struct elf_note elf_note, *Pelf_note;

typedef struct elf_note Elf32_Nhdr;

struct elf_note {
    Elf32_Word n_namesz;
    Elf32_Word n_descsz;
    Elf32_Word n_type;
};

typedef struct Elf64_Nhdr Elf64_Nhdr, *PElf64_Nhdr;

struct Elf64_Nhdr {
    Elf64_Word n_namesz;
    Elf64_Word n_descsz;
    Elf64_Word n_type;
};

typedef struct Elf64_Phdr Elf64_Phdr, *PElf64_Phdr;

typedef uint64_t Elf64_Xword;

struct Elf64_Phdr {
    Elf64_Word p_type;
    Elf64_Word p_flags;
    Elf64_Off p_offset;
    Elf64_Addr p_vaddr;
    Elf64_Addr p_paddr;
    Elf64_Xword p_filesz;
    Elf64_Xword p_memsz;
    Elf64_Xword p_align;
};

typedef struct Aux64Info Aux64Info, *PAux64Info;

struct Aux64Info {
    Elf64_Xword a_type;
    Elf64_Xword a_v;
};

typedef struct Elf64_Cap Elf64_Cap, *PElf64_Cap;

typedef union anon_union_8_2_f73d1a54_for_c_un anon_union_8_2_f73d1a54_for_c_un, *Panon_union_8_2_f73d1a54_for_c_un;

union anon_union_8_2_f73d1a54_for_c_un {
    Elf64_Xword c_val;
    Elf64_Addr c_ptr;
};

struct Elf64_Cap {
    Elf64_Xword c_tag;
    union anon_union_8_2_f73d1a54_for_c_un c_un;
};

typedef struct Elf32_Shdr Elf32_Shdr, *PElf32_Shdr;

struct Elf32_Shdr {
    Elf32_Word sh_name;
    Elf32_Word sh_type;
    Elf32_Word sh_flags;
    Elf32_Addr sh_addr;
    Elf32_Off sh_offset;
    Elf32_Word sh_size;
    Elf32_Word sh_link;
    Elf32_Word sh_info;
    Elf32_Word sh_addralign;
    Elf32_Word sh_entsize;
};

typedef struct Aux32Info Aux32Info, *PAux32Info;

struct Aux32Info {
    Elf32_Word a_type;
    Elf32_Word a_v;
};

typedef struct Elf32_Cap Elf32_Cap, *PElf32_Cap;

typedef union anon_union_4_2_f73d1a54_for_c_un anon_union_4_2_f73d1a54_for_c_un, *Panon_union_4_2_f73d1a54_for_c_un;

union anon_union_4_2_f73d1a54_for_c_un {
    Elf32_Word c_val;
    Elf32_Addr c_ptr;
};

struct Elf32_Cap {
    Elf32_Word c_tag;
    union anon_union_4_2_f73d1a54_for_c_un c_un;
};

typedef uint16_t Elf32_Half;

typedef struct Elf32_Ehdr Elf32_Ehdr, *PElf32_Ehdr;

struct Elf32_Ehdr {
    Elf32_Char e_ident[16];
    Elf32_Half e_type;
    Elf32_Half e_machine;
    Elf32_Word e_version;
    Elf32_Addr e_entry;
    Elf32_Off e_phoff;
    Elf32_Off e_shoff;
    Elf32_Word e_flags;
    Elf32_Half e_ehsize;
    Elf32_Half e_phentsize;
    Elf32_Half e_phnum;
    Elf32_Half e_shentsize;
    Elf32_Half e_shnum;
    Elf32_Half e_shstrndx;
};

typedef struct fd_set fd_set, *Pfd_set;

struct fd_set {
    __fd_mask fds_bits[16];
};

typedef __int16_t int16_t;

typedef __int64_t int64_t;

typedef __int8_t int8_t;

typedef void (*__sighandler_t)(int);

typedef __sighandler_t sig_t;

typedef struct anon_struct_16_2_947320a1 anon_struct_16_2_947320a1, *Panon_struct_16_2_947320a1;

struct anon_struct_16_2_947320a1 {
    uint32_t v;
    char *n;
};

typedef union anon_union_4_2_94730243 anon_union_4_2_94730243, *Panon_union_4_2_94730243;

union anon_union_4_2_94730243 {
    char s[4];
    uint32_t u;
};

typedef struct re_pattern_buffer re_pattern_buffer, *Pre_pattern_buffer;

struct re_pattern_buffer {
    struct re_dfa_t *buffer;
    __re_long_size_t allocated;
    __re_long_size_t used;
    reg_syntax_t syntax;
    char *fastmap;
    uchar *translate;
    size_t re_nsub;
    uint can_be_null:1;
    uint regs_allocated:2;
    uint fastmap_accurate:1;
    uint no_sub:1;
    uint not_bol:1;
    uint not_eol:1;
    uint newline_anchor:1;
};

typedef struct regmatch_t regmatch_t, *Pregmatch_t;

struct regmatch_t {
    regoff_t rm_so;
    regoff_t rm_eo;
};

typedef struct re_pattern_buffer regex_t;

typedef struct cdf_property_info_t cdf_property_info_t, *Pcdf_property_info_t;

typedef union anon_union_16_10_0598ddce_for_pi_val anon_union_16_10_0598ddce_for_pi_val, *Panon_union_16_10_0598ddce_for_pi_val;

typedef int64_t cdf_timestamp_t;

typedef struct anon_struct_16_2_ba9ba367_for__pi_str anon_struct_16_2_ba9ba367_for__pi_str, *Panon_struct_16_2_ba9ba367_for__pi_str;

struct anon_struct_16_2_ba9ba367_for__pi_str {
    uint32_t s_len;
    char *s_buf;
};

union anon_union_16_10_0598ddce_for_pi_val {
    uint16_t _pi_u16;
    int16_t _pi_s16;
    uint32_t _pi_u32;
    int32_t _pi_s32;
    uint64_t _pi_u64;
    int64_t _pi_s64;
    cdf_timestamp_t _pi_tp;
    float _pi_f;
    double _pi_d;
    struct anon_struct_16_2_ba9ba367_for__pi_str _pi_str;
};

struct cdf_property_info_t {
    uint32_t pi_id;
    uint32_t pi_type;
    union anon_union_16_10_0598ddce_for_pi_val pi_val;
};

typedef struct cdf_sat_t cdf_sat_t, *Pcdf_sat_t;

typedef int32_t cdf_secid_t;

struct cdf_sat_t {
    cdf_secid_t *sat_tab;
    size_t sat_len;
};

typedef struct cdf_info_t cdf_info_t, *Pcdf_info_t;

struct cdf_info_t {
    int i_fd;
    uchar *i_buf;
    size_t i_len;
};

typedef struct cdf_directory_t cdf_directory_t, *Pcdf_directory_t;

typedef int32_t cdf_dirid_t;

struct cdf_directory_t {
    uint16_t d_name[32];
    uint16_t d_namelen;
    uint8_t d_type;
    uint8_t d_color;
    cdf_dirid_t d_left_child;
    cdf_dirid_t d_right_child;
    cdf_dirid_t d_storage;
    uint64_t d_storage_uuid[2];
    uint32_t d_flags;
    cdf_timestamp_t d_created;
    cdf_timestamp_t d_modified;
    cdf_secid_t d_stream_first_sector;
    uint32_t d_size;
    uint32_t d_unused0;
};

typedef struct cdf_classid_t cdf_classid_t, *Pcdf_classid_t;

struct cdf_classid_t {
    uint32_t cl_dword;
    uint16_t cl_word[2];
    uint8_t cl_two[2];
    uint8_t cl_six[6];
};

typedef struct cdf_catalog_t cdf_catalog_t, *Pcdf_catalog_t;

typedef struct cdf_catalog_entry_t cdf_catalog_entry_t, *Pcdf_catalog_entry_t;

struct cdf_catalog_entry_t {
    uint16_t ce_namlen;
    uint32_t ce_num;
    uint64_t ce_timestamp;
    uint16_t ce_name[256];
};

struct cdf_catalog_t {
    size_t cat_num;
    struct cdf_catalog_entry_t cat_e[1];
};

typedef struct cdf_summary_info_header_t cdf_summary_info_header_t, *Pcdf_summary_info_header_t;

struct cdf_summary_info_header_t {
    uint16_t si_byte_order;
    uint16_t si_zero;
    uint16_t si_os_version;
    uint16_t si_os;
    struct cdf_classid_t si_class;
    uint32_t si_count;
};

typedef struct cdf_section_declaration_t cdf_section_declaration_t, *Pcdf_section_declaration_t;

struct cdf_section_declaration_t {
    struct cdf_classid_t sd_class;
    uint32_t sd_offset;
};

typedef struct cdf_header_t cdf_header_t, *Pcdf_header_t;

struct cdf_header_t {
    uint64_t h_magic;
    uint64_t h_uuid[2];
    uint16_t h_revision;
    uint16_t h_version;
    uint16_t h_byte_order;
    uint16_t h_sec_size_p2;
    uint16_t h_short_sec_size_p2;
    uint8_t h_unused0[10];
    uint32_t h_num_sectors_in_sat;
    uint32_t h_secid_first_directory;
    uint8_t h_unused1[4];
    uint32_t h_min_size_standard_stream;
    cdf_secid_t h_secid_first_sector_in_short_sat;
    uint32_t h_num_sectors_in_short_sat;
    cdf_secid_t h_secid_first_sector_in_master_sat;
    uint32_t h_num_sectors_in_master_sat;
    cdf_secid_t h_master_sat[109];
};

typedef struct cdf_dir_t cdf_dir_t, *Pcdf_dir_t;

struct cdf_dir_t {
    struct cdf_directory_t *dir_tab;
    size_t dir_len;
};

typedef struct cdf_section_header_t cdf_section_header_t, *Pcdf_section_header_t;

struct cdf_section_header_t {
    uint32_t sh_len;
    uint32_t sh_properties;
};

typedef struct cdf_stream_t cdf_stream_t, *Pcdf_stream_t;

struct cdf_stream_t {
    void *sst_tab;
    size_t sst_len;
    size_t sst_dirlen;
    size_t sst_ss;
};

typedef enum __e_fmtcheck_types {
    FMTCHECK_START=0,
    FMTCHECK_SHORT=1,
    FMTCHECK_INT=2,
    FMTCHECK_LONG=3,
    FMTCHECK_QUAD=4,
    FMTCHECK_SHORTPOINTER=5,
    FMTCHECK_INTPOINTER=6,
    FMTCHECK_LONGPOINTER=7,
    FMTCHECK_QUADPOINTER=8,
    FMTCHECK_DOUBLE=9,
    FMTCHECK_LONGDOUBLE=10,
    FMTCHECK_STRING=11,
    FMTCHECK_WIDTH=12,
    FMTCHECK_PRECISION=13,
    FMTCHECK_DONE=14,
    FMTCHECK_UNKNOWN=15
} __e_fmtcheck_types;

typedef enum __e_fmtcheck_types EFT;

typedef struct file_regex_t file_regex_t, *Pfile_regex_t;

struct file_regex_t {
    char *pat;
    locale_t old_lc_ctype;
    locale_t c_lc_ctype;
    int rc;
    regex_t rx;
};

typedef struct file_pushbuf_t file_pushbuf_t, *Pfile_pushbuf_t;

struct file_pushbuf_t {
    char *buf;
    uint32_t offset;
};

typedef __uintmax_t uintmax_t;

typedef __intmax_t intmax_t;


// WARNING! conflicting data type names: /stdio.h/FILE - /DWARF/FILE.h/FILE


// WARNING! conflicting data type names: /xlocale.h/__locale_data - /DWARF/_UNCATEGORIZED_/__locale_data


// WARNING! conflicting data type names: /xlocale.h/__locale_struct - /DWARF/__locale_t.h/__locale_struct


// WARNING! conflicting data type names: /xlocale.h/__locale_t - /DWARF/__locale_t.h/__locale_t

typedef uint wint_t;

typedef int __pid_t;


// WARNING! conflicting data type names: /types.h/__int32_t - /DWARF/__int32_t


// WARNING! conflicting data type names: /signal.h/__sighandler_t - /DWARF/signal.h/__sighandler_t

typedef struct evp_pkey_ctx_st evp_pkey_ctx_st, *Pevp_pkey_ctx_st;

struct evp_pkey_ctx_st {
};

typedef struct evp_pkey_ctx_st EVP_PKEY_CTX;


// WARNING! conflicting data type names: /dirent.h/__dirstream - /DWARF/_UNCATEGORIZED_/__dirstream


// WARNING! conflicting data type names: /dirent.h/DIR - /DWARF/dirent.h/DIR


// WARNING! conflicting data type names: /regex.h/re_pattern_buffer - /DWARF/regex.h/re_pattern_buffer


// WARNING! conflicting data type names: /regex.h/regex_t - /DWARF/regex.h/regex_t

typedef union _union_27 _union_27, *P_union_27;

union _union_27 {
    uint __wch;
    char __wchb[4];
};

typedef int (*__compar_fn_t)(void *, void *);

typedef struct Elf64_Rela Elf64_Rela, *PElf64_Rela;

struct Elf64_Rela {
    qword r_offset; // location to apply the relocation action
    qword r_info; // the symbol table index and the type of relocation
    qword r_addend; // a constant addend used to compute the relocatable field value
};

typedef enum Elf_ProgramHeaderType {
    PT_NULL=0,
    PT_LOAD=1,
    PT_DYNAMIC=2,
    PT_INTERP=3,
    PT_NOTE=4,
    PT_SHLIB=5,
    PT_PHDR=6,
    PT_TLS=7,
    PT_GNU_EH_FRAME=1685382480,
    PT_GNU_STACK=1685382481,
    PT_GNU_RELRO=1685382482
} Elf_ProgramHeaderType;

typedef struct Elf64_Dyn Elf64_Dyn, *PElf64_Dyn;

typedef enum Elf64_DynTag {
    DT_NULL=0,
    DT_NEEDED=1,
    DT_PLTRELSZ=2,
    DT_PLTGOT=3,
    DT_HASH=4,
    DT_STRTAB=5,
    DT_SYMTAB=6,
    DT_RELA=7,
    DT_RELASZ=8,
    DT_RELAENT=9,
    DT_STRSZ=10,
    DT_SYMENT=11,
    DT_INIT=12,
    DT_FINI=13,
    DT_SONAME=14,
    DT_RPATH=15,
    DT_SYMBOLIC=16,
    DT_REL=17,
    DT_RELSZ=18,
    DT_RELENT=19,
    DT_PLTREL=20,
    DT_DEBUG=21,
    DT_TEXTREL=22,
    DT_JMPREL=23,
    DT_BIND_NOW=24,
    DT_INIT_ARRAY=25,
    DT_FINI_ARRAY=26,
    DT_INIT_ARRAYSZ=27,
    DT_FINI_ARRAYSZ=28,
    DT_RUNPATH=29,
    DT_FLAGS=30,
    DT_PREINIT_ARRAY=32,
    DT_PREINIT_ARRAYSZ=33,
    DT_RELRSZ=35,
    DT_RELR=36,
    DT_RELRENT=37,
    DT_ANDROID_REL=1610612751,
    DT_ANDROID_RELSZ=1610612752,
    DT_ANDROID_RELA=1610612753,
    DT_ANDROID_RELASZ=1610612754,
    DT_ANDROID_RELR=1879040000,
    DT_ANDROID_RELRSZ=1879040001,
    DT_ANDROID_RELRENT=1879040003,
    DT_GNU_PRELINKED=1879047669,
    DT_GNU_CONFLICTSZ=1879047670,
    DT_GNU_LIBLISTSZ=1879047671,
    DT_CHECKSUM=1879047672,
    DT_PLTPADSZ=1879047673,
    DT_MOVEENT=1879047674,
    DT_MOVESZ=1879047675,
    DT_FEATURE_1=1879047676,
    DT_POSFLAG_1=1879047677,
    DT_SYMINSZ=1879047678,
    DT_SYMINENT=1879047679,
    DT_GNU_XHASH=1879047924,
    DT_GNU_HASH=1879047925,
    DT_TLSDESC_PLT=1879047926,
    DT_TLSDESC_GOT=1879047927,
    DT_GNU_CONFLICT=1879047928,
    DT_GNU_LIBLIST=1879047929,
    DT_CONFIG=1879047930,
    DT_DEPAUDIT=1879047931,
    DT_AUDIT=1879047932,
    DT_PLTPAD=1879047933,
    DT_MOVETAB=1879047934,
    DT_SYMINFO=1879047935,
    DT_VERSYM=1879048176,
    DT_RELACOUNT=1879048185,
    DT_RELCOUNT=1879048186,
    DT_FLAGS_1=1879048187,
    DT_VERDEF=1879048188,
    DT_VERDEFNUM=1879048189,
    DT_VERNEED=1879048190,
    DT_VERNEEDNUM=1879048191,
    DT_AUXILIARY=2147483645,
    DT_FILTER=2147483647
} Elf64_DynTag;

struct Elf64_Dyn {
    enum Elf64_DynTag d_tag;
    qword d_val;
};


// WARNING! conflicting data type names: /ELF/Elf64_Shdr - /DWARF/readelf.h/Elf64_Shdr

typedef struct GnuBuildId GnuBuildId, *PGnuBuildId;

struct GnuBuildId {
    dword namesz; // Length of name field
    dword descsz; // Length of description field
    dword type; // Vendor specific type
    char name[4]; // Vendor name
    byte hash[20];
};

typedef struct NoteGnuProperty_4 NoteGnuProperty_4, *PNoteGnuProperty_4;

struct NoteGnuProperty_4 {
    dword namesz; // Length of name field
    dword descsz; // Length of description field
    dword type; // Vendor specific type
    char name[4]; // Vendor name
};


// WARNING! conflicting data type names: /ELF/Elf64_Ehdr - /DWARF/readelf.h/Elf64_Ehdr


// WARNING! conflicting data type names: /ELF/Elf64_Phdr - /DWARF/readelf.h/Elf64_Phdr

typedef struct Elf64_Sym Elf64_Sym, *PElf64_Sym;

struct Elf64_Sym {
    dword st_name;
    byte st_info;
    byte st_other;
    word st_shndx;
    qword st_value;
    qword st_size;
};

typedef enum Elf_SectionHeaderType {
    SHT_NULL=0,
    SHT_PROGBITS=1,
    SHT_SYMTAB=2,
    SHT_STRTAB=3,
    SHT_RELA=4,
    SHT_HASH=5,
    SHT_DYNAMIC=6,
    SHT_NOTE=7,
    SHT_NOBITS=8,
    SHT_REL=9,
    SHT_SHLIB=10,
    SHT_DYNSYM=11,
    SHT_INIT_ARRAY=14,
    SHT_FINI_ARRAY=15,
    SHT_PREINIT_ARRAY=16,
    SHT_GROUP=17,
    SHT_SYMTAB_SHNDX=18,
    SHT_ANDROID_REL=1610612737,
    SHT_ANDROID_RELA=1610612738,
    SHT_GNU_ATTRIBUTES=1879048181,
    SHT_GNU_HASH=1879048182,
    SHT_GNU_LIBLIST=1879048183,
    SHT_CHECKSUM=1879048184,
    SHT_SUNW_move=1879048186,
    SHT_SUNW_COMDAT=1879048187,
    SHT_SUNW_syminfo=1879048188,
    SHT_GNU_verdef=1879048189,
    SHT_GNU_verneed=1879048190,
    SHT_GNU_versym=1879048191
} Elf_SectionHeaderType;




int _init(EVP_PKEY_CTX *ctx)

{
  int iVar1;
  
  iVar1 = 0x1251e8;
  if (true) {
    iVar1 = __gmon_start__();
  }
  return iVar1;
}



void FUN_00104020(void)

{
  (*(code *)(undefined *)0x0)();
  return;
}



void __cxa_finalize(void)

{
  __cxa_finalize();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__int32_t ** __ctype_toupper_loc(void)

{
  __int32_t **pp_Var1;
  
  pp_Var1 = __ctype_toupper_loc();
  return pp_Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * getenv(char *__name)

{
  char *pcVar1;
  
  pcVar1 = getenv(__name);
  return pcVar1;
}



void __snprintf_chk(void)

{
  __snprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void free(void *__ptr)

{
  free(__ptr);
  return;
}



void __vfprintf_chk(void)

{
  __vfprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void abort(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int * __errno_location(void)

{
  int *piVar1;
  
  piVar1 = __errno_location();
  return piVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int unlink(char *__name)

{
  int iVar1;
  
  iVar1 = unlink(__name);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int strncmp(char *__s1,char *__s2,size_t __n)

{
  int iVar1;
  
  iVar1 = strncmp(__s1,__s2,__n);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

tm * localtime_r(time_t *__timer,tm *__tp)

{
  tm *ptVar1;
  
  ptVar1 = localtime_r(__timer,__tp);
  return ptVar1;
}



void inflate(void)

{
  inflate();
  return;
}



void __read_chk(void)

{
  __read_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int puts(char *__s)

{
  int iVar1;
  
  iVar1 = puts(__s);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void qsort(void *__base,size_t __nmemb,size_t __size,__compar_fn_t __compar)

{
  qsort(__base,__nmemb,__size,__compar);
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

double strtod(char *__nptr,char **__endptr)

{
  double dVar1;
  
  dVar1 = strtod(__nptr,__endptr);
  return dVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ssize_t readlink(char *__path,char *__buf,size_t __len)

{
  ssize_t sVar1;
  
  sVar1 = readlink(__path,__buf,__len);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int fcntl(int __fd,int __cmd,...)

{
  int iVar1;
  
  iVar1 = fcntl(__fd,__cmd);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ssize_t write(int __fd,void *__buf,size_t __n)

{
  ssize_t sVar1;
  
  sVar1 = write(__fd,__buf,__n);
  return sVar1;
}



void __open_2(void)

{
  __open_2();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int fclose(FILE *__stream)

{
  int iVar1;
  
  iVar1 = fclose(__stream);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

DIR * opendir(char *__name)

{
  DIR *pDVar1;
  
  pDVar1 = opendir(__name);
  return pDVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void regfree(regex_t *__preg)

{
  regfree(__preg);
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t strlen(char *__s)

{
  size_t sVar1;
  
  sVar1 = strlen(__s);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int __lxstat(int __ver,char *__filename,stat *__stat_buf)

{
  int iVar1;
  
  iVar1 = __lxstat(__ver,__filename,__stat_buf);
  return iVar1;
}



char * magic_file(magic_set *ms,char *inname)

{
  char *pcVar1;
  
  if (ms == (magic_set *)0x0) {
    return (char *)0x0;
  }
  pcVar1 = file_or_fd(ms,inname,0);
  return pcVar1;
}



void __stack_chk_fail(void)

{
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * mmap(void *__addr,size_t __len,int __prot,int __flags,int __fd,__off_t __offset)

{
  void *pvVar1;
  
  pvVar1 = mmap(__addr,__len,__prot,__flags,__fd,__offset);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void freelocale(__locale_t __dataset)

{
  freelocale(__dataset);
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t mbrtowc(wchar_t *__pwc,char *__s,size_t __n,mbstate_t *__p)

{
  size_t sVar1;
  
  sVar1 = mbrtowc(__pwc,__s,__n,__p);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int dup2(int __fd,int __fd2)

{
  int iVar1;
  
  iVar1 = dup2(__fd,__fd2);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strchr(char *__s,int __c)

{
  char *pcVar1;
  
  pcVar1 = strchr(__s,__c);
  return pcVar1;
}



void zError(void)

{
  zError();
  return;
}



void __fdelt_chk(void)

{
  __fdelt_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__locale_t newlocale(int __category_mask,char *__locale,__locale_t __base)

{
  __locale_t p_Var1;
  
  p_Var1 = newlocale(__category_mask,__locale,__base);
  return p_Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int snprintf(char *__s,size_t __maxlen,char *__format,...)

{
  int iVar1;
  
  iVar1 = snprintf(__s,__maxlen,__format);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strrchr(char *__s,int __c)

{
  char *pcVar1;
  
  pcVar1 = strrchr(__s,__c);
  return pcVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

tm * gmtime_r(time_t *__timer,tm *__tp)

{
  tm *ptVar1;
  
  ptVar1 = gmtime_r(__timer,__tp);
  return ptVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__off_t lseek(int __fd,__off_t __offset,int __whence)

{
  __off_t _Var1;
  
  _Var1 = lseek(__fd,__offset,__whence);
  return _Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void __assert_fail(char *__assertion,char *__file,uint __line,char *__function)

{
                    // WARNING: Subroutine does not return
  __assert_fail(__assertion,__file,__line,__function);
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

float strtof(char *__nptr,char **__endptr)

{
  float fVar1;
  
  fVar1 = strtof(__nptr,__endptr);
  return fVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * memset(void *__s,int __c,size_t __n)

{
  void *pvVar1;
  
  pvVar1 = memset(__s,__c,__n);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int ioctl(int __fd,ulong __request,...)

{
  int iVar1;
  
  iVar1 = ioctl(__fd,__request);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int close(int __fd)

{
  int iVar1;
  
  iVar1 = close(__fd);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int pipe(int *__pipedes)

{
  int iVar1;
  
  iVar1 = pipe(__pipedes);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int closedir(DIR *__dirp)

{
  int iVar1;
  
  iVar1 = closedir(__dirp);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int regcomp(regex_t *__preg,char *__pattern,int __cflags)

{
  int iVar1;
  
  iVar1 = regcomp(__preg,__pattern,__cflags);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int fputc(int __c,FILE *__stream)

{
  int iVar1;
  
  iVar1 = fputc(__c,__stream);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t strcspn(char *__s,char *__reject)

{
  size_t sVar1;
  
  sVar1 = strcspn(__s,__reject);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * memchr(void *__s,int __c,size_t __n)

{
  void *pvVar1;
  
  pvVar1 = memchr(__s,__c,__n);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ssize_t read(int __fd,void *__buf,size_t __nbytes)

{
  ssize_t sVar1;
  
  sVar1 = read(__fd,__buf,__nbytes);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strndup(char *__string,size_t __n)

{
  char *pcVar1;
  
  pcVar1 = strndup(__string,__n);
  return pcVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int memcmp(void *__s1,void *__s2,size_t __n)

{
  int iVar1;
  
  iVar1 = memcmp(__s1,__s2,__n);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ulonglong strtoull(char *__nptr,char **__endptr,int __base)

{
  ulonglong uVar1;
  
  uVar1 = strtoull(__nptr,__endptr,__base);
  return uVar1;
}



void __asprintf_chk(void)

{
  __asprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int utimes(char *__file,timeval *__tvp)

{
  int iVar1;
  
  iVar1 = utimes(__file,__tvp);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * calloc(size_t __nmemb,size_t __size)

{
  void *pvVar1;
  
  pvVar1 = calloc(__nmemb,__size);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__ssize_t __getdelim(char **__lineptr,size_t *__n,int __delimiter,FILE *__stream)

{
  __ssize_t _Var1;
  
  _Var1 = __getdelim(__lineptr,__n,__delimiter,__stream);
  return _Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int strcmp(char *__s1,char *__s2)

{
  int iVar1;
  
  iVar1 = strcmp(__s1,__s2);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__sighandler_t signal(int __sig,__sighandler_t __handler)

{
  __sighandler_t p_Var1;
  
  p_Var1 = signal(__sig,__handler);
  return p_Var1;
}



void __memcpy_chk(void)

{
  __memcpy_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

long strtol(char *__nptr,char **__endptr,int __base)

{
  long lVar1;
  
  lVar1 = strtol(__nptr,__endptr,__base);
  return lVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * memcpy(void *__dest,void *__src,size_t __n)

{
  void *pvVar1;
  
  pvVar1 = memcpy(__dest,__src,__n);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t regerror(int __errcode,regex_t *__preg,char *__errbuf,size_t __errbuf_size)

{
  size_t sVar1;
  
  sVar1 = regerror(__errcode,__preg,__errbuf,__errbuf_size);
  return sVar1;
}



void inflateEnd(void)

{
  inflateEnd();
  return;
}



// WARNING: Unknown calling convention

int magic_setflags(magic_set *ms,int flags)

{
  if (ms == (magic_set *)0x0) {
    return -1;
  }
  ms->flags = flags;
  return 0;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int select(int __nfds,fd_set *__readfds,fd_set *__writefds,fd_set *__exceptfds,timeval *__timeout)

{
  int iVar1;
  
  iVar1 = select(__nfds,__readfds,__writefds,__exceptfds,__timeout);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int __xstat(int __ver,char *__filename,stat *__stat_buf)

{
  int iVar1;
  
  iVar1 = __xstat(__ver,__filename,__stat_buf);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

dirent * readdir(DIR *__dirp)

{
  dirent *pdVar1;
  
  pdVar1 = readdir(__dirp);
  return pdVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__locale_t uselocale(__locale_t __dataset)

{
  __locale_t p_Var1;
  
  p_Var1 = uselocale(__dataset);
  return p_Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * malloc(size_t __size)

{
  void *pvVar1;
  
  pvVar1 = malloc(__size);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int fflush(FILE *__stream)

{
  int iVar1;
  
  iVar1 = fflush(__stream);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * ctime_r(time_t *__timer,char *__buf)

{
  char *pcVar1;
  
  pcVar1 = ctime_r(__timer,__buf);
  return pcVar1;
}



void __vasprintf_chk(void)

{
  __vasprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int __fxstat(int __ver,int __fildes,stat *__stat_buf)

{
  int iVar1;
  
  iVar1 = __fxstat(__ver,__fildes,__stat_buf);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int regexec(regex_t *__preg,char *__string,size_t __nmatch,regmatch_t *__pmatch,int __eflags)

{
  int iVar1;
  
  iVar1 = regexec(__preg,__string,__nmatch,__pmatch,__eflags);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

time_t mktime(tm *__tp)

{
  time_t tVar1;
  
  tVar1 = mktime(__tp);
  return tVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int mkstemp(char *__template)

{
  int iVar1;
  
  iVar1 = mkstemp(__template);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * realloc(void *__ptr,size_t __size)

{
  void *pvVar1;
  
  pvVar1 = realloc(__ptr,__size);
  return pvVar1;
}



char * magic_getpath(char *magicfile,int action)

{
  int iVar1;
  char *pcVar2;
  long in_FS_OFFSET;
  char *pcStack_d0;
  stat sStack_c8;
  long lStack_30;
  
  lStack_30 = *(long *)(in_FS_OFFSET + 0x28);
  if (((magicfile != (char *)0x0) || (magicfile = getenv("MAGIC"), magicfile != (char *)0x0)) ||
     (magicfile = "/usr/local/share/misc/magic", action != 0)) goto LAB_001054ac;
  if (default_magic_6427 != (char *)0x0) {
    free(default_magic_6427);
    default_magic_6427 = (char *)0x0;
  }
  pcVar2 = getenv("HOME");
  if (pcVar2 != (char *)0x0) {
    iVar1 = __asprintf_chk(&pcStack_d0,1,"%s/.magic.mgc",pcVar2);
    if (-1 < iVar1) {
      iVar1 = __xstat(1,pcStack_d0,&sStack_c8);
      if (iVar1 == -1) {
        free(pcStack_d0);
        iVar1 = __asprintf_chk(&pcStack_d0,1,"%s/.magic",pcVar2);
        if (iVar1 < 0) goto LAB_00105668;
        iVar1 = __xstat(1,pcStack_d0,&sStack_c8);
        if (iVar1 != -1) {
          if ((sStack_c8.st_mode & 0xf000) == 0x4000) {
            free(pcStack_d0);
            iVar1 = __asprintf_chk(&pcStack_d0,1,"%s/%s",pcVar2,"/.magic/magic.mgc");
            if (iVar1 < 0) goto LAB_00105668;
            iVar1 = access(pcStack_d0,4);
            if (iVar1 == -1) goto LAB_0010564f;
          }
          goto LAB_00105571;
        }
      }
      else {
LAB_00105571:
        iVar1 = __asprintf_chk(&default_magic_6427,1,"%s:%s",pcStack_d0,
                               "/usr/local/share/misc/magic");
        if (-1 < iVar1) {
          free(pcStack_d0);
          magicfile = default_magic_6427;
          goto LAB_001054ac;
        }
      }
LAB_0010564f:
      default_magic_6427 = (char *)0x0;
      free(pcStack_d0);
    }
  }
LAB_00105668:
  magicfile = "/usr/local/share/misc/magic";
LAB_001054ac:
  if (lStack_30 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return magicfile;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int munmap(void *__addr,size_t __len)

{
  int iVar1;
  
  iVar1 = munmap(__addr,__len);
  return iVar1;
}



void __printf_chk(void)

{
  __printf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * asctime_r(tm *__tp,char *__buf)

{
  char *pcVar1;
  
  pcVar1 = asctime_r(__tp,__buf);
  return pcVar1;
}



void inflateInit_(void)

{
  inflateInit_();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void * memmove(void *__dest,void *__src,size_t __n)

{
  void *pvVar1;
  
  pvVar1 = memmove(__dest,__src,__n);
  return pvVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int mprotect(void *__addr,size_t __len,int __prot)

{
  int iVar1;
  
  iVar1 = mprotect(__addr,__len,__prot);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int open(char *__file,int __oflag,...)

{
  int iVar1;
  
  iVar1 = open(__file,__oflag);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int access(char *__name,int __type)

{
  int iVar1;
  
  iVar1 = access(__name,__type);
  return iVar1;
}



void __pread_chk(void)

{
  __pread_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

FILE * fopen(char *__filename,char *__modes)

{
  FILE *pFVar1;
  
  pFVar1 = fopen(__filename,__modes);
  return pFVar1;
}



void inflateInit2_(void)

{
  inflateInit2_();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strcasestr(char *__haystack,char *__needle)

{
  char *pcVar1;
  
  pcVar1 = strcasestr(__haystack,__needle);
  return pcVar1;
}



void __dprintf_chk(void)

{
  __dprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ulong strtoul(char *__nptr,char **__endptr,int __base)

{
  ulong uVar1;
  
  uVar1 = strtoul(__nptr,__endptr,__base);
  return uVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int execvp(char *__file,char **__argv)

{
  int iVar1;
  
  iVar1 = execvp(__file,__argv);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

ssize_t pread(int __fd,void *__buf,size_t __nbytes,__off_t __offset)

{
  ssize_t sVar1;
  
  sVar1 = pread(__fd,__buf,__nbytes,__offset);
  return sVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void exit(int __status)

{
                    // WARNING: Subroutine does not return
  exit(__status);
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

size_t fwrite(void *__ptr,size_t __size,size_t __n,FILE *__s)

{
  size_t sVar1;
  
  sVar1 = fwrite(__ptr,__size,__n,__s);
  return sVar1;
}



void __fprintf_chk(void)

{
  __fprintf_chk();
  return;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strdup(char *__s)

{
  char *pcVar1;
  
  pcVar1 = strdup(__s);
  return pcVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strerror(int __errnum)

{
  char *pcVar1;
  
  pcVar1 = strerror(__errnum);
  return pcVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

int iswprint(wint_t __wc)

{
  int iVar1;
  
  iVar1 = iswprint(__wc);
  return iVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__pid_t wait(void *__stat_loc)

{
  __pid_t _Var1;
  
  _Var1 = wait(__stat_loc);
  return _Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__pid_t fork(void)

{
  __pid_t _Var1;
  
  _Var1 = fork();
  return _Var1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

char * strstr(char *__haystack,char *__needle)

{
  char *pcVar1;
  
  pcVar1 = strstr(__haystack,__needle);
  return pcVar1;
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

__int32_t ** __ctype_tolower_loc(void)

{
  __int32_t **pp_Var1;
  
  pp_Var1 = __ctype_tolower_loc();
  return pp_Var1;
}



void FUN_00104d70(void)

{
  __ctype_b_loc();
  return;
}



void processEntry apprentice_unmap_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void apprentice_magic_strength_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void abort(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



void file_pstring_length_size_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



void load_1_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



void file_pstring_get_length_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void file_zmagic_cold(void)

{
                    // WARNING: Subroutine does not return
  abort();
}



void deregister_tm_clones(void)

{
  if ((false) && (true)) {
    _ITM_deregisterTMCloneTable();
    return;
  }
  return;
}



void register_tm_clones(void)

{
  if ((false) && (true)) {
    _ITM_registerTMCloneTable();
    return;
  }
  return;
}



void __do_global_dtors_aux(void)

{
  if (completed_8061 == '\0') {
    if (true) {
      __cxa_finalize(__dso_handle);
    }
    deregister_tm_clones();
    completed_8061 = 1;
    return;
  }
  return;
}



void frame_dummy(void)

{
  register_tm_clones();
  return;
}



int unreadable_info(magic_set *ms,mode_t md,char *file)

{
  int iVar1;
  wchar_t wVar2;
  
  if (((file == (char *)0x0) ||
      (((iVar1 = access(file,2), iVar1 != 0 ||
        (wVar2 = file_printf(ms,"writable, "), wVar2 != L'\xffffffff')) &&
       ((iVar1 = access(file,1), iVar1 != 0 ||
        (wVar2 = file_printf(ms,"executable, "), wVar2 != L'\xffffffff')))))) &&
     (((md & 0xf000) != 0x8000 || (wVar2 = file_printf(ms,"regular file, "), wVar2 != L'\xffffffff')
      ))) {
    wVar2 = file_printf(ms,"no read permission");
    iVar1 = -(uint)(wVar2 == L'\xffffffff');
  }
  else {
    iVar1 = -1;
  }
  return iVar1;
}



char * file_or_fd(magic_set *ms,char *inname,int fd)

{
  long lVar1;
  undefined auVar2 [16];
  wchar_t wVar3;
  int iVar4;
  int iVar5;
  uint uVar6;
  void *__ptr;
  char *pcVar7;
  ssize_t sVar8;
  wchar_t *pwVar9;
  size_t sVar10;
  ulong uVar11;
  size_t __nbytes;
  undefined8 *puVar12;
  undefined4 uVar13;
  __off_t __offset;
  long in_FS_OFFSET;
  bool bVar14;
  byte bVar15;
  wchar_t *local_108;
  timeval utsbuf [2];
  stat sb;
  
  bVar15 = 0;
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  wVar3 = file_reset(ms);
  if ((wVar3 == L'\xffffffff') || (__ptr = malloc(ms->bytes_max + 0x61), __ptr == (void *)0x0))
  goto LAB_00105010;
  iVar4 = file_fsmagic(ms,inname,&sb);
  if (iVar4 == -1) {
    free(__ptr);
    if ((1 < fd + 1U) && (inname != (char *)0x0)) {
LAB_00104ff7:
      iVar4 = -1;
      close(fd);
      if ((*(byte *)&ms->flags & 0x80) != 0) {
LAB_001051c0:
        utsbuf[0].tv_sec = sb.st_atim.tv_sec;
        utsbuf[1].tv_usec = 0;
        auVar2._8_8_ = 0;
        auVar2._0_8_ = sb.st_mtim.tv_sec;
        utsbuf._8_16_ = auVar2 << 0x40;
        utimes(inname,(timeval *)utsbuf);
LAB_001051f6:
        if (iVar4 == 0) goto LAB_00104fd4;
      }
    }
LAB_00105010:
    pcVar7 = (char *)0x0;
  }
  else {
    if (iVar4 == 0) {
      iVar4 = 0;
      if (inname == (char *)0x0) {
        iVar5 = __fxstat(1,fd,(stat *)&sb);
        if ((iVar5 == 0) && ((sb.st_mode & 0xf000) == 0x1000)) {
          __nbytes = ms->bytes_max;
LAB_0010526d:
          sVar10 = 0;
          while( true ) {
            puVar12 = (undefined8 *)((long)__ptr + sVar10);
            sVar8 = sread(fd,puVar12,__nbytes - sVar10,1);
            if (sVar8 < 1) break;
            sVar10 = sVar10 + sVar8;
            if (sVar8 < 0x1000) {
              puVar12 = (undefined8 *)((long)__ptr + sVar10);
              __offset = -1;
              goto LAB_0010513a;
            }
            __nbytes = ms->bytes_max;
          }
          if ((sVar10 != 0) || (inname == (char *)0x0)) {
            __offset = -1;
LAB_0010513a:
            *puVar12 = 0;
            *(undefined8 *)((long)puVar12 + 0x59) = 0;
            uVar11 = (ulong)(((int)puVar12 -
                             (int)(undefined8 *)((ulong)(puVar12 + 1) & 0xfffffffffffffff8)) + 0x61U
                            >> 3);
            puVar12 = (undefined8 *)((ulong)(puVar12 + 1) & 0xfffffffffffffff8);
            for (; uVar11 != 0; uVar11 = uVar11 - 1) {
              *puVar12 = 0;
              puVar12 = puVar12 + (ulong)bVar15 * -2 + 1;
            }
            wVar3 = file_buffer(ms,fd,inname,__ptr,sVar10);
            if (wVar3 == L'\xffffffff') {
LAB_001053a7:
              free(__ptr);
              if (fd == L'\xffffffff') goto LAB_00105010;
              goto LAB_00105354;
            }
            free(__ptr);
            if (fd == L'\xffffffff') goto LAB_00104fd4;
            goto LAB_0010518b;
          }
          iVar4 = unreadable_info(ms,sb.st_mode,inname);
          iVar4 = -(uint)(iVar4 == -1);
          free(__ptr);
          if (fd != L'\xffffffff') goto LAB_0010519e;
        }
        else {
          __offset = lseek(fd,0,1);
          sVar10 = read(fd,__ptr,ms->bytes_max);
          puVar12 = (undefined8 *)((long)__ptr + sVar10);
          if (sVar10 != 0xffffffffffffffff) goto LAB_0010513a;
          pwVar9 = __errno_location();
          pcVar7 = "/dev/stdin";
          wVar3 = *pwVar9;
          if (fd != 0) {
            file_error(ms,wVar3,"cannot read fd %d",(ulong)(uint)fd);
            goto LAB_001053a7;
          }
LAB_0010533b:
          file_error(ms,wVar3,"cannot read `%s\'",pcVar7);
          free(__ptr);
LAB_00105354:
          iVar4 = -1;
LAB_0010518b:
          if (__offset != -1) {
            lseek(fd,__offset,0);
          }
LAB_0010519e:
          if ((fd != L'\0') && (inname != (char *)0x0)) {
LAB_001051a8:
            close(fd);
            if ((*(byte *)&ms->flags & 0x80) != 0) goto LAB_001051c0;
          }
        }
        goto LAB_001051f6;
      }
      iVar5 = __xstat(1,inname,(stat *)&sb);
      if (iVar5 == 0) {
        bVar14 = (sb.st_mode & 0xf000) == 0x1000;
        uVar13 = 0x800;
        if (!bVar14) {
          uVar13 = 0;
        }
        local_108 = __errno_location();
        *local_108 = L'\0';
        fd = __open_2(inname,uVar13);
        if (L'\xffffffff' < fd) {
          uVar6 = fcntl(fd,3);
          if (uVar6 != 0xffffffff) {
LAB_00105249:
            fcntl(fd,4,(ulong)(uVar6 & 0xfffff7ff));
          }
          __nbytes = ms->bytes_max;
          if (bVar14) goto LAB_0010526d;
LAB_001053c7:
          sVar10 = read(fd,__ptr,__nbytes);
          if (sVar10 == 0xffffffffffffffff) {
            wVar3 = *local_108;
            __offset = -1;
            pcVar7 = inname;
            goto LAB_0010533b;
          }
          puVar12 = (undefined8 *)((long)__ptr + sVar10);
          *puVar12 = 0;
          *(undefined8 *)((long)puVar12 + 0x59) = 0;
          uVar11 = (ulong)(((int)puVar12 -
                           (int)(undefined8 *)((ulong)(puVar12 + 1) & 0xfffffffffffffff8)) + 0x61U
                          >> 3);
          puVar12 = (undefined8 *)((ulong)(puVar12 + 1) & 0xfffffffffffffff8);
          for (; uVar11 != 0; uVar11 = uVar11 - 1) {
            *puVar12 = 0;
            puVar12 = puVar12 + (ulong)bVar15 * -2 + 1;
          }
          wVar3 = file_buffer(ms,fd,inname,__ptr,sVar10);
          if (wVar3 == L'\xffffffff') {
            iVar4 = -1;
            free(__ptr);
            if (fd == L'\0') goto LAB_00105010;
          }
          else {
            free(__ptr);
            if (fd == L'\0') goto LAB_00104fd4;
          }
          goto LAB_001051a8;
        }
        iVar4 = unreadable_info(ms,sb.st_mode,inname);
        if (iVar4 == -1) {
          free(__ptr);
          if (fd != L'\xffffffff') goto LAB_00104ff7;
          goto LAB_00105010;
        }
      }
      else {
        local_108 = __errno_location();
        *local_108 = L'\0';
        fd = __open_2(inname,0);
        if (L'\xffffffff' < fd) {
          uVar6 = fcntl(fd,3);
          if (uVar6 != 0xffffffff) {
            bVar14 = false;
            goto LAB_00105249;
          }
          __nbytes = ms->bytes_max;
          goto LAB_001053c7;
        }
      }
      free(__ptr);
      if (fd != L'\xffffffff') goto LAB_00104fc0;
    }
    else {
      free(__ptr);
      if ((1 < fd + 1U) && (inname != (char *)0x0)) {
LAB_00104fc0:
        iVar4 = 0;
        close(fd);
        if ((*(byte *)&ms->flags & 0x80) != 0) goto LAB_001051c0;
      }
    }
LAB_00104fd4:
    pcVar7 = file_getbuffer(ms);
  }
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return pcVar7;
}



char * magic_getpath(char *magicfile,int action)

{
  long lVar1;
  int iVar2;
  char *pcVar3;
  long in_FS_OFFSET;
  char *hmagicpath;
  stat st;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  if (((magicfile != (char *)0x0) || (magicfile = getenv("MAGIC"), magicfile != (char *)0x0)) ||
     (magicfile = "/usr/local/share/misc/magic", action != 0)) goto LAB_001054ac;
  if (default_magic_6427 != (char *)0x0) {
    free(default_magic_6427);
    default_magic_6427 = (char *)0x0;
  }
  pcVar3 = getenv("HOME");
  if (pcVar3 != (char *)0x0) {
    iVar2 = __asprintf_chk(&hmagicpath,1,"%s/.magic.mgc",pcVar3);
    if (-1 < iVar2) {
      iVar2 = __xstat(1,hmagicpath,(stat *)&st);
      if (iVar2 == -1) {
        free(hmagicpath);
        iVar2 = __asprintf_chk(&hmagicpath,1,"%s/.magic",pcVar3);
        if (iVar2 < 0) goto LAB_00105668;
        iVar2 = __xstat(1,hmagicpath,(stat *)&st);
        if (iVar2 != -1) {
          if ((st.st_mode & 0xf000) == 0x4000) {
            free(hmagicpath);
            iVar2 = __asprintf_chk(&hmagicpath,1,"%s/%s",pcVar3,"/.magic/magic.mgc");
            if (iVar2 < 0) goto LAB_00105668;
            iVar2 = access(hmagicpath,4);
            if (iVar2 == -1) goto LAB_0010564f;
          }
          goto LAB_00105571;
        }
      }
      else {
LAB_00105571:
        iVar2 = __asprintf_chk(&default_magic_6427,1,"%s:%s",hmagicpath,
                               "/usr/local/share/misc/magic");
        if (-1 < iVar2) {
          free(hmagicpath);
          magicfile = default_magic_6427;
          goto LAB_001054ac;
        }
      }
LAB_0010564f:
      default_magic_6427 = (char *)0x0;
      free(hmagicpath);
    }
  }
LAB_00105668:
  magicfile = "/usr/local/share/misc/magic";
LAB_001054ac:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return magicfile;
}



magic_set * magic_open(int flags)

{
  magic_set *pmVar1;
  
  pmVar1 = file_ms_alloc(flags);
  return pmVar1;
}



void magic_close(magic_set *ms)

{
  if (ms != (magic_set *)0x0) {
    file_ms_free(ms);
    return;
  }
  return;
}



int magic_load(magic_set *ms,char *magicfile)

{
  int iVar1;
  
  if (ms != (magic_set *)0x0) {
    iVar1 = file_apprentice(ms,magicfile,0);
    return iVar1;
  }
  return -1;
}



int magic_load_buffers(magic_set *ms,void **bufs,size_t *sizes,size_t nbufs)

{
  int iVar1;
  
  if (ms != (magic_set *)0x0) {
    iVar1 = buffer_apprentice(ms,(magic **)bufs,sizes,nbufs);
    return iVar1;
  }
  return -1;
}



int magic_compile(magic_set *ms,char *magicfile)

{
  int iVar1;
  
  if (ms != (magic_set *)0x0) {
    iVar1 = file_apprentice(ms,magicfile,2);
    return iVar1;
  }
  return -1;
}



int magic_check(magic_set *ms,char *magicfile)

{
  int iVar1;
  
  if (ms != (magic_set *)0x0) {
    iVar1 = file_apprentice(ms,magicfile,1);
    return iVar1;
  }
  return -1;
}



int magic_list(magic_set *ms,char *magicfile)

{
  int iVar1;
  
  if (ms != (magic_set *)0x0) {
    iVar1 = file_apprentice(ms,magicfile,3);
    return iVar1;
  }
  return -1;
}



char * magic_descriptor(magic_set *ms,int fd)

{
  char *pcVar1;
  
  if (ms != (magic_set *)0x0) {
    pcVar1 = file_or_fd(ms,(char *)0x0,fd);
    return pcVar1;
  }
  return (char *)0x0;
}



char * magic_file(magic_set *ms,char *inname)

{
  char *pcVar1;
  
  if (ms != (magic_set *)0x0) {
    pcVar1 = file_or_fd(ms,inname,0);
    return pcVar1;
  }
  return (char *)0x0;
}



char * magic_buffer(magic_set *ms,void *buf,size_t nb)

{
  wchar_t wVar1;
  char *pcVar2;
  
  if (ms == (magic_set *)0x0) {
    return (char *)0x0;
  }
  wVar1 = file_reset(ms);
  if (wVar1 != L'\xffffffff') {
    wVar1 = file_buffer(ms,L'\xffffffff',(char *)0x0,buf,nb);
    if (wVar1 != L'\xffffffff') {
      pcVar2 = file_getbuffer(ms);
      return pcVar2;
    }
  }
  return (char *)0x0;
}



// WARNING: Unknown calling convention

char * magic_error(magic_set *ms)

{
  char *pcVar1;
  
  pcVar1 = "Magic database is not open";
  if ((ms != (magic_set *)0x0) && (pcVar1 = (char *)0x0, (*(byte *)&ms->event_flags & 1) != 0)) {
    pcVar1 = (ms->o).buf;
  }
  return pcVar1;
}



// WARNING: Unknown calling convention

int magic_errno(magic_set *ms)

{
  uint uVar1;
  
  if (ms == (magic_set *)0x0) {
    uVar1 = 0x16;
  }
  else {
    uVar1 = ms->event_flags & 1;
    if (uVar1 != 0) {
      return ms->error;
    }
  }
  return uVar1;
}



// WARNING: Unknown calling convention

int magic_setflags(magic_set *ms,int flags)

{
  if (ms != (magic_set *)0x0) {
    ms->flags = flags;
    return 0;
  }
  return -1;
}



// WARNING: Unknown calling convention

int magic_version(void)

{
  return 0x210;
}



int magic_setparam(magic_set *ms,int param,void *val)

{
  int *piVar1;
  
  switch(param) {
  case 0:
                    // WARNING: Load size is inaccurate
    ms->indir_max = (uint16_t)*val;
    return param;
  case 1:
                    // WARNING: Load size is inaccurate
    ms->name_max = (uint16_t)*val;
    return 0;
  case 2:
                    // WARNING: Load size is inaccurate
    ms->elf_phnum_max = (uint16_t)*val;
    return 0;
  case 3:
                    // WARNING: Load size is inaccurate
    ms->elf_shnum_max = (uint16_t)*val;
    return 0;
  case 4:
  case 5:
                    // WARNING: Load size is inaccurate
    ms->elf_notes_max = (uint16_t)*val;
    return 0;
  case 6:
                    // WARNING: Load size is inaccurate
    ms->bytes_max = *val;
    return 0;
  default:
    piVar1 = __errno_location();
    *piVar1 = 0x16;
    return -1;
  }
}



int magic_getparam(magic_set *ms,int param,void *val)

{
  int *piVar1;
  
  switch(param) {
  case 0:
    *(ulong *)val = (ulong)ms->indir_max;
    return param;
  case 1:
    *(ulong *)val = (ulong)ms->name_max;
    return 0;
  case 2:
    *(ulong *)val = (ulong)ms->elf_phnum_max;
    return 0;
  case 3:
    *(ulong *)val = (ulong)ms->elf_shnum_max;
    return 0;
  case 4:
    *(ulong *)val = (ulong)ms->elf_notes_max;
    return 0;
  case 5:
    *(ulong *)val = (ulong)ms->regex_max;
    return 0;
  case 6:
    *(size_t *)val = ms->bytes_max;
    return 0;
  default:
    piVar1 = __errno_location();
    *piVar1 = 0x16;
    return -1;
  }
}



int get_op(char c)

{
  int iVar1;
  
  if (c < '0') {
    iVar1 = -1;
    if ('$' < c) {
      if (true) {
        switch(c) {
        case '%':
          return 7;
        case '&':
          return 0;
        case '*':
          return 5;
        case '+':
          return 3;
        case '-':
          return 4;
        case '/':
          return 6;
        }
      }
      return -1;
    }
  }
  else {
    iVar1 = 2;
    if (c != '^') {
      return ((c == '|') - 1) + (uint)(c == '|');
    }
  }
  return iVar1;
}



void apprentice_unmap(magic_map *map)

{
  int iVar1;
  magic *pmVar2;
  magic *__ptr;
  
  if (map == (magic_map *)0x0) {
    return;
  }
  iVar1 = map->type;
  if (iVar1 != 1) {
    if (iVar1 == 2) {
      if ((long)map->p - 1U < 0xfffffffffffffffe) {
        munmap(map->p,map->len);
      }
    }
    else if (iVar1 != 0) {
      apprentice_unmap_cold();
      return;
    }
    free(map);
    return;
  }
  pmVar2 = map->magic[0];
  __ptr = (magic *)map->p;
  if ((pmVar2 < __ptr) || ((magic *)(__ptr->desc + (map->len - 0x80)) < pmVar2)) {
    free(pmVar2);
    __ptr = (magic *)map->p;
  }
  pmVar2 = map->magic[1];
  if ((pmVar2 < __ptr) || ((magic *)(__ptr->desc + (map->len - 0x80)) < pmVar2)) {
    free(pmVar2);
    __ptr = (magic *)map->p;
  }
  free(__ptr);
  free(map);
  return;
}



void mlist_free(mlist *mlist)

{
  mlist *pmVar1;
  mlist *__ptr;
  bool bVar2;
  
  if (mlist == (mlist *)0x0) {
    return;
  }
  __ptr = mlist->next;
  do {
    pmVar1 = __ptr->next;
    if (pmVar1 == (mlist *)0x0) {
      return;
    }
    if ((magic_map *)__ptr->map != (magic_map *)0x0) {
      apprentice_unmap((magic_map *)__ptr->map);
    }
    free(__ptr);
    bVar2 = __ptr != mlist;
    __ptr = pmVar1;
  } while (bVar2);
  return;
}



int add_mlist(mlist *mlp,magic_map *map,size_t idx)

{
  mlist *pmVar1;
  int iVar2;
  mlist *pmVar3;
  magic_map *pmVar4;
  
  mlp->map = (void *)0x0;
  pmVar3 = (mlist *)malloc(0x28);
  if (pmVar3 == (mlist *)0x0) {
    iVar2 = -1;
  }
  else {
    pmVar4 = (magic_map *)0x0;
    if (idx == 0) {
      pmVar4 = map;
    }
    pmVar3->map = pmVar4;
    pmVar3->magic = map->magic[idx];
    pmVar3->nmagic = map->nmagic[idx];
    pmVar1 = mlp->prev;
    pmVar1->next = pmVar3;
    pmVar3->prev = pmVar1;
    pmVar3->next = mlp;
    mlp->prev = pmVar3;
    iVar2 = 0;
  }
  return iVar2;
}



int check_buffer(magic_set *ms,magic_map *map,char *dbname)

{
  uint uVar1;
  int32_t iVar2;
  uint32_t uVar3;
  int *piVar4;
  long lVar5;
  bool bVar6;
  int iVar7;
  magic *pmVar8;
  magic *pmVar9;
  magic *pmVar10;
  ulong uVar11;
  long lVar12;
  ulong uVar13;
  long in_FS_OFFSET;
  uint32_t rv;
  
  piVar4 = (int *)map->p;
  lVar5 = *(long *)(in_FS_OFFSET + 0x28);
  iVar7 = *piVar4;
  if (iVar7 == -0xee1fbe4) {
    uVar1 = piVar4[1];
    bVar6 = false;
  }
  else {
    rv._0_2_ = CONCAT11((char)((uint)iVar7 >> 0x10),(char)((uint)iVar7 >> 0x18));
    if (CONCAT22(CONCAT11((char)iVar7,(char)((uint)iVar7 >> 8)),(undefined2)rv) != -0xee1fbe4) {
      file_error(ms,L'\0',"bad magic in `%s\'",dbname);
      iVar7 = -1;
      goto LAB_00105df7;
    }
    iVar7 = piVar4[1];
    bVar6 = true;
    rv._0_2_ = CONCAT11((char)((uint)iVar7 >> 0x10),(char)((uint)iVar7 >> 0x18));
    uVar1 = CONCAT22(CONCAT11((char)iVar7,(char)((uint)iVar7 >> 8)),(undefined2)rv);
  }
  if (uVar1 == 0xe) {
    uVar13 = map->len;
    uVar11 = uVar13 / 0x158;
    if (uVar13 == (uVar11 & 0xffffffff) * 0x158) {
      pmVar8 = (magic *)(piVar4 + 0x56);
      uVar1 = piVar4[2];
      map->magic[0] = pmVar8;
      if (bVar6) {
        rv._0_2_ = CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18));
        uVar1 = CONCAT22(CONCAT11((char)uVar1,(char)(uVar1 >> 8)),(undefined2)rv);
        _rv = (ulong)uVar1;
        uVar13 = _rv;
        map->nmagic[0] = uVar1;
        map->magic[1] = pmVar8 + _rv;
        iVar7 = piVar4[3];
        rv._0_2_ = CONCAT11((char)((uint)iVar7 >> 0x10),(char)((uint)iVar7 >> 0x18));
        uVar3 = CONCAT22(CONCAT11((char)iVar7,(char)((uint)iVar7 >> 8)),(undefined2)rv);
        map->nmagic[1] = uVar3;
        if (uVar1 + 1 + uVar3 == (int)uVar11) {
          lVar12 = 0;
          do {
            if ((int)uVar13 != 0) {
              pmVar10 = pmVar8;
              do {
                while( true ) {
                  uVar1 = pmVar10->offset;
                  pmVar10->cont_level = pmVar10->cont_level << 8 | pmVar10->cont_level >> 8;
                  pmVar10->offset =
                       uVar1 >> 0x18 | (uVar1 & 0xff0000) >> 8 | (uVar1 & 0xff00) << 8 |
                       uVar1 << 0x18;
                  iVar2 = pmVar10->in_offset;
                  rv._0_2_ = CONCAT11((char)((uint)iVar2 >> 0x10),(char)((uint)iVar2 >> 0x18));
                  pmVar10->in_offset =
                       CONCAT22(CONCAT11((char)iVar2,(char)((uint)iVar2 >> 8)),(undefined2)rv);
                  uVar1 = pmVar10->lineno;
                  pmVar10->lineno =
                       uVar1 >> 0x18 | (uVar1 & 0xff0000) >> 8 | (uVar1 & 0xff00) << 8 |
                       uVar1 << 0x18;
                  if ((0x2e < pmVar10->type) ||
                     ((0x6200001e2020U >> ((ulong)pmVar10->type & 0x3f) & 1) == 0)) break;
                  uVar1 = (pmVar10->_u)._s._count;
                  pmVar9 = pmVar10 + 1;
                  (pmVar10->_u)._s._count =
                       uVar1 >> 0x18 | (uVar1 & 0xff0000) >> 8 | (uVar1 & 0xff00) << 8 |
                       uVar1 << 0x18;
                  uVar1 = (pmVar10->_u)._s._flags;
                  (pmVar10->_u)._s._flags =
                       uVar1 >> 0x18 | (uVar1 & 0xff0000) >> 8 | (uVar1 & 0xff00) << 8 |
                       uVar1 << 0x18;
                  pmVar10 = pmVar9;
                  if (pmVar9 == pmVar8 + (ulong)((int)uVar13 - 1) + 1) goto LAB_00105db5;
                }
                uVar11 = (pmVar10->value).q;
                pmVar9 = pmVar10 + 1;
                (pmVar10->value).q =
                     uVar11 >> 0x38 | (uVar11 & 0xff000000000000) >> 0x28 |
                     (uVar11 & 0xff0000000000) >> 0x18 | (uVar11 & 0xff00000000) >> 8 |
                     (uVar11 & 0xff000000) << 8 | (uVar11 & 0xff0000) << 0x18 |
                     (uVar11 & 0xff00) << 0x28 | uVar11 << 0x38;
                uVar11 = (pmVar10->_u)._mask;
                (pmVar10->_u)._mask =
                     uVar11 >> 0x38 | (uVar11 & 0xff000000000000) >> 0x28 |
                     (uVar11 & 0xff0000000000) >> 0x18 | (uVar11 & 0xff00000000) >> 8 |
                     (uVar11 & 0xff000000) << 8 | (uVar11 & 0xff0000) << 0x18 |
                     (uVar11 & 0xff00) << 0x28 | uVar11 << 0x38;
                pmVar10 = pmVar9;
              } while (pmVar9 != pmVar8 + (ulong)((int)uVar13 - 1) + 1);
            }
LAB_00105db5:
            if (lVar12 + 4 == 8) goto LAB_00105df5;
            uVar13 = (ulong)*(uint *)((long)map->nmagic + lVar12 + 4);
            pmVar8 = *(magic **)((long)map->magic + lVar12 * 2 + 8);
            lVar12 = lVar12 + 4;
          } while( true );
        }
      }
      else {
        map->nmagic[0] = uVar1;
        map->magic[1] = pmVar8 + uVar1;
        uVar3 = piVar4[3];
        map->nmagic[1] = uVar3;
        if ((int)uVar11 == uVar1 + 1 + uVar3) {
LAB_00105df5:
          iVar7 = 0;
          goto LAB_00105df7;
        }
      }
      file_error(ms,L'\0',"Inconsistent entries in `%s\' %u != %u",dbname,uVar11 & 0xffffffff);
      iVar7 = -1;
    }
    else {
      file_error(ms,L'\0',"Size of `%s\' %zu is not a multiple of %zu",dbname,uVar13,0x158);
      iVar7 = -1;
    }
  }
  else {
    file_error(ms,L'\0',"File %s supports only version %d magic files. `%s\' is version %d",
               &DAT_0011c415,0xe,dbname,(ulong)uVar1);
    iVar7 = -1;
  }
LAB_00105df7:
  if (lVar5 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar7;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int addentry(magic_set *ms,magic_entry *me,magic_entry_set *mset)

{
  uint uVar1;
  magic *pmVar2;
  uint32_t uVar3;
  uint32_t uVar4;
  magic_entry *pmVar5;
  long lVar6;
  magic_entry_set *pmVar7;
  magic_entry *pmVar8;
  byte bVar9;
  
  bVar9 = 0;
  pmVar7 = mset + (me->mp->type == '-');
  uVar1 = pmVar7->count;
  pmVar5 = pmVar7->me;
  if (uVar1 == pmVar7->max) {
    pmVar7->max = uVar1 + 200;
    pmVar5 = (magic_entry *)realloc(pmVar5,(ulong)(uVar1 + 200) << 4);
    if (pmVar5 == (magic_entry *)0x0) {
      file_oomem(ms,(ulong)pmVar7->max << 4);
      return -1;
    }
    pmVar8 = pmVar5 + pmVar7->count;
    for (lVar6 = 400; lVar6 != 0; lVar6 = lVar6 + -1) {
      pmVar8->mp = (magic *)0x0;
      pmVar8 = (magic_entry *)&pmVar8[-(ulong)bVar9].cont_count;
    }
    pmVar7->me = pmVar5;
    uVar1 = pmVar7->count;
  }
  pmVar2 = me->mp;
  uVar3 = me->cont_count;
  uVar4 = me->max_count;
  pmVar7->count = uVar1 + 1;
  pmVar5 = pmVar5 + uVar1;
  pmVar5->mp = pmVar2;
  pmVar5->cont_count = uVar3;
  pmVar5->max_count = uVar4;
  me->mp = (magic *)0x0;
  me->cont_count = 0;
  me->max_count = 0;
  return 0;
}



int cmpstrp(void *p1,void *p2)

{
  int iVar1;
  
                    // WARNING: Load size is inaccurate
                    // WARNING: Load size is inaccurate
  iVar1 = strcmp(*p1,*p2);
  return iVar1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

size_t apprentice_magic_strength(magic *m)

{
  uint8_t *puVar1;
  byte bVar2;
  undefined auVar3 [16];
  int iVar4;
  ulong uVar5;
  long lVar6;
  VALUETYPE *pVVar7;
  char cVar8;
  uint8_t uVar9;
  
  if (false) {
switchD_00105fa2_caseD_0:
    __fprintf_chk(_stderr,1,"Bad type %d\n");
                    // WARNING: Subroutine does not return
    abort();
  }
  switch(m->type) {
  default:
    goto switchD_00105fa2_caseD_0;
  case '\x01':
  case '0':
switchD_00105fa2_caseD_1:
    lVar6 = 0x1e;
    break;
  case '\x02':
  case '\a':
  case '\n':
    lVar6 = 0x28;
    break;
  case '\x03':
    if (m->factor_op != '\0') {
                    // WARNING: Subroutine does not return
      abort();
    }
    return 0;
  case '\x04':
  case '\x06':
  case '\b':
  case '\t':
  case '\v':
  case '\f':
  case '\x0e':
  case '\x0f':
  case '\x10':
  case '\x15':
  case '\x16':
  case '\x17':
  case '!':
  case '\"':
  case '#':
    lVar6 = 0x3c;
    break;
  case '\x05':
  case '\r':
    lVar6 = (long)(int)(((uint)m->vallen + (uint)m->vallen * 4) * 2) + 0x14;
    break;
  case '\x11':
    cVar8 = (m->value).s[0];
    pVVar7 = &m->value;
    if (cVar8 == '\0') goto switchD_00105fa2_caseD_1;
    uVar5 = 0;
    if ('^' < cVar8) goto LAB_0010611f;
LAB_001060f0:
    if (cVar8 < '$') goto switchD_00106107_caseD_25;
    if (false) goto switchD_00106107_caseD_25;
    switch(cVar8) {
    case '$':
    case '*':
    case '+':
    case '.':
    case '?':
    case '^':
switchD_00106107_caseD_24:
      cVar8 = pVVar7->s[1];
      pVVar7 = (VALUETYPE *)(pVVar7->s + 1);
LAB_00106116:
      do {
        if (cVar8 == '\0') break;
        if (cVar8 < '_') goto LAB_001060f0;
LAB_0010611f:
        if (cVar8 != '{') goto switchD_00106107_caseD_25;
        uVar9 = pVVar7->b;
        if (uVar9 == '}') {
LAB_00106141:
          if (uVar9 != '\0') goto switchD_00106107_caseD_24;
        }
        else if (uVar9 != '\0') {
          do {
            uVar9 = pVVar7->hs[1];
            pVVar7 = (VALUETYPE *)(pVVar7->s + 1);
            if (uVar9 == '\0') goto LAB_00106148;
          } while (uVar9 != '}');
          goto LAB_00106141;
        }
LAB_00106148:
        cVar8 = pVVar7->s[0];
      } while( true );
    default:
      goto switchD_00106107_caseD_25;
    case '[':
      cVar8 = pVVar7->s[0];
      if (cVar8 == ']') goto LAB_00106116;
      if (cVar8 != '\0') {
        while( true ) {
          puVar1 = pVVar7->hs + 1;
          pVVar7 = (VALUETYPE *)(pVVar7->s + 1);
          if (*puVar1 == '\0') break;
          if (*puVar1 == ']') {
            cVar8 = ']';
            goto LAB_00106116;
          }
        }
      }
      break;
    case '\\':
      if (pVVar7->hs[1] != '\0') {
        cVar8 = pVVar7->s[2];
        uVar5 = uVar5 + 1;
        pVVar7 = (VALUETYPE *)(pVVar7->hs + 2);
        goto LAB_00106116;
      }
      uVar5 = uVar5 + 1;
    }
    if (uVar5 == 0) {
      uVar5 = 1;
    }
    auVar3._8_8_ = 0;
    auVar3._0_8_ = uVar5;
    lVar6 = SUB168((ZEXT816(0) << 0x40 | ZEXT816(10)) / auVar3,0);
    if (lVar6 == 0) {
      lVar6 = 1;
    }
    lVar6 = lVar6 * uVar5 + 0x14;
    break;
  case '\x12':
  case '\x13':
    lVar6 = (long)(int)((uint)m->vallen + (uint)m->vallen * 4) + 0x14;
    break;
  case '\x14':
    iVar4 = (int)(10 / (ulong)(long)(int)(uint)m->vallen);
    if (iVar4 == 0) {
      iVar4 = 1;
    }
    lVar6 = (long)(int)(iVar4 * (uint)m->vallen) + 0x14;
    break;
  case '\x18':
  case '\x19':
  case '\x1a':
  case '\x1b':
  case '\x1c':
  case '\x1d':
  case '\x1e':
  case '\x1f':
  case ' ':
  case '$':
  case '%':
  case '&':
  case '*':
  case '+':
  case ',':
    lVar6 = 100;
    break;
  case ')':
  case '-':
  case '.':
    lVar6 = 0x14;
  }
  bVar2 = m->reln;
  if (bVar2 < 0x3f) {
    if ((bVar2 < 0x21) || (false)) {
switchD_00105fdc_caseD_22:
      __fprintf_chk(_stderr,1,"Bad relation %c\n",bVar2);
                    // WARNING: Subroutine does not return
      abort();
    }
    switch(bVar2) {
    case 0x21:
      goto switchD_00105fdc_caseD_21;
    default:
      goto switchD_00105fdc_caseD_22;
    case 0x26:
      goto switchD_00105fdc_caseD_26;
    case 0x3c:
    case 0x3e:
      uVar5 = lVar6 - 0x14;
      break;
    case 0x3d:
      uVar5 = lVar6 + 10;
    }
  }
  else {
    if (bVar2 != 0x5e) {
      if (bVar2 != 0x78) goto switchD_00105fdc_caseD_22;
switchD_00105fdc_caseD_21:
      bVar2 = m->factor_op;
      uVar5 = 1;
      goto joined_r0x00106047;
    }
switchD_00105fdc_caseD_26:
    uVar5 = lVar6 - 10;
  }
  if (uVar5 == 0) {
    uVar5 = 1;
  }
  bVar2 = m->factor_op;
joined_r0x00106047:
  if (bVar2 == 0x2b) {
    uVar5 = uVar5 + m->factor;
  }
  else if (bVar2 < 0x2c) {
    if (bVar2 != 0) {
      if (bVar2 != 0x2a) {
                    // WARNING: Subroutine does not return
        abort();
      }
      uVar5 = uVar5 * m->factor;
    }
  }
  else if (bVar2 == 0x2d) {
    uVar5 = uVar5 - m->factor;
  }
  else {
    if (bVar2 != 0x2f) {
                    // WARNING: Subroutine does not return
      abort();
    }
    uVar5 = uVar5 / m->factor;
  }
  return uVar5 + (m->desc[0] == '\0');
switchD_00106107_caseD_25:
  uVar5 = uVar5 + 1;
  goto switchD_00106107_caseD_24;
}



int apprentice_sort(void *a,void *b)

{
  size_t sVar1;
  size_t sVar2;
  uint uVar3;
  
                    // WARNING: Load size is inaccurate
  sVar1 = apprentice_magic_strength(*a);
                    // WARNING: Load size is inaccurate
  sVar2 = apprentice_magic_strength(*b);
  uVar3 = 0;
  if (sVar1 != sVar2) {
    uVar3 = -(uint)(sVar2 < sVar1) | 1;
  }
  return uVar3;
}



int goodchar(uchar x,char *extra)

{
  long *plVar1;
  char *pcVar2;
  
  if ((x & 0x80) == 0) {
    plVar1 = (long *)FUN_00104d70();
    if ((*(byte *)(*plVar1 + (ulong)x * 2) & 8) != 0) {
      return 1;
    }
  }
  pcVar2 = strchr(extra,(uint)x);
  return (int)(pcVar2 != (char *)0x0);
}



int get_standard_integer_type(char *l,char **t)

{
  byte bVar1;
  ushort uVar2;
  long *plVar3;
  char *pcVar4;
  int iVar5;
  
  plVar3 = (long *)FUN_00104d70();
  bVar1 = l[1];
  uVar2 = *(ushort *)(*plVar3 + (ulong)bVar1 * 2);
  if ((uVar2 & 0x400) == 0) {
    if ((uVar2 & 0x800) == 0) {
      pcVar4 = l + 1;
      iVar5 = 4;
      goto LAB_0010636f;
    }
    if ((*(byte *)(*plVar3 + 1 + (ulong)(byte)l[2] * 2) & 8) != 0) {
      return 0;
    }
    if (bVar1 == 0x34) {
switchD_00106398_caseD_49:
      iVar5 = 4;
    }
    else {
      if ('4' < (char)bVar1) {
        if (bVar1 != 0x38) {
          return 0;
        }
        goto switchD_00106398_caseD_51;
      }
      if (bVar1 == 0x31) goto switchD_00106398_caseD_43;
      if (bVar1 != 0x32) {
        return 0;
      }
switchD_00106398_caseD_53:
      iVar5 = 2;
    }
  }
  else {
    if (false) {
switchD_00106398_caseD_44:
      return 0;
    }
    switch(bVar1) {
    case 0x43:
switchD_00106398_caseD_43:
      iVar5 = 1;
      break;
    default:
      goto switchD_00106398_caseD_44;
    case 0x49:
    case 0x4c:
      goto switchD_00106398_caseD_49;
    case 0x51:
switchD_00106398_caseD_51:
      iVar5 = 0x18;
      break;
    case 0x53:
      goto switchD_00106398_caseD_53;
    }
  }
  pcVar4 = l + 2;
LAB_0010636f:
  *t = pcVar4;
  return iVar5;
}



int parse_strength(magic_set *ms,magic_entry *me,char *line)

{
  byte *pbVar1;
  magic *pmVar2;
  int iVar3;
  long *plVar4;
  ulong uVar5;
  byte bVar6;
  char *__nptr;
  long in_FS_OFFSET;
  char *el;
  long local_40;
  
  pmVar2 = me->mp;
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  if (pmVar2->factor_op != 0) {
    file_magwarn(ms,"Current entry already has a strength type: %c %d",(ulong)pmVar2->factor_op,
                 (ulong)pmVar2->factor);
    iVar3 = -1;
    goto LAB_00106480;
  }
  if (pmVar2->type == '-') {
    file_magwarn(ms,"%s: Strength setting is not supported in \"name\" magic entries",&pmVar2->value
                );
    iVar3 = -1;
    goto LAB_00106480;
  }
  uVar5 = (ulong)(byte)*line;
  if ((*line & 0x80U) == 0) {
    plVar4 = (long *)FUN_00104d70();
    do {
      if ((*(byte *)(*plVar4 + 1 + uVar5 * 2) & 0x20) == 0) break;
      pbVar1 = (byte *)(line + 1);
      uVar5 = (ulong)*pbVar1;
      line = line + 1;
    } while ((*pbVar1 & 0x80) == 0);
  }
  bVar6 = (byte)uVar5;
  if ((0x2f < bVar6) || ((0xac0000000001U >> (uVar5 & 0x3f) & 1) == 0)) {
    file_magwarn(ms,"Unknown factor op `%c\'",(ulong)(uint)(int)(char)bVar6);
    iVar3 = -1;
    goto LAB_00106480;
  }
  pmVar2->factor_op = bVar6;
  bVar6 = line[1];
  __nptr = line + 1;
  if ((bVar6 & 0x80) == 0) {
    plVar4 = (long *)FUN_00104d70();
    do {
      if ((*(byte *)(*plVar4 + 1 + (ulong)bVar6 * 2) & 0x20) == 0) break;
      bVar6 = __nptr[1];
      __nptr = __nptr + 1;
    } while ((bVar6 & 0x80) == 0);
  }
  uVar5 = strtoul(__nptr,&el,0);
  if (uVar5 < 0x100) {
    bVar6 = *el;
    if (bVar6 != 0) {
      plVar4 = (long *)FUN_00104d70();
      if ((*(byte *)(*plVar4 + 1 + (ulong)bVar6 * 2) & 0x20) == 0) {
        file_magwarn(ms,"Bad factor `%s\'",__nptr);
        goto LAB_0010654e;
      }
    }
    pmVar2->factor = (uint8_t)uVar5;
    iVar3 = 0;
    if ((uVar5 != 0) || (pmVar2->factor_op != '/')) goto LAB_00106480;
    file_magwarn(ms,"Cannot have factor op `%c\' and factor %u",0x2f,0);
  }
  else {
    file_magwarn(ms,"Too large factor `%lu\'",uVar5);
  }
LAB_0010654e:
  pmVar2->factor_op = '\0';
  iVar3 = -1;
  pmVar2->factor = '\0';
LAB_00106480:
  if (local_40 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar3;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int get_type(type_tbl_s *tbl,char *l,char **t)

{
  size_t __n;
  int iVar1;
  type_tbl_s *p;
  
  __n = tbl->len;
  do {
    if (__n == 0) {
LAB_00106606:
      return tbl->type;
    }
    iVar1 = strncmp(l,tbl->name,__n);
    if (iVar1 == 0) {
      *t = l + __n;
      goto LAB_00106606;
    }
    __n = tbl[1].len;
    tbl = tbl + 1;
  } while( true );
}



void eatsize(char **p)

{
  byte *pbVar1;
  long lVar2;
  long *plVar3;
  __int32_t **pp_Var4;
  byte bVar5;
  byte *pbVar7;
  int iVar6;
  
  pbVar1 = (byte *)*p;
  plVar3 = (long *)FUN_00104d70();
  lVar2 = *plVar3;
  bVar5 = *pbVar1;
  pbVar7 = pbVar1;
  if ((*(byte *)(lVar2 + 1 + (ulong)bVar5 * 2) & 1) == 0) {
    if (bVar5 == 0x75) goto LAB_00106691;
  }
  else {
    pp_Var4 = __ctype_tolower_loc();
    iVar6 = (*pp_Var4)[bVar5];
    if (iVar6 != 0x75) goto LAB_00106655;
LAB_00106691:
    pbVar7 = pbVar1 + 1;
    bVar5 = pbVar1[1];
    if ((*(byte *)(lVar2 + 1 + (ulong)bVar5 * 2) & 1) != 0) {
      pp_Var4 = __ctype_tolower_loc();
      iVar6 = (*pp_Var4)[bVar5];
      goto LAB_00106655;
    }
  }
  iVar6 = (int)(char)bVar5;
LAB_00106655:
  if (iVar6 - 0x62U < 0x12) {
    pbVar7 = pbVar7 + ((1L << ((byte)(iVar6 - 0x62U) & 0x3f) & 0x20443U) != 0);
  }
  *p = (char *)pbVar7;
  return;
}



void apprentice_list(mlist *mlist,int mode)

{
  uint32_t uVar1;
  mlist *pmVar2;
  ulong uVar3;
  magic *pmVar4;
  size_t sVar5;
  magic *pmVar6;
  uint uVar7;
  uint uVar8;
  magic *m;
  ulong uVar9;
  ulong uVar10;
  
  pmVar2 = mlist->next;
  do {
    if (mlist == pmVar2) {
      return;
    }
    uVar7 = pmVar2->nmagic;
    uVar9 = 0;
    if (uVar7 != 0) {
      do {
        while( true ) {
          pmVar6 = pmVar2->magic;
          m = pmVar6 + uVar9;
          uVar3 = (ulong)((int)uVar9 + 1);
          if (((uint)m->flag & mode) == mode) break;
          pmVar6 = pmVar6 + uVar3;
          while ((uVar8 = (uint)uVar3, uVar8 < uVar7 && (pmVar6->cont_level != 0))) {
            uVar3 = (ulong)(uVar8 + 1);
            pmVar6 = pmVar6 + 1;
          }
          uVar9 = uVar3;
          if (uVar7 <= uVar8) goto LAB_0010674f;
        }
        pmVar4 = pmVar6 + uVar3;
        uVar10 = uVar9;
        while( true ) {
          uVar9 = uVar3;
          uVar8 = (uint)uVar9;
          if ((((uVar7 <= uVar8) || (pmVar4->cont_level == 0)) || (pmVar6[uVar10].desc[0] != '\0'))
             || (pmVar4 = pmVar4 + 1, pmVar6[uVar10].mimetype[0] != '\0')) break;
          uVar3 = (ulong)(uVar8 + 1);
          uVar10 = uVar9;
        }
        uVar1 = pmVar6[uVar10].lineno;
        sVar5 = apprentice_magic_strength(m);
        __printf_chk(1,"Strength = %3zu@%u: %s [%s]\n",sVar5,uVar1,pmVar6[uVar10].desc,
                     pmVar6[uVar10].mimetype);
        uVar7 = pmVar2->nmagic;
      } while (uVar8 < uVar7);
    }
LAB_0010674f:
    pmVar2 = pmVar2->next;
  } while( true );
}



// WARNING: Unknown calling convention -- yet parameter storage is locked

void init_file_tables(void)

{
  long lVar1;
  size_t sVar2;
  type_tbl_s *ptVar3;
  int iVar4;
  
  lVar1 = (long)done_6772;
  if (done_6772 != 0) {
    return;
  }
  iVar4 = 0;
  sVar2 = 4;
  done_6772 = 1;
  ptVar3 = type_tbl;
  while( true ) {
    *(type_tbl_s **)(file_names + lVar1 * 8) = ptVar3;
    file_formats[lVar1] = iVar4;
    if (sVar2 == 0) break;
    lVar1 = (long)ptVar3[1].type;
    if (0x30 < ptVar3[1].type) {
                    // WARNING: Subroutine does not return
      __assert_fail("p->type < FILE_NAMES_SIZE","apprentice.c",399,"init_file_tables");
    }
    iVar4 = ptVar3[1].format;
    sVar2 = ptVar3[2].len;
    ptVar3 = ptVar3 + 1;
  }
  if (ptVar3 + 1 == (type_tbl_s *)0x11c360) {
    return;
  }
                    // WARNING: Subroutine does not return
  __assert_fail("p - type_tbl == FILE_NAMES_SIZE","apprentice.c",0x193,"init_file_tables");
}



char * mkdbname(magic_set *ms,char *fn,int strip)

{
  int iVar1;
  char *pcVar2;
  char *pcVar3;
  char *pcVar4;
  char cVar5;
  long in_FS_OFFSET;
  char *buf;
  long local_30;
  
  local_30 = *(long *)(in_FS_OFFSET + 0x28);
  if (strip != 0) {
    pcVar2 = strrchr(fn,0x2f);
    if (pcVar2 != (char *)0x0) {
      fn = pcVar2 + 1;
    }
  }
  cVar5 = *fn;
  pcVar2 = fn;
  while ((pcVar3 = pcVar2, cVar5 != '\0' && (pcVar3 = pcVar2 + 1, *pcVar3 != '\0'))) {
    pcVar2 = pcVar2 + 2;
    cVar5 = *pcVar2;
  }
  cVar5 = '\0';
  pcVar4 = "";
  pcVar2 = pcVar3;
  while (fn <= pcVar2) {
    if (*pcVar4 != cVar5) {
      if (pcVar4 < ".mgc") goto LAB_00106950;
      break;
    }
    pcVar4 = pcVar4 + -1;
    if (pcVar3 + -5 == pcVar2 + -1) goto LAB_00106958;
    cVar5 = pcVar2[-1];
    pcVar2 = pcVar2 + -1;
  }
  if (cVar5 == '\0') {
LAB_00106950:
    pcVar2 = pcVar2 + 1;
  }
  else {
    do {
      pcVar3 = pcVar2;
      pcVar2 = pcVar3 + 1;
    } while (*pcVar2 != '\0');
    pcVar2 = pcVar3 + 2;
  }
LAB_00106958:
  if ((*(uint *)ms->mlist & 0x410) == 0) {
LAB_001069d9:
    iVar1 = __asprintf_chk(&buf,1,"%.*s%s",(long)pcVar2 - (long)fn & 0xffffffff,fn,".mgc");
    if (iVar1 < 0) {
LAB_00106a80:
      buf = (char *)0x0;
      goto LAB_001069b1;
    }
    pcVar2 = strstr(fn,".mime");
    if (pcVar2 == (char *)0x0) goto LAB_001069b1;
  }
  else {
    iVar1 = __asprintf_chk(&buf,1,"%.*s.mime%s",(long)pcVar2 - (long)fn & 0xffffffff,fn,".mgc");
    if (iVar1 < 0) goto LAB_00106a80;
    iVar1 = access(buf,4);
    if (iVar1 == -1) {
      free(buf);
      goto LAB_001069d9;
    }
  }
  *(uint *)ms->mlist = *(uint *)ms->mlist & 0x10;
LAB_001069b1:
  if (local_30 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return buf;
}



int apprentice_compile(magic_set *ms,magic_map *map,char *fn)

{
  int __fd;
  char *__file;
  ssize_t sVar1;
  size_t sVar2;
  wchar_t *pwVar3;
  long lVar4;
  size_t sVar5;
  anon_union_344_2_947300e6 *paVar6;
  int iVar7;
  long in_FS_OFFSET;
  byte bVar8;
  anon_union_344_2_947300e6 hdr;
  long local_30;
  
  bVar8 = 0;
  local_30 = *(long *)(in_FS_OFFSET + 0x28);
  __file = mkdbname((magic_set *)&ms->flags,fn,1);
  if (__file == (char *)0x0) {
    iVar7 = -1;
  }
  else {
    __fd = open(__file,0x241,0x1a4);
    if (__fd == -1) {
      pwVar3 = __errno_location();
      file_error(ms,*pwVar3,"cannot open `%s\'",__file);
      iVar7 = -1;
    }
    else {
      paVar6 = &hdr;
      for (lVar4 = 0x2b; lVar4 != 0; lVar4 = lVar4 + -1) {
        *(undefined8 *)paVar6 = 0;
        paVar6 = (anon_union_344_2_947300e6 *)((long)paVar6 + ((ulong)bVar8 * -2 + 1) * 8);
      }
      hdr._0_8_ = 0xef11e041c;
      hdr._8_8_ = *(undefined8 *)map->nmagic;
      sVar1 = write(__fd,&hdr,0x158);
      if (sVar1 == 0x158) {
        sVar5 = (ulong)map->nmagic[0] * 0x158;
        sVar2 = write(__fd,map->magic[0],sVar5);
        if (sVar2 == sVar5) {
          sVar5 = (ulong)map->nmagic[1] * 0x158;
          sVar2 = write(__fd,map->magic[1],sVar5);
          if (sVar2 == sVar5) {
            iVar7 = 0;
            close(__fd);
            goto LAB_00106b78;
          }
        }
      }
      pwVar3 = __errno_location();
      iVar7 = -1;
      file_error(ms,*pwVar3,"error writing `%s\'",__file);
    }
  }
LAB_00106b78:
  apprentice_unmap(map);
  free(__file);
  if (local_30 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar7;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int hextoint(int c)

{
  int iVar1;
  long *plVar2;
  
  if ((c & 0x80U) != 0) {
    return -1;
  }
  plVar2 = (long *)FUN_00104d70();
  if ((*(byte *)(*plVar2 + 1 + (ulong)(c & 0xff) * 2) & 8) == 0) {
    if (5 < c - 0x61U) {
      iVar1 = -1;
      if (c - 0x41U < 6) {
        iVar1 = c + -0x37;
      }
      return iVar1;
    }
    return c + -0x57;
  }
  return c + -0x30;
}



// DWARF original prototype: int parse_extra(magic_set * ms, magic_entry * me, char * line, off_t
// off, size_t len, char * name, char * extra, int nt, magic_entry * me)

int parse_extra(magic_set *ms,magic_entry *me,char *line,off_t off,size_t len,char *name,char *extra
               ,int nt,magic_entry *me_1)

{
  char *__s;
  byte bVar1;
  int iVar2;
  long *plVar3;
  undefined8 *puVar4;
  ulong uVar5;
  char *pcVar6;
  byte *pbVar7;
  char cVar8;
  uint uVar9;
  undefined4 in_stack_00000014;
  char *local_48;
  
  if ((int)line != 0) {
    me = (magic_entry *)((long)me + (ulong)((int)line - 1) * 0x158);
  }
  __s = (char *)((long)&me->mp + len);
  if (*__s != '\0') {
    local_48 = name;
    if ((int)me_1 != 0) {
      local_48 = (char *)strlen(__s);
    }
    file_magwarn(ms,"Current entry already has a %s type `%.*s\', new type `%s\'",extra,
                 (ulong)local_48 & 0xffffffff,__s,off);
    return -1;
  }
  if (*(char *)&me[8].mp == '\0') {
    file_magwarn(ms,"Current entry does not yet have a description for adding a %s type",extra);
    return -1;
  }
  bVar1 = *(byte *)off;
  uVar5 = (ulong)bVar1;
  uVar9 = (uint)bVar1;
  pbVar7 = (byte *)off;
  if ((bVar1 & 0x80) == 0) {
    plVar3 = (long *)FUN_00104d70();
    do {
      if ((*(byte *)(*plVar3 + 1 + uVar5 * 2) & 0x20) == 0) {
        bVar1 = *pbVar7;
        uVar5 = (ulong)bVar1;
        pcVar6 = (char *)0x0;
        uVar9 = (uint)bVar1;
        if (bVar1 == 0) goto LAB_00106d80;
        goto LAB_00106d09;
      }
      bVar1 = pbVar7[1];
      pbVar7 = pbVar7 + 1;
      uVar9 = (uint)bVar1;
      uVar5 = (ulong)bVar1;
    } while ((bVar1 & 0x80) == 0);
    uVar5 = (ulong)uVar9;
  }
LAB_00106d09:
  pcVar6 = (char *)0x0;
  while( true ) {
    cVar8 = (char)uVar9;
    iVar2 = goodchar((uchar)uVar5,(char *)CONCAT44(in_stack_00000014,nt));
    if (iVar2 == 0) break;
    pcVar6 = pcVar6 + 1;
    (__s + -1)[(long)pcVar6] = cVar8;
    uVar9 = (uint)pbVar7[(long)pcVar6];
    if (pbVar7[(long)pcVar6] == 0) goto LAB_00106d80;
    if (pcVar6 == name) {
      if ((int)me_1 != 0) {
        (__s + -1)[(long)name] = '\0';
      }
      if ((*(byte *)&ms->flags & 0x40) != 0) {
        file_magwarn(ms,"%s type `%s\' truncated %zu",extra,off,name);
      }
      goto LAB_00106d42;
    }
    uVar5 = (ulong)uVar9;
  }
  plVar3 = (long *)FUN_00104d70();
  if ((*(byte *)(*plVar3 + 1 + (ulong)uVar9 * 2) & 0x20) != 0) goto LAB_00106d2d;
LAB_00106da8:
  file_magwarn(ms,"%s type `%s\' has bad char \'%c\'",extra,off,(ulong)(uint)(int)cVar8);
LAB_00106d2d:
  if ((int)me_1 != 0) {
    __s[(long)pcVar6] = '\0';
  }
  if (pcVar6 == (char *)0x0) {
    file_magerror(ms,"Bad magic entry \'%s\'",off);
    iVar2 = -1;
  }
  else {
LAB_00106d42:
    iVar2 = 0;
  }
  return iVar2;
LAB_00106d80:
  puVar4 = (undefined8 *)FUN_00104d70();
  if (((*(ushort *)*puVar4 & 0x2000) != 0) ||
     (iVar2 = goodchar('\0',(char *)CONCAT44(in_stack_00000014,nt)), iVar2 != 0)) goto LAB_00106d2d;
  cVar8 = '\0';
  goto LAB_00106da8;
}



int parse_ext(magic_set *ms,magic_entry *me,char *line)

{
  int iVar1;
  
  iVar1 = parse_extra(ms,(magic_entry *)me->mp,(char *)(ulong)me->cont_count,(off_t)line,0x118,
                      (char *)0x40,"EXTENSION",0x11c527,(magic_entry *)0x0);
  return iVar1;
}



int parse_apple(magic_set *ms,magic_entry *me,char *line)

{
  int iVar1;
  
  iVar1 = parse_extra(ms,(magic_entry *)me->mp,(char *)(ulong)me->cont_count,(off_t)line,0x110,
                      (char *)0x8,"APPLE",0x11c537,(magic_entry *)0x0);
  return iVar1;
}



int parse_mime(magic_set *ms,magic_entry *me,char *line)

{
  int iVar1;
  
  iVar1 = parse_extra(ms,(magic_entry *)me->mp,(char *)(ulong)me->cont_count,(off_t)line,0xc0,
                      (char *)0x50,"MIME",0x11c544,(magic_entry *)0x1);
  return iVar1;
}



uint64_t file_signextend(magic_set *ms,magic *m,uint64_t v)

{
  if (true) {
    switch(m->type) {
    case '\x01':
      return (long)(char)v;
    case '\x02':
    case '\a':
    case '\n':
      return (long)(short)v;
    case '\x03':
    case '\x05':
    case '\r':
    case '\x11':
    case '\x12':
    case '\x13':
    case '\x14':
    case '\x18':
    case '\x19':
    case '\x1a':
    case '\x1b':
    case '\x1c':
    case '\x1d':
    case '\x1e':
    case '\x1f':
    case ' ':
    case '$':
    case '%':
    case '&':
    case ')':
    case '*':
    case '+':
    case ',':
    case '-':
    case '.':
    case '/':
    case '0':
      return v;
    case '\x04':
    case '\x06':
    case '\b':
    case '\t':
    case '\v':
    case '\f':
    case '\x0e':
    case '\x0f':
    case '\x10':
    case '\x15':
    case '\x16':
    case '\x17':
    case '!':
    case '\"':
    case '#':
      return (long)(int)v;
    }
  }
  if ((*(byte *)&ms->flags & 0x40) == 0) {
    return 0xffffffff;
  }
  file_magwarn(ms,"cannot happen: m->type=%d\n");
  return 0xffffffff;
}



void file_ms_free(magic_set *ms)

{
  if (ms != (magic_set *)0x0) {
    mlist_free(ms->mlist[0]);
    mlist_free(ms->mlist[1]);
    free((ms->o).pbuf);
    free((ms->o).buf);
    free((ms->c).li);
    free(ms);
    return;
  }
  return;
}



magic_set * file_ms_alloc(int flags)

{
  int iVar1;
  magic_set *ms;
  level_info *plVar2;
  int *piVar3;
  
  ms = (magic_set *)calloc(1,0xe8);
  if (ms == (magic_set *)0x0) {
    return (magic_set *)0x0;
  }
  iVar1 = magic_setflags(ms,flags);
  if (iVar1 == -1) {
    piVar3 = __errno_location();
    *piVar3 = 0x16;
  }
  else {
    (ms->o).pbuf = (char *)0x0;
    (ms->o).buf = (char *)0x0;
    (ms->c).len = 10;
    plVar2 = (level_info *)malloc(0xa0);
    (ms->c).li = plVar2;
    if (plVar2 != (level_info *)0x0) {
      ms->mlist[0] = (mlist *)0x0;
      ms->file = "unknown";
      ms->event_flags = 0;
      ms->error = -1;
      ms->mlist[1] = (mlist *)0x0;
      ms->line = 0;
      ms->indir_max = 0x32;
      ms->name_max = 0x1e;
      ms->elf_shnum_max = 0x8000;
      ms->elf_phnum_max = 0x800;
      ms->elf_notes_max = 0x100;
      ms->regex_max = 0x2000;
      ms->bytes_max = 0x100000;
      return ms;
    }
  }
  free(ms);
  return (magic_set *)0x0;
}



int buffer_apprentice(magic_set *ms,magic **bufs,size_t *sizes,size_t nbufs)

{
  mlist *mlist;
  size_t sVar1;
  magic *pmVar2;
  int iVar3;
  mlist *pmVar4;
  magic_map *map;
  long lVar5;
  size_t sVar6;
  
  if (nbufs == 0) {
    return -1;
  }
  if (ms->mlist[0] != (mlist *)0x0) {
    file_reset(ms);
  }
  init_file_tables();
  mlist_free(ms->mlist[0]);
  pmVar4 = (mlist *)calloc(1,0x28);
  if (pmVar4 == (mlist *)0x0) {
    lVar5 = 0;
  }
  else {
    pmVar4->prev = pmVar4;
    mlist = ms->mlist[1];
    pmVar4->next = pmVar4;
    ms->mlist[0] = pmVar4;
    mlist_free(mlist);
    pmVar4 = (mlist *)calloc(1,0x28);
    if (pmVar4 != (mlist *)0x0) {
      pmVar4->prev = pmVar4;
      sVar6 = 0;
      pmVar4->next = pmVar4;
      ms->mlist[1] = pmVar4;
      while( true ) {
        sVar1 = sizes[sVar6];
        pmVar2 = bufs[sVar6];
        map = (magic_map *)calloc(1,0x30);
        if (map == (magic_map *)0x0) {
          file_oomem(ms,0x30);
          goto LAB_0010728d;
        }
        map->p = pmVar2;
        map->len = sVar1;
        map->type = 0;
        iVar3 = check_buffer(ms,map,"buffer");
        if (iVar3 != 0) break;
        iVar3 = add_mlist(ms->mlist[0],map,0);
        if ((iVar3 == -1) || (iVar3 = add_mlist(ms->mlist[1],map,1), iVar3 == -1)) {
          file_oomem(ms,0x28);
          goto LAB_0010728d;
        }
        sVar6 = sVar6 + 1;
        if (nbufs == sVar6) {
          return 0;
        }
      }
      apprentice_unmap(map);
      goto LAB_0010728d;
    }
    lVar5 = 1;
  }
  ms->mlist[lVar5] = (mlist *)0x0;
  file_oomem(ms,0x28);
LAB_0010728d:
  mlist_free(ms->mlist[0]);
  ms->mlist[0] = (mlist *)0x0;
  mlist_free(ms->mlist[1]);
  ms->mlist[1] = (mlist *)0x0;
  return -1;
}



uint64_t file_signextend(magic_set *ms,magic *m,uint64_t v)

{
  uint64_t uVar1;
  
  if ((m->flag & 8) == 0) {
    uVar1 = file_signextend(ms,m,v);
    return uVar1;
  }
  return v;
}



void file_showstr(FILE *fp,char *s,size_t len)

{
  char cVar1;
  char *pcVar2;
  
  pcVar2 = s + 1;
  do {
    if (len == 0xffffffff) {
      cVar1 = pcVar2[-1];
      if (cVar1 == '\0') {
        return;
      }
    }
    else {
      if (len == 0) {
        return;
      }
      cVar1 = pcVar2[-1];
      len = len - 1;
    }
    if ((byte)(cVar1 - 0x20U) < 0x5f) {
      fputc((int)cVar1,(FILE *)fp);
    }
    else {
      fputc(0x5c,(FILE *)fp);
      switch(cVar1) {
      case '\a':
        fputc(0x61,(FILE *)fp);
        break;
      case '\b':
        fputc(0x62,(FILE *)fp);
        break;
      case '\t':
        fputc(0x74,(FILE *)fp);
        break;
      case '\n':
        fputc(0x6e,(FILE *)fp);
        break;
      case '\v':
        fputc(0x76,(FILE *)fp);
        break;
      case '\f':
        fputc(0x66,(FILE *)fp);
        break;
      case '\r':
        fputc(0x72,(FILE *)fp);
        break;
      default:
        __fprintf_chk(fp,1,&DAT_0011c570,cVar1);
      }
    }
    pcVar2 = pcVar2 + 1;
  } while( true );
}



size_t file_pstring_length_size(magic *m)

{
  uint uVar1;
  size_t sVar2;
  
  uVar1 = (m->_u)._s._flags & 0xf80;
  if (uVar1 != 0x100) {
    if (uVar1 < 0x101) {
      if (uVar1 != 0x80) {
        sVar2 = file_pstring_length_size_cold();
        return sVar2;
      }
      return 1;
    }
    if ((uVar1 - 0x400 & 0xfffffb80) == 0) {
      return 4;
    }
    if (uVar1 != 0x200) {
                    // WARNING: Subroutine does not return
      abort();
    }
  }
  return 2;
}



void load_1(magic_set *ms,int action,char *fn,int *errs,magic_entry_set *mset)

{
  uint32_t *puVar1;
  VALUETYPE *pat;
  uint uVar2;
  level_info *plVar3;
  uint32_t uVar4;
  undefined8 uVar5;
  ushort uVar6;
  wchar_t wVar7;
  int iVar8;
  uint uVar9;
  int iVar10;
  FILE *__stream;
  __ssize_t _Var11;
  long *plVar12;
  ulonglong uVar13;
  long lVar14;
  magic *pmVar15;
  wchar_t *pwVar16;
  long lVar17;
  int *piVar18;
  char *pcVar19;
  uint8_t uVar20;
  ulong uVar21;
  VALUETYPE *pVVar22;
  char cVar23;
  byte bVar24;
  ulong uVar25;
  ulong uVar26;
  char *pcVar27;
  ulong uVar28;
  uint uVar29;
  char *pcVar30;
  byte *pbVar31;
  byte *pbVar32;
  undefined8 *puVar33;
  magic *pmVar34;
  ulong uVar35;
  byte bVar36;
  char *pcVar37;
  undefined1 *__s2;
  byte *pbVar38;
  anon_struct_24_3_b56a9d0a *paVar39;
  size_t sVar40;
  char *pcVar41;
  size_t sVar42;
  long in_FS_OFFSET;
  bool bVar43;
  byte bVar44;
  float fVar45;
  double dVar46;
  byte *local_118;
  size_t llen;
  char *line;
  char *l;
  char *t;
  char *l_1;
  magic_entry me;
  char *t_1;
  long local_40;
  
  bVar44 = 0;
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  ms->file = fn;
  llen = 0;
  line = (char *)0x0;
  __stream = fopen(fn,"r");
  if (__stream == (FILE *)0x0) {
    pwVar16 = __errno_location();
    if (*pwVar16 == L'\x02') {
      *errs = *errs + 1;
    }
    else {
      file_error(ms,*pwVar16,"cannot read magic file `%s\'",fn);
      *errs = *errs + 1;
    }
  }
  else {
    ms->line = 1;
    uVar4 = 0;
    me.mp = (magic *)0x0;
    me.cont_count = 0;
    me.max_count = 0;
    while (_Var11 = __getdelim(&line,&llen,10,__stream), pcVar30 = line, _Var11 != -1) {
      if (_Var11 != 0) {
        if (line[_Var11 + -1] == '\n') {
          uVar4 = uVar4 + 1;
          line[_Var11 + -1] = '\0';
        }
        cVar23 = *line;
        if (cVar23 == '!') {
          if (line[1] != ':') goto LAB_001075e1;
          lVar14 = 0;
          pcVar27 = line + 2;
          sVar42 = 4;
          pcVar37 = "mime";
          paVar39 = bang;
          while( true ) {
            if ((sVar42 < _Var11 - 2U) && (iVar8 = memcmp(pcVar37,pcVar27,sVar42), iVar8 == 0)) {
              if (me.mp != (magic *)0x0) {
                iVar8 = (*bang[lVar14].fun)(ms,&me,pcVar30 + sVar42 + 2);
                if (iVar8 != 0) goto LAB_00107634;
                goto LAB_0010763c;
              }
              pcVar27 = "No current entry for :!%s type";
              goto LAB_001079e1;
            }
            pcVar37 = paVar39[1].name;
            lVar14 = lVar14 + 1;
            if (pcVar37 == (char *)0x0) break;
            sVar42 = paVar39[1].len;
            paVar39 = paVar39 + 1;
          }
          pcVar27 = "Unknown !: entry `%s\'";
          pcVar37 = pcVar30;
LAB_001079e1:
          file_error(ms,L'\0',pcVar27,pcVar37);
          *errs = *errs + 1;
        }
        else if ((cVar23 != '#') && (cVar23 != '\0')) {
LAB_001075e1:
          l = line;
          if (*line == '>') {
            pcVar30 = line + 1;
            do {
              l = pcVar30;
              uVar29 = (1 - (int)(line + 1)) + (int)l;
              uVar25 = (ulong)uVar29;
              pcVar30 = l + 1;
            } while (*l == '>');
            if (uVar29 == 0) goto LAB_00107a00;
            if ((last_cont_level_7361 < uVar29) &&
               (wVar7 = file_check_mem(ms,uVar29), wVar7 == L'\xffffffff')) goto LAB_00107634;
            last_cont_level_7361 = uVar29;
            if (me.mp == (magic *)0x0) {
              file_magerror(ms,"No current entry for continuation");
              goto LAB_00107634;
            }
            if (me.cont_count == 0) {
              file_magerror(ms,"Continuations present with 0 count");
              goto LAB_00107634;
            }
            pmVar15 = me.mp;
            uVar2 = me.cont_count;
            if (1 < (int)(uVar29 - me.mp[me.cont_count - 1].cont_level)) {
              file_magwarn(ms,
                           "New continuation level %u is more than one larger than current level %u"
                           ,(ulong)uVar29);
              pmVar15 = me.mp;
              uVar2 = me.cont_count;
            }
            uVar21 = (ulong)uVar2;
            if (me.max_count == uVar2) {
              sVar40 = (uVar21 + 10) * 0x158;
              pmVar15 = (magic *)realloc(pmVar15,sVar40);
              if (pmVar15 == (magic *)0x0) {
                file_oomem(ms,sVar40);
                goto LAB_00107634;
              }
              uVar5 = me._8_8_;
              me.mp = pmVar15;
              me.max_count = uVar2 + 10;
              uVar21 = uVar5 & 0xffffffff;
            }
            me.cont_count = (int)uVar21 + 1;
            pmVar15 = pmVar15 + uVar21;
            pmVar15->cont_level = 0;
            pmVar15->flag = '\0';
            pmVar15->factor = '\0';
            pmVar15->reln = '\0';
            pmVar15->vallen = '\0';
            pmVar15->type = '\0';
            pmVar15->in_type = '\0';
            *(undefined8 *)(pmVar15->ext + 0x38) = 0;
            puVar33 = (undefined8 *)((ulong)&pmVar15->in_op & 0xfffffffffffffff8);
            uVar21 = (ulong)(((int)pmVar15 - (int)puVar33) + 0x158U >> 3);
            for (; uVar21 != 0; uVar21 = uVar21 - 1) {
              *puVar33 = 0;
              puVar33 = puVar33 + (ulong)bVar44 * -2 + 1;
            }
            pmVar15->cont_level = (uint16_t)uVar29;
            goto LAB_0010770c;
          }
LAB_00107a00:
          wVar7 = file_check_mem(ms,0);
          if (wVar7 == L'\xffffffff') goto LAB_00107634;
          last_cont_level_7361 = 0;
          if (me.mp != (magic *)0x0) goto code_r0x00107a2c;
          pmVar15 = (magic *)malloc(0xd70);
          if (pmVar15 == (magic *)0x0) {
            file_oomem(ms,0xd70);
          }
          else {
            pmVar34 = pmVar15;
            for (lVar14 = 0x2b; lVar14 != 0; lVar14 = lVar14 + -1) {
              pmVar34->cont_level = 0;
              pmVar34->flag = '\0';
              pmVar34->factor = '\0';
              pmVar34->reln = '\0';
              pmVar34->vallen = '\0';
              pmVar34->type = '\0';
              pmVar34->in_type = '\0';
              pmVar34 = (magic *)((long)pmVar34 + (ulong)bVar44 * -0x10 + 8);
            }
            uVar25 = 0;
            me.cont_count = 1;
            me.max_count = 10;
            me.mp = pmVar15;
            uVar29 = 0;
LAB_0010770c:
            pmVar15->lineno = uVar4;
            cVar23 = *l;
            if (cVar23 == '&') {
              pmVar15->flag = pmVar15->flag | 2;
              cVar23 = l[1];
              l = l + 1;
            }
            pcVar30 = l;
            if (cVar23 == '(') {
              bVar24 = pmVar15->flag;
              bVar36 = bVar24 | 1;
              if ((bVar24 & 2) != 0) {
                bVar36 = bVar24 & 0xf9 | 5;
              }
              pmVar15->flag = bVar36;
              pcVar30 = l + 1;
              if (l[1] == '&') {
                pmVar15->flag = pmVar15->flag | 2;
                pcVar30 = l + 2;
              }
            }
            l = pcVar30;
            if (((short)uVar29 == 0) && ((pmVar15->flag & 6) != 0)) {
              if ((*(byte *)&ms->flags & 0x40) != 0) {
                file_magwarn(ms,"relative offset at level 0");
              }
            }
            else {
              uVar21 = strtoul(l,&t,0);
              pmVar15->offset = (uint32_t)uVar21;
              if (l != t) {
                l = t;
                if ((pmVar15->flag & 1) != 0) {
                  pmVar15->in_offset = 0;
                  pmVar15->in_type = '\x04';
                  pmVar15->in_op = '\0';
                  bVar24 = *t;
                  pcVar30 = t;
                  if ((bVar24 & 0xfd) == 0x2c) {
                    if (bVar24 == 0x2c) {
                      pmVar15->in_op = ' ';
                    }
                    l = t + 1;
                    if (false) {
switchD_00107b0c_caseD_44:
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"indirect offset type `%c\' invalid");
                      }
                      goto LAB_00107634;
                    }
                    switch(t[1]) {
                    case 'B':
                    case 'C':
                    case 'b':
                    case 'c':
                      pmVar15->in_type = '\x01';
                      break;
                    default:
                      goto switchD_00107b0c_caseD_44;
                    case 'E':
                    case 'F':
                    case 'G':
                      pmVar15->in_type = '%';
                      break;
                    case 'H':
                    case 'S':
                      pmVar15->in_type = '\a';
                      break;
                    case 'I':
                      pmVar15->in_type = '\'';
                      break;
                    case 'L':
                      pmVar15->in_type = '\b';
                      break;
                    case 'e':
                    case 'f':
                    case 'g':
                      pmVar15->in_type = '&';
                      break;
                    case 'h':
                    case 's':
                      pmVar15->in_type = '\n';
                      break;
                    case 'i':
                      pmVar15->in_type = '(';
                      break;
                    case 'l':
                      pmVar15->in_type = '\v';
                      break;
                    case 'm':
                      pmVar15->in_type = '\x17';
                    }
                    pcVar30 = t + 2;
                    bVar24 = t[2];
                  }
                  l = pcVar30;
                  if (bVar24 == 0x7e) {
                    l = pcVar30 + 1;
                    pmVar15->in_op = pmVar15->in_op | 0x40;
                    bVar24 = pcVar30[1];
                  }
                  pcVar27 = l;
                  iVar8 = get_op(bVar24);
                  pcVar30 = pcVar27;
                  if (iVar8 != -1) {
                    pmVar15->in_op = pmVar15->in_op | (byte)iVar8;
                    pcVar30 = pcVar27 + 1;
                    bVar24 = pcVar27[1];
                    l = pcVar30;
                  }
                  pcVar27 = pcVar30;
                  if (bVar24 == 0x28) {
                    pcVar27 = pcVar30 + 1;
                    pmVar15->in_op = pmVar15->in_op | 0x80;
                    bVar24 = pcVar30[1];
                    l = pcVar27;
                  }
                  plVar12 = (long *)FUN_00104d70();
                  if (((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 8) != 0) || (bVar24 == 0x2d))
                  {
                    lVar14 = strtol(pcVar27,&t,0);
                    pmVar15->in_offset = (int32_t)lVar14;
                    pcVar27 = t;
                    if (l == t) {
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"in_offset `%s\' invalid",t);
                      }
                      goto LAB_00107634;
                    }
                  }
                  l = pcVar27 + 1;
                  if ((*pcVar27 != ')') ||
                     (((char)pmVar15->in_op < '\0' && (l = pcVar27 + 2, pcVar27[1] != ')')))) {
                    if ((*(byte *)&ms->flags & 0x40) != 0) {
                      file_magwarn(ms,"missing \')\' in indirect offset");
                    }
                    goto LAB_00107634;
                  }
                }
                pbVar31 = (byte *)l;
                bVar24 = *l;
                if ((bVar24 & 0x80) == 0) {
                  plVar12 = (long *)FUN_00104d70();
                  do {
                    if ((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x20) == 0) break;
                    pbVar31 = pbVar31 + 1;
                    bVar24 = *pbVar31;
                    l = (char *)pbVar31;
                  } while ((bVar24 & 0x80) == 0);
                }
                sVar40 = 2;
                __s2 = cond_tbl_7274;
                do {
                  iVar8 = strncmp((char *)pbVar31,__s2,sVar40);
                  if (iVar8 == 0) {
                    plVar12 = (long *)FUN_00104d70();
                    pbVar32 = pbVar31 + sVar40;
                    if ((*(byte *)(*plVar12 + 1 + (ulong)pbVar31[sVar40] * 2) & 0x20) != 0) break;
                  }
                  sVar40 = *(size_t *)(__s2 + 0x20);
                  __s2 = __s2 + 0x18;
                  pbVar32 = (byte *)l;
                } while (sVar40 != 0);
                l = (char *)pbVar32;
                pbVar31 = (byte *)l;
                uVar29 = *(uint *)(__s2 + 0x10);
                pmVar15->cond = (uint8_t)uVar29;
                uVar29 = uVar29 & 0xff;
                plVar3 = (ms->c).li;
                uVar2 = plVar3[uVar25].last_cond;
                uVar9 = uVar29;
                if (uVar29 == 2) {
                  if (1 < uVar2 - 1) {
                    if ((*(byte *)&ms->flags & 0x40) != 0) {
                      file_magwarn(ms,"syntax error: `elif\'");
                    }
                    goto LAB_00107634;
                  }
                }
                else if (uVar29 < 3) {
                  if (((uVar29 != 0) && (uVar9 = uVar2, uVar29 == 1)) &&
                     (uVar9 = uVar29, (uVar2 & 0xfffffffd) != 0)) {
                    if ((*(byte *)&ms->flags & 0x40) != 0) {
                      file_magwarn(ms,"syntax error: `if\'");
                    }
                    goto LAB_00107634;
                  }
                }
                else {
                  uVar9 = uVar2;
                  if (uVar29 == 3) {
                    if (1 < uVar2 - 1) {
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"syntax error: `else\'");
                      }
                      goto LAB_00107634;
                    }
                    uVar9 = 0;
                  }
                }
                plVar3[uVar25].last_cond = uVar9;
                bVar24 = *l;
                if ((bVar24 & 0x80) == 0) {
                  plVar12 = (long *)FUN_00104d70();
                  do {
                    if ((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x20) == 0) break;
                    pbVar31 = pbVar31 + 1;
                    bVar24 = *pbVar31;
                    l = (char *)pbVar31;
                  } while ((bVar24 & 0x80) == 0);
                }
                if (bVar24 == 0x75) {
                  uVar29 = get_type(type_tbl,(char *)(pbVar31 + 1),&l);
                  pmVar15->type = (uint8_t)uVar29;
                  if ((uint8_t)uVar29 == '\0') {
                    uVar29 = get_standard_integer_type(l,&l);
                    pmVar15->type = (uint8_t)uVar29;
                    pcVar30 = l;
                    if ((uint8_t)uVar29 == '\0') goto LAB_001078ed;
                  }
                  uVar25 = (ulong)uVar29;
                  pmVar15->flag = pmVar15->flag | 8;
LAB_00107b2f:
                  pmVar15->mask_op = '\0';
                  if (*l != '~') goto LAB_00107b3c;
                  if (((byte)uVar25 < 0x2f) && ((0x6200001e2020U >> (uVar25 & 0x3f) & 1) != 0)) {
LAB_00108dc4:
                    if ((*(byte *)&ms->flags & 0x40) != 0) {
                      file_magwarn(ms,"\'~\' invalid for string types");
                    }
                  }
                  else {
                    pmVar15->mask_op = '@';
                  }
                  l = l + 1;
                  (pmVar15->_u)._s._count = 0;
                  bVar24 = pmVar15->type;
                  if (bVar24 != 0xd) goto LAB_00107b50;
LAB_00107fb8:
                  local_118 = (byte *)l;
                  (pmVar15->_u)._s._flags = 0x80;
                  bVar24 = *l;
                  iVar8 = get_op(bVar24);
                  uVar25 = (ulong)bVar24;
                  if (iVar8 != -1) {
                    if (iVar8 == 6) {
                      plVar12 = (long *)FUN_00104d70();
                      lVar14 = *plVar12;
LAB_00108187:
                      uVar25 = (ulong)local_118[1];
                      bVar43 = false;
                      uVar6 = *(ushort *)(lVar14 + uVar25 * 2);
                      do {
                        while( true ) {
                          pbVar31 = local_118;
                          cVar23 = (char)uVar25;
                          local_118 = pbVar31 + 1;
                          if ((uVar6 & 0x2000) != 0) goto LAB_00108961;
                          if (false) goto switchD_001081c2_caseD_a;
                          switch((int)uVar25 - 0x30U & 0xff) {
                          case 0:
                          case 1:
                          case 2:
                          case 3:
                          case 4:
                          case 5:
                          case 6:
                          case 7:
                          case 8:
                          case 9:
                            if ((bVar43) && ((*(byte *)&ms->flags & 0x40) != 0)) {
                              file_magwarn(ms,"multiple ranges");
                            }
                            uVar25 = strtoul((char *)local_118,&t_1,0);
                            (pmVar15->_u)._s._count = (uint32_t)uVar25;
                            if ((uint32_t)uVar25 == 0) {
                              file_magwarn(ms,"zero range");
                            }
                            lVar14 = *plVar12;
                            bVar43 = true;
                            pbVar31 = (byte *)(t_1 + -1);
                            pbVar32 = (byte *)t_1;
                            break;
                          default:
                            goto switchD_001081c2_caseD_a;
                          case 0x12:
                            if (pmVar15->type != '\r') {
                              uVar25 = 0x42;
                              goto LAB_00108314;
                            }
                            (pmVar15->_u)._s._flags = (pmVar15->_u)._s._flags & 0xfffff07f | 0x80;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x13:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 8;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x18:
                            if (pmVar15->type != '\r') {
                              uVar25 = 0x48;
                              goto LAB_00108314;
                            }
                            (pmVar15->_u)._s._flags = (pmVar15->_u)._s._flags & 0xfffff07f | 0x100;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x1a:
                            if (pmVar15->type != '\r') {
                              uVar25 = 0x4a;
                              goto LAB_00108314;
                            }
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 0x1000;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x1c:
                            if (pmVar15->type != '\r') {
                              uVar25 = 0x4c;
                              goto LAB_00108314;
                            }
                            (pmVar15->_u)._s._flags = (pmVar15->_u)._s._flags & 0xfffff07f | 0x400;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x24:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 0x2000;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x27:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 1;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x32:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 0x40;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x33:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 4;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x38:
                            if (pmVar15->type != '\r') {
                              uVar25 = 0x68;
                              goto LAB_00108314;
                            }
                            (pmVar15->_u)._s._flags = (pmVar15->_u)._s._flags & 0xfffff07f | 0x200;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x3c:
                            if ((pmVar15->type - 0xd & 0xfb) != 0) {
                              uVar25 = 0x6c;
                              goto LAB_00108314;
                            }
                            (pmVar15->_u)._s._flags = (pmVar15->_u)._s._flags & 0xfffff07f | 0x800;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x43:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 0x10;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x44:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 0x20;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                            break;
                          case 0x47:
                            puVar1 = &(pmVar15->_u)._s._flags;
                            *puVar1 = *puVar1 | 2;
                            pbVar32 = pbVar31 + 2;
                            pbVar31 = local_118;
                          }
                          bVar24 = pbVar31[1];
                          uVar25 = (ulong)bVar24;
                          if (bVar24 == 0x2f) break;
                          uVar6 = *(ushort *)(lVar14 + (ulong)bVar24 * 2);
                          local_118 = pbVar31;
                        }
                        uVar25 = (ulong)pbVar31[2];
                        uVar6 = *(ushort *)(lVar14 + uVar25 * 2);
                        local_118 = pbVar32;
                      } while ((uVar6 & 0x2000) == 0);
                      local_118 = pbVar31 + 1;
                      cVar23 = '/';
                      if ((*(byte *)(lVar14 + 0x5f) & 0x20) == 0) {
switchD_001081c2_caseD_a:
                        uVar25 = (ulong)(uint)(int)cVar23;
LAB_00108314:
                        if ((*(byte *)&ms->flags & 0x40) != 0) {
                          file_magwarn(ms,"string modifier `%c\' invalid",uVar25);
                        }
                      }
                      else {
LAB_00108961:
                        if ((*(byte *)&ms->flags & 0x40) == 0) goto LAB_001089b7;
                        bVar24 = pmVar15->type;
                        uVar29 = (pmVar15->_u)._s._flags;
                        if (bVar24 == 0x11) {
                          if (((uVar29 & 0x800) == 0) && ((uVar29 & 0xf80) != 0)) {
LAB_00109071:
                            file_magwarn(ms,
                                         "\'/BHhLl\' modifiers are only allowed for pascal strings\n"
                                        );
                          }
                          else {
switchD_001089a7_caseD_11:
                            if ((uVar29 & 1) == 0) {
                              if ((uVar29 & 2) == 0) goto LAB_001089b7;
                              file_magwarn(ms,"\'/%c\' not allowed on regex\n",0x77);
                            }
                            else {
                              file_magwarn(ms,"\'/%c\' not allowed on regex\n",0x57);
                            }
                          }
                        }
                        else if (bVar24 == 0xd) {
switchD_001089a7_caseD_5:
                          if ((uVar29 & 0x10) == 0) goto LAB_001089b7;
                          file_magwarn(ms,"\'/%c\' only allowed on regex and search\n",0x73);
                        }
                        else {
                          if ((uVar29 & 0xf80) != 0) goto LAB_00109071;
                          if (false) {
switchD_001089a7_caseD_6:
                            file_magwarn(ms,"coding error: m->type=%d\n",(ulong)bVar24);
                          }
                          else {
                            switch(bVar24) {
                            case 5:
                              goto switchD_001089a7_caseD_5;
                            default:
                              goto switchD_001089a7_caseD_6;
                            case 0x11:
                              goto switchD_001089a7_caseD_11;
                            case 0x12:
                            case 0x13:
                              if (uVar29 == 0) {
LAB_001089b7:
                                uVar25 = (ulong)pbVar31[1];
                                l = (char *)local_118;
                                goto LAB_00107bf0;
                              }
                              file_magwarn(ms,"no modifiers allowed for 16-bit strings\n");
                              break;
                            case 0x14:
                              if ((pmVar15->_u)._s._count != 0) goto LAB_001089b7;
                              file_magwarn(ms,"missing range; defaulting to %d\n",100);
                              (pmVar15->_u)._s._count = 100;
                            }
                          }
                        }
                      }
                    }
                    else {
LAB_00107ff2:
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"invalid string/indirect op: `%c\'",(ulong)(uint)(int)*t);
                      }
                    }
                    goto LAB_00107634;
                  }
                }
                else {
                  uVar29 = get_type(type_tbl,(char *)pbVar31,&l);
                  pcVar30 = l;
                  pmVar15->type = (uint8_t)uVar29;
                  uVar25 = (ulong)uVar29;
                  if ((uint8_t)uVar29 != '\0') goto LAB_00107b2f;
                  if (*l == 'd') {
                    uVar29 = get_standard_integer_type(l,&l);
                    pmVar15->type = (uint8_t)uVar29;
                    uVar25 = (ulong)uVar29;
                    pcVar30 = l;
                    if ((uint8_t)uVar29 == '\0') goto LAB_001078ed;
                    goto LAB_00107b2f;
                  }
                  if ((*l != 's') ||
                     (plVar12 = (long *)FUN_00104d70(),
                     (*(byte *)(*plVar12 + 1 + (ulong)(byte)pcVar30[1] * 2) & 4) != 0)) {
LAB_001078ed:
                    uVar29 = get_type(special_tbl,pcVar30,&l);
                    pmVar15->type = (uint8_t)uVar29;
                    uVar25 = (ulong)uVar29;
                    if ((uint8_t)uVar29 == '\0') {
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"type `%s\' invalid",l);
                      }
                      goto LAB_00107634;
                    }
                    goto LAB_00107b2f;
                  }
                  l = pcVar30 + 1;
                  pmVar15->type = '\x05';
                  pmVar15->mask_op = '\0';
                  if (pcVar30[1] == '~') goto LAB_00108dc4;
LAB_00107b3c:
                  bVar24 = pmVar15->type;
                  (pmVar15->_u)._s._count = 0;
                  if (bVar24 == 0xd) goto LAB_00107fb8;
LAB_00107b50:
                  local_118 = (byte *)l;
                  (pmVar15->_u)._s._flags = 0;
                  bVar36 = *l;
                  iVar8 = get_op(bVar36);
                  uVar25 = (ulong)bVar36;
                  if (iVar8 != -1) {
                    if ((0x2e < bVar24) || ((0x6200001e0020U >> ((ulong)bVar24 & 0x3f) & 1) == 0)) {
                      pmVar15->mask_op = pmVar15->mask_op | (byte)iVar8;
                      l_1 = (char *)local_118 + 1;
                      uVar13 = strtoull(l_1,&t_1,0);
                      l_1 = t_1;
                      if ((pmVar15->flag & 8) == 0) {
                        uVar13 = file_signextend(ms,pmVar15,uVar13);
                      }
                      (pmVar15->_u)._mask = uVar13;
                      eatsize(&l_1);
                      l = l_1;
                      uVar25 = (ulong)(byte)*l_1;
                      local_118 = (byte *)l_1;
                      goto LAB_00107bf0;
                    }
                    if (iVar8 != 6) goto LAB_00107ff2;
                    plVar12 = (long *)FUN_00104d70();
                    lVar14 = *plVar12;
                    pbVar31 = local_118;
                    if (bVar24 == 0x29) {
                      while( true ) {
                        bVar24 = pbVar31[1];
                        local_118 = pbVar31 + 1;
                        if ((*(byte *)(lVar14 + 1 + (ulong)bVar24 * 2) & 0x20) != 0) break;
                        if (bVar24 != 0x72) {
                          if ((*(byte *)&ms->flags & 0x40) != 0) {
                            file_magwarn(ms,"indirect modifier `%c\' invalid",
                                         (ulong)(uint)(int)(char)bVar24);
                          }
                          goto LAB_00107634;
                        }
                        puVar1 = &(pmVar15->_u)._s._flags;
                        *puVar1 = *puVar1 | 1;
                        pbVar31 = local_118;
                      }
                      uVar25 = (ulong)pbVar31[1];
                      l = (char *)local_118;
                      goto LAB_00107bf0;
                    }
                    goto LAB_00108187;
                  }
                }
LAB_00107bf0:
                if ((uVar25 & 0x80) == 0) {
                  plVar12 = (long *)FUN_00104d70();
                  do {
                    if ((*(byte *)(*plVar12 + 1 + uVar25 * 2) & 0x20) == 0) break;
                    local_118 = local_118 + 1;
                    uVar25 = (ulong)*local_118;
                    l = (char *)local_118;
                  } while ((*local_118 & 0x80) == 0);
                }
                uVar20 = (uint8_t)uVar25;
                if ((char)uVar20 < '?') {
                  if (((char)uVar20 < '!') || (false)) goto switchD_00107c71_caseD_1;
                  switch((int)uVar25 - 0x21U & 0xff) {
                  case 0:
                    l = (char *)(local_118 + 1);
                    pmVar15->reln = uVar20;
                    break;
                  default:
                    goto switchD_00107c71_caseD_1;
                  case 5:
                  case 0x1c:
                    goto switchD_00107c71_caseD_5;
                  case 0x1b:
                  case 0x1d:
                    l = (char *)(local_118 + 1);
                    pmVar15->reln = uVar20;
                    if (local_118[1] == 0x3d) {
                      if ((*(byte *)&ms->flags & 0x40) != 0) {
                        file_magwarn(ms,"%c= not supported",uVar25);
                        goto LAB_00107634;
                      }
                      goto LAB_001082eb;
                    }
                  }
LAB_00108216:
                  if (uVar20 != 'x') goto LAB_001080eb;
                }
                else {
                  if (uVar20 == '^') {
switchD_00107c71_caseD_5:
                    l = (char *)(local_118 + 1);
                    pmVar15->reln = uVar20;
                    if (local_118[1] == 0x3d) {
LAB_001082eb:
                      l = (char *)(local_118 + 2);
                    }
                    goto LAB_00108216;
                  }
switchD_00107c71_caseD_1:
                  pmVar15->reln = '=';
                  if (((*local_118 == 0x78) && (bVar24 = local_118[1], (bVar24 & 0x80) == 0)) &&
                     ((plVar12 = (long *)FUN_00104d70(),
                      (*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x20) != 0 || (bVar24 == 0))))
                  {
                    pmVar15->reln = 'x';
                    l = (char *)(local_118 + 1);
                  }
                  else {
LAB_001080eb:
                    pcVar30 = l;
                    if (false) {
switchD_0010810b_caseD_6:
                      piVar18 = __errno_location();
                      *piVar18 = 0;
                      uVar13 = strtoull(pcVar30,&t_1,0);
                      if ((pmVar15->flag & 8) == 0) {
                        uVar13 = file_signextend(ms,pmVar15,uVar13);
                      }
                      (pmVar15->value).q = uVar13;
                      if (*piVar18 == 0) {
                        l = t_1;
                        eatsize(&l);
                      }
                    }
                    else {
                      switch(pmVar15->type) {
                      case '\x05':
                      case '\r':
                      case '\x11':
                      case '\x12':
                      case '\x13':
                      case '\x14':
                      case '-':
                      case '.':
                      case '0':
                        bVar24 = *l;
                        bVar43 = action == 2;
                        pat = &pmVar15->value;
                        pVVar22 = pat;
                        pbVar31 = (byte *)l;
                        if (bVar24 != 0) {
                          plVar12 = (long *)FUN_00104d70();
                          pbVar31 = (byte *)pcVar30;
                          while( true ) {
                            pbVar32 = pbVar31 + 1;
                            if ((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x20) != 0) break;
                            if ((VALUETYPE *)((long)&pmVar15->value + 0x5f) == pVVar22) {
                              file_error(ms,L'\0',"string too long: `%s\'",pcVar30);
                              l = (char *)0x0;
                              if ((*(byte *)&ms->flags & 0x40) != 0) {
                                file_magwarn(ms,"cannot get string from `%s\'",pat);
                              }
                              goto LAB_00107634;
                            }
                            if (bVar24 != 0x5c) {
                              pVVar22->s[0] = bVar24;
                              pbVar31 = pbVar32;
                              goto LAB_001085ba;
                            }
                            bVar24 = pbVar31[1];
                            uVar29 = (uint)(char)bVar24;
                            pbVar38 = pbVar31 + 2;
                            if (false) {
switchD_0010861c_caseD_1:
                              if (bVar43) {
                                if ((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x40) == 0) {
                                  file_magwarn(ms,"unknown escape sequence: \\%03o");
                                }
                                else {
                                  pcVar27 = strchr("<>&^=!",uVar29);
                                  if ((pcVar27 == (char *)0x0) &&
                                     ((pmVar15->type != '\x11' ||
                                      (pcVar27 = strchr("[]().*?^$|{}",uVar29),
                                      pcVar27 == (char *)0x0)))) {
                                    file_magwarn(ms,"no need to escape `%c\'",(ulong)uVar29);
                                  }
                                }
                              }
                              goto switchD_0010861c_caseD_20;
                            }
                            switch(bVar24) {
                            case 0:
                              pbVar31 = pbVar32;
                              if (bVar43) {
                                file_magwarn(ms,"incomplete escape");
                              }
                              goto LAB_001088cb;
                            default:
                              goto switchD_0010861c_caseD_1;
                            case 9:
                              if (bVar43) {
                                file_magwarn(ms,"escaped tab found, use \\t instead");
                                bVar43 = false;
                              }
                            case 0x20:
                            case 0x21:
                            case 0x26:
                            case 0x3c:
                            case 0x3d:
                            case 0x3e:
                            case 0x5c:
                            case 0x5e:
switchD_0010861c_caseD_20:
                              pVVar22->b = bVar24;
                              pbVar31 = pbVar38;
                              break;
                            case 0x30:
                            case 0x31:
                            case 0x32:
                            case 0x33:
                            case 0x34:
                            case 0x35:
                            case 0x36:
                            case 0x37:
                              bVar24 = (byte)(uVar29 - 0x30);
                              if ((int)(char)pbVar31[2] - 0x30U < 8) {
                                uVar29 = (uVar29 - 0x30) * 8 | (int)(char)pbVar31[2] - 0x30U;
                                bVar24 = (byte)uVar29;
                                if ((int)(char)pbVar31[3] - 0x30U < 8) {
                                  pbVar38 = pbVar31 + 4;
                                  bVar24 = (byte)(uVar29 << 3) |
                                           (byte)((int)(char)pbVar31[3] - 0x30U);
                                }
                                else {
                                  pbVar38 = pbVar31 + 3;
                                }
                              }
                              pVVar22->b = bVar24;
                              pbVar31 = pbVar38;
                              break;
                            case 0x61:
                              pVVar22->b = 7;
                              pbVar31 = pbVar38;
                              break;
                            case 0x62:
                              pVVar22->b = 8;
                              pbVar31 = pbVar38;
                              break;
                            case 0x66:
                              pVVar22->b = 0xc;
                              pbVar31 = pbVar38;
                              break;
                            case 0x6e:
                              pVVar22->b = 10;
                              pbVar31 = pbVar38;
                              break;
                            case 0x72:
                              pVVar22->b = 0xd;
                              pbVar31 = pbVar38;
                              break;
                            case 0x74:
                              pVVar22->b = 9;
                              pbVar31 = pbVar38;
                              break;
                            case 0x76:
                              pVVar22->b = 0xb;
                              pbVar31 = pbVar38;
                              break;
                            case 0x78:
                              iVar8 = hextoint((int)(char)pbVar31[2]);
                              if (-1 < iVar8) {
                                iVar10 = hextoint((int)(char)pbVar31[3]);
                                bVar24 = (byte)iVar8;
                                if (iVar10 < 0) {
                                  pbVar38 = pbVar31 + 3;
                                }
                                else {
                                  pbVar38 = pbVar31 + 4;
                                  bVar24 = bVar24 * '\x10' + (char)iVar10;
                                }
                              }
                              pVVar22->b = bVar24;
                              pbVar31 = pbVar38;
                            }
LAB_001085ba:
                            pVVar22 = (VALUETYPE *)(pVVar22->hs + 1);
                            bVar24 = *pbVar31;
                            if (bVar24 == 0) break;
                          }
                        }
LAB_001088cb:
                        pVVar22->b = 0;
                        uVar20 = (char)pVVar22 - (char)pat;
                        pmVar15->vallen = uVar20;
                        if (pmVar15->type == '\r') {
                          sVar42 = file_pstring_length_size(pmVar15);
                          pmVar15->vallen = uVar20 + (char)sVar42;
                          l = (char *)pbVar31;
                        }
                        else {
                          l = (char *)pbVar31;
                          if (pmVar15->type == '\x11') {
                            wVar7 = file_regcomp((file_regex_t *)&t_1,pat->s,L'\x01');
                            if (wVar7 != L'\0') {
                              if ((*(byte *)&ms->flags & 0x40) != 0) {
                                file_regerror((file_regex_t *)&t_1,wVar7,ms);
                              }
                              file_regfree((file_regex_t *)&t_1);
                              goto LAB_00107634;
                            }
                            file_regfree((file_regex_t *)&t_1);
                          }
                        }
                        goto LAB_0010821f;
                      default:
                        goto switchD_0010810b_caseD_6;
                      case '!':
                      case '\"':
                      case '#':
                        piVar18 = __errno_location();
                        *piVar18 = 0;
                        fVar45 = strtof(pcVar30,&t_1);
                        (pmVar15->value).f = fVar45;
                        iVar8 = *piVar18;
                        break;
                      case '$':
                      case '%':
                      case '&':
                        piVar18 = __errno_location();
                        *piVar18 = 0;
                        dVar46 = strtod(pcVar30,&t_1);
                        (pmVar15->value).d = dVar46;
                        iVar8 = *piVar18;
                      }
                      if (iVar8 == 0) {
                        l = t_1;
                      }
                    }
                  }
                }
LAB_0010821f:
                pbVar31 = (byte *)l;
                bVar24 = *l;
                if ((bVar24 & 0x80) == 0) {
                  plVar12 = (long *)FUN_00104d70();
                  do {
                    if ((*(byte *)(*plVar12 + 1 + (ulong)bVar24 * 2) & 0x20) == 0) break;
                    pbVar31 = pbVar31 + 1;
                    bVar24 = *pbVar31;
                    l = (char *)pbVar31;
                  } while ((bVar24 & 0x80) == 0);
                }
                if (bVar24 == 8) {
                  pmVar15->flag = pmVar15->flag | 0x10;
                  l = (char *)(pbVar31 + 1);
                }
                else if ((bVar24 == 0x5c) && (pbVar31[1] == 0x62)) {
                  pmVar15->flag = pmVar15->flag | 0x10;
                  l = (char *)(pbVar31 + 2);
                }
                lVar14 = 0;
                pbVar31 = (byte *)l;
                do {
                  l = (char *)(pbVar31 + 1);
                  bVar24 = *pbVar31;
                  lVar17 = lVar14 + 1;
                  pmVar15->desc[lVar14] = bVar24;
                  if (bVar24 == 0) {
                    if (lVar17 != 0x40) goto LAB_001082b0;
                    break;
                  }
                  lVar14 = lVar17;
                  pbVar31 = (byte *)l;
                } while (lVar17 != 0x40);
                pmVar15->desc[0x3f] = '\0';
                if ((*(byte *)&ms->flags & 0x40) != 0) {
                  file_magwarn(ms,"description `%s\' truncated",pmVar15->desc);
LAB_001082b0:
                  if ((*(byte *)&ms->flags & 0x40) != 0) {
                    cVar23 = pmVar15->desc[0];
                    pcVar30 = pmVar15->desc;
                    pcVar27 = pcVar30;
                    if (cVar23 != '\0') {
LAB_00108ac0:
                      if (cVar23 != '%') goto LAB_00108ab0;
                      bVar24 = pmVar15->type;
                      if (bVar24 < 0x31) {
                        uVar25 = (ulong)bVar24;
                        iVar8 = file_formats[uVar25];
                        if (iVar8 == 0) {
                          file_magwarn(ms,"No format string for `%s\' with description `%s\'",
                                       pcVar30,*(undefined8 *)(file_names + uVar25 * 8));
                        }
                        else {
                          bVar36 = pcVar27[1];
                          uVar21 = (ulong)bVar36;
                          pcVar37 = pcVar27 + 1;
                          if (bVar36 == 0) {
                            pcVar27 = "missing format spec";
                          }
                          else {
                            if (iVar8 == 3) {
                              bVar43 = true;
                              iVar8 = 0;
LAB_00108bdb:
                              pcVar41 = pcVar37;
                              bVar24 = bVar36;
                              if (bVar36 == 0x2d) {
                                bVar24 = pcVar27[2];
                                pcVar41 = pcVar27 + 2;
                              }
                              if (bVar24 == 0x2e) {
                                bVar24 = pcVar41[1];
                                pcVar41 = pcVar41 + 1;
                              }
                              plVar12 = (long *)FUN_00104d70();
                              uVar35 = 0;
                              lVar14 = *plVar12;
                              uVar21 = 0;
                              while ((*(byte *)(lVar14 + 1 + (ulong)bVar24 * 2) & 8) != 0) {
                                iVar10 = (int)(char)bVar24;
                                bVar24 = pcVar41[1];
                                pcVar41 = pcVar41 + 1;
                                uVar35 = uVar35 + 1;
                                uVar21 = (long)(iVar10 + -0x30) + uVar21 * 10;
                              }
                              if ((5 < uVar35) || (0x400 < uVar21)) goto switchD_00108cbe_caseD_59;
                              pcVar27 = pcVar41;
                              if (bVar24 == 0x2e) {
                                bVar24 = pcVar41[1];
                                uVar21 = (ulong)bVar24;
                                pcVar27 = pcVar41 + 1;
                                if ((*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0) {
                                  uVar35 = 0;
                                  do {
                                    cVar23 = (char)uVar21;
                                    pcVar19 = pcVar27 + 1;
                                    bVar24 = *pcVar19;
                                    uVar21 = (ulong)bVar24;
                                    uVar26 = (long)pcVar27 - (long)pcVar41;
                                    uVar35 = (long)(cVar23 + -0x30) + uVar35 * 10;
                                    pcVar27 = pcVar19;
                                  } while ((*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0);
                                  if ((5 < uVar26) || (0x400 < uVar35))
                                  goto switchD_00108cbe_caseD_59;
                                }
                              }
                              if (((bVar43) &&
                                  ((bVar24 != 0x6c ||
                                   (pcVar41 = pcVar27 + 1, pcVar27 = pcVar27 + 2, *pcVar41 != 0x6c))
                                  )) || (false)) goto switchD_00108cbe_caseD_59;
                              switch(*pcVar27) {
                              case 'X':
                              case 'd':
                              case 'i':
                              case 'o':
                              case 'u':
                              case 'x':
                                break;
                              default:
                                goto switchD_00108cbe_caseD_59;
                              case 'c':
                                if (iVar8 != 2) goto switchD_00108cbe_caseD_59;
                              }
switchD_00108cbe_caseD_58:
                              do {
                                if (bVar36 == 0x25) {
                                  file_magwarn(ms,
                                               "Too many format strings (should have at most one) for `%s\' with description `%s\'"
                                               ,*(undefined8 *)(file_names + uVar25 * 8),pcVar30);
                                  goto LAB_00107634;
                                }
                                bVar36 = pcVar37[1];
                                pcVar37 = pcVar37 + 1;
                              } while (bVar36 != 0);
                              goto LAB_001082bb;
                            }
                            if (iVar8 < 4) {
                              if (iVar8 != 1) {
                                if (iVar8 != 2) {
                                  load_1_cold();
                                  return;
                                }
                                pcVar41 = pcVar37;
                                if (bVar36 == 0x2d) {
                                  uVar21 = (ulong)(byte)pcVar27[2];
                                  pcVar41 = pcVar27 + 2;
                                }
                                plVar12 = (long *)FUN_00104d70();
                                lVar14 = *plVar12;
                                while ((*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0) {
                                  uVar21 = (ulong)(byte)pcVar41[1];
                                  pcVar41 = pcVar41 + 1;
                                }
                                if ((char)uVar21 == '.') {
                                  uVar21 = (ulong)(byte)pcVar41[1];
                                  bVar24 = *(byte *)(lVar14 + 1 + uVar21 * 2);
                                  while ((bVar24 & 8) != 0) {
                                    uVar21 = (ulong)(byte)pcVar41[2];
                                    pcVar41 = pcVar41 + 1;
                                    bVar24 = *(byte *)(lVar14 + 1 + uVar21 * 2);
                                  }
                                }
                                if ((char)uVar21 != 's') goto switchD_00108cbe_caseD_59;
                                goto switchD_00108cbe_caseD_58;
                              }
                              if (false) {
code_r0x00104d94:
                    // WARNING: Subroutine does not return
                                abort();
                              }
                              switch(bVar24) {
                              default:
                                goto code_r0x00104d94;
                              case 1:
                                bVar43 = false;
                                iVar8 = 2;
                                break;
                              case 2:
                              case 7:
                              case 10:
                                bVar43 = false;
                                iVar8 = 1;
                                break;
                              case 4:
                              case 8:
                              case 0xb:
                              case 0x17:
                              case 0x27:
                              case 0x28:
                              case 0x29:
                                bVar43 = false;
                                iVar8 = 0;
                              }
                              goto LAB_00108bdb;
                            }
                            if (1 < iVar8 - 4U) {
                              load_1_cold();
                              return;
                            }
                            pcVar41 = pcVar37;
                            if (bVar36 == 0x2d) {
                              uVar21 = (ulong)(byte)pcVar27[2];
                              pcVar41 = pcVar27 + 2;
                            }
                            if ((char)uVar21 == '.') {
                              uVar21 = (ulong)(byte)pcVar41[1];
                              pcVar41 = pcVar41 + 1;
                            }
                            plVar12 = (long *)FUN_00104d70();
                            uVar26 = 0;
                            lVar14 = *plVar12;
                            uVar35 = 0;
                            while (cVar23 = (char)uVar21,
                                  (*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0) {
                              uVar21 = (ulong)(byte)pcVar41[1];
                              pcVar41 = pcVar41 + 1;
                              uVar26 = uVar26 + 1;
                              uVar35 = (long)(cVar23 + -0x30) + uVar35 * 10;
                            }
                            if ((uVar26 < 6) && (uVar35 < 0x401)) {
                              if ((cVar23 == '.') &&
                                 (uVar21 = (ulong)(byte)pcVar41[1],
                                 (*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0)) {
                                uVar35 = 0;
                                uVar26 = 0;
                                do {
                                  uVar28 = uVar26 + 1;
                                  uVar35 = (long)((char)uVar21 + -0x30) + uVar35 * 10;
                                  uVar21 = (ulong)(byte)pcVar41[uVar26 + 2];
                                  uVar26 = uVar28;
                                } while ((*(byte *)(lVar14 + 1 + uVar21 * 2) & 8) != 0);
                                if ((5 < uVar28) || (0x400 < uVar35))
                                goto switchD_00108cbe_caseD_59;
                              }
                              cVar23 = (char)uVar21;
                              if (cVar23 < 'H') {
                                if (cVar23 < 'E') goto switchD_00108cbe_caseD_59;
                              }
                              else if (2 < (byte)(cVar23 + 0x9bU)) goto switchD_00108cbe_caseD_59;
                              goto switchD_00108cbe_caseD_58;
                            }
switchD_00108cbe_caseD_59:
                            pcVar27 = "too long";
                          }
                          file_magwarn(ms,"Printf format is %s for type `%s\' in description `%s\'",
                                       pcVar27,*(undefined8 *)(file_names + uVar25 * 8),pcVar30);
                        }
                      }
                      else {
                        file_magwarn(ms,
                                     "Internal error inconsistency between m->type and format strings"
                                    );
                      }
                      goto LAB_00107634;
                    }
                  }
                }
LAB_001082bb:
                if (action == 1) {
                  file_mdump(pmVar15);
                }
                pmVar15->mimetype[0] = '\0';
                goto LAB_0010763c;
              }
              if ((*(byte *)&ms->flags & 0x40) != 0) {
                file_magwarn(ms,"offset `%s\' invalid");
              }
            }
          }
LAB_00107634:
          *errs = *errs + 1;
        }
      }
LAB_0010763c:
      ms->line = ms->line + 1;
    }
    if (me.mp != (magic *)0x0) {
      addentry(ms,&me,mset);
    }
    free(line);
    fclose(__stream);
  }
  if (local_40 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return;
code_r0x00107a2c:
  addentry(ms,&me,mset);
  goto LAB_001075e1;
LAB_00108ab0:
  cVar23 = pcVar27[1];
  pcVar27 = pcVar27 + 1;
  if (cVar23 == '\0') goto LAB_001082bb;
  goto LAB_00108ac0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

magic_map * apprentice_load(magic_set *ms,char *fn,int action)

{
  undefined8 *puVar1;
  long lVar2;
  magic **ppmVar3;
  byte bVar4;
  int iVar5;
  uint uVar6;
  magic *pmVar7;
  char *pcVar8;
  long *plVar9;
  magic_entry *pmVar10;
  void *pvVar11;
  DIR *__dirp;
  dirent *pdVar12;
  ulong uVar13;
  long lVar14;
  size_t sVar15;
  size_t sVar16;
  uint32_t *puVar17;
  ulong uVar18;
  magic_entry *pmVar19;
  undefined *puVar20;
  char *pcVar21;
  uint32_t uVar22;
  uint uVar23;
  magic *pmVar24;
  size_t __size;
  ulong uVar25;
  magic_entry *pmVar26;
  long in_FS_OFFSET;
  void *local_140;
  magic_entry_set *local_130;
  magic_map *local_128;
  long local_120;
  magic_entry_set *local_110;
  int errs;
  char *mfn;
  magic_entry_set mset [2];
  stat st;
  
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  ms->flags = ms->flags | 0x40;
  errs = 0;
  mset[0].me = (magic_entry *)0x0;
  mset[0].count = 0;
  mset[0].max = 0;
  mset[1].me = (magic_entry *)0x0;
  mset[1].count = 0;
  mset[1].max = 0;
  local_128 = (magic_map *)calloc(1,0x30);
  if (local_128 == (magic_map *)0x0) {
    file_oomem(ms,0x30);
  }
  else {
    local_128->type = 1;
    if (action == 1) {
      __fprintf_chk(_stderr,1,"%s\n","cont\toffset\ttype\topcode\tmask\tvalue\tdesc");
    }
    iVar5 = __xstat(1,fn,(stat *)&st);
    if ((iVar5 == 0) && ((st.st_mode & 0xf000) == 0x4000)) {
      __dirp = opendir(fn);
      if (__dirp != (DIR *)0x0) {
        local_140 = (void *)0x0;
        uVar18 = 0;
        local_130 = (magic_entry_set *)0x0;
        do {
          pdVar12 = readdir(__dirp);
          while( true ) {
            if (pdVar12 == (dirent *)0x0) {
              closedir(__dirp);
              qsort(local_140,uVar18,8,cmpstrp);
              if (uVar18 != 0) {
                uVar13 = 0;
                do {
                  puVar1 = (undefined8 *)((long)local_140 + uVar13 * 8);
                  load_1(ms,action,(char *)*puVar1,&errs,mset);
                  free((void *)*puVar1);
                  uVar13 = (ulong)((int)uVar13 + 1);
                } while (uVar13 < uVar18);
              }
              free(local_140);
              goto LAB_001093a0;
            }
            iVar5 = __asprintf_chk(&mfn,1,"%s/%s",fn,pdVar12->d_name);
            if (iVar5 < 0) {
              sVar15 = strlen(fn);
              sVar16 = strlen(pdVar12->d_name);
              file_oomem(ms,sVar15 + 2 + sVar16);
              errs = errs + 1;
              closedir(__dirp);
              goto LAB_0010977e;
            }
            iVar5 = __xstat(1,mfn,(stat *)&st);
            if ((iVar5 == -1) || ((st.st_mode & 0xf000) != 0x8000)) break;
            if (local_130 <= uVar18) {
              lVar14 = (long)local_130 + 1;
              local_130 = (magic_entry_set *)(lVar14 * 2);
              sVar15 = lVar14 * 0x10;
              local_140 = realloc(local_140,sVar15);
              if (local_140 == (void *)0x0) {
                file_oomem(ms,sVar15);
                free(mfn);
                closedir(__dirp);
                goto LAB_00109a97;
              }
            }
            *(char **)((long)local_140 + uVar18 * 8) = mfn;
            uVar18 = uVar18 + 1;
            pdVar12 = readdir(__dirp);
          }
          free(mfn);
        } while( true );
      }
LAB_00109a97:
      errs = errs + 1;
    }
    else {
      load_1(ms,action,fn,&errs,mset);
LAB_001093a0:
      local_110 = mset;
      if (errs == 0) {
        local_120 = 0;
        local_130 = local_110;
LAB_001093bf:
        uVar18 = 0;
        uVar22 = local_130->count;
        pmVar26 = local_130->me;
        if (uVar22 != 0) {
LAB_001093f7:
          do {
            pmVar10 = pmVar26 + uVar18;
            pmVar7 = pmVar10->mp;
            if (pmVar7->cont_level == 0) {
              uVar13 = (ulong)((int)uVar18 + 1);
              pmVar19 = pmVar26 + uVar13;
              pmVar24 = pmVar7;
              uVar25 = uVar18;
              do {
                uVar18 = uVar13;
                if (true) {
                  switch(pmVar7->type) {
                  case '\x01':
                  case '\x02':
                  case '\x04':
                  case '\x06':
                  case '\a':
                  case '\b':
                  case '\t':
                  case '\n':
                  case '\v':
                  case '\f':
                  case '\x0e':
                  case '\x0f':
                  case '\x10':
                  case '\x15':
                  case '\x16':
                  case '\x17':
                  case '\x18':
                  case '\x19':
                  case '\x1a':
                  case '\x1b':
                  case '\x1c':
                  case '\x1d':
                  case '\x1e':
                  case '\x1f':
                  case ' ':
                  case '!':
                  case '\"':
                  case '#':
                  case '$':
                  case '%':
                  case '&':
                  case '*':
                  case '+':
                  case ',':
                  case '0':
switchD_00109438_caseD_1:
                    pmVar24->flag = pmVar24->flag | 0x20;
                    break;
                  case '\x05':
                  case '\r':
                  case '\x12':
                  case '\x13':
                    bVar4 = pmVar24->flag | 0x40;
                    if ((*(byte *)((long)&pmVar24->_u + 4) & 0x20) == 0) {
                      bVar4 = pmVar24->flag | 0x20;
                    }
                    pmVar24->flag = bVar4;
                    break;
                  case '\x11':
                  case '\x14':
                    uVar6 = (pmVar24->_u)._s._flags;
                    bVar4 = pmVar24->flag;
                    if ((uVar6 & 0x40) != 0) {
                      bVar4 = bVar4 | 0x20;
                      pmVar24->flag = bVar4;
                    }
                    if ((uVar6 & 0x20) != 0) {
                      bVar4 = bVar4 | 0x40;
                      pmVar24->flag = bVar4;
                    }
                    if ((bVar4 & 0x60) == 0) {
                      iVar5 = file_looks_utf8((pmVar7->value).us,(ulong)pmVar7->vallen,
                                              (unichar *)0x0,(size_t *)0x0);
                      if (iVar5 < 1) goto switchD_00109438_caseD_1;
                      pmVar24->flag = pmVar24->flag | 0x40;
                    }
                  }
                }
                if ((*(byte *)&ms->flags & 1) != 0) {
                  pcVar8 = "text";
                  pcVar21 = "(no description)";
                  pmVar7 = pmVar26[uVar25].mp;
                  if ((pmVar7->flag & 0x20) != 0) {
                    pcVar8 = "binary";
                  }
                  if (pmVar7->desc[0] != '\0') {
                    pcVar21 = pmVar7->desc;
                  }
                  puVar20 = &DAT_0011ddf7;
                  if (pmVar7->mimetype[0] != '\0') {
                    puVar20 = &DAT_0011c77d;
                  }
                  __fprintf_chk(_stderr,1,"%s%s%s: %s\n",pmVar7->mimetype,puVar20,pcVar21,pcVar8);
                  pmVar7 = pmVar26[uVar25].mp;
                  if ((pmVar7->flag & 0x20) != 0) {
                    pcVar21 = pmVar7->desc;
                    pcVar8 = strstr(pcVar21,"text");
                    if (((pcVar8 != (char *)0x0) &&
                        ((pcVar21 == pcVar8 ||
                         (plVar9 = (long *)FUN_00104d70(),
                         (*(byte *)(*plVar9 + 1 + (ulong)(byte)pcVar8[-1] * 2) & 0x20) != 0)))) &&
                       ((pcVar8 + -0x5b == pcVar21 ||
                        ((bVar4 = pcVar8[5], bVar4 == 0 ||
                         (plVar9 = (long *)FUN_00104d70(),
                         (*(byte *)(*plVar9 + 1 + (ulong)bVar4 * 2) & 0x20) != 0)))))) {
                      fwrite("*** Possible binary test for text type\n",1,0x27,_stderr);
                    }
                  }
                }
                uVar6 = (uint)uVar18;
                if (uVar22 <= uVar6) goto LAB_00109610;
                pmVar7 = pmVar19->mp;
                pmVar19 = pmVar19 + 1;
                if (pmVar7->cont_level == 0) goto LAB_00109610;
                pmVar24 = pmVar10->mp;
                uVar13 = (ulong)(uVar6 + 1);
                uVar25 = uVar18;
              } while( true );
            }
            uVar6 = (int)uVar18 + 1;
            uVar18 = (ulong)uVar6;
          } while (uVar6 < uVar22);
          goto LAB_0010962d;
        }
        uVar22 = 0;
        if (pmVar26 != (magic_entry *)0x0) goto LAB_00109637;
        goto LAB_00109891;
      }
    }
LAB_0010977e:
    local_110 = mset;
    do {
      pmVar26 = local_110->me;
      if (pmVar26 != (magic_entry *)0x0) {
        uVar22 = local_110->count;
        if (uVar22 != 0) {
          pmVar10 = pmVar26;
          do {
            ppmVar3 = &pmVar10->mp;
            pmVar10 = pmVar10 + 1;
            free(*ppmVar3);
          } while (pmVar26 + (ulong)(uVar22 - 1) + 1 != pmVar10);
        }
        free(pmVar26);
      }
      local_110 = local_110 + 1;
    } while (&st != (stat *)local_110);
    if (errs != 0) {
      apprentice_unmap(local_128);
      local_128 = (magic_map *)0x0;
    }
  }
  if (lVar2 == *(long *)(in_FS_OFFSET + 0x28)) {
    return local_128;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
LAB_00109610:
  pmVar26 = local_130->me;
  uVar22 = local_130->count;
  if (uVar22 <= uVar6) goto LAB_0010962d;
  goto LAB_001093f7;
LAB_0010962d:
  if (pmVar26 != (magic_entry *)0x0) {
LAB_00109637:
    qsort(pmVar26,(ulong)uVar22,0x10,apprentice_sort);
    pmVar26 = local_130->me;
    uVar22 = local_130->count;
  }
  if (uVar22 != 0) {
    uVar18 = 0;
    pmVar10 = pmVar26;
    do {
      pmVar7 = pmVar10->mp;
      uVar6 = (int)uVar18 + 1;
      uVar13._0_2_ = pmVar7->cont_level;
      uVar13._2_1_ = pmVar7->flag;
      uVar13._3_1_ = pmVar7->factor;
      uVar13._4_1_ = pmVar7->reln;
      uVar13._5_1_ = pmVar7->vallen;
      uVar13._6_1_ = pmVar7->type;
      uVar13._7_1_ = pmVar7->in_type;
      if ((uVar13 & 0xff00000000ffff) == 0x3000000000000) {
        pmVar10 = pmVar26 + uVar6;
        goto LAB_001096c1;
      }
      pmVar10 = pmVar10 + 1;
      uVar18 = (ulong)uVar6;
    } while (uVar22 != uVar6);
    goto LAB_001096cf;
  }
LAB_00109891:
  pvVar11 = malloc(0);
  *(void **)((long)local_128->magic + local_120 * 2) = pvVar11;
  if (pvVar11 == (void *)0x0) {
    __size = 0;
LAB_00109b13:
    file_oomem(ms,__size);
    errs = errs + 1;
    goto LAB_0010977e;
  }
  uVar23 = 0;
LAB_00109756:
  local_130 = local_130 + 1;
  *(uint *)((long)local_128->nmagic + local_120) = uVar23;
  local_120 = local_120 + 4;
  if (local_120 == 8) goto LAB_0010977e;
  goto LAB_001093bf;
  while( true ) {
    pmVar7 = pmVar10->mp;
    pmVar10 = pmVar10 + 1;
    if (pmVar7->cont_level == 0) break;
LAB_001096c1:
    uVar6 = (int)uVar18 + 1;
    uVar18 = (ulong)uVar6;
    if (uVar22 <= uVar6) {
      if (uVar22 == uVar6) goto LAB_001096cf;
      pmVar7 = pmVar26[uVar18].mp;
      break;
    }
  }
  ms->line = (ulong)pmVar7->lineno;
  file_magwarn(ms,"level 0 \"default\" did not sort last");
  uVar22 = local_130->count;
  if (uVar22 != 0) {
    pmVar26 = local_130->me;
LAB_001096cf:
    uVar18 = 0;
    uVar6 = 0;
    puVar17 = &pmVar26->cont_count;
    do {
      uVar6 = uVar6 + 1;
      uVar18 = (ulong)((int)uVar18 + *puVar17);
      puVar17 = puVar17 + 4;
    } while (uVar6 < uVar22);
    __size = uVar18 * 0x158;
    pvVar11 = malloc(__size);
    *(void **)((long)local_128->magic + local_120 * 2) = pvVar11;
    if (pvVar11 == (void *)0x0) goto LAB_00109b13;
    uVar18 = 0;
    uVar6 = 0;
    puVar17 = &pmVar26->cont_count;
    while( true ) {
      uVar6 = uVar6 + 1;
      memcpy((void *)(uVar18 * 0x158 + (long)pvVar11),((magic_entry *)(puVar17 + -2))->mp,
             (ulong)*puVar17 * 0x158);
      uVar23 = (int)uVar18 + *puVar17;
      uVar18 = (ulong)uVar23;
      if (uVar22 <= uVar6) break;
      pvVar11 = *(void **)((long)local_128->magic + local_120 * 2);
      puVar17 = puVar17 + 4;
    }
    goto LAB_00109756;
  }
  goto LAB_00109891;
}



int file_apprentice(magic_set *ms,char *fn,int action)

{
  char cVar1;
  long lVar2;
  mlist *mlist;
  int iVar3;
  int iVar4;
  char *pcVar5;
  char *__ptr;
  mlist *pmVar6;
  char *pcVar7;
  magic_map *pmVar8;
  void *pvVar9;
  wchar_t *pwVar10;
  ulong uVar11;
  char *f;
  char *pcVar12;
  int iVar13;
  long in_FS_OFFSET;
  byte bVar14;
  stat st;
  
  bVar14 = 0;
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  if (ms->mlist[0] != (mlist *)0x0) {
    file_reset(ms);
  }
  pcVar5 = magic_getpath(fn,action);
  if (pcVar5 == (char *)0x0) {
    iVar13 = -1;
  }
  else {
    init_file_tables();
    __ptr = strdup(pcVar5);
    if (__ptr == (char *)0x0) {
      uVar11 = 0xffffffffffffffff;
      iVar13 = -1;
      do {
        if (uVar11 == 0) break;
        uVar11 = uVar11 - 1;
        cVar1 = *pcVar5;
        pcVar5 = pcVar5 + (ulong)bVar14 * -2 + 1;
      } while (cVar1 != '\0');
      file_oomem(ms,~uVar11 - 1);
    }
    else {
      mlist_free(ms->mlist[0]);
      pmVar6 = (mlist *)calloc(1,0x28);
      if (pmVar6 == (mlist *)0x0) {
        ms->mlist[0] = (mlist *)0x0;
        file_oomem(ms,0x28);
      }
      else {
        pmVar6->prev = pmVar6;
        mlist = ms->mlist[1];
        pmVar6->next = pmVar6;
        ms->mlist[0] = pmVar6;
        mlist_free(mlist);
        pmVar6 = (mlist *)calloc(1,0x28);
        if (pmVar6 != (mlist *)0x0) {
          pmVar6->prev = pmVar6;
          iVar13 = -1;
          pmVar6->next = pmVar6;
          ms->mlist[1] = pmVar6;
          pcVar5 = __ptr;
          do {
            pcVar12 = (char *)0x0;
            pcVar7 = strchr(pcVar5,0x3a);
            if (pcVar7 != (char *)0x0) {
              *pcVar7 = '\0';
              pcVar12 = pcVar7 + 1;
            }
            if (*pcVar5 == '\0') break;
            if (action == 2) {
              pmVar8 = apprentice_load(ms,pcVar5,2);
              if (pmVar8 == (magic_map *)0x0) {
LAB_0010a05b:
                iVar3 = -1;
                goto LAB_00109e03;
              }
              iVar3 = apprentice_compile(ms,pmVar8,pcVar5);
              if (iVar13 < iVar3) {
                iVar13 = iVar3;
              }
            }
            else {
              pmVar8 = (magic_map *)calloc(1,0x30);
              if (pmVar8 == (magic_map *)0x0) {
                file_oomem(ms,0x30);
                apprentice_unmap((magic_map *)0x0);
LAB_00109d9f:
                bVar14 = *(byte *)&ms->flags;
joined_r0x00109f3c:
                if ((bVar14 & 0x40) != 0) {
                  file_magwarn(ms,"using regular magic file `%s\'",pcVar5);
                }
                pmVar8 = apprentice_load(ms,pcVar5,action);
                if (pmVar8 == (magic_map *)0x0) goto LAB_0010a05b;
LAB_00109dca:
                iVar3 = add_mlist(ms->mlist[0],pmVar8,0);
                if ((iVar3 != -1) && (iVar3 = add_mlist(ms->mlist[1],pmVar8,1), iVar3 != -1)) {
                  if (action == 3) {
                    __printf_chk(1,"Set %zu:\nBinary patterns:\n",0);
                    apprentice_list(ms->mlist[0],0x20);
                    puts("Text patterns:");
                    apprentice_list(ms->mlist[0],0x40);
                    __printf_chk(1,"Set %zu:\nBinary patterns:\n",1);
                    apprentice_list(ms->mlist[1],0x20);
                    puts("Text patterns:");
                    apprentice_list(ms->mlist[1],0x40);
                  }
                  iVar3 = 0;
                  goto LAB_00109e03;
                }
                file_oomem(ms,0x28);
              }
              else {
                pmVar8->type = 0;
                pcVar7 = mkdbname((magic_set *)&ms->flags,pcVar5,0);
                if (pcVar7 == (char *)0x0) {
                  apprentice_unmap(pmVar8);
                  bVar14 = *(byte *)&ms->flags;
                  goto joined_r0x00109f3c;
                }
                iVar3 = open(pcVar7,0);
                if (iVar3 == -1) {
LAB_00109d8f:
                  apprentice_unmap(pmVar8);
                  free(pcVar7);
                  goto LAB_00109d9f;
                }
                iVar4 = __fxstat(1,iVar3,(stat *)&st);
                if (iVar4 == -1) {
                  pwVar10 = __errno_location();
                  f = "cannot stat `%s\'";
LAB_00109fbf:
                  file_error(ms,*pwVar10,f,pcVar7);
LAB_00109d87:
                  close(iVar3);
                  goto LAB_00109d8f;
                }
                if (st.st_size < 8) {
                  file_error(ms,L'\0',"file `%s\' is too %s",pcVar7,"small");
                  goto LAB_00109d87;
                }
                pmVar8->len = st.st_size;
                pmVar8->type = 2;
                pvVar9 = mmap((void *)0x0,st.st_size,3,2,iVar3,0);
                pmVar8->p = pvVar9;
                if (pvVar9 == (void *)0xffffffffffffffff) {
                  pwVar10 = __errno_location();
                  f = "cannot map `%s\'";
                  goto LAB_00109fbf;
                }
                close(iVar3);
                iVar3 = check_buffer(ms,pmVar8,pcVar7);
                if (iVar3 == 0) {
                  iVar3 = mprotect(pmVar8->p,st.st_size,1);
                  if (iVar3 == -1) {
                    pwVar10 = __errno_location();
                    file_error(ms,*pwVar10,"cannot mprotect `%s\'",pcVar7);
                    apprentice_unmap(pmVar8);
                    free(pcVar7);
                    goto LAB_00109d9f;
                  }
                  free(pcVar7);
                  goto LAB_00109dca;
                }
                apprentice_unmap(pmVar8);
                free(pcVar7);
              }
              mlist_free(ms->mlist[0]);
              ms->mlist[0] = (mlist *)0x0;
              mlist_free(ms->mlist[1]);
              ms->mlist[1] = (mlist *)0x0;
              iVar3 = -1;
LAB_00109e03:
              if (iVar13 < iVar3) {
                iVar13 = iVar3;
              }
            }
            pcVar5 = pcVar12;
          } while (pcVar12 != (char *)0x0);
          free(__ptr);
          if (iVar13 == -1) {
            mlist_free(ms->mlist[0]);
            ms->mlist[0] = (mlist *)0x0;
            mlist_free(ms->mlist[1]);
            ms->mlist[1] = (mlist *)0x0;
            file_error(ms,L'\0',"could not find any valid magic files!");
            iVar13 = -1;
          }
          else if ((uint)action < 4) {
            iVar13 = 0;
          }
          else {
            iVar13 = -1;
            file_error(ms,L'\0',"Invalid action %d",(ulong)(uint)action);
          }
          goto LAB_00109f01;
        }
        ms->mlist[1] = (mlist *)0x0;
        file_oomem(ms,0x28);
        mlist_free(ms->mlist[0]);
        ms->mlist[0] = (mlist *)0x0;
      }
      iVar13 = -1;
      free(__ptr);
    }
  }
LAB_00109f01:
  if (lVar2 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar13;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



size_t file_pstring_get_length(magic *m,char *ss)

{
  uint uVar1;
  uint uVar2;
  size_t sVar3;
  size_t sVar4;
  
  uVar1 = (m->_u)._s._flags;
  uVar2 = uVar1 & 0xf80;
  if (uVar2 == 0x200) {
    sVar4 = (size_t)*(ushort *)ss;
  }
  else if (uVar2 < 0x201) {
    if (uVar2 == 0x80) {
      sVar4 = (size_t)(byte)*ss;
    }
    else {
      if (uVar2 != 0x100) {
        sVar4 = file_pstring_get_length_cold();
        return sVar4;
      }
      sVar4 = (size_t)(ushort)(*(ushort *)ss << 8 | *(ushort *)ss >> 8);
    }
  }
  else if (uVar2 == 0x400) {
    uVar2 = *(uint *)ss;
    sVar4 = (size_t)(int)(uVar2 >> 0x18 | (uVar2 & 0xff0000) >> 8 | (uVar2 & 0xff00) << 8 |
                         uVar2 << 0x18);
  }
  else {
    if (uVar2 != 0x800) {
      sVar4 = file_pstring_get_length_cold();
      return sVar4;
    }
    sVar4 = (size_t)*(int *)ss;
  }
  if ((uVar1 & 0x1000) != 0) {
    sVar3 = file_pstring_length_size(m);
    return sVar4 - sVar3;
  }
  return sVar4;
}



int file_magicfind(magic_set *ms,char *name,mlist *v)

{
  uint uVar1;
  mlist *pmVar2;
  mlist *pmVar3;
  int iVar4;
  magic *pmVar5;
  magic *pmVar6;
  uint uVar7;
  uint32_t uVar8;
  uint uVar9;
  
  pmVar2 = ms->mlist[1];
  pmVar3 = pmVar2->next;
  do {
    if (pmVar2 == pmVar3) {
      return -1;
    }
    uVar1 = pmVar3->nmagic;
    pmVar6 = pmVar3->magic;
    if (uVar1 != 0) {
      uVar9 = 0;
      pmVar5 = pmVar6;
      do {
        if ((pmVar5->type == '-') && (iVar4 = strcmp((pmVar5->value).s,name), iVar4 == 0)) {
          uVar7 = uVar9 + 1;
          v->magic = pmVar5;
          if (uVar7 < uVar1) {
            pmVar6 = pmVar6 + uVar7;
            goto LAB_0010a27f;
          }
          uVar8 = 1;
          goto LAB_0010a289;
        }
        uVar9 = uVar9 + 1;
        pmVar5 = pmVar5 + 1;
      } while (uVar1 != uVar9);
    }
    pmVar3 = pmVar3->next;
  } while( true );
  while( true ) {
    uVar7 = uVar7 + 1;
    pmVar6 = pmVar6 + 1;
    if (uVar1 <= uVar7) break;
LAB_0010a27f:
    if (pmVar6->cont_level == 0) break;
  }
  uVar8 = uVar7 - uVar9;
LAB_0010a289:
  v->nmagic = uVar8;
  return 0;
}



int handle_annotation(magic_set *ms,magic *m,int firstline)

{
  uint uVar1;
  wchar_t wVar2;
  char *pcVar3;
  
  uVar1 = ms->flags;
  if (((uVar1 & 0x800) == 0) || (m->apple[0] == '\0')) {
    if (((uVar1 & 0x1000000) == 0) || (m->ext[0] == '\0')) {
      if ((uVar1 & 0x10) == 0) {
        return 0;
      }
      if (m->mimetype[0] == '\0') {
        return 0;
      }
      if ((firstline == 0) && (wVar2 = file_printf(ms,"\n- "), wVar2 == L'\xffffffff')) {
        return -1;
      }
      pcVar3 = m->mimetype;
    }
    else {
      if ((firstline == 0) && (wVar2 = file_printf(ms,"\n- "), wVar2 == L'\xffffffff')) {
        return -1;
      }
      pcVar3 = m->ext;
    }
    wVar2 = file_printf(ms,"%s",pcVar3);
  }
  else {
    if ((firstline == 0) && (wVar2 = file_printf(ms,"\n- "), wVar2 == L'\xffffffff')) {
      return -1;
    }
    wVar2 = file_printf(ms,"%.8s",m->apple);
  }
  if (wVar2 == L'\xffffffff') {
    return -1;
  }
  return 1;
}



int check_fmt(magic_set *ms,magic *m)

{
  long lVar1;
  wchar_t wVar2;
  char *pcVar3;
  uint uVar4;
  long in_FS_OFFSET;
  file_regex_t rx;
  
  uVar4 = 0;
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  pcVar3 = strchr(m->desc,0x25);
  if (pcVar3 != (char *)0x0) {
    wVar2 = file_regcomp(&rx,"%[-0-9\\.]*s",L'\t');
    if (wVar2 == L'\0') {
      wVar2 = file_regexec(&rx,m->desc,0,(regmatch_t *)0x0,L'\0');
      uVar4 = (uint)(wVar2 == L'\0');
    }
    else {
      uVar4 = 0xffffffff;
      file_regerror(&rx,wVar2,ms);
    }
    file_regfree(&rx);
  }
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar4;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int moffset(magic_set *ms,magic *m,size_t nbytes,int32_t *op)

{
  uint32_t uVar1;
  size_t sVar2;
  size_t sVar3;
  ulong uVar4;
  
  if (false) {
switchD_0010a4a6_caseD_0:
    uVar1 = 0;
  }
  else {
    switch(m->type) {
    default:
      goto switchD_0010a4a6_caseD_0;
    case '\x01':
      uVar1 = ms->offset + 1;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '\x02':
    case '\a':
    case '\n':
      uVar1 = ms->offset + 2;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '\x03':
    case ')':
    case '/':
      uVar1 = ms->offset;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '\x04':
    case '\x06':
    case '\b':
    case '\t':
    case '\v':
    case '\f':
    case '\x0e':
    case '\x0f':
    case '\x10':
    case '\x15':
    case '\x16':
    case '\x17':
    case '!':
    case '\"':
    case '#':
      uVar1 = ms->offset + 4;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '\x05':
    case '\r':
    case '\x12':
    case '\x13':
      uVar1 = ms->offset;
      if ((m->reln == '=') || (m->reln == '!')) {
        uVar1 = uVar1 + m->vallen;
        uVar4 = (ulong)(int)uVar1;
      }
      else {
        if ((m->value).b == '\0') {
          sVar2 = strcspn((ms->ms_value).s,"\r\n");
          *(undefined *)((long)ms->mlist + sVar2 + 0x70) = 0;
        }
        sVar2 = strlen((ms->ms_value).s);
        uVar1 = uVar1 + (int)sVar2;
        if (m->type == '\r') {
          sVar3 = file_pstring_length_size(m);
          uVar1 = uVar1 + (int)sVar3;
        }
        uVar4 = (ulong)(int)uVar1;
      }
      break;
    case '\x11':
      uVar1 = (uint32_t)(ms->search).offset;
      if ((*(byte *)((long)&m->_u + 4) & 0x10) == 0) {
        uVar1 = uVar1 + *(int *)&(ms->search).rm_len;
        uVar4 = (ulong)(int)uVar1;
      }
      else {
LAB_0010a5ad:
        uVar4 = (ulong)(int)uVar1;
      }
      break;
    case '\x14':
      uVar1 = (uint32_t)(ms->search).offset;
      if ((*(byte *)((long)&m->_u + 4) & 0x10) != 0) goto LAB_0010a5ad;
      uVar1 = m->vallen + uVar1;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '\x18':
    case '\x19':
    case '\x1a':
    case '\x1b':
    case '\x1c':
    case '\x1d':
    case '\x1e':
    case '\x1f':
    case ' ':
    case '$':
    case '%':
    case '&':
      uVar1 = ms->offset + 8;
      uVar4 = (ulong)(int)uVar1;
      break;
    case '0':
      uVar1 = der_offs(ms,m,nbytes);
      if ((uVar1 == 0xffffffff) || (nbytes < (ulong)(long)(int)uVar1)) {
        if ((*(byte *)&ms->flags & 1) != 0) {
          __fprintf_chk(_stderr,1,"Bad DER offset %d nbytes=%zu",uVar1,nbytes);
        }
        *op = 0;
        return 0;
      }
      goto LAB_0010a4c5;
    }
    if (nbytes < uVar4) {
      return -1;
    }
  }
LAB_0010a4c5:
  *op = uVar1;
  return 1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

uint32_t cvt_id3(magic_set *ms,uint32_t v)

{
  uint uVar1;
  
  uVar1 = v >> 1 & 0x3f80 | v >> 2 & 0x1fc000 | v & 0x7f | v >> 3 & 0xfe00000;
  if (((ulong)ms & 1) == 0) {
    return uVar1;
  }
  __fprintf_chk(_stderr,1,"id3 offs=%u\n",uVar1);
  return uVar1;
}



int cvt_flip(int type,int flip)

{
  if (true) {
    switch(type) {
    case 7:
      return 10;
    case 8:
      return 0xb;
    case 9:
      return 0xc;
    case 10:
      return 7;
    case 0xb:
      return 8;
    case 0xc:
      return 9;
    case 0xf:
      return 0x10;
    case 0x10:
      return 0xf;
    case 0x19:
      return 0x1a;
    case 0x1a:
      return 0x19;
    case 0x1c:
      return 0x1d;
    case 0x1d:
      return 0x1c;
    case 0x1f:
      return 0x20;
    case 0x20:
      return 0x1f;
    case 0x22:
      return 0x23;
    case 0x23:
      return 0x22;
    case 0x25:
      return 0x26;
    case 0x26:
      return 0x25;
    case 0x2b:
      return 0x2c;
    case 0x2c:
      return 0x2b;
    }
  }
  return type;
}



// DWARF original prototype: int cvt_16(VALUETYPE * p, magic * m, magic * m)

int cvt_16(VALUETYPE *p,magic *m,magic *m_1)

{
  ushort uVar1;
  byte bVar2;
  
  bVar2 = *(byte *)&m->cont_level;
  if (m_1 != (magic *)0x0) {
    uVar1 = (ushort)m_1;
    switch(bVar2 & 7) {
    case 0:
      p->h = p->h & uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 1:
      p->h = p->h | uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 2:
      p->h = p->h ^ uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 3:
      p->h = p->h + uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 4:
      p->h = p->h - uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 5:
      p->h = uVar1 * p->h;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 6:
      if (uVar1 == 0) {
        return -1;
      }
      p->h = p->h / uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 7:
      if (uVar1 == 0) {
        return -1;
      }
      p->h = p->h % uVar1;
      bVar2 = *(byte *)&m->cont_level;
    }
  }
  if ((bVar2 & 0x40) != 0) {
    p->h = ~p->h;
  }
  return 0;
}



// DWARF original prototype: int cvt_32(VALUETYPE * p, magic * m, magic * m)

int cvt_32(VALUETYPE *p,magic *m,magic *m_1)

{
  byte bVar1;
  uint uVar2;
  
  bVar1 = *(byte *)&m->cont_level;
  if (m_1 != (magic *)0x0) {
    uVar2 = (uint)m_1;
    switch(bVar1 & 7) {
    case 0:
      p->l = p->l & uVar2;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 1:
      p->l = p->l | uVar2;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 2:
      p->l = p->l ^ uVar2;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 3:
      p->l = p->l + uVar2;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 4:
      p->l = p->l - uVar2;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 5:
      p->l = uVar2 * p->l;
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 6:
      if (uVar2 == 0) {
        return -1;
      }
      p->l = (uint32_t)((ulong)p->l / ((ulong)m_1 & 0xffffffff));
      bVar1 = *(byte *)&m->cont_level;
      break;
    case 7:
      if (uVar2 == 0) {
        return -1;
      }
      p->l = (uint32_t)((ulong)p->l % ((ulong)m_1 & 0xffffffff));
      bVar1 = *(byte *)&m->cont_level;
    }
  }
  if ((bVar1 & 0x40) != 0) {
    p->l = ~p->l;
  }
  return 0;
}



// DWARF original prototype: int cvt_64(VALUETYPE * p, magic * m, magic * m)

int cvt_64(VALUETYPE *p,magic *m,magic *m_1)

{
  ulong uVar1;
  byte bVar2;
  
  bVar2 = *(byte *)&m->cont_level;
  if (m_1 != (magic *)0x0) {
    uVar1 = p->q;
    switch(bVar2 & 7) {
    case 0:
      p->q = (ulong)m_1 & uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 1:
      p->q = (ulong)m_1 | uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 2:
      p->q = (ulong)m_1 ^ uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 3:
      p->q = (uint64_t)(m_1->desc + (uVar1 - 0x80));
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 4:
      p->q = uVar1 - (long)m_1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 5:
      p->q = (long)m_1 * uVar1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 6:
      p->q = uVar1 / (ulong)m_1;
      bVar2 = *(byte *)&m->cont_level;
      break;
    case 7:
      p->q = uVar1 % (ulong)m_1;
      bVar2 = *(byte *)&m->cont_level;
    }
  }
  if ((bVar2 & 0x40) != 0) {
    p->q = ~p->q;
  }
  return 0;
}



// DWARF original prototype: int cvt_float(VALUETYPE * p, magic * m, magic * m)

int cvt_float(VALUETYPE *p,magic *m,magic *m_1)

{
  byte bVar1;
  
  if (m_1 != (magic *)0x0) {
    bVar1 = (byte)m & 7;
    if (bVar1 == 5) {
      p->f = (float)m_1 * p->f;
      return 0;
    }
    if (bVar1 < 6) {
      if (bVar1 == 3) {
        p->f = (float)m_1 + p->f;
        return 0;
      }
      if (bVar1 == 4) {
        p->f = p->f - (float)m_1;
        return 0;
      }
      return 0;
    }
    if (bVar1 != 6) {
      return 0;
    }
    if ((true) && ((float)m_1 == 0.0)) {
      return -1;
    }
    p->f = p->f / (float)m_1;
  }
  return 0;
}



// DWARF original prototype: int cvt_double(VALUETYPE * p, magic * m, magic * m)

int cvt_double(VALUETYPE *p,magic *m,magic *m_1)

{
  byte bVar1;
  
  if (m_1 != (magic *)0x0) {
    bVar1 = (byte)m & 7;
    if (bVar1 == 5) {
      p->d = (double)m_1 * p->d;
      return 0;
    }
    if (bVar1 < 6) {
      if (bVar1 == 3) {
        p->d = (double)m_1 + p->d;
        return 0;
      }
      if (bVar1 == 4) {
        p->d = p->d - (double)m_1;
        return 0;
      }
      return 0;
    }
    if (bVar1 != 6) {
      return 0;
    }
    if ((true) && ((double)m_1 == 0.0)) {
      return -1;
    }
    p->d = p->d / (double)m_1;
  }
  return 0;
}



uint32_t do_ops(magic *m,intmax_t lhs,intmax_t off)

{
  uint uVar1;
  
  if (off != 0) {
    switch((uint)m & 7) {
    case 0:
      lhs = lhs & off;
      break;
    case 1:
      lhs = lhs | off;
      break;
    case 2:
      lhs = lhs ^ off;
      break;
    case 3:
      lhs = lhs + off;
      break;
    case 4:
      lhs = lhs - off;
      break;
    case 5:
      lhs = lhs * off;
      break;
    case 6:
      lhs = lhs / off;
      break;
    case 7:
      lhs = lhs % off;
    }
  }
  uVar1 = (uint)lhs;
  if (((ulong)m & 0x40) != 0) {
    uVar1 = ~(uint)lhs;
  }
  return uVar1;
}



// DWARF original prototype: int mcopy(magic_set * ms, VALUETYPE * p, int type, int indir, uchar *
// s, uint32_t offset, size_t nbytes, magic * m, magic * m)

int mcopy(magic_set *ms,VALUETYPE *p,int type,int indir,uchar *s,uint32_t offset,size_t nbytes,
         magic *m,magic *m_1)

{
  uint64_t *__src;
  uint8_t uVar1;
  uint uVar2;
  uint64_t uVar3;
  uint uVar4;
  uchar *puVar5;
  void *pvVar6;
  ulong uVar7;
  uint8_t *puVar8;
  ulong uVar9;
  VALUETYPE *pVVar10;
  undefined8 *puVar11;
  ulong uVar12;
  ulong uVar13;
  uchar *puVar14;
  uchar *__s;
  bool bVar15;
  byte bVar16;
  ulong local_50;
  uchar *local_48;
  
  bVar16 = 0;
  if (indir == 0) {
    if (type < 0x14) {
      if (0x11 < type) {
        puVar8 = s + (ulong)(type == 0x12) + (ulong)offset;
        if (offset < nbytes) {
          pVVar10 = p;
          do {
            if (s + nbytes <= puVar8) break;
            uVar1 = *puVar8;
            pVVar10->hs[0] = uVar1;
            if (uVar1 == '\0') {
              if (type == 0x12) {
                uVar1 = puVar8[-1];
              }
              else {
                uVar1 = puVar8[1];
              }
              if (uVar1 != '\0') {
                pVVar10->b = ' ';
              }
            }
            pVVar10 = (VALUETYPE *)(pVVar10->hs + 1);
            puVar8 = puVar8 + 2;
          } while (pVVar10 < (VALUETYPE *)(p->hs + 0x5f));
          p->hs[0x5f] = '\0';
          return 0;
        }
        goto LAB_0010afcb;
      }
      if (type != 0x11) goto LAB_0010af10;
      if (s == (uchar *)0x0) {
        (ms->search).s_len = 0;
        (ms->search).s = (char *)0x0;
        return 0;
      }
      uVar4._0_2_ = m->cont_level;
      uVar4._2_1_ = m->flag;
      uVar4._3_1_ = m->factor;
      uVar9 = (ulong)uVar4;
      uVar2._0_2_ = m_1->cont_level;
      uVar2._2_1_ = m_1->flag;
      uVar2._3_1_ = m_1->factor;
      if ((uVar2 & 0x800) == 0) {
        uVar12 = (ulong)offset;
        uVar13 = nbytes - uVar12;
        if (uVar9 == 0) {
          local_48 = s + uVar12;
          uVar9 = (ulong)ms->regex_max;
          if (uVar13 < ms->regex_max) {
            uVar9 = uVar13;
          }
          puVar5 = s + uVar9 + uVar12;
          goto LAB_0010b089;
        }
        bVar15 = false;
        uVar12 = 0;
        uVar7 = uVar9;
LAB_0010ae25:
        if (uVar7 < uVar13) {
          uVar13 = uVar7;
        }
      }
      else {
        bVar15 = uVar9 != 0;
        uVar13 = nbytes - offset;
        uVar7 = uVar9 * 0x50;
        uVar12 = uVar9;
        if (uVar9 * 5 != 0) goto LAB_0010ae25;
      }
      local_50 = (ulong)offset;
      local_48 = s + local_50;
      if (ms->regex_max <= uVar13) {
        uVar13 = (ulong)ms->regex_max;
      }
      puVar14 = s + uVar13 + local_50;
      puVar5 = puVar14;
      if ((local_48 < puVar14) && (__s = local_48, bVar15)) {
        do {
          puVar5 = (uchar *)memchr(__s,10,(long)puVar14 - (long)__s);
          if ((puVar5 == (uchar *)0x0) &&
             (puVar5 = (uchar *)memchr(__s,0xd,(long)puVar14 - (long)__s), puVar5 == (uchar *)0x0))
          goto LAB_0010b081;
          __s = puVar5 + 1;
          if ((*puVar5 == '\r') && (puVar5[1] == '\n')) {
            __s = puVar5 + 2;
          }
          uVar12 = uVar12 - 1;
          if (uVar12 == 0) goto LAB_0010b089;
        } while (__s < puVar14);
      }
      if (uVar12 != 0) {
LAB_0010b081:
        puVar5 = s + uVar13;
      }
LAB_0010b089:
      local_50 = (ulong)offset;
      (ms->search).rm_len = 0;
      (ms->search).s = (char *)local_48;
      (ms->search).s_len = (long)puVar5 - (long)local_48;
      (ms->search).offset = local_50;
      return 0;
    }
    if ((type == 0x14) || (type == 0x30)) {
      uVar9 = (ulong)offset;
      if (nbytes < offset) {
        uVar9 = nbytes & 0xffffffff;
      }
      (ms->search).offset = uVar9;
      (ms->search).s = (char *)(s + uVar9);
      (ms->search).s_len = nbytes - uVar9;
      return 0;
    }
  }
LAB_0010af10:
  uVar9 = (ulong)offset;
  if (uVar9 < nbytes) {
    __src = (uint64_t *)(s + uVar9);
    uVar12 = nbytes - uVar9;
    if (0x5f < uVar12) {
      uVar3 = __src[1];
      p->q = *__src;
      *(uint64_t *)(p->hs + 8) = uVar3;
      uVar3 = __src[3];
      *(uint64_t *)(p->hs + 0x10) = __src[2];
      *(uint64_t *)(p->hs + 0x18) = uVar3;
      uVar3 = __src[5];
      *(uint64_t *)(p->hs + 0x20) = __src[4];
      *(uint64_t *)(p->hs + 0x28) = uVar3;
      uVar3 = __src[7];
      *(uint64_t *)(p->hs + 0x30) = __src[6];
      *(uint64_t *)(p->hs + 0x38) = uVar3;
      uVar3 = __src[9];
      *(uint64_t *)(p->hs + 0x40) = __src[8];
      *(uint64_t *)(p->hs + 0x48) = uVar3;
      uVar3 = __src[0xb];
      *(uint64_t *)(p->hs + 0x50) = __src[10];
      *(uint64_t *)(p->hs + 0x58) = uVar3;
      return 0;
    }
    pvVar6 = memcpy(p,__src,uVar12);
    uVar9 = (uVar9 - nbytes) + 0x60;
    puVar11 = (undefined8 *)((long)pvVar6 + uVar12);
    uVar4 = (uint)uVar9;
    if (7 < uVar4) {
      *puVar11 = 0;
      *(undefined8 *)((long)puVar11 + ((uVar9 & 0xffffffff) - 8)) = 0;
      uVar9 = (ulong)(((int)puVar11 - (int)(undefined8 *)((ulong)(puVar11 + 1) & 0xfffffffffffffff8)
                      ) + uVar4 >> 3);
      puVar11 = (undefined8 *)((ulong)(puVar11 + 1) & 0xfffffffffffffff8);
      for (; uVar9 != 0; uVar9 = uVar9 - 1) {
        *puVar11 = 0;
        puVar11 = puVar11 + (ulong)bVar16 * -2 + 1;
      }
      return 0;
    }
    if ((uVar9 & 4) != 0) {
      *(undefined4 *)puVar11 = 0;
      *(undefined4 *)((long)puVar11 + ((uVar9 & 0xffffffff) - 4)) = 0;
      return 0;
    }
    if (uVar4 == 0) {
      return 0;
    }
    *(undefined *)puVar11 = 0;
    if ((uVar9 & 2) == 0) {
      return 0;
    }
    *(undefined2 *)((long)puVar11 + ((uVar9 & 0xffffffff) - 2)) = 0;
    return 0;
  }
LAB_0010afcb:
  p->q = 0;
  *(uint8_t *)((long)p + 0x58) = '\0';
  *(uint8_t *)((long)p + 0x59) = '\0';
  *(uint8_t *)((long)p + 0x5a) = '\0';
  *(uint8_t *)((long)p + 0x5b) = '\0';
  *(uint8_t *)((long)p + 0x5c) = '\0';
  *(uint8_t *)((long)p + 0x5d) = '\0';
  *(uint8_t *)((long)p + 0x5e) = '\0';
  *(uint8_t *)((long)p + 0x5f) = '\0';
  puVar11 = (undefined8 *)((ulong)(p->hs + 8) & 0xfffffffffffffff8);
  for (uVar9 = (ulong)(((int)p - (int)(undefined8 *)((ulong)(p->hs + 8) & 0xfffffffffffffff8)) +
                       0x60U >> 3); uVar9 != 0; uVar9 = uVar9 - 1) {
    *puVar11 = 0;
    puVar11 = puVar11 + 1;
  }
  return 0;
}



uint64_t file_strncmp(char *s1,char *s2,size_t len,uint32_t flags)

{
  byte *pbVar1;
  byte *pbVar2;
  byte bVar3;
  byte bVar4;
  long lVar5;
  int iVar6;
  long *plVar7;
  __int32_t **pp_Var8;
  uint64_t uVar9;
  size_t sVar10;
  ulong uVar11;
  byte *pbVar12;
  
  if (flags == 0) {
    sVar10 = 0;
    do {
      if (len == sVar10) goto LAB_0010b1c8;
      pbVar2 = (byte *)(s2 + sVar10);
      pbVar12 = (byte *)(s1 + sVar10);
      sVar10 = sVar10 + 1;
      uVar9 = (uint64_t)(int)((uint)*pbVar2 - (uint)*pbVar12);
    } while (uVar9 == 0);
  }
  else {
    pbVar2 = (byte *)(s1 + len);
    if (len != 0) {
      do {
        bVar3 = *s1;
        bVar4 = *s2;
        uVar11 = (ulong)bVar4;
        s1 = (char *)((byte *)s1 + 1);
        if (((flags & 4) == 0) ||
           (plVar7 = (long *)FUN_00104d70(), (*(byte *)(*plVar7 + 1 + (ulong)bVar3 * 2) & 2) == 0))
        {
          if (((flags & 8) != 0) &&
             (plVar7 = (long *)FUN_00104d70(), (*(byte *)(*plVar7 + 1 + (ulong)bVar3 * 2) & 1) != 0)
             ) {
            pp_Var8 = __ctype_toupper_loc();
            goto LAB_0010b1fb;
          }
          if ((flags & 1) == 0) {
LAB_0010b290:
            if ((flags & 2) != 0) {
              plVar7 = (long *)FUN_00104d70();
              lVar5 = *plVar7;
              if ((*(byte *)(lVar5 + 1 + (ulong)bVar3 * 2) & 0x20) != 0) {
                bVar3 = *(byte *)(lVar5 + 1 + uVar11 * 2);
                pbVar12 = (byte *)s2;
                while ((bVar3 & 0x20) != 0) {
                  pbVar1 = pbVar12 + 1;
                  pbVar12 = pbVar12 + 1;
                  bVar3 = *(byte *)(lVar5 + 1 + (ulong)*pbVar1 * 2);
                }
                goto LAB_0010b20e;
              }
            }
            iVar6 = (uint)bVar4 - (uint)bVar3;
            goto joined_r0x0010b20c;
          }
          plVar7 = (long *)FUN_00104d70();
          lVar5 = *plVar7;
          if ((*(byte *)(lVar5 + 1 + (ulong)bVar3 * 2) & 0x20) == 0) goto LAB_0010b290;
          pbVar12 = (byte *)s2 + 1;
          if ((*(byte *)(lVar5 + 1 + uVar11 * 2) & 0x20) == 0) {
            return 1;
          }
          if ((*(byte *)(lVar5 + 1 + (ulong)(byte)*s1 * 2) & 0x20) == 0) {
            bVar3 = *(byte *)(lVar5 + 1 + (ulong)((byte *)s2)[1] * 2);
            while ((bVar3 & 0x20) != 0) {
              pbVar1 = pbVar12 + 1;
              pbVar12 = pbVar12 + 1;
              bVar3 = *(byte *)(lVar5 + 1 + (ulong)*pbVar1 * 2);
            }
          }
        }
        else {
          pp_Var8 = __ctype_tolower_loc();
LAB_0010b1fb:
          iVar6 = (*pp_Var8)[uVar11] - (uint)bVar3;
joined_r0x0010b20c:
          pbVar12 = (byte *)s2 + 1;
          if ((long)iVar6 != 0) {
            return (long)iVar6;
          }
        }
LAB_0010b20e:
        s2 = (char *)pbVar12;
      } while (pbVar2 != (byte *)s1);
    }
LAB_0010b1c8:
    uVar9 = 0;
  }
  return uVar9;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int magiccheck(magic_set *ms,magic *m)

{
  size_t *psVar1;
  float fVar2;
  float fVar3;
  byte bVar4;
  long lVar5;
  size_t __size;
  uint uVar6;
  wchar_t rc;
  uint uVar7;
  double dVar8;
  uint64_t v;
  void *__dest;
  wchar_t *pwVar9;
  char *pcVar10;
  size_t len;
  double dVar11;
  char *pcVar12;
  ulong uVar13;
  long in_FS_OFFSET;
  bool bVar14;
  regmatch_t pmatch;
  file_regex_t rx;
  
  dVar11 = (m->value).d;
  lVar5 = *(long *)(in_FS_OFFSET + 0x28);
  if (false) {
switchD_0010b3ac_caseD_0:
    uVar7 = 0xffffffff;
    file_magerror(ms,"invalid type %d in magiccheck()");
    goto LAB_0010b3e2;
  }
  switch(m->type) {
  default:
    goto switchD_0010b3ac_caseD_0;
  case '\x01':
    v = (uint64_t)(ms->ms_value).b;
    break;
  case '\x02':
  case '\a':
  case '\n':
    v = (uint64_t)(ms->ms_value).h;
    break;
  case '\x03':
  case '/':
    v = 0;
    dVar11 = 0.0;
    break;
  case '\x04':
  case '\x06':
  case '\b':
  case '\t':
  case '\v':
  case '\f':
  case '\x0e':
  case '\x0f':
  case '\x10':
  case '\x15':
  case '\x16':
  case '\x17':
    v = (uint64_t)(ms->ms_value).l;
    break;
  case '\x05':
  case '\r':
    dVar11 = 0.0;
    v = file_strncmp((m->value).s,(ms->ms_value).s,(ulong)m->vallen,(m->_u)._s._flags);
    break;
  case '\x11':
    if ((ms->search).s == (char *)0x0) goto LAB_0010b800;
    rc = file_regcomp(&rx,(m->value).s,
                      (-(uint)(((m->_u)._s._flags & 0xc) == 0) & 0xfffffffe) + L'\a');
    if (rc != L'\0') {
LAB_0010b738:
      file_regerror(&rx,rc,ms);
      uVar7 = 0xffffffff;
      file_regfree(&rx);
      goto LAB_0010b3e2;
    }
    __size = (ms->search).s_len;
    if (__size == 0) {
      pcVar10 = (ms->search).s;
      pcVar12 = (char *)0x0;
    }
    else {
      __dest = malloc(__size);
      if (__dest == (void *)0x0) {
        uVar7 = 0xffffffff;
        file_regfree(&rx);
        pwVar9 = __errno_location();
        file_error(ms,*pwVar9,"can\'t allocate %zu bytes",__size);
        goto LAB_0010b3e2;
      }
      pcVar10 = (char *)memcpy(__dest,(ms->search).s,__size);
      pcVar10[__size - 1] = '\0';
      pcVar12 = pcVar10;
    }
    rc = file_regexec(&rx,pcVar10,1,&pmatch,L'\0');
    free(pcVar12);
    if (rc == L'\0') {
      (ms->search).s = (ms->search).s + pmatch.rm_so;
      psVar1 = &(ms->search).offset;
      *psVar1 = *psVar1 + (long)pmatch.rm_so;
      dVar11 = 0.0;
      (ms->search).rm_len = (long)(pmatch.rm_eo - pmatch.rm_so);
      file_regfree(&rx);
      v = 0;
    }
    else {
      if (rc != L'\x01') goto LAB_0010b738;
      dVar11 = 0.0;
      file_regfree(&rx);
      v = 1;
    }
    break;
  case '\x12':
  case '\x13':
    dVar11 = 0.0;
    v = file_strncmp((m->value).s,(ms->ms_value).s,(ulong)m->vallen,0);
    break;
  case '\x14':
    pcVar10 = (ms->search).s;
    if (pcVar10 == (char *)0x0) goto LAB_0010b800;
    len = (size_t)m->vallen;
    if (0x60 < m->vallen) {
      len = 0x60;
    }
    uVar7 = (m->_u)._s._count;
    uVar13 = 0;
    v = 0;
    pcVar12 = pcVar10;
    while( true ) {
      if (((uVar7 != 0) && (uVar7 <= uVar13)) ||
         ((char *)(ms->search).s_len < pcVar12 + (len - (long)pcVar10))) {
        dVar11 = 0.0;
        goto LAB_0010b418;
      }
      v = file_strncmp((m->value).s,pcVar12,len,(m->_u)._s._flags);
      if (v == 0) break;
      uVar13 = uVar13 + 1;
      pcVar12 = pcVar12 + 1;
    }
    psVar1 = &(ms->search).offset;
    *psVar1 = *psVar1 + uVar13;
    dVar11 = 0.0;
    (ms->search).rm_len = uVar7 - uVar13;
    break;
  case '\x18':
  case '\x19':
  case '\x1a':
  case '\x1b':
  case '\x1c':
  case '\x1d':
  case '\x1e':
  case '\x1f':
  case ' ':
  case '*':
  case '+':
  case ',':
    v = (ms->ms_value).q;
    break;
  case '!':
  case '\"':
  case '#':
    bVar4 = m->reln;
    fVar2 = (m->value).f;
    fVar3 = (ms->ms_value).f;
    if (bVar4 == 0x3d) {
      uVar7 = (uint)(!NAN(fVar2) && !NAN(fVar3));
      if (fVar2 != fVar3) {
        uVar7 = 0;
      }
      goto LAB_0010b3e2;
    }
    if (bVar4 < 0x3e) {
      if (bVar4 == 0x21) {
        uVar7 = (uint)(NAN(fVar2) || NAN(fVar3));
        if (fVar2 != fVar3) {
          uVar7 = 1;
        }
        goto LAB_0010b3e2;
      }
      if (bVar4 == 0x3c) {
        uVar7 = (uint)(fVar3 < fVar2);
        goto LAB_0010b3e2;
      }
    }
    else {
      if (bVar4 == 0x3e) {
        uVar7 = (uint)(fVar2 < fVar3);
        goto LAB_0010b3e2;
      }
      if (bVar4 == 0x78) goto switchD_0010b3ac_caseD_29;
    }
    file_magerror(ms,"cannot happen with float: invalid relation `%c\'",(ulong)bVar4);
    uVar7 = 0xffffffff;
    goto LAB_0010b3e2;
  case '$':
  case '%':
  case '&':
    bVar4 = m->reln;
    dVar8 = (ms->ms_value).d;
    if (bVar4 == 0x3d) {
      uVar7 = (uint)(!NAN(dVar8) && !NAN(dVar11));
      if (dVar8 != dVar11) {
        uVar7 = 0;
      }
      goto LAB_0010b3e2;
    }
    if (bVar4 < 0x3e) {
      if (bVar4 == 0x21) {
        uVar7 = (uint)(NAN(dVar8) || NAN(dVar11));
        if (dVar8 != dVar11) {
          uVar7 = 1;
        }
        goto LAB_0010b3e2;
      }
      if (bVar4 == 0x3c) {
        uVar7 = (uint)(dVar8 < dVar11);
        goto LAB_0010b3e2;
      }
    }
    else {
      if (bVar4 == 0x3e) {
        uVar7 = (uint)(dVar11 < dVar8);
        goto LAB_0010b3e2;
      }
      if (bVar4 == 0x78) goto switchD_0010b3ac_caseD_29;
    }
    file_magerror(ms,"cannot happen with double: invalid relation `%c\'",(ulong)bVar4);
    uVar7 = 0xffffffff;
    goto LAB_0010b3e2;
  case ')':
  case '-':
  case '.':
    goto switchD_0010b3ac_caseD_29;
  case '0':
    uVar7 = der_cmp(ms,m);
    if (uVar7 != 0xffffffff) goto LAB_0010b3e2;
    if ((*(byte *)&ms->flags & 1) != 0) {
      fwrite("EOF comparing DER entries",1,0x19,_stderr);
    }
LAB_0010b800:
    uVar7 = 0;
    goto LAB_0010b3e2;
  }
LAB_0010b418:
  dVar8 = (double)file_signextend(ms,m,v);
  bVar4 = m->reln;
  if (0x3e < bVar4) {
    if (bVar4 == 0x5e) {
      uVar7 = (uint)((double)((ulong)dVar11 & (ulong)dVar8) != dVar11);
      if ((*(byte *)&ms->flags & 1) == 0) goto LAB_0010b3e2;
      pcVar10 = "((%llx & %llx) != %llx) = %d\n";
LAB_0010b532:
      __fprintf_chk(_stderr,1,pcVar10,dVar8,dVar11,dVar11,uVar7);
      goto LAB_0010b3e2;
    }
    if (bVar4 == 0x78) {
      uVar7 = ms->flags & 1;
      if (uVar7 == 0) {
switchD_0010b3ac_caseD_29:
        uVar7 = 1;
      }
      else {
        __fprintf_chk(_stderr,1,"%llu == *any* = 1\n");
      }
      goto LAB_0010b3e2;
    }
switchD_0010b45b_caseD_22:
    uVar7 = 0xffffffff;
    file_magerror(ms,"cannot happen: invalid relation `%c\'");
    goto LAB_0010b3e2;
  }
  if ((bVar4 < 0x21) || (false)) goto switchD_0010b45b_caseD_22;
  switch(bVar4) {
  case 0x21:
    bVar14 = dVar11 != dVar8;
    pcVar10 = "%llu != %llu = %d\n";
    bVar4 = *(byte *)&ms->flags;
    goto joined_r0x0010b4c8;
  default:
    goto switchD_0010b45b_caseD_22;
  case 0x26:
    uVar7 = (uint)((double)((ulong)dVar11 & (ulong)dVar8) == dVar11);
    if ((*(byte *)&ms->flags & 1) == 0) goto LAB_0010b3e2;
    pcVar10 = "((%llx & %llx) == %llx) = %d\n";
    goto LAB_0010b532;
  case 0x3c:
    uVar6 = ms->flags & 1;
    if ((m->flag & 8) != 0) {
      pcVar10 = "%llu < %llu = %d\n";
      bVar14 = (ulong)dVar8 < (ulong)dVar11;
      goto joined_r0x0010b8d9;
    }
    uVar7 = (uint)((long)dVar8 < (long)dVar11);
    if (uVar6 == 0) goto LAB_0010b3e2;
    pcVar10 = "%lld < %lld = %d\n";
    break;
  case 0x3d:
    bVar14 = dVar11 == dVar8;
    pcVar10 = "%llu == %llu = %d\n";
    bVar4 = *(byte *)&ms->flags;
joined_r0x0010b4c8:
    uVar7 = (uint)bVar14;
    if ((bVar4 & 1) == 0) goto LAB_0010b3e2;
    break;
  case 0x3e:
    uVar6 = ms->flags & 1;
    if ((m->flag & 8) == 0) {
      pcVar10 = "%lld > %lld = %d\n";
      bVar14 = (long)dVar11 < (long)dVar8;
    }
    else {
      bVar14 = (ulong)dVar11 < (ulong)dVar8;
      pcVar10 = "%llu > %llu = %d\n";
    }
joined_r0x0010b8d9:
    uVar7 = (uint)bVar14;
    if (uVar6 == 0) goto LAB_0010b3e2;
  }
  __fprintf_chk(_stderr,1,pcVar10,dVar8,dVar11,uVar7);
LAB_0010b3e2:
  if (lVar5 == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar7;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void mdebug(uint32_t offset,char *str,size_t len)

{
  __fprintf_chk(_stderr,1,"mget/%zu @%d: ",0x60,offset);
  file_showstr((FILE *)_stderr,str,0x60);
  fputc(10,_stderr);
  fputc(10,_stderr);
  return;
}



// DWARF original prototype: char * file_fmtcheck(magic_set * ms, magic * m, char * def, char *
// file, size_t line, char * file)

char * file_fmtcheck(magic_set *ms,magic *m,char *def,char *file,size_t line,char *file_1)

{
  char *pcVar1;
  
  pcVar1 = fmtcheck(m->desc,def);
  if (def != pcVar1) {
    return pcVar1;
  }
  file_magerror(ms,"%s, %zu: format `%s\' does not match with `%s\'","softmagic.c",line,m->desc,
                pcVar1);
  return pcVar1;
}



int32_t mprint(magic_set *ms,magic *m)

{
  byte *pbVar1;
  float fVar2;
  byte bVar3;
  long lVar4;
  long lVar5;
  wchar_t wVar6;
  int iVar7;
  uint32_t uVar8;
  uint64_t uVar9;
  size_t sVar10;
  long *plVar11;
  VALUETYPE *pVVar12;
  char *pcVar13;
  char *pcVar14;
  char *pcVar15;
  VALUETYPE *pVVar16;
  size_t sVar17;
  char *in_R9;
  VALUETYPE *__s;
  long in_FS_OFFSET;
  char tbuf [26];
  char buf [128];
  char sbuf [512];
  
  lVar4 = *(long *)(in_FS_OFFSET + 0x28);
  if (false) {
switchD_0010bbb6_caseD_0:
    file_magerror(ms,"invalid m->type (%d) in mprint()",(ulong)m->type);
    uVar8 = 0xffffffff;
    goto LAB_0010bc16;
  }
  switch(m->type) {
  default:
    goto switchD_0010bbb6_caseD_0;
  case '\x01':
    uVar9 = file_signextend(ms,m,(ulong)(ms->ms_value).b);
    iVar7 = check_fmt(ms,m);
    if (iVar7 != -1) {
      if (iVar7 == 1) {
        pcVar14 = (char *)(uVar9 & 0xff);
        __snprintf_chk(buf,0x80,1,0x80,"%d");
        pcVar14 = file_fmtcheck(ms,m,"%s","softmagic.c",0x1ce,pcVar14);
        wVar6 = file_printf(ms,pcVar14,buf);
      }
      else {
        pcVar14 = file_fmtcheck(ms,m,"%d","softmagic.c",0x1d2,in_R9);
        wVar6 = file_printf(ms,pcVar14,uVar9 & 0xff);
      }
      if (wVar6 != L'\xffffffff') {
        uVar8 = ms->offset + 1;
        goto LAB_0010bc16;
      }
    }
    break;
  case '\x02':
  case '\a':
  case '\n':
    uVar9 = file_signextend(ms,m,(ulong)(ms->ms_value).h);
    iVar7 = check_fmt(ms,m);
    if (iVar7 != -1) {
      if (iVar7 == 1) {
        pcVar14 = (char *)(uVar9 & 0xffff);
        __snprintf_chk(buf,0x80,1,0x80,"%u");
        pcVar14 = file_fmtcheck(ms,m,"%s","softmagic.c",0x1e4,pcVar14);
        wVar6 = file_printf(ms,pcVar14,buf);
      }
      else {
        pcVar14 = file_fmtcheck(ms,m,"%u","softmagic.c",0x1e8,in_R9);
        wVar6 = file_printf(ms,pcVar14,uVar9 & 0xffff);
      }
      if (wVar6 != L'\xffffffff') {
        uVar8 = ms->offset + 2;
        goto LAB_0010bc16;
      }
    }
    break;
  case '\x03':
  case '/':
    pcVar14 = m->desc;
    pcVar15 = "%s";
    goto LAB_0010be07;
  case '\x04':
  case '\b':
  case '\v':
  case '\x17':
    uVar9 = file_signextend(ms,m,(ulong)(ms->ms_value).l);
    iVar7 = check_fmt(ms,m);
    if (iVar7 == -1) break;
    if (iVar7 == 1) {
      pcVar14 = buf;
      in_R9 = (char *)(uVar9 & 0xffffffff);
      __snprintf_chk(pcVar14,0x80,1,0x80,"%u");
      sVar17 = 0x1fa;
      goto LAB_0010bbdb;
    }
    pcVar14 = file_fmtcheck(ms,m,"%u","softmagic.c",0x1fe,in_R9);
    wVar6 = file_printf(ms,pcVar14,uVar9 & 0xffffffff);
    goto joined_r0x0010bc07;
  case '\x05':
  case '\r':
  case '\x12':
  case '\x13':
    if ((m->reln == '=') || (m->reln == '!')) {
      pcVar14 = file_printable(sbuf,0x200,(m->value).s);
      pcVar15 = file_fmtcheck(ms,m,"%s","softmagic.c",0x220,in_R9);
      wVar6 = file_printf(ms,pcVar15,pcVar14);
      if (wVar6 != L'\xffffffff') {
        uVar8 = (uint)m->vallen + ms->offset;
        goto LAB_0010bc16;
      }
    }
    else {
      __s = &ms->ms_value;
      sVar10 = strlen(__s->s);
      uVar8 = ms->offset + (int)sVar10;
      if ((m->value).b == '\0') {
        sVar10 = strcspn(__s->s,"\r\n");
        *(undefined *)((long)ms->mlist + sVar10 + 0x70) = 0;
      }
      if ((*(byte *)((long)&m->_u + 5) & 0x20) != 0) {
        plVar11 = (long *)FUN_00104d70();
        lVar5 = *plVar11;
        while ((*(byte *)(lVar5 + 1 + (ulong)__s->b * 2) & 0x20) != 0) {
          __s = (VALUETYPE *)((long)__s + 1);
        }
        pVVar12 = __s;
        if (__s->b == 0) {
          pVVar16 = (VALUETYPE *)((long)__s + -1);
        }
        else {
          do {
            pVVar16 = pVVar12;
            pVVar12 = (VALUETYPE *)(pVVar16->hs + 1);
          } while (pVVar12->b != 0);
        }
        bVar3 = *(byte *)(lVar5 + 1 + (ulong)*(byte *)((long)pVVar12 + -1) * 2);
        while ((bVar3 & 0x20) != 0) {
          pbVar1 = (byte *)((long)pVVar16 + -1);
          pVVar16 = (VALUETYPE *)((long)pVVar16 + -1);
          bVar3 = *(byte *)(lVar5 + 1 + (ulong)*pbVar1 * 2);
        }
        pVVar16->hs[1] = 0;
      }
      pcVar14 = file_printable(sbuf,0x200,__s->s);
      pcVar15 = file_fmtcheck(ms,m,"%s","softmagic.c",0x23c,in_R9);
      wVar6 = file_printf(ms,pcVar15,pcVar14);
      if (wVar6 != L'\xffffffff') {
        if (m->type == '\r') {
          sVar17 = file_pstring_length_size(m);
          uVar8 = uVar8 + (int)sVar17;
        }
        goto LAB_0010bc16;
      }
    }
    break;
  case '\x06':
  case '\t':
  case '\f':
  case '\x15':
    pcVar14 = file_fmttime((ulong)(ms->ms_value).l,0,tbuf);
    sVar17 = 0x249;
    goto LAB_0010bbdb;
  case '\x0e':
  case '\x0f':
  case '\x10':
  case '\x16':
    pcVar14 = file_fmttime((ulong)(ms->ms_value).l,1,tbuf);
    sVar17 = 0x253;
LAB_0010bbdb:
    pcVar15 = file_fmtcheck(ms,m,"%s","softmagic.c",sVar17,in_R9);
    wVar6 = file_printf(ms,pcVar15,pcVar14);
joined_r0x0010bc07:
    if (wVar6 != L'\xffffffff') {
LAB_0010bc0d:
      uVar8 = ms->offset + 4;
      goto LAB_0010bc16;
    }
    break;
  case '\x11':
  case '\x14':
    sVar10 = (ms->search).rm_len;
    pcVar14 = strndup((ms->search).s,sVar10);
    if (pcVar14 == (char *)0x0) {
      file_oomem(ms,sVar10);
    }
    else {
      pcVar15 = file_printable(sbuf,0x200,pcVar14);
      pcVar13 = file_fmtcheck(ms,m,"%s","softmagic.c",0x2a6,in_R9);
      wVar6 = file_printf(ms,pcVar13,pcVar15);
      free(pcVar14);
      if (wVar6 != L'\xffffffff') {
        uVar8 = (uint32_t)(ms->search).offset;
        if ((*(byte *)((long)&m->_u + 4) & 0x10) == 0) {
          uVar8 = uVar8 + (int)(ms->search).rm_len;
        }
        goto LAB_0010bc16;
      }
    }
    break;
  case '\x18':
  case '\x19':
  case '\x1a':
    pcVar13 = (char *)file_signextend(ms,m,(ms->ms_value).q);
    iVar7 = check_fmt(ms,m);
    if (iVar7 == -1) break;
    if (iVar7 != 1) {
      sVar17 = 0x213;
      pcVar15 = "%llu";
      pcVar14 = pcVar13;
      goto LAB_0010bf2a;
    }
    pcVar14 = buf;
    __snprintf_chk(pcVar14,0x80,1,0x80,&DAT_0011cf63);
    pcVar15 = file_fmtcheck(ms,m,"%s","softmagic.c",0x20f,pcVar13);
    goto LAB_0010bf3b;
  case '\x1b':
  case '\x1c':
  case '\x1d':
    pcVar14 = file_fmttime((ms->ms_value).q,0,tbuf);
    sVar17 = 0x25c;
    goto LAB_0010bf1c;
  case '\x1e':
  case '\x1f':
  case ' ':
    pcVar14 = file_fmttime((ms->ms_value).q,1,tbuf);
    sVar17 = 0x265;
    goto LAB_0010bf1c;
  case '!':
  case '\"':
  case '#':
    fVar2 = (ms->ms_value).f;
    iVar7 = check_fmt(ms,m);
    if (iVar7 == -1) break;
    if (iVar7 == 1) {
      pcVar14 = buf;
      __snprintf_chk((double)fVar2,pcVar14,0x80,1,0x80,"%g");
      sVar17 = 0x27d;
      goto LAB_0010bbdb;
    }
    pcVar14 = file_fmtcheck(ms,m,"%g","softmagic.c",0x281,in_R9);
    wVar6 = file_printf(ms,pcVar14,(double)fVar2);
    if (wVar6 == L'\xffffffff') break;
    goto LAB_0010bc0d;
  case '$':
  case '%':
  case '&':
    uVar9 = (ms->ms_value).q;
    iVar7 = check_fmt(ms,m);
    if (iVar7 == -1) break;
    if (iVar7 == 1) {
      pcVar14 = buf;
      __snprintf_chk(uVar9,pcVar14,0x80,1,0x80,"%g");
      sVar17 = 0x291;
      goto LAB_0010bf1c;
    }
    pcVar14 = file_fmtcheck(ms,m,"%g","softmagic.c",0x295,in_R9);
    wVar6 = file_printf(ms,pcVar14,uVar9);
    if (wVar6 == L'\xffffffff') break;
    goto LAB_0010bf4e;
  case ')':
  case '-':
  case '.':
    goto switchD_0010bbb6_caseD_29;
  case '*':
  case '+':
  case ',':
    pcVar14 = file_fmttime((ms->ms_value).q,2,tbuf);
    sVar17 = 0x26e;
LAB_0010bf1c:
    pcVar15 = "%s";
LAB_0010bf2a:
    pcVar15 = file_fmtcheck(ms,m,pcVar15,"softmagic.c",sVar17,in_R9);
LAB_0010bf3b:
    wVar6 = file_printf(ms,pcVar15,pcVar14);
    if (wVar6 != L'\xffffffff') {
LAB_0010bf4e:
      uVar8 = ms->offset + 8;
      goto LAB_0010bc16;
    }
    break;
  case '0':
    pcVar14 = file_printable(sbuf,0x200,(ms->ms_value).s);
    pcVar15 = file_fmtcheck(ms,m,"%s","softmagic.c",0x2c1,in_R9);
LAB_0010be07:
    wVar6 = file_printf(ms,pcVar15,pcVar14);
    if (wVar6 != L'\xffffffff') {
switchD_0010bbb6_caseD_29:
      uVar8 = ms->offset;
      goto LAB_0010bc16;
    }
  }
  uVar8 = 0xffffffff;
LAB_0010bc16:
  if (lVar4 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return uVar8;
}



int file_softmagic(magic_set *ms,uchar *buf,size_t nbytes,uint16_t *indir_count,uint16_t *name_count
                  ,int mode,int text)

{
  int iVar1;
  mlist *pmVar2;
  long in_FS_OFFSET;
  uint16_t nc;
  uint16_t ic;
  int printed_something;
  int need_separator;
  long local_40;
  
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  printed_something = 0;
  need_separator = 0;
  if (name_count == (uint16_t *)0x0) {
    name_count = &nc;
    nc = 0;
  }
  if (indir_count == (uint16_t *)0x0) {
    indir_count = &ic;
    ic = 0;
  }
  pmVar2 = ms->mlist[0]->next;
  if (ms->mlist[0] != pmVar2) {
    do {
      iVar1 = match(ms,pmVar2->magic,pmVar2->nmagic,buf,nbytes,0,mode,text,0,indir_count,name_count,
                    &printed_something,&need_separator,(int *)0x0);
      if (iVar1 != 0) goto LAB_0010c535;
      pmVar2 = pmVar2->next;
    } while (ms->mlist[0] != pmVar2);
  }
  iVar1 = 0;
LAB_0010c535:
  if (local_40 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int mget(magic_set *ms,uchar *s,magic *m,size_t nbytes,size_t o,uint cont_level,int mode,int text,
        int flip,uint16_t *indir_count,uint16_t *name_count,int *printed_something,
        int *need_separator,int *returnval)

{
  magic *m_1;
  byte bVar1;
  ushort uVar2;
  long lVar3;
  uint uVar4;
  uint uVar5;
  wchar_t wVar6;
  int iVar7;
  int iVar8;
  uint32_t uVar9;
  long lVar10;
  ulong uVar11;
  file_pushbuf_t *pb;
  char *fmt;
  size_t sVar12;
  size_t sVar13;
  uint *puVar14;
  byte bVar15;
  uint uVar16;
  size_t len;
  size_t len_00;
  char *pcVar17;
  VALUETYPE *pVVar18;
  ulong uVar19;
  byte bVar20;
  ulong uVar21;
  VALUETYPE *pVVar22;
  VALUETYPE *pVVar23;
  long in_FS_OFFSET;
  mlist ml;
  
  uVar16 = ms->offset;
  pVVar23 = (VALUETYPE *)(ulong)uVar16;
  uVar2 = *indir_count;
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  if (ms->indir_max <= uVar2) {
    pcVar17 = "indirect count (%hu) exceeded";
LAB_0010d1a2:
    file_error(ms,L'\0',pcVar17,(ulong)uVar2);
    goto LAB_0010cbe0;
  }
  uVar2 = *name_count;
  if (ms->name_max <= uVar2) {
    pcVar17 = "name use count (%hu) exceeded";
    goto LAB_0010d1a2;
  }
  pVVar22 = &ms->ms_value;
  m_1 = (magic *)((long)&m->_u + 4);
  pVVar18 = pVVar22;
  uVar4 = mcopy(ms,pVVar22,(uint)m->type,m->flag & 1,s,uVar16 + (int)o,nbytes & 0xffffffff,
                (magic *)&(m->_u)._s,m_1);
  if (uVar4 == 0xffffffff) goto LAB_0010c918;
  bVar20 = m->flag;
  if ((*(byte *)&ms->flags & 1) != 0) {
    __fprintf_chk(_stderr,1,"mget(type=%d, flag=%x, offset=%u, o=%zu, nbytes=%zu, il=%hu, nc=%hu)\n"
                  ,m->type,bVar20,pVVar23,o,nbytes,*indir_count,*name_count);
    pVVar18 = pVVar22;
    mdebug(uVar16,pVVar22->s,len_00);
    file_mdump(m);
    bVar20 = m->flag;
  }
  if ((bVar20 & 1) == 0) goto LAB_0010c7c0;
  uVar21 = (ulong)m->in_offset;
  bVar20 = m->in_op & 0x20;
  if (-1 < (char)m->in_op) {
    uVar4 = (uint)m->in_type;
    goto LAB_0010c6bb;
  }
  if ((nbytes < m->in_offset + uVar16) || (nbytes - ((long)pVVar23 + uVar21) < 0x60))
  goto LAB_0010ca50;
  bVar15 = m->in_type;
  uVar4 = (uint)bVar15;
  uVar5 = (uint)bVar15;
  uVar19 = uVar21;
  pVVar18 = pVVar23;
  if (flip != 0) {
    uVar4 = (uint)bVar15;
    uVar5 = cvt_flip((uint)bVar15,uVar16);
  }
  puVar14 = (uint *)(pVVar18->hs + uVar19 + (long)s);
  if (false) goto switchD_0010ca0d_caseD_0;
  switch(uVar5) {
  case 1:
    uVar21 = (long)(char)*(byte *)puVar14;
    if (bVar20 == 0) {
      uVar21 = (ulong)*(byte *)puVar14;
    }
    break;
  case 2:
    uVar21 = (long)(short)*(ushort *)puVar14;
    if (bVar20 == 0) {
      uVar21 = (ulong)*(ushort *)puVar14;
    }
    break;
  case 4:
  case 0xb:
  case 0x28:
    uVar21 = (long)(int)*puVar14;
    if (bVar20 == 0) {
      uVar21 = (ulong)*puVar14;
    }
    break;
  case 7:
    bVar15 = *(byte *)puVar14;
    bVar1 = *(byte *)((long)puVar14 + 1);
    goto LAB_0010cb57;
  case 8:
  case 0x27:
    uVar16 = *puVar14;
    uVar16 = uVar16 >> 0x18 | (uVar16 & 0xff0000) >> 8 | (uVar16 & 0xff00) << 8 | uVar16 << 0x18;
    uVar21 = (long)(int)uVar16;
    if (bVar20 == 0) {
      uVar21 = (ulong)uVar16;
    }
    break;
  case 10:
    bVar15 = *(byte *)((long)puVar14 + 1);
    bVar1 = *(byte *)puVar14;
LAB_0010cb57:
    uVar21 = (long)CONCAT11(bVar15,bVar1);
    if (bVar20 == 0) {
      uVar21 = (ulong)CONCAT11(bVar15,bVar1);
    }
    break;
  case 0x17:
    uVar16 = (uint)*(byte *)((long)puVar14 + 1) << 0x18 | (uint)*(byte *)puVar14 << 0x10 |
             (uint)*(byte *)((long)puVar14 + 2) | (uint)*(byte *)((long)puVar14 + 3) << 8;
    uVar21 = (long)(int)uVar16;
    if (bVar20 == 0) {
      uVar21 = (ulong)uVar16;
    }
  }
switchD_0010ca0d_caseD_0:
  if ((*(byte *)&ms->flags & 1) != 0) {
    pVVar18 = (VALUETYPE *)0x1;
    __fprintf_chk(_stderr,1,"indirect offs=%jd\n");
    uVar4 = (uint)m->in_type;
  }
LAB_0010c6bb:
  if (flip != 0) {
    uVar4 = cvt_flip(uVar4,(int)pVVar18);
  }
  if (true) {
    switch(uVar4) {
    default:
      goto switchD_0010c6ee_caseD_0;
    case 1:
      if (pVVar23 < nbytes) {
        uVar19 = (ulong)(char)(ms->ms_value).b;
        uVar11 = (ulong)(ms->ms_value).b;
LAB_0010c728:
        if (bVar20 == 0) {
          uVar19 = uVar11;
        }
        uVar9 = do_ops((magic *)(ulong)m->in_op,uVar19,uVar21);
        pVVar23 = (VALUETYPE *)(ulong)uVar9;
        goto switchD_0010c6ee_caseD_0;
      }
      break;
    case 2:
      if ((pVVar23 <= nbytes) && (1 < nbytes - (long)pVVar23)) {
        uVar19 = (ulong)(short)(ms->ms_value).h;
        uVar11 = (ulong)(ms->ms_value).h;
        goto LAB_0010c728;
      }
      break;
    case 4:
      if ((pVVar23 <= nbytes) && (3 < nbytes - (long)pVVar23)) {
        uVar19 = (ulong)(int)(ms->ms_value).l;
        uVar11 = (ulong)(ms->ms_value).l;
        goto LAB_0010c728;
      }
      break;
    case 7:
      if ((pVVar23 <= nbytes) && (1 < nbytes - (long)pVVar23)) {
        lVar10 = (ulong)(ms->ms_value).b << 8;
        uVar19 = (ulong)(short)((ushort)(ms->ms_value).hs[1] | (ushort)lVar10);
        uVar11 = (ulong)((uint)(ms->ms_value).hs[1] | (uint)lVar10);
        goto LAB_0010c728;
      }
      break;
    case 8:
    case 0x27:
      if ((pVVar23 <= nbytes) && (3 < nbytes - (long)pVVar23)) {
        uVar16 = (ms->ms_value).l;
        uVar16 = uVar16 >> 0x18 | (uVar16 & 0xff0000) >> 8 | (uVar16 & 0xff00) << 8 | uVar16 << 0x18
        ;
        uVar19 = (ulong)uVar16;
        if (uVar4 == 0x27) {
LAB_0010ce10:
          uVar9 = cvt_id3((magic_set *)(ulong)(uint)ms->flags,uVar16);
          uVar19 = (ulong)uVar9;
        }
LAB_0010cdc3:
        if (bVar20 != 0) {
          uVar19 = (long)(int)uVar19;
        }
        uVar9 = do_ops((magic *)(ulong)m->in_op,uVar19,uVar21);
        pVVar23 = (VALUETYPE *)(ulong)uVar9;
        goto switchD_0010c6ee_caseD_0;
      }
      break;
    case 10:
      if ((pVVar23 <= nbytes) && (1 < nbytes - (long)pVVar23)) {
        lVar10 = (ulong)(ms->ms_value).hs[1] << 8;
        uVar19 = (ulong)(short)((ushort)(ms->ms_value).b | (ushort)lVar10);
        uVar11 = (ulong)((uint)(ms->ms_value).b | (uint)lVar10);
        goto LAB_0010c728;
      }
      break;
    case 0xb:
    case 0x28:
      if ((pVVar23 <= nbytes) && (3 < nbytes - (long)pVVar23)) {
        uVar16 = (ms->ms_value).l;
        uVar19 = (ulong)uVar16;
        if (uVar4 == 0x28) goto LAB_0010ce10;
        goto LAB_0010cdc3;
      }
      break;
    case 0x17:
      if ((pVVar23 <= nbytes) && (3 < nbytes - (long)pVVar23)) {
        uVar16 = (uint)(ms->ms_value).hs[1] << 0x18 | (uint)(ms->ms_value).b << 0x10 |
                 (uint)(ms->ms_value).hs[2] | (uint)(ms->ms_value).hs[3] << 8;
        uVar19 = (ulong)(int)uVar16;
        uVar11 = (ulong)uVar16;
        goto LAB_0010c728;
      }
    }
    goto LAB_0010ca50;
  }
switchD_0010c6ee_caseD_0:
  if ((m->flag & 4) != 0) {
    uVar16 = ms->flags & 1;
    uVar4 = (int)pVVar23 + (ms->c).li[cont_level - 1].off;
    pVVar23 = (VALUETYPE *)(ulong)uVar4;
    if (uVar4 == 0) {
      if (uVar16 != 0) {
        fwrite("indirect *zero* offset\n",1,0x17,_stderr);
        uVar4 = 0;
        goto LAB_0010c918;
      }
      goto LAB_0010ca50;
    }
    if (uVar16 != 0) {
      __fprintf_chk(_stderr,1,"indirect +offs=%u\n");
    }
  }
  uVar9 = (uint32_t)pVVar23;
  uVar4 = mcopy(ms,pVVar22,(uint)m->type,0,s,uVar9,nbytes,(magic *)&(m->_u)._s,m_1);
  if (uVar4 == 0xffffffff) goto LAB_0010c918;
  ms->offset = uVar9;
  if ((*(byte *)&ms->flags & 1) != 0) {
    mdebug(uVar9,pVVar22->s,len);
    file_mdump(m);
  }
LAB_0010c7c0:
  bVar20 = m->type;
  if (false) goto switchD_0010c7e0_caseD_0;
  switch(bVar20) {
  case 1:
    if (pVVar23 < nbytes) {
      uVar21 = 1;
      if (flip != 0) goto LAB_0010ca8a;
      goto switchD_0010caac_caseD_1;
    }
    goto LAB_0010ca50;
  case 2:
  case 7:
  case 10:
    if ((nbytes < pVVar23) || (nbytes - (long)pVVar23 < 2)) goto LAB_0010ca50;
    break;
  case 4:
  case 6:
  case 8:
  case 9:
  case 0xb:
  case 0xc:
  case 0xe:
  case 0xf:
  case 0x10:
  case 0x15:
  case 0x16:
  case 0x17:
  case 0x21:
  case 0x22:
  case 0x23:
    if ((nbytes < pVVar23) || (nbytes - (long)pVVar23 < 4)) goto LAB_0010ca50;
    break;
  case 5:
  case 0xd:
  case 0x14:
    if ((nbytes < pVVar23) || (nbytes - (long)pVVar23 < (ulong)m->vallen)) goto LAB_0010ca50;
    break;
  case 0x11:
    if (nbytes < pVVar23) goto LAB_0010ca50;
    uVar21 = 0x11;
    if (flip != 0) goto LAB_0010ca8a;
    goto switchD_0010caac_caseD_3;
  case 0x24:
  case 0x25:
  case 0x26:
    if ((nbytes < pVVar23) || (nbytes - (long)pVVar23 < 8)) goto LAB_0010ca50;
    break;
  case 0x29:
    uVar16 = (uint)pVVar23;
    if ((*(byte *)((long)&m->_u + 4) & 1) != 0) {
      uVar16 = (int)o + (uint)pVVar23;
    }
    if ((uVar16 == 0) || (uVar21 = (ulong)uVar16, nbytes < uVar21)) goto LAB_0010ca50;
    pb = file_push_buffer(ms);
    if (pb != (file_pushbuf_t *)0x0) {
      *indir_count = *indir_count + 1;
      uVar4 = file_softmagic(ms,s + uVar21,nbytes - uVar21,indir_count,name_count,0x20,text);
      if ((*(byte *)&ms->flags & 1) != 0) {
        __fprintf_chk(_stderr,1,"indirect @offs=%u[%d]\n",uVar16,uVar4);
      }
      pcVar17 = file_pop_buffer(ms,pb);
      if ((pcVar17 != (char *)0x0) || ((*(byte *)&ms->event_flags & 1) == 0)) {
        if (uVar4 == 1) {
          if ((ms->flags & 0x1000c10U) == 0) {
            fmt = file_fmtcheck(ms,m,"%u","softmagic.c",0x624,(char *)(ulong)uVar4);
            wVar6 = file_printf(ms,fmt,(ulong)uVar16);
            uVar4 = 1;
            if (wVar6 != L'\xffffffff') goto LAB_0010c8dc;
          }
          else {
LAB_0010c8dc:
            wVar6 = file_printf(ms,"%s",pcVar17);
            if (wVar6 != L'\xffffffff') goto LAB_0010c901;
          }
          free(pcVar17);
          uVar4 = 0xffffffff;
        }
        else {
LAB_0010c901:
          free(pcVar17);
        }
        goto LAB_0010c918;
      }
    }
LAB_0010cbe0:
    uVar4 = 0xffffffff;
    goto LAB_0010c918;
  case 0x2d:
    if (((ms->flags & 0x1000c10U) == 0) &&
       (wVar6 = file_printf(ms,"%s",m->desc), wVar6 == L'\xffffffff')) goto LAB_0010cbe0;
    goto switchD_0010caac_caseD_3;
  case 0x2e:
    if (nbytes < pVVar23) goto LAB_0010ca50;
    pVVar22 = &m->value;
    if ((m->value).b == '^') {
      pVVar22 = (VALUETYPE *)((m->value).s + 1);
      flip = (int)(flip == 0);
    }
    iVar7 = file_magicfind(ms,pVVar22->s,&ml);
    if (iVar7 == -1) {
      file_error(ms,L'\0',"cannot find entry `%s\'",pVVar22);
      uVar4 = 0xffffffff;
      goto LAB_0010c918;
    }
    *name_count = *name_count + 1;
    iVar7 = *need_separator;
    if ((m->flag & 0x10) != 0) {
      *need_separator = 0;
    }
    iVar8 = match(ms,ml.magic,ml.nmagic,s,nbytes,(long)pVVar23 + o,mode,text,flip,indir_count,
                  name_count,printed_something,need_separator,returnval);
    if (iVar8 != 1) {
      uVar4 = 1;
      *need_separator = iVar7;
      goto LAB_0010c918;
    }
    goto switchD_0010caac_caseD_3;
  }
switchD_0010c7e0_caseD_0:
  uVar19 = (ulong)bVar20;
  uVar21 = uVar19;
  if (flip != 0) {
LAB_0010ca8a:
    uVar16 = cvt_flip((int)uVar21,(uint)bVar20);
    uVar19 = (ulong)(uVar16 & 0xff);
  }
  if (false) {
switchD_0010caac_caseD_0:
    file_magerror(ms,"invalid type %d in mconvert()",uVar21 & 0xffffffff);
    uVar4 = 0;
    goto LAB_0010c918;
  }
  switch(uVar19) {
  default:
    goto switchD_0010caac_caseD_0;
  case 1:
switchD_0010caac_caseD_1:
    bVar20 = m->mask_op;
    if ((m->_u)._mask == 0) goto LAB_0010d0c8;
    bVar15 = (byte)(m->_u)._mask;
    switch(bVar20 & 7) {
    case 0:
      (ms->ms_value).b = (ms->ms_value).b & bVar15;
      bVar20 = m->mask_op;
      break;
    case 1:
      (ms->ms_value).b = (ms->ms_value).b | bVar15;
      bVar20 = m->mask_op;
      break;
    case 2:
      (ms->ms_value).b = (ms->ms_value).b ^ bVar15;
      bVar20 = m->mask_op;
      break;
    case 3:
      (ms->ms_value).b = (ms->ms_value).b + bVar15;
      bVar20 = m->mask_op;
      break;
    case 4:
      (ms->ms_value).b = (ms->ms_value).b - bVar15;
      bVar20 = m->mask_op;
      break;
    case 5:
      (ms->ms_value).b = (ms->ms_value).b * bVar15;
      bVar20 = m->mask_op;
      break;
    case 6:
      if (bVar15 != 0) {
        (ms->ms_value).b = (ms->ms_value).b / bVar15;
        bVar20 = m->mask_op;
        break;
      }
      goto LAB_0010ca38;
    case 7:
      if (bVar15 == 0) goto LAB_0010ca38;
      (ms->ms_value).b = (ms->ms_value).b % bVar15;
      bVar20 = m->mask_op;
    }
LAB_0010d0c8:
    if ((bVar20 & 0x40) != 0) {
      (ms->ms_value).b = ~(ms->ms_value).b;
      uVar4 = 1;
      goto LAB_0010c918;
    }
    goto switchD_0010caac_caseD_3;
  case 2:
  case 10:
    goto switchD_0010caac_caseD_2;
  case 3:
  case 0x11:
  case 0x14:
  case 0x2d:
  case 0x2e:
  case 0x2f:
  case 0x30:
    goto switchD_0010caac_caseD_3;
  case 4:
  case 6:
  case 0xb:
  case 0xc:
  case 0xe:
  case 0x10:
    break;
  case 5:
  case 0x12:
  case 0x13:
    (ms->ms_value).hs[0x5f] = '\0';
    uVar4 = 1;
    goto LAB_0010c918;
  case 7:
    (ms->ms_value).h = CONCAT11((ms->ms_value).b,(ms->ms_value).hs[1]);
switchD_0010caac_caseD_2:
    iVar7 = cvt_16(pVVar22,(magic *)&m->mask_op,(magic *)m->_u);
joined_r0x0010ce99:
    if (iVar7 != -1) goto switchD_0010caac_caseD_3;
    goto LAB_0010ca38;
  case 8:
  case 9:
  case 0xf:
    uVar16 = (ms->ms_value).l;
    (ms->ms_value).l =
         uVar16 >> 0x18 | (uVar16 & 0xff0000) >> 8 | (uVar16 & 0xff00) << 8 | uVar16 << 0x18;
    break;
  case 0xd:
    sVar12 = file_pstring_length_size(m);
    sVar13 = file_pstring_get_length(m,pVVar22->s);
    uVar21 = 0x60 - sVar12;
    if (sVar13 < 0x60 - sVar12) {
      uVar21 = sVar13;
    }
    if (uVar21 != 0) {
      sVar13 = 0;
      do {
        *(uint8_t *)((long)ms->mlist + sVar13 + 0x70) = pVVar22->hs[sVar13 + sVar12];
        sVar13 = sVar13 + 1;
      } while (sVar13 != uVar21);
      pVVar22 = (VALUETYPE *)(pVVar22->hs + sVar13);
    }
    pVVar22->b = '\0';
    uVar4 = 1;
    goto LAB_0010c918;
  case 0x15:
  case 0x16:
  case 0x17:
    (ms->ms_value).l =
         (uint)(ms->ms_value).hs[1] << 0x18 | (uint)(ms->ms_value).b << 0x10 |
         (uint)(ms->ms_value).hs[2] | (uint)(ms->ms_value).hs[3] << 8;
    break;
  case 0x18:
  case 0x19:
  case 0x1b:
  case 0x1c:
  case 0x1e:
  case 0x1f:
  case 0x2a:
  case 0x2b:
    goto switchD_0010caac_caseD_18;
  case 0x1a:
  case 0x1d:
  case 0x20:
  case 0x2c:
    uVar21 = (ms->ms_value).q;
    (ms->ms_value).q =
         uVar21 >> 0x38 | (uVar21 & 0xff000000000000) >> 0x28 | (uVar21 & 0xff0000000000) >> 0x18 |
         (uVar21 & 0xff00000000) >> 8 | (uVar21 & 0xff000000) << 8 | (uVar21 & 0xff0000) << 0x18 |
         (uVar21 & 0xff00) << 0x28 | uVar21 << 0x38;
switchD_0010caac_caseD_18:
    iVar7 = cvt_64(pVVar22,(magic *)&m->mask_op,(magic *)m->_u);
    goto joined_r0x0010ce99;
  case 0x21:
  case 0x23:
    goto switchD_0010caac_caseD_21;
  case 0x22:
    uVar16 = (ms->ms_value).l;
    (ms->ms_value).l =
         uVar16 >> 0x18 | (uVar16 & 0xff0000) >> 8 | (uVar16 & 0xff00) << 8 | uVar16 << 0x18;
switchD_0010caac_caseD_21:
    iVar7 = cvt_float(pVVar22,(magic *)(ulong)m->mask_op,(magic *)m->_u);
    goto joined_r0x0010ce99;
  case 0x24:
  case 0x26:
    goto switchD_0010caac_caseD_24;
  case 0x25:
    uVar21 = (ms->ms_value).q;
    (ms->ms_value).q =
         uVar21 >> 0x38 | (uVar21 & 0xff000000000000) >> 0x28 | (uVar21 & 0xff0000000000) >> 0x18 |
         (uVar21 & 0xff00000000) >> 8 | (uVar21 & 0xff000000) << 8 | (uVar21 & 0xff0000) << 0x18 |
         (uVar21 & 0xff00) << 0x28 | uVar21 << 0x38;
switchD_0010caac_caseD_24:
    iVar7 = cvt_double(pVVar22,(magic *)(ulong)m->mask_op,(magic *)m->_u);
    goto joined_r0x0010ce99;
  }
  iVar7 = cvt_32(pVVar22,(magic *)&m->mask_op,(magic *)m->_u);
  if (iVar7 == -1) {
LAB_0010ca38:
    file_magerror(ms,"zerodivide in mconvert()");
LAB_0010ca50:
    uVar4 = 0;
  }
  else {
switchD_0010caac_caseD_3:
    uVar4 = 1;
  }
LAB_0010c918:
  if (lVar3 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return uVar4;
}



int match(magic_set *ms,magic *magic,uint32_t nmagic,uchar *s,size_t nbytes,size_t offset,int mode,
         int text,int flip,uint16_t *indir_count,uint16_t *name_count,int *printed_something,
         int *need_separator,int *returnval)

{
  byte bVar1;
  ushort uVar2;
  uint32_t uVar3;
  level_info *plVar4;
  uint uVar5;
  wchar_t wVar6;
  uint uVar7;
  int iVar8;
  int32_t iVar9;
  uint cont_level;
  magic *pmVar10;
  uint uVar11;
  ulong uVar12;
  uint uVar13;
  long in_FS_OFFSET;
  int local_60;
  int returnvalv;
  long local_40;
  
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  returnvalv = 0;
  uVar5 = ms->flags & 0x1000c10;
  if (returnval == (int *)0x0) {
    returnval = &returnvalv;
  }
  wVar6 = file_check_mem(ms,0);
  if (wVar6 == L'\xffffffff') {
LAB_0010d618:
    iVar8 = -1;
  }
  else {
    if (nmagic != 0) {
      local_60 = 1;
      uVar12 = 0;
      do {
        pmVar10 = magic + uVar12;
        bVar1 = pmVar10->type;
        if (bVar1 == 0x2d) {
LAB_0010d36b:
          ms->offset = pmVar10->offset;
          ms->line = (ulong)pmVar10->lineno;
          iVar8 = mget(ms,s,pmVar10,nbytes,offset,0,mode,text,flip,indir_count,name_count,
                       printed_something,need_separator,returnval);
          if (iVar8 == -1) goto LAB_0010d618;
          if (iVar8 == 0) {
            if (pmVar10->reln == '!') goto LAB_0010d3fb;
            goto LAB_0010d650;
          }
          if (pmVar10->type == ')') {
            *returnval = 1;
          }
          iVar8 = magiccheck(ms,pmVar10);
          if (iVar8 == -1) goto LAB_0010d618;
          if (iVar8 == 0) goto LAB_0010d650;
LAB_0010d3fb:
          iVar8 = handle_annotation(ms,pmVar10,local_60);
          if (iVar8 != 0) {
LAB_0010d86f:
            *need_separator = 1;
            *printed_something = 1;
            *returnval = 1;
            goto LAB_0010d61d;
          }
          if (pmVar10->desc[0] != '\0') {
            *need_separator = 1;
            *printed_something = 1;
            if ((local_60 == 0) && (wVar6 = file_printf(ms,"\n- "), wVar6 == L'\xffffffff'))
            goto LAB_0010d618;
          }
          if ((uVar5 == 0) && (iVar9 = mprint(ms,pmVar10), iVar9 == -1)) goto LAB_0010d618;
          iVar8 = moffset(ms,pmVar10,nbytes,&((ms->c).li)->off);
          if (iVar8 + 1U < 2) goto LAB_0010d650;
          wVar6 = file_check_mem(ms,1);
          if (wVar6 == L'\xffffffff') goto LAB_0010d618;
          uVar7 = (uint)uVar12 + 1;
          uVar11 = (uint)uVar12;
          if (uVar7 < nmagic) {
            pmVar10 = magic + uVar7;
            cont_level = 1;
            do {
              uVar13 = uVar7;
              uVar2 = pmVar10->cont_level;
              uVar11 = uVar13 - 1;
              if (uVar2 == 0) break;
              ms->line = (ulong)pmVar10->lineno;
              uVar7 = (uint)uVar2;
              if (uVar7 <= cont_level) {
                if (uVar7 < cont_level) {
                  cont_level = uVar7;
                }
                uVar3 = pmVar10->offset;
                ms->offset = uVar3;
                if ((pmVar10->flag & 2) != 0) {
                  ms->offset = uVar3 + (ms->c).li[cont_level - 1].off;
                }
                if ((1 < (byte)(pmVar10->cond - 2)) || ((ms->c).li[cont_level].last_match != 1)) {
                  iVar8 = mget(ms,s,pmVar10,nbytes,offset,cont_level,mode,text,flip,indir_count,
                               name_count,printed_something,need_separator,returnval);
                  if (iVar8 == -1) goto LAB_0010d618;
                  if (iVar8 == 0) {
                    if (pmVar10->reln == '!') {
LAB_0010d58d:
                      plVar4 = (ms->c).li;
                      plVar4[cont_level].last_match = 1;
                      if (pmVar10->type == '/') {
                        plVar4[cont_level].got_match = 0;
                      }
                      else if (plVar4[cont_level].got_match == 0) {
                        plVar4[cont_level].got_match = 1;
                      }
                      else if (pmVar10->type == '\x03') goto LAB_0010d5d0;
                      iVar8 = handle_annotation(ms,pmVar10,local_60);
                      if (iVar8 != 0) goto LAB_0010d86f;
                      if ((((pmVar10->desc[0] != '\0') && (*printed_something == 0)) &&
                          (*printed_something = 1, local_60 == 0)) &&
                         (wVar6 = file_printf(ms,"\n- "), wVar6 == L'\xffffffff'))
                      goto LAB_0010d618;
                      if (((*need_separator != 0) && ((pmVar10->flag & 0x10) == 0)) &&
                         (pmVar10->desc[0] != '\0')) {
                        if ((uVar5 == 0) && (wVar6 = file_printf(ms," "), wVar6 == L'\xffffffff'))
                        goto LAB_0010d618;
                        *need_separator = 0;
                      }
                      if ((uVar5 == 0) && (iVar9 = mprint(ms,pmVar10), iVar9 == -1))
                      goto LAB_0010d618;
                      moffset(ms,pmVar10,nbytes,&(ms->c).li[cont_level].off);
                      if (pmVar10->desc[0] != '\0') {
                        *need_separator = 1;
                      }
                      cont_level = cont_level + 1;
                      wVar6 = file_check_mem(ms,cont_level);
                      if (wVar6 == L'\xffffffff') goto LAB_0010d618;
                    }
                  }
                  else {
                    if (pmVar10->type == ')') {
                      *returnval = 1;
                    }
                    iVar8 = magiccheck(ms,pmVar10);
                    if (iVar8 == -1) goto LAB_0010d618;
                    if (iVar8 != 0) goto LAB_0010d58d;
                    (ms->c).li[cont_level].last_match = 0;
                  }
                }
              }
LAB_0010d5d0:
              pmVar10 = pmVar10 + 1;
              uVar7 = uVar13 + 1;
              uVar11 = uVar13;
            } while (uVar13 + 1 < nmagic);
          }
          if (*printed_something == 0) {
LAB_0010d852:
            uVar12 = (ulong)(uVar11 + 1);
          }
          else {
            if (uVar5 == 0) {
              *returnval = 1;
              if ((*(byte *)&ms->flags & 0x20) == 0) {
                local_60 = *printed_something;
                if (local_60 == 0) goto LAB_0010d852;
                break;
              }
            }
            else if ((*(byte *)&ms->flags & 0x20) == 0) break;
            local_60 = 0;
            uVar12 = (ulong)(uVar11 + 1);
          }
        }
        else {
          if ((bVar1 < 0x2f) && ((0x4200001e2020U >> ((ulong)bVar1 & 0x3f) & 1) != 0)) {
            uVar7 = (pmVar10->_u)._s._flags & 0x60;
            if (text == 0) {
              if (uVar7 != 0x20) goto LAB_0010d352;
            }
            else if (uVar7 != 0x40) goto LAB_0010d352;
          }
          else {
LAB_0010d352:
            if (((uint)pmVar10->flag & mode) == mode) goto LAB_0010d36b;
          }
LAB_0010d650:
          do {
            uVar7 = (uint)uVar12;
            uVar12 = (ulong)(uVar7 + 1);
            if (nmagic - 1 <= uVar7) break;
          } while (magic[uVar12].cont_level != 0);
        }
      } while ((uint)uVar12 < nmagic);
    }
    iVar8 = *returnval;
  }
LAB_0010d61d:
  if (local_40 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar8;
}



int file_ascmagic_with_encoding
              (magic_set *ms,uchar *buf,size_t nbytes,unichar *ubuf,size_t ulen,char *code,
              char *type,int text)

{
  int iVar1;
  uint uVar2;
  unichar uVar3;
  ulong uVar4;
  byte bVar5;
  size_t __size;
  bool bVar6;
  bool bVar7;
  byte bVar8;
  wchar_t wVar9;
  ulong uVar10;
  size_t sVar11;
  byte *buf_00;
  long lVar12;
  byte *pbVar13;
  byte *pbVar14;
  ulong uVar15;
  ulong uVar16;
  byte *pbVar17;
  char *fmt;
  uint uVar18;
  int iVar19;
  uint uVar20;
  uint uVar21;
  int iVar22;
  bool bVar23;
  bool bVar24;
  byte bVar25;
  uint local_48;
  
  bVar25 = 0;
  do {
    uVar15 = nbytes;
    if (uVar15 < 2) {
      buf_00 = (byte *)0x0;
      uVar20 = 0;
      goto LAB_0010d912;
    }
    nbytes = uVar15 - 1;
  } while (buf[uVar15 - 1] == '\0');
  uVar2 = ms->flags;
  if (ulen == 0) {
    if ((uVar2 & 0x1000800) != 0) {
      return 0;
    }
    bVar7 = false;
    iVar22 = 0;
    uVar18 = 0;
    iVar19 = 0;
    iVar1 = 0;
    bVar23 = false;
    buf_00 = (byte *)0x0;
    bVar24 = true;
    bVar6 = false;
    local_48 = 0xffffffff;
    uVar21 = 0;
  }
  else {
    if ((uVar2 & 0x4000) == 0) {
      __size = ulen * 6;
      buf_00 = (byte *)malloc(__size);
      if (buf_00 == (byte *)0x0) {
        file_oomem(ms,__size);
        uVar20 = 0xffffffff;
        goto LAB_0010d912;
      }
      pbVar17 = buf_00 + __size;
      sVar11 = 0;
      pbVar13 = buf_00;
      do {
        uVar4 = ubuf[sVar11];
        bVar8 = (byte)uVar4;
        if (uVar4 < 0x80) {
          if (pbVar17 == pbVar13 || (long)pbVar17 - (long)pbVar13 < 0) goto LAB_0010dfd9;
          *pbVar13 = bVar8;
          pbVar14 = pbVar13 + 1;
        }
        else if (uVar4 < 0x800) {
          if ((long)pbVar17 - (long)pbVar13 < 2) goto LAB_0010dfd9;
          pbVar14 = pbVar13 + 2;
          pbVar13[1] = (bVar8 & 0x3f) + 0x80;
          *pbVar13 = (char)(uVar4 >> 6) - 0x40;
        }
        else if (uVar4 < 0x10000) {
          if ((long)pbVar17 - (long)pbVar13 < 3) goto LAB_0010dfd9;
          pbVar14 = pbVar13 + 3;
          *pbVar13 = (char)(uVar4 >> 0xc) - 0x20;
          pbVar13[2] = (bVar8 & 0x3f) + 0x80;
          pbVar13[1] = ((byte)(uVar4 >> 6) & 0x3f) + 0x80;
        }
        else if (uVar4 < 0x200000) {
          if ((long)pbVar17 - (long)pbVar13 < 4) goto LAB_0010dfd9;
          pbVar14 = pbVar13 + 4;
          *pbVar13 = (char)(uVar4 >> 0x12) - 0x10;
          pbVar13[1] = ((byte)(uVar4 >> 0xc) & 0x3f) + 0x80;
          pbVar13[3] = (bVar8 & 0x3f) + 0x80;
          pbVar13[2] = ((byte)(uVar4 >> 6) & 0x3f) + 0x80;
        }
        else {
          bVar5 = (byte)(uVar4 >> 0x18);
          if (uVar4 < 0x4000000) {
            if ((long)pbVar17 - (long)pbVar13 < 5) {
LAB_0010dfd9:
              uVar20 = 0xffffffff;
              goto LAB_0010d912;
            }
            pbVar14 = pbVar13 + 5;
            *pbVar13 = bVar5 - 8;
            pbVar13[1] = ((byte)(uVar4 >> 0x12) & 0x3f) + 0x80;
            pbVar13[2] = ((byte)(uVar4 >> 0xc) & 0x3f) + 0x80;
            pbVar13[4] = (bVar8 & 0x3f) + 0x80;
            pbVar13[3] = ((byte)(uVar4 >> 6) & 0x3f) + 0x80;
          }
          else {
            if ((0x7fffffff < uVar4) || ((long)pbVar17 - (long)pbVar13 < 6)) goto LAB_0010dfd9;
            pbVar14 = pbVar13 + 6;
            *pbVar13 = (char)(uVar4 >> 0x1e) - 4;
            pbVar13[1] = (bVar5 & 0x3f) + 0x80;
            pbVar13[2] = ((byte)(uVar4 >> 0x12) & 0x3f) + 0x80;
            pbVar13[3] = ((byte)(uVar4 >> 0xc) & 0x3f) + 0x80;
            pbVar13[5] = (bVar8 & 0x3f) + 0x80;
            pbVar13[4] = ((byte)(uVar4 >> 6) & 0x3f) + 0x80;
          }
        }
        sVar11 = sVar11 + 1;
        pbVar13 = pbVar14;
      } while (ulen != sVar11);
      uVar20 = file_softmagic(ms,buf_00,(long)pbVar14 - (long)buf_00,(uint16_t *)0x0,(uint16_t *)0x0
                              ,0x40,text);
      local_48 = 0xffffffff;
      if (uVar20 != 0) {
        local_48 = uVar20;
      }
      if ((ms->flags & 0x1000800U) != 0) {
        uVar20 = (uint)(local_48 != 0xffffffff);
        goto LAB_0010d912;
      }
    }
    else {
      if ((uVar2 & 0x1000800) != 0) {
        return 0;
      }
      local_48 = 0xffffffff;
      buf_00 = (byte *)0x0;
    }
    bVar6 = false;
    iVar22 = 0;
    uVar21 = 0;
    bVar23 = false;
    iVar1 = 0;
    iVar19 = 0;
    uVar18 = 0;
    bVar7 = false;
    uVar4 = 0;
    uVar16 = 0xffffffffffffffff;
    do {
      while (uVar10 = uVar4, uVar3 = ubuf[uVar10], uVar3 == 10) {
        if (bVar23) {
          iVar19 = iVar19 + 1;
        }
        else {
          iVar1 = iVar1 + 1;
        }
        bVar23 = false;
        uVar4 = uVar10 + 1;
        uVar16 = uVar10;
        bVar24 = false;
        if (ulen == uVar10 + 1) goto LAB_0010da05;
      }
      uVar21 = (uVar21 + 1) - (uint)!bVar23;
      bVar23 = uVar3 == 0xd;
      uVar4 = uVar10;
      if (!bVar23) {
        if (uVar3 == 0x85) {
          iVar22 = iVar22 + 1;
        }
        else {
          bVar23 = false;
          uVar4 = uVar16;
          if (uVar16 + 300 < uVar10) {
            bVar6 = true;
          }
        }
      }
      uVar16 = uVar4;
      if (uVar3 == 0x1b) {
        bVar7 = true;
      }
      else if (uVar3 == 8) {
        uVar18 = 1;
      }
      uVar4 = uVar10 + 1;
      bVar24 = bVar23;
    } while (ulen != uVar10 + 1);
LAB_0010da05:
    bVar23 = false;
    bVar24 = !bVar24;
    if (!bVar24) {
      uVar20 = (uint)(uVar15 < ms->bytes_max);
      bVar23 = CARRY4(uVar21,uVar20);
      uVar21 = uVar21 + uVar20;
      bVar24 = uVar21 == 0;
    }
  }
  lVar12 = 7;
  pbVar17 = (byte *)type;
  pbVar13 = (byte *)"binary";
  do {
    if (lVar12 == 0) break;
    lVar12 = lVar12 + -1;
    bVar23 = *pbVar17 < *pbVar13;
    bVar24 = *pbVar17 == *pbVar13;
    pbVar17 = pbVar17 + (ulong)bVar25 * -2 + 1;
    pbVar13 = pbVar13 + (ulong)bVar25 * -2 + 1;
  } while (bVar24);
  uVar20 = (uint)(char)((!bVar23 && !bVar24) - bVar23);
  if (uVar20 == 0) goto LAB_0010d912;
  uVar20 = local_48;
  if ((uVar2 & 0x410) != 0) {
    sVar11 = file_printedlen(ms);
    uVar20 = 1;
    if ((sVar11 == 0) && ((uVar2 & 0x10) != 0)) {
      wVar9 = file_printf(ms,"text/plain");
      uVar20 = 1;
      if (wVar9 == L'\xffffffff') {
        uVar20 = local_48;
      }
    }
    goto LAB_0010d912;
  }
  sVar11 = file_printedlen(ms);
  bVar23 = false;
  if (sVar11 != 0) {
    wVar9 = file_replace(ms," text$",", ");
    if (wVar9 == L'\xffffffff') goto LAB_0010d912;
    if (wVar9 == L'\0') {
      wVar9 = file_replace(ms," text executable$",", ");
      if (wVar9 == L'\xffffffff') goto LAB_0010d912;
      if (wVar9 == L'\0') {
        wVar9 = file_printf(ms,", ");
        if (wVar9 == L'\xffffffff') goto LAB_0010d912;
      }
      else {
        bVar23 = true;
      }
    }
  }
  wVar9 = file_printf(ms,"%s",code);
  if ((((wVar9 == L'\xffffffff') || (wVar9 = file_printf(ms," %s",type), wVar9 == L'\xffffffff')) ||
      ((bVar23 && (wVar9 = file_printf(ms," executable"), wVar9 == L'\xffffffff')))) ||
     ((bVar6 && (wVar9 = file_printf(ms,", with very long lines"), wVar9 == L'\xffffffff'))))
  goto LAB_0010d912;
  if (iVar1 == 0 && ((iVar19 == 0 && uVar21 == 0) && iVar22 == 0)) {
    wVar9 = file_printf(ms,", with");
    if (wVar9 == L'\xffffffff') goto LAB_0010d912;
    fmt = " no";
LAB_0010e118:
    wVar9 = file_printf(ms,fmt);
    if (wVar9 == L'\xffffffff') goto LAB_0010d912;
LAB_0010dca8:
    wVar9 = file_printf(ms," line terminators");
    if (wVar9 == L'\xffffffff') goto LAB_0010d912;
  }
  else if ((iVar19 != 0 || uVar21 != 0) || iVar22 != 0) {
    wVar9 = file_printf(ms,", with");
    if (wVar9 == L'\xffffffff') goto LAB_0010d912;
    if (iVar19 == 0) {
LAB_0010dc57:
      if (uVar21 != 0) {
        wVar9 = file_printf(ms," CR");
        if (wVar9 == L'\xffffffff') goto LAB_0010d912;
        if (iVar1 == 0 && iVar22 == 0) goto LAB_0010dca8;
        wVar9 = file_printf(ms,",");
        if (wVar9 == L'\xffffffff') goto LAB_0010d912;
      }
      if (iVar1 == 0) {
        if (iVar22 != 0) {
LAB_0010e279:
          fmt = " NEL";
          goto LAB_0010e118;
        }
      }
      else {
        wVar9 = file_printf(ms," LF");
        if (wVar9 == L'\xffffffff') goto LAB_0010d912;
        if (iVar22 != 0) {
          wVar9 = file_printf(ms,",");
          if (wVar9 == L'\xffffffff') goto LAB_0010d912;
          goto LAB_0010e279;
        }
      }
    }
    else {
      wVar9 = file_printf(ms," CRLF");
      if (wVar9 == L'\xffffffff') goto LAB_0010d912;
      if ((uVar21 != 0 || iVar22 != 0) || iVar1 != 0) {
        wVar9 = file_printf(ms,",");
        if (wVar9 == L'\xffffffff') goto LAB_0010d912;
        goto LAB_0010dc57;
      }
    }
    goto LAB_0010dca8;
  }
  if ((((!bVar7) || (wVar9 = file_printf(ms,", with escape sequences"), wVar9 != L'\xffffffff')) &&
      (uVar20 = 1, uVar18 != 0)) &&
     (wVar9 = file_printf(ms,", with overstriking"), uVar20 = local_48, wVar9 != L'\xffffffff')) {
    uVar20 = uVar18;
  }
LAB_0010d912:
  free(buf_00);
  return uVar20;
}



int file_ascmagic(magic_set *ms,uchar *buf,size_t nbytes,int text)

{
  int iVar1;
  ulong nbytes_00;
  long in_FS_OFFSET;
  unichar *ubuf;
  size_t ulen;
  char *code;
  char *code_mime;
  char *type;
  long local_30;
  
  local_30 = *(long *)(in_FS_OFFSET + 0x28);
  ubuf = (unichar *)0x0;
  ulen = 0;
  code = (char *)0x0;
  code_mime = (char *)0x0;
  type = (char *)0x0;
  do {
    nbytes_00 = nbytes;
    if (nbytes_00 < 2) break;
    nbytes = nbytes_00 - 1;
  } while (buf[nbytes_00 - 1] == '\0');
  iVar1 = file_encoding(ms,buf,nbytes_00,&ubuf,&ulen,&code,&code_mime,&type);
  if (iVar1 != 0) {
    iVar1 = file_ascmagic_with_encoding(ms,buf,nbytes_00,ubuf,ulen,code,type,text);
  }
  free(ubuf);
  if (local_30 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar1;
}



// WARNING: Unknown calling convention

int file_looks_utf8(uchar *buf,size_t nbytes,unichar *ubuf,size_t *ulen)

{
  byte bVar1;
  size_t sVar2;
  bool bVar3;
  bool bVar4;
  int iVar5;
  unichar uVar6;
  ulong uVar7;
  ulong uVar8;
  
  if (ubuf != (unichar *)0x0) {
    *ulen = 0;
  }
  if (nbytes == 0) {
    return 1;
  }
  bVar3 = false;
  uVar7 = 0;
  bVar4 = false;
  do {
    bVar1 = buf[uVar7];
    if ((char)bVar1 < '\0') {
      if ((bVar1 & 0x40) == 0) {
        return -1;
      }
      if ((bVar1 & 0x20) == 0) {
        iVar5 = 1;
        uVar6 = (unichar)(bVar1 & 0x1f);
      }
      else if ((bVar1 & 0x10) == 0) {
        iVar5 = 2;
        uVar6 = (unichar)(bVar1 & 0xf);
      }
      else if ((bVar1 & 8) == 0) {
        iVar5 = 3;
        uVar6 = (unichar)(bVar1 & 7);
      }
      else if ((bVar1 & 4) == 0) {
        iVar5 = 4;
        uVar6 = (unichar)(bVar1 & 3);
      }
      else {
        if ((bVar1 & 2) != 0) {
          return -1;
        }
        iVar5 = 5;
        uVar6 = (unichar)(bVar1 & 1);
      }
      uVar7 = uVar7 + 1;
      uVar8 = (iVar5 - 1) + uVar7;
      while( true ) {
        if (nbytes <= uVar7) goto LAB_0010e478;
        bVar1 = buf[uVar7];
        if (-1 < (char)bVar1) {
          return -1;
        }
        if ((bVar1 & 0x40) != 0) {
          return -1;
        }
        uVar6 = uVar6 * 0x40 + (ulong)(bVar1 & 0x3f);
        if (uVar8 == uVar7) break;
        uVar7 = uVar7 + 1;
      }
      bVar4 = true;
      if (ubuf != (unichar *)0x0) {
        sVar2 = *ulen;
        *ulen = sVar2 + 1;
        ubuf[sVar2] = uVar6;
      }
    }
    else {
      if (""[bVar1] != '\x01') {
        bVar3 = true;
      }
      if (ubuf != (unichar *)0x0) {
        sVar2 = *ulen;
        *ulen = sVar2 + 1;
        ubuf[sVar2] = (ulong)bVar1;
      }
    }
    uVar7 = uVar7 + 1;
  } while (uVar7 < nbytes);
LAB_0010e478:
  iVar5 = 0;
  if ((!bVar3) && (iVar5 = 2, !bVar4)) {
    return 1;
  }
  return iVar5;
}



int file_encoding(magic_set *ms,uchar *buf,size_t nbytes,unichar **ubuf,size_t *ulen,char **code,
                 char **code_mime,char **type)

{
  size_t __size;
  byte bVar1;
  byte bVar2;
  ulong uVar3;
  bool bVar4;
  int iVar5;
  unichar *puVar6;
  byte *__ptr;
  size_t sVar7;
  char *pcVar8;
  byte *pbVar9;
  byte *pbVar10;
  
  __size = nbytes + 1;
  *type = "text";
  *ulen = 0;
  *code = "unknown";
  *code_mime = "binary";
  puVar6 = (unichar *)calloc(1,__size * 8);
  *ubuf = puVar6;
  if (puVar6 == (unichar *)0x0) {
    iVar5 = 1;
    file_oomem(ms,__size * 8);
    __ptr = (byte *)0x0;
  }
  else {
    __ptr = (byte *)calloc(1,__size);
    if (__ptr == (byte *)0x0) {
      iVar5 = 1;
      file_oomem(ms,__size);
    }
    else {
      *ulen = 0;
      if (nbytes != 0) {
        pbVar10 = buf + nbytes;
        pbVar9 = buf;
        do {
          bVar1 = *pbVar9;
          if (""[bVar1] != '\x01') {
            if (nbytes < 4) {
              iVar5 = file_looks_utf8(buf,nbytes,puVar6,ulen);
              if (iVar5 < 2) {
                puVar6 = *ubuf;
                if (nbytes == 1) goto LAB_0010e8db;
LAB_0010e7fc:
                if (*buf == 0xff) {
                  if (buf[1] != 0xfe) goto LAB_0010e8db;
                  *ulen = 0;
                  bVar4 = false;
                  if (nbytes < 4) goto LAB_0010ea7e;
                }
                else {
                  if ((*buf != 0xfe) || (buf[1] != 0xff)) goto LAB_0010e8db;
                  *ulen = 0;
                  bVar4 = true;
                  if (nbytes < 4) goto LAB_0010ea0d;
                }
                pbVar9 = buf + 2;
                sVar7 = 0;
                goto LAB_0010e880;
              }
LAB_0010e7e4:
              pcVar8 = "UTF-8 Unicode";
            }
            else {
              if (((*buf != 0xef) || (buf[1] != 0xbb)) || (buf[2] != 0xbf)) {
LAB_0010e7c4:
                iVar5 = file_looks_utf8(buf,nbytes,puVar6,ulen);
                if (iVar5 < 2) {
                  puVar6 = *ubuf;
                  goto LAB_0010e7fc;
                }
                goto LAB_0010e7e4;
              }
              iVar5 = file_looks_utf8(buf + 3,nbytes - 3,puVar6,ulen);
              if (iVar5 < 1) {
                puVar6 = *ubuf;
                goto LAB_0010e7c4;
              }
              pcVar8 = "UTF-8 Unicode (with BOM)";
            }
            *code = pcVar8;
            iVar5 = 1;
            *code_mime = "utf-8";
            goto LAB_0010e714;
          }
          sVar7 = *ulen;
          pbVar9 = pbVar9 + 1;
          puVar6[sVar7] = (ulong)bVar1;
          *ulen = sVar7 + 1;
        } while (pbVar10 != pbVar9);
        if (((((4 < nbytes) && (*buf == '+')) && (buf[1] == '/')) &&
            ((buf[2] == 'v' && (buf[3] < 0x3a)))) &&
           ((0x300880000000000U >> ((ulong)buf[3] & 0x3f) & 1) != 0)) {
          *ulen = 0;
          iVar5 = 1;
          *code = "UTF-7 Unicode";
          *code_mime = "utf-7";
          goto LAB_0010e714;
        }
      }
      iVar5 = 1;
      *code = "ASCII";
      *code_mime = "us-ascii";
    }
  }
  goto LAB_0010e714;
  while (pbVar9 = pbVar9 + 2, buf + (nbytes - 4 & 0xfffffffffffffffe) + 4 != pbVar9) {
LAB_0010e880:
    bVar1 = *pbVar9;
    bVar2 = pbVar9[1];
    *ulen = sVar7 + 1;
    if (bVar4) {
      puVar6[sVar7] = (long)(int)((uint)bVar2 + (uint)bVar1 * 0x100);
    }
    else {
      puVar6[sVar7] = (long)(int)((uint)bVar2 * 0x100 + (uint)bVar1);
    }
    sVar7 = *ulen;
    uVar3 = puVar6[sVar7 - 1];
    if ((uVar3 == 0xfffe) || ((uVar3 < 0x80 && (""[uVar3] != '\x01')))) goto LAB_0010e8db;
  }
  if (bVar4) {
LAB_0010ea0d:
    iVar5 = 1;
    *code = "Big-endian UTF-16 Unicode";
    *code_mime = "utf-16be";
  }
  else {
LAB_0010ea7e:
    iVar5 = 1;
    *code = "Little-endian UTF-16 Unicode";
    *code_mime = "utf-16le";
  }
  goto LAB_0010e714;
LAB_0010e948:
  bVar1 = *pbVar9;
  if ((int)""[bVar1] - 1U < 3) {
    sVar7 = *ulen;
    pbVar9 = pbVar9 + 1;
    *ulen = sVar7 + 1;
    puVar6[sVar7] = (ulong)bVar1;
    if (pbVar10 == pbVar9) goto LAB_0010eaa7;
    goto LAB_0010e948;
  }
  sVar7 = 0;
  do {
    __ptr[sVar7] = ""[buf[sVar7]];
    sVar7 = sVar7 + 1;
  } while (nbytes != sVar7);
  *ulen = 0;
  pbVar10 = __ptr;
  do {
    bVar1 = *pbVar10;
    if (""[bVar1] != '\x01') {
      *ulen = 0;
      pbVar10 = __ptr;
      do {
        bVar1 = *pbVar10;
        if (1 < (int)""[bVar1] - 1U) {
          iVar5 = 0;
          *type = "binary";
          goto LAB_0010e714;
        }
        sVar7 = *ulen;
        pbVar10 = pbVar10 + 1;
        *ulen = sVar7 + 1;
        puVar6[sVar7] = (ulong)bVar1;
      } while (pbVar10 != __ptr + nbytes);
      pcVar8 = "International EBCDIC";
      goto LAB_0010eadc;
    }
    sVar7 = *ulen;
    pbVar10 = pbVar10 + 1;
    *ulen = sVar7 + 1;
    puVar6[sVar7] = (ulong)bVar1;
  } while (__ptr + nbytes != pbVar10);
  pcVar8 = "EBCDIC";
LAB_0010eadc:
  *code = pcVar8;
  iVar5 = 1;
  *code_mime = "ebcdic";
  goto LAB_0010e714;
LAB_0010eaa7:
  iVar5 = 1;
  *code = "Non-ISO extended-ASCII";
  *code_mime = "unknown-8bit";
  goto LAB_0010e714;
LAB_0010e8db:
  *ulen = 0;
  pbVar9 = buf;
  do {
    bVar1 = *pbVar9;
    if (1 < (int)""[bVar1] - 1U) {
      *ulen = 0;
      pbVar9 = buf;
      goto LAB_0010e948;
    }
    sVar7 = *ulen;
    pbVar9 = pbVar9 + 1;
    *ulen = sVar7 + 1;
    puVar6[sVar7] = (ulong)bVar1;
  } while (pbVar10 != pbVar9);
  iVar5 = 1;
  *code = "ISO-8859";
  *code_mime = "iso-8859-1";
LAB_0010e714:
  free(__ptr);
  return iVar5;
}



// WARNING: Unknown calling convention

int zlibcmp(uchar *buf)

{
  byte bVar1;
  uint uVar2;
  
  bVar1 = *buf;
  uVar2 = 0;
  if (((bVar1 & 0xf) == 8) && (-1 < (char)bVar1)) {
    uVar2 = (uint)((ushort)(CONCAT11(bVar1,buf[1]) * 0x7bdf) < 0x843);
  }
  return uVar2;
}



ssize_t swrite(int fd,void *buf,size_t n)

{
  ssize_t sVar1;
  int *piVar2;
  size_t rn;
  size_t __n;
  
  __n = n;
  do {
    sVar1 = write(fd,buf,__n);
    if (sVar1 == -1) {
      piVar2 = __errno_location();
      if (*piVar2 != 4) {
        return -1;
      }
    }
    else {
      __n = __n - sVar1;
      buf = (void *)((long)buf + sVar1);
    }
  } while (__n != 0);
  return n;
}



int makeerror(uchar **buf,size_t *len,char *fmt,...)

{
  long lVar1;
  char in_AL;
  int iVar2;
  size_t sVar3;
  undefined8 in_RCX;
  undefined8 in_R8;
  undefined8 in_R9;
  long in_FS_OFFSET;
  undefined8 in_XMM0_Qa;
  undefined8 in_XMM1_Qa;
  undefined8 in_XMM2_Qa;
  undefined8 in_XMM3_Qa;
  undefined8 in_XMM4_Qa;
  undefined8 in_XMM5_Qa;
  undefined8 in_XMM6_Qa;
  undefined8 in_XMM7_Qa;
  char *msg;
  va_list ap;
  undefined local_c8 [24];
  undefined8 local_b0;
  undefined8 local_a8;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_88;
  undefined8 local_78;
  undefined8 local_68;
  undefined8 local_58;
  undefined8 local_48;
  undefined8 local_38;
  undefined8 local_28;
  
  if (in_AL != '\0') {
    local_98 = in_XMM0_Qa;
    local_88 = in_XMM1_Qa;
    local_78 = in_XMM2_Qa;
    local_68 = in_XMM3_Qa;
    local_58 = in_XMM4_Qa;
    local_48 = in_XMM5_Qa;
    local_38 = in_XMM6_Qa;
    local_28 = in_XMM7_Qa;
  }
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  ap[0].overflow_arg_area = &stack0x00000008;
  ap[0].gp_offset = 0x18;
  ap[0].reg_save_area = local_c8;
  ap[0].fp_offset = 0x30;
  local_b0 = in_RCX;
  local_a8 = in_R8;
  local_a0 = in_R9;
  iVar2 = __vasprintf_chk(&msg,1,fmt,ap);
  if (iVar2 < 0) {
    *buf = (uchar *)0x0;
    iVar2 = 1;
    *len = 0;
  }
  else {
    *buf = (uchar *)msg;
    sVar3 = strlen(msg);
    *len = sVar3;
    iVar2 = 2;
  }
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar2;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int uncompresszlib(uchar *old,uchar **newch,size_t bytes_max,size_t *n,int zlib)

{
  long lVar1;
  uint uVar2;
  int iVar3;
  uchar *puVar4;
  size_t sVar5;
  int *piVar6;
  char *pcVar7;
  long in_FS_OFFSET;
  z_stream z;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  puVar4 = (uchar *)malloc(bytes_max + 1);
  *newch = puVar4;
  if (puVar4 == (uchar *)0x0) {
    piVar6 = __errno_location();
    pcVar7 = strerror(*piVar6);
    iVar3 = makeerror(newch,n,"No buffer, %s",pcVar7);
  }
  else {
    z.avail_in = (uInt)*n;
    z.avail_out = (uInt)bytes_max;
    z.zalloc = (alloc_func)0x0;
    z.zfree = (free_func)0x0;
    z.opaque = (voidpf)0x0;
    z.next_in = old;
    z.next_out = puVar4;
    if (zlib == 0) {
      uVar2 = inflateInit2_(&z,0xfffffff1,"1.2.11",0x70);
    }
    else {
      uVar2 = inflateInit_(&z,"1.2.11",0x70);
    }
    if ((uVar2 == 0) && (uVar2 = inflate(&z,2), uVar2 < 2)) {
      *n = z.total_out;
      uVar2 = inflateEnd(&z);
      if (uVar2 == 0) {
        (*newch)[*n] = '\0';
        iVar3 = 0;
        goto LAB_0010edc9;
      }
    }
    if (z.msg == (char *)0x0) {
      z.msg = (char *)zError(uVar2);
    }
    strlcpy((char *)*newch,z.msg,bytes_max);
    sVar5 = strlen((char *)*newch);
    *n = sVar5;
    iVar3 = 2;
  }
LAB_0010edc9:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar3;
}



void closep(int *fd)

{
  if (*fd != -1) {
    close(*fd);
    *fd = -1;
  }
  if (fd[1] != -1) {
    close(fd[1]);
    fd[1] = -1;
  }
  return;
}



ssize_t sread(int fd,void *buf,size_t n,int canbepipe)

{
  long lVar1;
  byte bVar2;
  int iVar3;
  ssize_t sVar4;
  int *piVar5;
  ulong uVar6;
  long lVar7;
  __fd_mask *p_Var8;
  ulong uVar9;
  long in_FS_OFFSET;
  long local_f8;
  int t;
  timeval tout;
  fd_set check;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  t = 0;
  uVar9 = n;
  if ((fd != 0) && (canbepipe != 0)) {
    iVar3 = ioctl(fd,0x541b,&t);
    if ((iVar3 == -1) || (t == 0)) {
      local_f8 = 0;
      bVar2 = (byte)(fd >> 0x1f);
      while( true ) {
        tout.tv_sec = 0;
        tout.tv_usec = 100000;
        lVar7 = 0x10;
        p_Var8 = check.fds_bits;
        for (; lVar7 != 0; lVar7 = lVar7 + -1) {
          *p_Var8 = 0;
          p_Var8 = p_Var8 + 1;
        }
        lVar7 = __fdelt_chk((long)fd);
        check.fds_bits[lVar7] =
             check.fds_bits[lVar7] | 1L << (((char)fd + (bVar2 >> 2) & 0x3f) - (bVar2 >> 2) & 0x3f);
        iVar3 = select(fd + 1,(fd_set *)&check,(fd_set *)0x0,(fd_set *)0x0,(timeval *)&tout);
        if (iVar3 != -1) break;
        local_f8 = local_f8 + 1;
      }
      if ((iVar3 == 0) && (uVar9 = 0, 4 < local_f8)) goto LAB_0010ef20;
      ioctl(fd,0x541b,&t);
    }
    uVar6 = (ulong)t;
    uVar9 = n;
    if ((0 < t) && (uVar6 < n)) {
      n = uVar6;
      uVar9 = uVar6;
    }
  }
  do {
    sVar4 = read(fd,buf,n);
    if (sVar4 == -1) {
      piVar5 = __errno_location();
      if (*piVar5 != 4) {
        uVar9 = 0xffffffffffffffff;
        break;
      }
    }
    else {
      if (sVar4 == 0) {
        uVar9 = uVar9 - n;
        break;
      }
      n = n - sVar4;
      buf = (void *)((long)buf + sVar4);
    }
  } while (n != 0);
LAB_0010ef20:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return uVar9;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int file_zmagic(magic_set *ms,int fd,char *name,uchar *buf,size_t nbytes)

{
  byte bVar1;
  size_t bytes_max;
  char **__argv;
  uchar *__dest;
  size_t n;
  uint uVar2;
  __pid_t _Var3;
  wchar_t wVar4;
  int iVar5;
  uint uVar6;
  __sighandler_t __handler;
  char *pcVar7;
  int *piVar8;
  char *pcVar9;
  file_pushbuf_t *pb;
  long lVar10;
  size_t sVar11;
  ulong uVar12;
  ulong uVar13;
  long *plVar14;
  __int32_t **pp_Var15;
  long lVar16;
  long lVar17;
  size_t sVar18;
  int (*fd_00) [2];
  byte *__s;
  long lVar19;
  anon_struct_24_3_ca1d61b4 *paVar20;
  long in_FS_OFFSET;
  uint local_c4;
  int (*local_b0) [2];
  size_t local_88;
  int status;
  uchar *newbuf;
  size_t nsz;
  int fdp [3] [2];
  
  lVar17 = *(long *)(in_FS_OFFSET + 0x28);
  newbuf = (uchar *)0x0;
  local_c4 = ms->flags & 4;
  if (local_c4 == 0) {
LAB_0010f0c8:
    if (lVar17 == *(long *)(in_FS_OFFSET + 0x28)) {
      return local_c4;
    }
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  uVar2 = ms->flags & 0x410;
  __handler = signal(0xd,(__sighandler_t)0x1);
  sVar18 = 2;
  pcVar7 = " (";
  lVar16 = 1;
  paVar20 = compr;
  if (uVar2 != 0) {
    pcVar7 = " compressed-encoding=";
  }
  local_c4 = 0;
LAB_0010f38d:
  lVar10 = lVar16 + -1;
  if (nbytes < sVar18) {
joined_r0x0010f36c:
    lVar10 = lVar16;
    if (lVar16 == 0xe) goto LAB_0010f3f0;
  }
  else {
    if (sVar18 == 0) {
      uVar6 = (*(code *)paVar20->magic)(buf);
    }
    else {
      iVar5 = memcmp(buf,paVar20->magic,sVar18);
      uVar6 = (uint)(iVar5 == 0);
    }
    if (uVar6 == 0) goto joined_r0x0010f36c;
    bytes_max = ms->bytes_max;
    nsz = nbytes;
    if (lVar10 != 2) {
      if (sVar18 == 0) {
        local_88._0_4_ = uncompresszlib(buf,&newbuf,bytes_max,&nsz,1);
      }
      else {
        fflush(_stdout);
        fflush(_stderr);
        fdp[0][0] = -1;
        fdp[0][1] = -1;
        fdp[1][0] = -1;
        fdp[1][1] = -1;
        fdp[2][0] = -1;
        fdp[2][1] = -1;
        if ((((fd == -1) && (iVar5 = pipe(fdp[0]), iVar5 == -1)) ||
            (iVar5 = pipe(fdp[1]), iVar5 == -1)) || (iVar5 = pipe(fdp[2]), iVar5 == -1)) {
          local_b0 = fdp + 1;
          closep(fdp[0]);
          closep(*local_b0);
          piVar8 = __errno_location();
          pcVar9 = strerror(*piVar8);
          local_88._0_4_ = makeerror(&newbuf,&nsz,"Cannot create pipe, %s",pcVar9);
        }
        else {
          _Var3 = fork();
          if (_Var3 == -1) {
            piVar8 = __errno_location();
            pcVar9 = strerror(*piVar8);
            local_88._0_4_ = makeerror(&newbuf,&nsz,"Cannot fork, %s",pcVar9);
          }
          else {
            if (_Var3 == 0) {
              if (fd != -1) {
                fdp[0][0] = fd;
                lseek(fd,0,0);
              }
              fd_00 = fdp;
              lVar17 = 0;
              goto LAB_0010faec;
            }
            if (fdp[1][1] != -1) {
              close(fdp[1][1]);
              fdp[1][1] = -1;
            }
            if (fdp[2][1] != -1) {
              close(fdp[2][1]);
              fdp[2][1] = -1;
            }
            n = nsz;
            if (fd == -1) {
              if (fdp[0][0] != -1) {
                close(fdp[0][0]);
                fdp[0][0] = -1;
              }
              _Var3 = fork();
              if (_Var3 == -1) goto LAB_0010fb64;
              if (_Var3 == 0) {
                if (fdp[1][0] != -1) {
                  close(fdp[1][0]);
                  fdp[1][0] = -1;
                }
                sVar18 = swrite(fdp[0][1],buf,n);
                if (sVar18 == n) {
                    // WARNING: Subroutine does not return
                  exit(0);
                }
                goto LAB_0010fb64;
              }
              _Var3 = wait(&status);
              if (_Var3 == -1) goto LAB_0010fb64;
              if (fdp[0][1] != -1) {
                close(fdp[0][1]);
                fdp[0][1] = -1;
              }
            }
            local_b0 = (int (*) [2])&status;
            newbuf = (uchar *)malloc(bytes_max + 1);
            if (newbuf == (uchar *)0x0) {
              piVar8 = __errno_location();
              pcVar9 = strerror(*piVar8);
              local_88._0_4_ = makeerror(&newbuf,&nsz,"No buffer, %s",pcVar9);
            }
            else {
              sVar11 = sread(fdp[1][0],newbuf,bytes_max,0);
              local_88._0_4_ = 0;
              if ((long)sVar11 < 1) {
                if (sVar11 == 0) {
                  local_88 = sread(fdp[2][0],newbuf,bytes_max,0);
                  __dest = newbuf;
                  if (0 < (long)local_88) {
                    newbuf[local_88] = '\0';
                    plVar14 = (long *)FUN_00104d70();
                    __s = __dest;
                    while ((*(byte *)(*plVar14 + 1 + (ulong)*__s * 2) & 0x20) != 0) {
                      __s = __s + 1;
                    }
                    pcVar9 = strchr((char *)__s,10);
                    if (pcVar9 != (char *)0x0) {
                      *pcVar9 = '\0';
                    }
                    pcVar9 = strchr((char *)__s,0x3b);
                    if (pcVar9 != (char *)0x0) {
                      *pcVar9 = '\0';
                    }
                    pcVar9 = strrchr((char *)__s,0x3a);
                    lVar19 = *plVar14;
                    if (pcVar9 != (char *)0x0) {
                      bVar1 = *(byte *)(lVar19 + 1 + (ulong)(byte)pcVar9[1] * 2);
                      while (pcVar9 = pcVar9 + 1, (bVar1 & 0x20) != 0) {
                        bVar1 = *(byte *)(lVar19 + 1 + (ulong)(byte)pcVar9[1] * 2);
                      }
                      local_88 = strlen(pcVar9);
                      memmove(__dest,pcVar9,local_88 + 1);
                      lVar19 = *plVar14;
                    }
                    sVar11 = local_88;
                    local_88._0_4_ = 2;
                    bVar1 = *__dest;
                    if ((*(byte *)(lVar19 + 1 + (ulong)bVar1 * 2) & 2) != 0) {
                      pp_Var15 = __ctype_toupper_loc();
                      local_88._0_4_ = 2;
                      *__dest = (uchar)(*pp_Var15)[bVar1];
                    }
                    goto LAB_0010f5b5;
                  }
                  free(newbuf);
                  if (local_88 == 0) {
                    piVar8 = __errno_location();
                    pcVar9 = strerror(*piVar8);
                    local_88._0_4_ = makeerror(&newbuf,&nsz,"Read failed, %s",pcVar9);
                    goto LAB_0010f5c3;
                  }
                }
                else {
                  free(newbuf);
                }
                local_88._0_4_ = makeerror(&newbuf,&nsz,"No data");
              }
              else {
LAB_0010f5b5:
                newbuf[sVar11] = '\0';
                nsz = sVar11;
              }
            }
LAB_0010f5c3:
            if (fdp[0][1] != -1) {
              close(fdp[0][1]);
              fdp[0][1] = -1;
            }
            if (fdp[1][0] != -1) {
              close(fdp[1][0]);
              fdp[1][0] = -1;
            }
            if (fdp[2][0] != -1) {
              close(fdp[2][0]);
              fdp[2][0] = -1;
            }
            _Var3 = wait(local_b0);
            if (_Var3 == -1) {
              free(newbuf);
              piVar8 = __errno_location();
              pcVar9 = strerror(*piVar8);
              local_88._0_4_ = makeerror(&newbuf,&nsz,"Wait failed, %s",pcVar9);
            }
            if (fdp[0][0] != -1) {
              close(fdp[0][0]);
            }
          }
        }
      }
      if ((uint)local_88 == 1) goto joined_r0x0010f36c;
      if (((uint)local_88 & 0xfffffffd) != 0) goto file_zmagic_cold;
      ms->flags = ms->flags & 0xfffffffb;
      if ((uint)local_88 == 2) {
        if ((sVar18 == 0) || (lVar10 == 2)) {
          pcVar9 = "zlib";
        }
        else {
          pcVar9 = *paVar20->argv;
        }
        goto LAB_0010f295;
      }
LAB_0010f490:
      wVar4 = file_buffer(ms,L'\xffffffff',name,newbuf,nsz);
LAB_0010f2a6:
      if (wVar4 != L'\xffffffff') {
        if (((*(byte *)((long)&ms->flags + 3) & 2) != 0) || ((uVar2 != 0x410 && (uVar2 != 0)))) {
          local_c4 = 1;
LAB_0010f3f0:
          signal(0xd,__handler);
          free(newbuf);
          ms->flags = ms->flags | 4;
          goto LAB_0010f0c8;
        }
        wVar4 = file_printf(ms,pcVar7);
        if (((wVar4 != L'\xffffffff') && (pb = file_push_buffer(ms), pb != (file_pushbuf_t *)0x0))
           && (wVar4 = file_buffer(ms,L'\xffffffff',(char *)0x0,buf,nbytes), wVar4 != L'\xffffffff')
           ) {
          pcVar9 = file_pop_buffer(ms,pb);
          if (pcVar9 != (char *)0x0) {
            wVar4 = file_printf(ms,"%s",pcVar9);
            if (wVar4 == L'\xffffffff') {
              free(pcVar9);
              local_c4 = 0xffffffff;
              goto joined_r0x0010f36c;
            }
            free(pcVar9);
          }
          if ((uVar2 != 0) || (wVar4 = file_printf(ms,")"), wVar4 != L'\xffffffff')) {
            local_c4 = 1;
            goto joined_r0x0010f36c;
          }
        }
      }
      local_c4 = 0xffffffff;
      goto joined_r0x0010f36c;
    }
    bVar1 = buf[3];
    if ((bVar1 & 4) == 0) {
      uVar12 = 10;
LAB_0010f6c8:
      if ((bVar1 & 8) != 0) {
        if (uVar12 < nbytes) {
          do {
            uVar13 = uVar12;
            uVar12 = uVar13 + 1;
            if (buf[uVar13] == '\0') goto LAB_0010f6f9;
          } while (uVar12 < nbytes);
          uVar12 = uVar13 + 2;
        }
        else {
          uVar12 = uVar12 + 1;
        }
      }
LAB_0010f6f9:
      if ((bVar1 & 0x10) != 0) {
        if (uVar12 < nbytes) {
          do {
            uVar13 = uVar12;
            uVar12 = uVar13 + 1;
            if (buf[uVar13] == '\0') goto LAB_0010f420;
          } while (uVar12 < nbytes);
          uVar12 = uVar13 + 2;
        }
        else {
          uVar12 = uVar12 + 1;
        }
      }
LAB_0010f420:
      if ((bVar1 & 2) != 0) {
        uVar12 = uVar12 + 2;
      }
      if (nbytes <= uVar12) goto LAB_0010f8d8;
      nsz = nbytes - uVar12;
      uVar6 = uncompresszlib(buf + uVar12,&newbuf,bytes_max,&nsz,0);
    }
    else {
      if (0xb < nbytes) {
        uVar12 = (long)(int)(buf[10] + 2 + (uint)buf[0xb] * 0x100) + 10;
        goto LAB_0010f6c8;
      }
LAB_0010f8d8:
      uVar6 = makeerror(&newbuf,&nsz,"File too short");
    }
    if (uVar6 != 1) {
      if ((uVar6 & 0xfffffffd) != 0) {
file_zmagic_cold:
                    // WARNING: Subroutine does not return
        abort();
      }
      ms->flags = ms->flags & 0xfffffffb;
      pcVar9 = "zlib";
      if (uVar6 != 2) goto LAB_0010f490;
LAB_0010f295:
      wVar4 = file_printf(ms,"%s ERROR: %s",pcVar9);
      goto LAB_0010f2a6;
    }
    lVar10 = 3;
  }
  lVar16 = lVar16 + 1;
  paVar20 = paVar20 + 1;
  sVar18 = compr[lVar10].maglen;
  goto LAB_0010f38d;
LAB_0010faec:
  do {
    iVar5 = (int)lVar17;
    if ((*fd_00)[iVar5 != 0] != iVar5) {
      iVar5 = dup2((*fd_00)[iVar5 != 0],iVar5);
      if (iVar5 == -1) goto LAB_0010fb64;
      closep(*fd_00);
    }
    lVar17 = lVar17 + 1;
    fd_00 = fd_00 + 1;
  } while (lVar17 != 3);
  __argv = compr[lVar10].argv;
  execvp(*__argv,__argv);
  piVar8 = __errno_location();
  pcVar7 = strerror(*piVar8);
  __dprintf_chk(2,1,"exec `%s\' failed, %s",*__argv,pcVar7);
LAB_0010fb64:
                    // WARNING: Subroutine does not return
  exit(1);
}



int file_pipe2file(magic_set *ms,int fd,void *startbuf,size_t nbytes)

{
  wchar_t error;
  long lVar1;
  int fd_00;
  int __fd;
  wchar_t *pwVar2;
  size_t sVar3;
  size_t sVar4;
  __off_t _Var5;
  char *f;
  long in_FS_OFFSET;
  char buf [4096];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  strlcpy(buf,"/tmp/file.XXXXXX",0x1000);
  fd_00 = mkstemp(buf);
  pwVar2 = __errno_location();
  error = *pwVar2;
  unlink(buf);
  *pwVar2 = error;
  if (fd_00 == -1) {
    __fd = -1;
    file_error(ms,error,"cannot create temporary file for pipe copy");
  }
  else {
    sVar3 = swrite(fd_00,startbuf,nbytes);
    if (sVar3 == nbytes) {
      do {
        sVar3 = sread(fd,buf,0x1000,1);
        if ((long)sVar3 < 1) {
          f = "error copying from pipe to temp file";
          if (sVar3 == 0xffffffffffffffff) goto LAB_0010fc71;
          if (sVar3 == 0) {
            __fd = dup2(fd_00,fd);
            if (__fd == -1) {
              file_error(ms,*pwVar2,"could not dup descriptor for temp file");
            }
            else {
              close(fd_00);
              _Var5 = lseek(__fd,0,0);
              if (_Var5 == -1) {
                __fd = -1;
                file_badseek(ms);
              }
            }
            goto LAB_0010fc84;
          }
          break;
        }
        sVar4 = swrite(fd_00,buf,sVar3);
      } while (sVar4 == sVar3);
    }
    f = "error while writing to temp file";
LAB_0010fc71:
    __fd = -1;
    file_error(ms,*pwVar2,f);
  }
LAB_0010fc84:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return __fd;
}



int file_is_tar(magic_set *ms,uchar *buf,size_t nbytes)

{
  byte bVar1;
  uchar uVar2;
  uint uVar3;
  char cVar4;
  wchar_t wVar5;
  long *plVar6;
  ulong uVar7;
  uchar *puVar8;
  uint uVar9;
  long lVar10;
  int iVar11;
  char *pcVar12;
  byte *pbVar13;
  byte *pbVar14;
  bool bVar15;
  bool bVar16;
  byte bVar17;
  
  bVar17 = 0;
  uVar3 = ms->flags;
  if ((uVar3 & 0x1000800) != 0) {
    return 0;
  }
  if (nbytes < 0x200) {
    return 0;
  }
  pbVar13 = buf + 0x94;
  plVar6 = (long *)FUN_00104d70();
  iVar11 = 8;
  do {
    uVar7 = (ulong)*pbVar13;
    if ((*(byte *)(*plVar6 + 1 + uVar7 * 2) & 0x20) == 0) {
      uVar9 = 0;
      pbVar14 = pbVar13 + (ulong)(iVar11 - 1) + 1;
      goto LAB_0010fdc3;
    }
    pbVar13 = pbVar13 + 1;
    iVar11 = iVar11 + -1;
  } while (iVar11 != 0);
  uVar9 = 0xffffffff;
LAB_0010fde3:
  iVar11 = 0;
  pbVar13 = buf;
  do {
    bVar1 = *pbVar13;
    pbVar13 = pbVar13 + 1;
    iVar11 = iVar11 + (uint)bVar1;
  } while (pbVar13 != buf + 0x200);
  puVar8 = buf + 0x9b;
  do {
    uVar2 = *puVar8;
    puVar8 = puVar8 + -1;
    iVar11 = iVar11 - (char)uVar2;
  } while (buf + 0x93 != puVar8);
  bVar15 = iVar11 + 0x100U < uVar9;
  bVar16 = iVar11 + 0x100U == uVar9;
  if (!bVar16) {
    return 0;
  }
  lVar10 = 8;
  iVar11 = 3;
  pbVar13 = buf + 0x101;
  pbVar14 = (byte *)"ustar  ";
  do {
    if (lVar10 == 0) break;
    lVar10 = lVar10 + -1;
    bVar15 = *pbVar13 < *pbVar14;
    bVar16 = *pbVar13 == *pbVar14;
    pbVar13 = pbVar13 + (ulong)bVar17 * -2 + 1;
    pbVar14 = pbVar14 + (ulong)bVar17 * -2 + 1;
  } while (bVar16);
  if (((!bVar15 && !bVar16) != bVar15) &&
     ((*(int *)(buf + 0x101) != 0x61747375 || (iVar11 = 2, *(short *)(buf + 0x105) != 0x72)))) {
    iVar11 = 1;
  }
  pcVar12 = "application/x-tar";
  if ((uVar3 & 0x410) == 0) {
    pcVar12 = tartype[iVar11 + -1];
  }
  wVar5 = file_printf(ms,"%s",pcVar12);
  if (wVar5 != L'\xffffffff') {
    wVar5 = L'\x01';
  }
  return wVar5;
LAB_0010fdc3:
  cVar4 = (char)uVar7;
  if (7 < (byte)(cVar4 - 0x30U)) goto LAB_0010fed8;
  pbVar13 = pbVar13 + 1;
  uVar9 = uVar9 << 3 | (int)cVar4 - 0x30U;
  if (pbVar14 == pbVar13) goto LAB_0010fde3;
  uVar7 = (ulong)*pbVar13;
  goto LAB_0010fdc3;
LAB_0010fed8:
  if ((cVar4 != '\0') && ((*(byte *)(*plVar6 + 1 + uVar7 * 2) & 0x20) == 0)) {
    uVar9 = 0xffffffff;
  }
  goto LAB_0010fde3;
}



uint32_t getu32(int swap,uint32_t value)

{
  long in_FS_OFFSET;
  
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return (uint)swap >> 0x18 | (swap & 0xff0000U) >> 8 | (swap & 0xff00U) << 8 | swap << 0x18;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int do_core_note(magic_set *ms,uchar *nbuf,uint32_t type,int swap,uint32_t namesz,uint32_t descsz,
                size_t noff,size_t doff,int *flags,size_t size,int clazz)

{
  byte bVar1;
  long lVar2;
  long lVar3;
  int iVar4;
  wchar_t wVar5;
  uint swap_00;
  long *plVar6;
  size_t sVar7;
  char *pcVar8;
  long lVar9;
  byte *pbVar10;
  uint32_t value;
  size_t sVar11;
  byte *pbVar12;
  ulong uVar13;
  long in_FS_OFFSET;
  bool bVar14;
  bool bVar15;
  size_t local_270;
  long local_250;
  char sbuf [512];
  
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  if (namesz == 4) {
    bVar14 = CARRY8(noff,(ulong)nbuf);
    bVar15 = nbuf + noff == (byte *)0x0;
    lVar9 = 4;
    pbVar12 = nbuf + noff;
    pbVar10 = (byte *)0x11e080;
    do {
      if (lVar9 == 0) break;
      lVar9 = lVar9 + -1;
      bVar14 = *pbVar12 < *pbVar10;
      bVar15 = *pbVar12 == *pbVar10;
      pbVar12 = pbVar12 + 1;
      pbVar10 = pbVar10 + 1;
    } while (bVar15);
    iVar4 = -(uint)((!bVar14 && !bVar15) != bVar14);
    if ((!bVar14 && !bVar15) == bVar14) {
LAB_00110233:
      bVar1 = *(byte *)flags;
joined_r0x00110238:
      if ((bVar1 & 8) == 0) {
        wVar5 = file_printf(ms,", %s-style",os_style_names + iVar4);
        if (wVar5 == L'\xffffffff') goto LAB_0011026a;
        *flags = *flags | 8;
      }
    }
LAB_00110038:
    if ((type == 3) && ((*flags & 0x100U) != 0)) {
      local_250 = 0;
      do {
        if (clazz == 1) {
          local_270 = prpsoffsets32[local_250];
        }
        else {
          local_270 = prpsoffsets64[local_250];
        }
        lVar9 = 0;
LAB_001100a0:
        if ((local_270 + doff + lVar9 < size) && (local_270 + lVar9 < (ulong)descsz)) {
          bVar1 = nbuf[lVar9 + local_270 + doff];
          if (bVar1 == 0) {
            if (lVar9 != 0) goto LAB_00110115;
          }
          else {
            plVar6 = (long *)FUN_00104d70();
            if (((*(byte *)(*plVar6 + 1 + (ulong)bVar1 * 2) & 0x40) != 0) &&
               (pcVar8 = strchr("\'\"`",(uint)bVar1), pcVar8 == (char *)0x0)) goto code_r0x0011010b;
          }
        }
        local_250 = local_250 + 1;
      } while (local_250 != 5);
    }
LAB_0010ffe3:
    iVar4 = 0;
    goto LAB_0010ffe5;
  }
  if (namesz == 5) {
    bVar14 = CARRY8(noff,(ulong)nbuf);
    bVar15 = nbuf + noff == (byte *)0x0;
    lVar9 = 5;
    pbVar12 = nbuf + noff;
    pbVar10 = (byte *)0x11e080;
    do {
      if (lVar9 == 0) break;
      lVar9 = lVar9 + -1;
      bVar14 = *pbVar12 < *pbVar10;
      bVar15 = *pbVar12 == *pbVar10;
      pbVar12 = pbVar12 + 1;
      pbVar10 = pbVar10 + 1;
    } while (bVar15);
    iVar4 = (int)(char)((!bVar14 && !bVar15) - bVar14);
    if (iVar4 == 0) goto LAB_00110233;
    goto LAB_00110038;
  }
  if (namesz == 8) {
    bVar14 = CARRY8(noff,(ulong)nbuf);
    bVar15 = nbuf + noff == (byte *)0x0;
    lVar9 = 8;
    pbVar12 = nbuf + noff;
    pbVar10 = (byte *)0x11e1cb;
    do {
      if (lVar9 == 0) break;
      lVar9 = lVar9 + -1;
      bVar14 = *pbVar12 < *pbVar10;
      bVar15 = *pbVar12 == *pbVar10;
      pbVar12 = pbVar12 + 1;
      pbVar10 = pbVar10 + 1;
    } while (bVar15);
    if ((!bVar14 && !bVar15) == bVar14) {
      iVar4 = 1;
      bVar1 = *(byte *)flags;
      goto joined_r0x00110238;
    }
    goto LAB_00110038;
  }
  if (namesz < 0xb) goto LAB_00110038;
  bVar14 = CARRY8(noff,(ulong)nbuf);
  bVar15 = nbuf + noff == (byte *)0x0;
  lVar9 = 0xb;
  pbVar12 = nbuf + noff;
  pbVar10 = (byte *)"NetBSD-CORE";
  do {
    if (lVar9 == 0) break;
    lVar9 = lVar9 + -1;
    bVar14 = *pbVar12 < *pbVar10;
    bVar15 = *pbVar12 == *pbVar10;
    pbVar12 = pbVar12 + 1;
    pbVar10 = pbVar10 + 1;
  } while (bVar15);
  if ((!bVar14 && !bVar15) != bVar14) goto LAB_00110038;
  if ((*(byte *)flags & 8) == 0) {
    wVar5 = file_printf(ms,", %s-style",0x11e5e0);
    if (wVar5 == L'\xffffffff') goto LAB_0011026a;
    *flags = *flags | 8;
  }
  if (type != 1) goto LAB_0010ffe3;
  pcVar8 = file_printable(sbuf,0x200,(char *)(nbuf + doff + 0x7c));
  value = 0x11e085;
  wVar5 = file_printf(ms,", from \'%.31s\'",pcVar8);
  if (wVar5 != L'\xffffffff') {
    swap_00 = *(uint *)(nbuf + doff + 8);
    if (swap != 0) {
      swap_00 = getu32(swap_00,value);
    }
    wVar5 = file_printf(ms," (signal %u)",(ulong)swap_00);
    if (wVar5 == L'\xffffffff') goto LAB_0011026a;
    goto LAB_001101fc;
  }
  goto LAB_0011026a;
code_r0x0011010b:
  lVar9 = lVar9 + 1;
  if (lVar9 == 0x10) {
LAB_00110115:
    lVar9 = local_250 + 1;
    if (local_250 != 4) goto LAB_00110140;
    local_250 = 4;
    goto LAB_0011016e;
  }
  goto LAB_001100a0;
LAB_00110140:
  do {
    if (clazz == 1) {
      sVar11 = prpsoffsets32[lVar9];
      sVar7 = prpsoffsets32[local_250];
    }
    else {
      sVar11 = prpsoffsets64[lVar9];
      sVar7 = prpsoffsets64[local_250];
    }
    lVar3 = local_250;
    if (sVar11 < sVar7) {
      uVar13 = sVar11 + doff;
      lVar3 = lVar9;
      if (uVar13 < sVar7 + doff) {
        plVar6 = (long *)FUN_00104d70();
        do {
          lVar3 = local_250;
          if ((*(byte *)(*plVar6 + 1 + (ulong)nbuf[uVar13] * 2) & 0x40) == 0) break;
          uVar13 = uVar13 + 1;
          lVar3 = lVar9;
        } while (uVar13 < sVar7 + doff);
      }
    }
    local_250 = lVar3;
    lVar9 = lVar9 + 1;
  } while (lVar9 != 5);
LAB_0011016e:
  if (clazz == 1) {
    sVar11 = prpsoffsets32[local_250];
  }
  else {
    sVar11 = prpsoffsets64[local_250];
  }
  pbVar12 = nbuf + sVar11 + doff;
  bVar1 = *pbVar12;
  if (bVar1 == 0) {
LAB_00110448:
    uVar13 = 0;
  }
  else {
    plVar6 = (long *)FUN_00104d70();
    pbVar10 = pbVar12;
    do {
      if ((*(byte *)(*plVar6 + 1 + (ulong)bVar1 * 2) & 0x40) == 0) break;
      bVar1 = pbVar10[1];
      pbVar10 = pbVar10 + 1;
    } while (bVar1 != 0);
    if (pbVar12 < pbVar10) {
      do {
        if ((*(byte *)(*plVar6 + 1 + (ulong)pbVar10[-1] * 2) & 0x20) == 0) goto LAB_001101e0;
        pbVar10 = pbVar10 + -1;
      } while (pbVar12 != pbVar10);
      goto LAB_00110448;
    }
LAB_001101e0:
    uVar13 = (ulong)(uint)((int)pbVar10 - (int)pbVar12);
  }
  wVar5 = file_printf(ms,", from \'%.*s\'",uVar13,pbVar12);
  if (wVar5 != L'\xffffffff') {
LAB_001101fc:
    *flags = *flags | 1;
  }
LAB_0011026a:
  iVar4 = 1;
LAB_0010ffe5:
  if (lVar2 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar4;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



uint64_t getu64(int swap,uint64_t value)

{
  uint in_register_0000003c;
  long in_FS_OFFSET;
  
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return (ulong)(in_register_0000003c >> 0x18) |
           (((ulong)in_register_0000003c & 0xff0000) << 0x20) >> 0x28 |
           (((ulong)in_register_0000003c & 0xff00) << 0x20) >> 0x18 |
           (((ulong)in_register_0000003c & 0xff) << 0x20) >> 8 |
           ((ulong)(uint)swap & 0xff000000) << 8 | ((ulong)(uint)swap & 0xff0000) << 0x18 |
           ((ulong)(uint)swap & 0xff00) << 0x28 | CONCAT44(in_register_0000003c,swap) << 0x38;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int do_auxv_note(magic_set *ms,uchar *nbuf,uint32_t type,int swap,uint32_t namesz,uint32_t descsz,
                size_t noff,size_t doff,int *flags,size_t size,int clazz,int fd,off_t ph_off,
                int ph_num,off_t fsize)

{
  long lVar1;
  uchar *puVar2;
  byte bVar3;
  long lVar4;
  uint uVar5;
  long lVar6;
  Elf32_Addr swap_00;
  Elf64_Addr EVar7;
  uint uVar8;
  Elf32_Word EVar9;
  uint32_t uVar10;
  wchar_t wVar11;
  uint64_t uVar13;
  uchar *puVar14;
  Elf64_Xword EVar15;
  Elf64_Off EVar16;
  uint64_t uVar17;
  ssize_t sVar18;
  long *plVar19;
  char *pcVar20;
  long lVar21;
  __off_t __offset;
  uchar *puVar22;
  Elf64_Phdr *__buf;
  uint *value;
  int iVar23;
  ulong uVar24;
  undefined4 in_register_0000008c;
  size_t __offset_00;
  long in_FS_OFFSET;
  undefined4 in_stack_00000034;
  long local_218;
  char *local_1d8;
  Aux32Info auxv32;
  Aux64Info auxv64;
  Elf32_Phdr ph32;
  Elf64_Phdr ph64;
  char cStack_149;
  char buf [256];
  ulong uVar12;
  
  lVar4 = *(long *)(in_FS_OFFSET + 0x28);
  if ((type == 6) && ((*(uint *)noff & 0x100) != 0)) {
    local_218 = 0;
    *(uint *)noff = *(uint *)noff | 0x200;
    lVar1 = (ulong)((int)doff != 1) * 8;
    puVar2 = (uchar *)(lVar1 + 8);
    uVar5 = (uint)puVar2;
    puVar22 = nbuf + CONCAT44(in_register_0000008c,descsz);
    puVar14 = puVar2;
    while (puVar14 <= (uchar *)(ulong)namesz) {
      if ((int)doff == 1) {
        value = &auxv32.a_type;
        *(undefined8 *)(&stack0xfffffffffffffe38 + (long)puVar2) = *(undefined8 *)(puVar22 + lVar1);
        if (7 < uVar5 - 1) {
          uVar8 = 0;
          do {
            uVar24 = (ulong)uVar8;
            uVar8 = uVar8 + 8;
            *(undefined8 *)((long)&((Aux32Info *)value)->a_type + uVar24) =
                 *(undefined8 *)(puVar22 + uVar24);
          } while (uVar8 < uVar5 - 8);
        }
        if (local_218 == 0x32) goto LAB_00110c10;
        if (swap != 0) {
          uVar10 = getu32(auxv32.a_type,(uint32_t)value);
          if (false) goto switchD_001105ef_caseD_10;
          switch(uVar10) {
          case 0xb:
            goto switchD_001105ef_caseD_b;
          case 0xc:
            goto switchD_001105ef_caseD_c;
          case 0xd:
            goto switchD_001105ef_caseD_d;
          case 0xe:
            pcVar20 = "effective gid";
            break;
          case 0xf:
            goto switchD_001105ef_caseD_f;
          default:
            goto switchD_001105ef_caseD_10;
          case 0x1f:
            goto switchD_001105ef_caseD_1f;
          }
          goto LAB_00110876;
        }
        if (true) {
          value = &switchD_00110b5a::switchdataD_0011e55c;
          switch(auxv32.a_type) {
          case 0xb:
            goto switchD_001105ef_caseD_b;
          case 0xc:
            goto switchD_001105ef_caseD_c;
          case 0xd:
            goto switchD_001105ef_caseD_d;
          case 0xe:
            uVar13 = (uint64_t)auxv32.a_v;
            pcVar20 = "effective gid";
            goto LAB_0011061b;
          case 0xf:
            goto switchD_001105ef_caseD_f;
          case 0x1f:
            goto switchD_001105ef_caseD_1f;
          }
        }
        goto switchD_001105ef_caseD_10;
      }
      uVar24 = 0;
      do {
        uVar8 = (int)uVar24 + 8;
        uVar12 = (ulong)uVar8;
        value = *(uint **)(puVar22 + uVar24);
        *(uint **)((long)&auxv64.a_type + uVar24) = value;
        uVar24 = uVar12;
      } while (uVar8 < uVar5);
      if (false) {
        *(uchar *)((long)&auxv64.a_type + uVar12) = puVar22[uVar12];
      }
      if (local_218 == 0x32) {
LAB_00110c10:
        file_error(ms,L'\0',"Too many ELF Auxv elements");
        break;
      }
      if (swap == 0) {
        if (false) goto switchD_001105ef_caseD_10;
        switch(auxv64.a_type) {
        case 0xb:
          goto switchD_001105ef_caseD_b;
        case 0xc:
          goto switchD_001105ef_caseD_c;
        case 0xd:
          goto switchD_001105ef_caseD_d;
        case 0xe:
          pcVar20 = "effective gid";
          uVar13 = auxv64.a_v;
          break;
        case 0xf:
          goto switchD_001105ef_caseD_f;
        default:
          goto switchD_001105ef_caseD_10;
        case 0x1f:
          goto switchD_001105ef_caseD_1f;
        }
        goto LAB_0011061b;
      }
      uVar13 = getu64((int)auxv64.a_type,(uint64_t)value);
      if (false) goto switchD_001105ef_caseD_10;
      switch(uVar13) {
      case 0xb:
switchD_001105ef_caseD_b:
        pcVar20 = "real uid";
        break;
      case 0xc:
switchD_001105ef_caseD_c:
        pcVar20 = "effective uid";
        break;
      case 0xd:
switchD_001105ef_caseD_d:
        pcVar20 = "real gid";
        break;
      case 0xe:
        iVar23 = (int)auxv64.a_v;
        pcVar20 = "effective gid";
        goto LAB_00110613;
      case 0xf:
switchD_001105ef_caseD_f:
        local_1d8 = "platform";
        if ((int)doff == 1) goto LAB_0011083e;
LAB_001106c6:
        EVar15 = auxv64.a_v;
        if (swap != 0) {
          EVar15 = getu64((int)auxv64.a_v,(uint64_t)value);
        }
        goto LAB_001106db;
      default:
        goto switchD_001105ef_caseD_10;
      case 0x1f:
switchD_001105ef_caseD_1f:
        local_1d8 = "execfn";
        if ((int)doff != 1) goto LAB_001106c6;
LAB_0011083e:
        EVar9 = auxv32.a_v;
        if (swap != 0) {
          EVar9 = getu32(auxv32.a_v,(uint32_t)value);
        }
        EVar15 = (Elf64_Xword)EVar9;
LAB_001106db:
        if (clazz != 0) {
          lVar6 = CONCAT44(in_stack_00000034,fd);
          __offset_00 = size;
          iVar23 = clazz;
          do {
            if ((int)doff == 1) {
              __buf = (Elf64_Phdr *)&ph32;
              sVar18 = pread((int)flags,__buf,0x20,__offset_00);
              lVar21 = 0x20;
              if (sVar18 < 0x20) {
LAB_00110809:
                file_badread(ms);
                __offset = -1;
                goto LAB_00110aa7;
              }
            }
            else {
              __buf = &ph64;
              sVar18 = pread((int)flags,&ph64,0x38,__offset_00);
              lVar21 = 0x38;
              if (sVar18 < 0x38) goto LAB_00110809;
            }
            __offset_00 = __offset_00 + lVar21;
            if (lVar6 == -1) {
              if ((int)doff == 1) {
                if (ph32.p_vaddr == 0) goto LAB_001109a3;
LAB_001108b1:
                if (swap == 0) {
                  if (ph32.p_vaddr <= EVar15) {
                    uVar13 = (ulong)ph32.p_filesz;
                    uVar17 = (ulong)ph32.p_vaddr;
                    goto LAB_001107bd;
                  }
                }
                else {
                  uVar10 = getu32(ph32.p_vaddr,(uint32_t)__buf);
                  uVar24 = (ulong)uVar10;
                  if (uVar24 <= EVar15) goto LAB_001108d2;
                }
              }
              else {
LAB_00110779:
                uVar13 = ph64.p_filesz;
                if (ph64.p_vaddr == 0) {
                  if (3 < EVar15) {
                    if (swap != 0) {
                      uVar17 = 4;
                      goto LAB_001107ab;
                    }
LAB_001109e0:
                    uVar17 = 4;
                    goto LAB_001107bd;
                  }
                }
                else if (swap == 0) {
                  uVar17 = ph64.p_vaddr;
                  if (ph64.p_vaddr <= EVar15) goto LAB_001107bd;
                }
                else {
                  uVar17 = getu64((int)ph64.p_vaddr,(uint64_t)__buf);
                  if (uVar17 <= EVar15) {
LAB_001107ab:
                    uVar13 = getu64((int)ph64.p_filesz,(uint64_t)__buf);
LAB_001107bd:
                    if (EVar15 < uVar13 + uVar17) goto LAB_001108f0;
                  }
                }
              }
            }
            else if ((int)doff == 1) {
              uVar8 = ph32.p_offset;
              if (swap != 0) {
                uVar8 = getu32(ph32.p_offset,(uint32_t)__buf);
              }
              if ((long)(ulong)uVar8 <= lVar6) {
                if (ph32.p_vaddr != 0) goto LAB_001108b1;
LAB_001109a3:
                if (3 < EVar15) {
                  uVar13 = (uint64_t)ph32.p_filesz;
                  if (swap == 0) goto LAB_001109e0;
                  uVar24 = 4;
LAB_001108d2:
                  uVar10 = getu32(ph32.p_filesz,(uint32_t)__buf);
                  if (uVar10 + uVar24 <= EVar15) goto LAB_001107c9;
LAB_001108f0:
                  EVar7 = ph64.p_vaddr;
                  swap_00 = ph32.p_vaddr;
                  if ((int)doff == 1) {
                    uVar13 = (uint64_t)ph32.p_vaddr;
                    if (swap == 0) {
                      uVar17 = (uint64_t)ph32.p_offset;
                      if (ph32.p_vaddr == 0) goto LAB_00110bfc;
                    }
                    else {
                      uVar10 = getu32(ph32.p_offset,(uint32_t)__buf);
                      uVar17 = (uint64_t)uVar10;
                      if (swap_00 == 0) {
LAB_00110bfc:
                        uVar13 = 4;
                      }
                      else {
                        uVar10 = getu32(swap_00,(uint32_t)__buf);
                        uVar13 = (uint64_t)uVar10;
                      }
                    }
                  }
                  else if (swap == 0) {
                    uVar13 = ph64.p_vaddr;
                    uVar17 = ph64.p_offset;
                    if (ph64.p_vaddr == 0) {
                      uVar13 = 4;
                    }
                  }
                  else {
                    uVar17 = getu64((int)ph64.p_offset,(uint64_t)__buf);
                    if (EVar7 == 0) goto LAB_00110bfc;
                    uVar13 = getu64((int)EVar7,(uint64_t)__buf);
                  }
                  __offset = (EVar15 + uVar17) - uVar13;
                  goto LAB_00110aa7;
                }
              }
            }
            else {
              EVar16 = ph64.p_offset;
              if (swap != 0) {
                EVar16 = getu64((int)ph64.p_offset,(uint64_t)__buf);
              }
              if ((long)EVar16 <= lVar6) goto LAB_00110779;
            }
LAB_001107c9:
            iVar23 = iVar23 + -1;
          } while (iVar23 != 0);
        }
        __offset = 0;
LAB_00110aa7:
        sVar18 = pread((int)flags,buf,0x100,__offset);
        if (0 < sVar18) {
          buf[sVar18 + -1] = '\0';
          bVar3 = buf[0];
          if (buf[0] == '\0') goto switchD_001105ef_caseD_10;
          plVar19 = (long *)FUN_00104d70();
          pcVar20 = buf;
          do {
            if ((*(byte *)(*plVar19 + 1 + (ulong)bVar3 * 2) & 0x40) == 0)
            goto switchD_001105ef_caseD_10;
            bVar3 = pcVar20[1];
            pcVar20 = pcVar20 + 1;
          } while (bVar3 != 0);
          if (pcVar20 == buf) goto switchD_001105ef_caseD_10;
          wVar11 = file_printf(ms,", %s: \'%s\'",local_1d8,buf);
          goto joined_r0x00110b2b;
        }
        file_badread(ms);
        goto switchD_001105ef_caseD_10;
      }
      if ((int)doff == 1) {
        uVar13 = (ulong)auxv32.a_v;
        if (swap != 0) {
LAB_00110876:
          uVar10 = getu32(auxv32.a_v,(uint32_t)value);
          uVar13 = (ulong)uVar10;
        }
      }
      else {
        iVar23 = (int)auxv64.a_v;
        uVar13 = auxv64.a_v;
        if (swap != 0) {
LAB_00110613:
          uVar13 = getu64(iVar23,(uint64_t)value);
        }
      }
LAB_0011061b:
      wVar11 = file_printf(ms,", %s: %d",pcVar20,uVar13 & 0xffffffff);
joined_r0x00110b2b:
      if (wVar11 == L'\xffffffff') goto LAB_00110640;
switchD_001105ef_caseD_10:
      local_218 = local_218 + 1;
      puVar22 = puVar22 + (long)puVar2;
      puVar14 = puVar22 + ((long)puVar2 - (long)(nbuf + CONCAT44(in_register_0000008c,descsz)));
    }
    iVar23 = 1;
  }
  else {
LAB_00110640:
    iVar23 = 0;
  }
  if (lVar4 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar23;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



size_t donote(magic_set *ms,void *vbuf,size_t offset,size_t size,int clazz,int swap,size_t align,
             int *flags,uint16_t *notecount,int fd,off_t ph_off,int ph_num,off_t fsize)

{
  ulong uVar1;
  long lVar2;
  uint32_t uVar3;
  wchar_t wVar4;
  uint uVar5;
  uint32_t descsz;
  uint32_t uVar6;
  uint32_t uVar7;
  uint32_t uVar8;
  size_t doff;
  ulong uVar9;
  long lVar10;
  uint32_t *puVar11;
  undefined1 *puVar12;
  char *pcVar13;
  int iVar14;
  uint uVar15;
  ulong uVar16;
  byte *pbVar18;
  byte *pbVar19;
  void *pvVar20;
  byte *pbVar21;
  ulong uVar22;
  ulong uVar23;
  long in_FS_OFFSET;
  bool bVar24;
  bool bVar25;
  bool bVar26;
  byte bVar27;
  off_t in_stack_ffffffffffffff68;
  undefined4 in_stack_ffffffffffffff78;
  uint32_t local_68;
  uint8_t desc [20];
  ulong uVar17;
  
  bVar27 = 0;
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  uVar9 = 0;
  if (*notecount == 0) goto LAB_00110ea8;
  uVar1 = offset + 0xc;
  *notecount = *notecount - 1;
  uVar9 = uVar1;
  if (size < uVar1) goto LAB_00110ea8;
  puVar11 = (uint32_t *)(offset + (long)vbuf);
  uVar8 = puVar11[2];
  uVar7 = *puVar11;
  descsz = puVar11[1];
  uVar9 = size;
  if (clazz == 1) {
    local_68 = uVar8;
    if (swap != 0) {
      pvVar20 = vbuf;
      uVar7 = getu32(uVar7,(uint32_t)vbuf);
      descsz = getu32(descsz,(uint32_t)pvVar20);
      local_68 = uVar8;
    }
LAB_00110cd8:
    if (descsz == 0 && uVar7 == 0) goto LAB_00110ea8;
  }
  else {
    if (swap == 0) goto LAB_00110cd8;
    pvVar20 = vbuf;
    uVar7 = getu32(uVar7,(uint32_t)vbuf);
    descsz = getu32(descsz,(uint32_t)pvVar20);
    if (descsz == 0 && uVar7 == 0) goto LAB_00110ea8;
  }
  if ((int)uVar7 < 0) {
    file_printf(ms,", bad note name size 0x%lx",(ulong)uVar7);
    uVar9 = 0;
    goto LAB_00110ea8;
  }
  if ((int)descsz < 0) {
    file_printf(ms,", bad note description size 0x%lx",(ulong)descsz);
    uVar9 = 0;
    goto LAB_00110ea8;
  }
  doff = ((uVar7 + uVar1 + (align - 1)) / align) * align;
  uVar9 = doff;
  if (size < uVar7 + uVar1) goto LAB_00110ea8;
  uVar17 = (ulong)descsz;
  pbVar18 = (byte *)(uVar17 + doff);
  uVar9 = ((ulong)(pbVar18 + (align - 1)) / align) * align;
  if (size < pbVar18) {
    if (uVar9 <= size) {
      uVar9 = size;
    }
    goto LAB_00110ea8;
  }
  uVar5 = *flags;
  if ((uVar5 & 2) == 0) {
    if (clazz == 1) {
      uVar3 = local_68;
      if (swap != 0) {
        uVar3 = getu32(local_68,(uint32_t)pbVar18);
      }
    }
    else {
      uVar3 = uVar8;
      if (swap != 0) {
        uVar3 = getu32(uVar8,(uint32_t)pbVar18);
      }
    }
    bVar24 = uVar7 < 5;
    bVar26 = uVar7 == 5;
    if (bVar26) {
      lVar10 = 5;
      pbVar21 = (byte *)((long)vbuf + uVar1);
      pbVar19 = &DAT_0011e152;
      do {
        pbVar18 = pbVar21;
        if (lVar10 == 0) break;
        lVar10 = lVar10 + -1;
        pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
        bVar24 = *pbVar21 < *pbVar19;
        bVar26 = *pbVar21 == *pbVar19;
        pbVar21 = pbVar18;
        pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
      } while (bVar26);
      if ((((!bVar24 && !bVar26) == bVar24) && (uVar3 == 1)) && (descsz == 2)) {
        *flags = uVar5 | 2;
        file_printf(ms,", for SuSE %d.%d",(ulong)*(byte *)((long)vbuf + doff),
                    (ulong)*(byte *)((long)vbuf + doff + 1));
        goto LAB_00110ea8;
      }
    }
    else {
      bVar24 = uVar7 < 4;
      bVar26 = uVar7 == 4;
      if (bVar26) {
        lVar10 = 4;
        pbVar21 = (byte *)((long)vbuf + uVar1);
        pbVar19 = &DAT_0011e168;
        do {
          pbVar18 = pbVar21;
          if (lVar10 == 0) break;
          lVar10 = lVar10 + -1;
          pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
          bVar24 = *pbVar21 < *pbVar19;
          bVar26 = *pbVar21 == *pbVar19;
          pbVar21 = pbVar18;
          pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
        } while (bVar26);
        if ((((!bVar24 && !bVar26) == bVar24) && (uVar3 == 1)) && (descsz == 0x10)) {
          uVar8 = 0x11e16c;
          uVar1 = *(ulong *)((long)vbuf + doff);
          uVar17 = *(ulong *)((long)vbuf + doff + 8);
          *flags = uVar5 | 2;
          wVar4 = file_printf(ms,", for GNU/");
          if (wVar4 != L'\xffffffff') {
            uVar7 = (uint32_t)uVar1;
            if (swap != 0) {
              uVar7 = getu32(uVar7,uVar8);
            }
            switch(uVar7) {
            case 0:
              pcVar13 = "Linux";
              break;
            case 1:
              pcVar13 = "Hurd";
              break;
            case 2:
              pcVar13 = "Solaris";
              break;
            case 3:
              pcVar13 = "kFreeBSD";
              break;
            case 4:
              pcVar13 = "kNetBSD";
              break;
            default:
              pcVar13 = "<unknown>";
            }
            wVar4 = file_printf(ms,pcVar13);
            uVar8 = (uint32_t)pcVar13;
            if (wVar4 != L'\xffffffff') {
              uVar16 = uVar1 >> 0x20;
              uVar23 = uVar17 & 0xffffffff;
              uVar22 = uVar17 >> 0x20;
              if (swap != 0) {
                uVar7 = getu32((int)(uVar17 >> 0x20),uVar8);
                uVar22 = (ulong)uVar7;
                uVar7 = getu32((int)uVar17,uVar8);
                uVar23 = (ulong)uVar7;
                uVar8 = getu32((int)(uVar1 >> 0x20),uVar8);
                uVar16 = (ulong)uVar8;
              }
              file_printf(ms," %d.%d.%d",uVar16,uVar23,uVar22);
            }
          }
          goto LAB_00110ea8;
        }
      }
      else {
        bVar24 = uVar7 < 7;
        bVar26 = uVar7 == 7;
        if (bVar26) {
          lVar10 = 7;
          pbVar21 = (byte *)((long)vbuf + uVar1);
          pbVar19 = (byte *)0x11e1b5;
          do {
            pbVar18 = pbVar21;
            if (lVar10 == 0) break;
            lVar10 = lVar10 + -1;
            pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
            bVar24 = *pbVar21 < *pbVar19;
            bVar26 = *pbVar21 == *pbVar19;
            pbVar21 = pbVar18;
            pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
          } while (bVar26);
          if ((((!bVar24 && !bVar26) == bVar24) && (uVar3 == 1)) && (descsz == 4)) {
            *flags = uVar5 | 2;
            uVar5 = *(uint *)((long)vbuf + doff);
            if (swap != 0) {
              uVar5 = getu32(uVar5,(uint32_t)pbVar18);
            }
            wVar4 = file_printf(ms,", for NetBSD");
            if ((wVar4 != L'\xffffffff') && (100000000 < uVar5)) {
              uVar1 = ((ulong)uVar5 / 100) % 100;
              uVar17 = ((ulong)uVar5 / 10000) % 100;
              uVar15 = (uint)uVar17;
              wVar4 = file_printf(ms," %u.%u",(ulong)uVar5 / 100000000,
                                  ((ulong)uVar5 / 1000000) % 100);
              if (wVar4 != L'\xffffffff') {
                if ((uVar15 == 0) && ((int)uVar1 != 0)) {
                  file_printf(ms,".%u",uVar1);
                }
                else if (uVar15 != 0) {
                  while (0x1a < uVar15) {
                    wVar4 = file_printf(ms,"Z");
                    if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
                    uVar15 = (int)uVar17 - 0x1a;
                    uVar17 = (ulong)uVar15;
                  }
                  file_printf(ms,"%c",(ulong)(uVar15 + 0x40));
                }
              }
            }
            goto LAB_00110ea8;
          }
        }
        else {
          bVar24 = uVar7 < 8;
          bVar26 = uVar7 == 8;
          if (bVar26) {
            lVar10 = 8;
            pbVar21 = (byte *)((long)vbuf + uVar1);
            pbVar19 = (byte *)0x11e1cb;
            do {
              pbVar18 = pbVar21;
              if (lVar10 == 0) break;
              lVar10 = lVar10 + -1;
              pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
              bVar24 = *pbVar21 < *pbVar19;
              bVar26 = *pbVar21 == *pbVar19;
              pbVar21 = pbVar18;
              pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
            } while (bVar26);
            bVar25 = false;
            bVar24 = (!bVar24 && !bVar26) == bVar24;
            if (bVar24) {
              if ((uVar3 == 1) && (descsz == 4)) {
                *flags = uVar5 | 2;
                uVar5 = *(uint *)((long)vbuf + doff);
                if (swap != 0) {
                  uVar5 = getu32(uVar5,(uint32_t)pbVar18);
                }
                wVar4 = file_printf(ms,", for FreeBSD");
                if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
                if (uVar5 == 0x704e2) {
                  file_printf(ms," 4.6.2");
                  goto LAB_00110ea8;
                }
                if (uVar5 < 0x70544) {
                  wVar4 = file_printf(ms," %d.%d",(ulong)uVar5 / 100000,((ulong)uVar5 / 10000) % 10)
                  ;
                  if (((wVar4 == L'\xffffffff') ||
                      (((int)(((ulong)uVar5 / 1000) % 10) != 0 &&
                       (wVar4 = file_printf(ms,".%d"), wVar4 == L'\xffffffff')))) ||
                     ((uVar5 % 1000 == 0 && (uVar5 % 100000 != 0)))) goto LAB_00110ea8;
LAB_00111be0:
                  file_printf(ms," (%d)",(ulong)uVar5);
                }
                else {
                  if (uVar5 < 500000) {
                    wVar4 = file_printf(ms," %d.%d",4,
                                        (ulong)(uint)((int)(((ulong)uVar5 / 1000) % 10) +
                                                     (int)(((ulong)uVar5 / 10000) % 10)));
                    if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
                    if ((int)(((ulong)uVar5 / 100) % 10) != 0) {
                      file_printf(ms," (%d)",(ulong)uVar5);
                      goto LAB_00110ea8;
                    }
                    iVar14 = (int)(((ulong)uVar5 / 10) % 10);
                  }
                  else {
                    wVar4 = file_printf(ms," %d.%d",(ulong)uVar5 / 100000,
                                        ((ulong)uVar5 / 1000) % 100);
                    if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
                    if (((int)(((ulong)uVar5 / 100) % 10) != 0) || (uVar5 % 100000 < 100))
                    goto LAB_00111be0;
                    iVar14 = (int)(((ulong)uVar5 / 10) % 10);
                  }
                  if (iVar14 != 0) {
                    file_printf(ms,".%d");
                  }
                }
                goto LAB_00110ea8;
              }
            }
            else {
              lVar10 = 8;
              pbVar21 = (byte *)((long)vbuf + uVar1);
              pbVar19 = (byte *)0x11e1e6;
              do {
                pbVar18 = pbVar21;
                if (lVar10 == 0) break;
                lVar10 = lVar10 + -1;
                pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
                bVar25 = *pbVar21 < *pbVar19;
                bVar24 = *pbVar21 == *pbVar19;
                pbVar21 = pbVar18;
                pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
              } while (bVar24);
              if ((((!bVar25 && !bVar24) == bVar25) && (uVar3 == 1)) && (descsz == 4)) {
                *flags = uVar5 | 2;
                file_printf(ms,", for OpenBSD");
                goto LAB_00110ea8;
              }
            }
          }
          else {
            bVar24 = uVar7 < 10;
            bVar26 = uVar7 == 10;
            if (bVar26) {
              lVar10 = 10;
              pbVar21 = (byte *)((long)vbuf + uVar1);
              pbVar19 = (byte *)0x11e1f4;
              do {
                pbVar18 = pbVar21;
                if (lVar10 == 0) break;
                lVar10 = lVar10 + -1;
                pbVar18 = pbVar21 + (ulong)bVar27 * -2 + 1;
                bVar24 = *pbVar21 < *pbVar19;
                bVar26 = *pbVar21 == *pbVar19;
                pbVar21 = pbVar18;
                pbVar19 = pbVar19 + (ulong)bVar27 * -2 + 1;
              } while (bVar26);
              if ((((!bVar24 && !bVar26) == bVar24) && (uVar3 == 1)) && (descsz == 4)) {
                uVar8 = 0x11e1ee;
                *flags = uVar5 | 2;
                wVar4 = file_printf(ms,", for DragonFly");
                if (wVar4 != L'\xffffffff') {
                  uVar5 = *(uint *)((long)vbuf + doff);
                  if (swap != 0) {
                    uVar5 = getu32(uVar5,uVar8);
                  }
                  file_printf(ms," %d.%d.%d",(ulong)(uVar5 >> 5) / 0xc35,
                              (ulong)(uVar5 / 10000 + (uVar5 / 100000) * -10),(ulong)(uVar5 % 10000)
                             );
                }
                goto LAB_00110ea8;
              }
            }
          }
        }
      }
    }
  }
  uVar3 = (uint32_t)pbVar18;
  if ((uVar5 & 4) == 0) {
    if (clazz == 1) {
      uVar6 = local_68;
      if (swap != 0) {
        uVar6 = getu32(local_68,uVar3);
      }
    }
    else {
      uVar6 = uVar8;
      if (swap != 0) {
        uVar6 = getu32(uVar8,uVar3);
      }
    }
    bVar24 = uVar7 < 4;
    bVar26 = uVar7 == 4;
    if (bVar26) {
      lVar10 = 4;
      pbVar18 = (byte *)((long)vbuf + uVar1);
      pbVar21 = &DAT_0011e168;
      do {
        pbVar19 = pbVar18;
        if (lVar10 == 0) break;
        lVar10 = lVar10 + -1;
        pbVar19 = pbVar18 + (ulong)bVar27 * -2 + 1;
        bVar24 = *pbVar18 < *pbVar21;
        bVar26 = *pbVar18 == *pbVar21;
        pbVar18 = pbVar19;
        pbVar21 = pbVar21 + (ulong)bVar27 * -2 + 1;
      } while (bVar26);
      uVar3 = (uint32_t)pbVar19;
      if (((!bVar24 && !bVar26) == bVar24) && (uVar6 == 3)) {
        *flags = uVar5 | 4;
        if (descsz == 0x10) {
          wVar4 = file_printf(ms,", BuildID[%s]=","md5/uuid");
          descsz = 0x10;
          if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
          desc._0_8_ = *(undefined8 *)((long)vbuf + doff);
          desc._8_8_ = ((undefined8 *)((long)vbuf + doff))[1];
        }
        else {
          if (descsz == 0x14) {
            pcVar13 = "sha1";
          }
          else {
            if (descsz != 8) {
              wVar4 = file_printf(ms,", BuildID[%s]=","unknown");
              if ((wVar4 == L'\xffffffff') ||
                 (__memcpy_chk(desc,(void *)(doff + (long)vbuf),uVar17,0x14), descsz == 0))
              goto LAB_00110ea8;
              goto LAB_00111028;
            }
            pcVar13 = "xxHash";
          }
          wVar4 = file_printf(ms,", BuildID[%s]=",pcVar13);
          if (wVar4 == L'\xffffffff') goto LAB_00110ea8;
          __memcpy_chk(desc,(void *)(doff + (long)vbuf),uVar17,0x14);
        }
LAB_00111028:
        lVar10 = 0;
        do {
          wVar4 = file_printf(ms,"%02x",(ulong)desc[lVar10]);
          if (wVar4 == L'\xffffffff') break;
          lVar10 = lVar10 + 1;
        } while ((uint)lVar10 < descsz);
        goto LAB_00110ea8;
      }
    }
  }
  if ((uVar5 & 0x10) == 0) {
    if (clazz == 1) {
      uVar6 = local_68;
      if (swap != 0) {
        uVar6 = getu32(local_68,uVar3);
      }
    }
    else {
      uVar6 = uVar8;
      if (swap != 0) {
        uVar6 = getu32(uVar8,uVar3);
      }
    }
    bVar24 = uVar7 < 4;
    bVar26 = uVar7 == 4;
    if (bVar26) {
      lVar10 = 4;
      pbVar18 = (byte *)((long)vbuf + uVar1);
      pbVar21 = &DAT_0011e212;
      do {
        pbVar19 = pbVar18;
        if (lVar10 == 0) break;
        lVar10 = lVar10 + -1;
        pbVar19 = pbVar18 + (ulong)bVar27 * -2 + 1;
        bVar24 = *pbVar18 < *pbVar21;
        bVar26 = *pbVar18 == *pbVar21;
        pbVar18 = pbVar19;
        pbVar21 = pbVar21 + (ulong)bVar27 * -2 + 1;
      } while (bVar26);
      uVar3 = (uint32_t)pbVar19;
      if ((((!bVar24 && !bVar26) == bVar24) && (uVar6 == 3)) && (descsz == 4)) {
        *flags = uVar5 | 0x10;
        uVar5 = *(uint *)((long)vbuf + doff);
        if (swap != 0) {
          uVar5 = getu32(uVar5,uVar3);
        }
        iVar14 = 0;
        if ((uVar5 == 0) || (wVar4 = file_printf(ms,", PaX: "), wVar4 != L'\xffffffff')) {
          lVar10 = 0;
          do {
            if ((1 << ((byte)lVar10 & 0x1f) & uVar5) != 0) {
              bVar24 = iVar14 != 0;
              iVar14 = iVar14 + 1;
              puVar12 = &DAT_0011ddf7;
              if (bVar24) {
                puVar12 = &DAT_0011e895;
              }
              wVar4 = file_printf(ms,"%s%s",puVar12,(&pax_6705)[lVar10]);
              if (wVar4 == L'\xffffffff') break;
            }
            lVar10 = lVar10 + 1;
          } while (lVar10 != 6);
        }
        goto LAB_00110ea8;
      }
    }
  }
  if ((uVar5 & 1) == 0) {
    if (clazz == 1) {
      uVar6 = local_68;
      if (swap != 0) {
        uVar6 = getu32(local_68,uVar3);
      }
    }
    else {
      uVar6 = uVar8;
      if (swap != 0) {
        uVar6 = getu32(uVar8,uVar3);
      }
    }
    pvVar20 = vbuf;
    iVar14 = do_core_note(ms,(uchar *)vbuf,uVar6,swap,uVar7,descsz,uVar1,doff,flags,size,clazz);
    uVar3 = (uint32_t)pvVar20;
    if (iVar14 != 0) goto LAB_00110ea8;
    uVar5 = *flags;
  }
  if ((uVar5 & 0x200) == 0) {
    if (clazz == 1) {
      uVar6 = local_68;
      if (swap != 0) {
        uVar6 = getu32(local_68,uVar3);
      }
    }
    else {
      uVar6 = uVar8;
      if (swap != 0) {
        uVar6 = getu32(uVar8,uVar3);
      }
    }
    iVar14 = do_auxv_note(ms,(uchar *)vbuf,uVar6,swap,descsz,(uint32_t)doff,(size_t)flags,
                          (ulong)(uint)clazz,(int *)(ulong)(uint)fd,ph_off,ph_num,(int)fsize,
                          in_stack_ffffffffffffff68,(int)flags,
                          CONCAT44(uVar8,in_stack_ffffffffffffff78));
    if (iVar14 != 0) goto LAB_00110ea8;
  }
  bVar24 = uVar7 < 7;
  bVar26 = uVar7 == 7;
  if (bVar26) {
    lVar10 = 7;
    pbVar18 = (byte *)((long)vbuf + uVar1);
    pbVar21 = (byte *)0x11e1b5;
    do {
      pbVar19 = pbVar18;
      if (lVar10 == 0) break;
      lVar10 = lVar10 + -1;
      pbVar19 = pbVar18 + (ulong)bVar27 * -2 + 1;
      bVar24 = *pbVar18 < *pbVar21;
      bVar26 = *pbVar18 == *pbVar21;
      pbVar18 = pbVar19;
      pbVar21 = pbVar21 + (ulong)bVar27 * -2 + 1;
    } while (bVar26);
    if ((!bVar24 && !bVar26) == bVar24) {
      uVar5 = 100;
      if (descsz < 0x65) {
        uVar5 = descsz;
      }
      if (clazz == 1) {
        if (swap != 0) {
          local_68 = getu32(local_68,(uint32_t)pbVar19);
        }
      }
      else {
        local_68 = uVar8;
        if (swap != 0) {
          local_68 = getu32(uVar8,(uint32_t)pbVar19);
        }
      }
      if (local_68 == 5) {
        if ((*flags & 0x20U) == 0) {
          *flags = *flags | 0x20;
          file_printf(ms,", compiled for: %.*s",(ulong)uVar5,(void *)(doff + (long)vbuf));
        }
      }
      else if (local_68 == 6) {
        if ((*flags & 0x40U) == 0) {
          *flags = *flags | 0x40;
          file_printf(ms,", compiler model: %.*s",(ulong)uVar5,(void *)(doff + (long)vbuf));
        }
      }
      else if ((local_68 != 1) && ((*flags & 0x80U) == 0)) {
        *flags = *flags | 0x80;
        file_printf(ms,", note=%u",(ulong)local_68);
      }
    }
  }
LAB_00110ea8:
  if (lVar2 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return uVar9;
}



int dophn_core(magic_set *ms,int clazz,int swap,int fd,off_t off,int num,size_t size,off_t fsize,
              int *flags,uint16_t *notecount)

{
  long lVar1;
  uint32_t uVar2;
  Elf32_Word EVar3;
  wchar_t wVar4;
  int iVar5;
  long lVar6;
  uint64_t uVar7;
  long lVar8;
  ulong size_00;
  size_t offset;
  Elf64_Off EVar9;
  Elf64_Phdr *pEVar10;
  Elf64_Xword EVar11;
  size_t sVar12;
  Elf64_Phdr *value;
  long in_FS_OFFSET;
  long local_20d8;
  int local_20b4;
  Elf32_Phdr ph32;
  Elf64_Phdr ph64;
  uchar nbuf [8192];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  lVar6 = 0x38;
  sVar12 = 0x38;
  if (clazz == 1) {
    sVar12 = 0x20;
  }
  if (sVar12 == size) {
    if (num != 0) {
      if (clazz == 1) {
        lVar6 = 0x20;
      }
      local_20d8 = off;
      local_20b4 = num;
      pEVar10 = &ph64;
      if (clazz == 1) {
        pEVar10 = (Elf64_Phdr *)&ph32;
      }
LAB_00111d83:
      do {
        value = pEVar10;
        lVar8 = __pread_chk(fd,pEVar10,sVar12,local_20d8,0x38);
        if (lVar8 < lVar6) {
LAB_00112000:
          file_badread(ms);
          iVar5 = -1;
          goto LAB_00111e84;
        }
        local_20d8 = local_20d8 + size;
        if (fsize != -1) {
          if (clazz == 1) {
            if (swap == 0) {
              if ((long)(ulong)ph32.p_offset <= fsize) goto LAB_00111f5d;
            }
            else {
              uVar2 = getu32(ph32.p_offset,(uint32_t)value);
              if ((long)(ulong)uVar2 <= fsize) goto LAB_00111ed6;
            }
          }
          else if (swap == 0) {
            if ((long)ph64.p_offset <= fsize) goto LAB_00111dd8;
          }
          else {
            uVar7 = getu64((int)ph64.p_offset,(uint64_t)value);
            if ((long)uVar7 <= fsize) goto LAB_00111d6a;
          }
          goto LAB_00111d78;
        }
        if (clazz == 1) {
          if (swap == 0) {
LAB_00111f5d:
            if (ph32.p_type == 4) {
              EVar3 = ph32.p_filesz;
              if (0x1fff < ph32.p_filesz) {
                EVar11 = 0x2000;
                EVar9 = (Elf64_Off)ph32.p_offset;
                goto LAB_00111dfa;
              }
LAB_00111ef4:
              uVar2 = (uint32_t)value;
              EVar11 = (Elf64_Xword)EVar3;
              if (swap == 0) {
                EVar9 = (Elf64_Off)ph32.p_offset;
                goto LAB_00111dfa;
              }
LAB_00111f0f:
              uVar2 = getu32(ph32.p_offset,uVar2);
              EVar9 = (Elf64_Off)uVar2;
              goto LAB_00111dfa;
            }
          }
          else {
LAB_00111ed6:
            uVar2 = getu32(ph32.p_type,(uint32_t)value);
            if (uVar2 == 4) {
              EVar3 = getu32(ph32.p_filesz,(uint32_t)value);
              uVar2 = (uint32_t)value;
              if (EVar3 < 0x2000) goto LAB_00111ef4;
              EVar11 = 0x2000;
              goto LAB_00111f0f;
            }
          }
LAB_00111d78:
          local_20b4 = local_20b4 + -1;
          if (local_20b4 == 0) break;
          goto LAB_00111d83;
        }
        if (swap != 0) {
LAB_00111d6a:
          uVar2 = getu32(ph64.p_type,(uint32_t)value);
          if (uVar2 == 4) {
            EVar11 = getu64((int)ph64.p_filesz,(uint64_t)value);
            if (0x1fff < EVar11) {
              EVar11 = 0x2000;
            }
            EVar9 = getu64((int)ph64.p_offset,(uint64_t)value);
            goto LAB_00111dfa;
          }
          goto LAB_00111d78;
        }
LAB_00111dd8:
        if (ph64.p_type != 4) goto LAB_00111d78;
        EVar9 = ph64.p_offset;
        EVar11 = ph64.p_filesz;
        if (0x1fff < ph64.p_filesz) {
          EVar11 = 0x2000;
        }
LAB_00111dfa:
        size_00 = __pread_chk(fd,nbuf,EVar11,EVar9,0x2000);
        if (size_00 == 0xffffffffffffffff) goto LAB_00112000;
        offset = 0;
        do {
          if (size_00 <= offset) break;
          offset = donote(ms,nbuf,offset,size_00,clazz,swap,4,flags,notecount,fd,off,num,fsize);
        } while (offset != 0);
        local_20b4 = local_20b4 + -1;
      } while (local_20b4 != 0);
    }
    iVar5 = 0;
  }
  else {
    wVar4 = file_printf(ms,", corrupted program header size");
    iVar5 = -(uint)(wVar4 == L'\xffffffff');
  }
LAB_00111e84:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar5;
}



int dophn_exec(magic_set *ms,int clazz,int swap,int fd,off_t off,int num,size_t size,off_t fsize,
              int sh_num,int *flags,uint16_t *notecount)

{
  int *piVar1;
  undefined *vbuf;
  uint32_t uVar2;
  uint32_t uVar3;
  wchar_t wVar4;
  int iVar5;
  uint32_t uVar6;
  uint uVar7;
  long lVar8;
  undefined *puVar9;
  uint64_t uVar10;
  size_t offset;
  char *pcVar11;
  ulong uVar12;
  undefined *puVar13;
  long in_FS_OFFSET;
  Elf32_Phdr ph32;
  Elf64_Phdr ph64;
  uchar nbuf [8192];
  char ibuf [8192];
  
  puVar9 = &stack0xffffffffffffffd0;
  do {
    puVar13 = puVar9;
    *(undefined8 *)(puVar13 + -0x1000) = *(undefined8 *)(puVar13 + -0x1000);
    puVar9 = puVar13 + -0x1000;
  } while (puVar13 + -0x1000 != nbuf + 0x18);
  *(undefined8 *)(puVar13 + -0x10c0) = *(undefined8 *)(puVar13 + 0x3050);
  *(off_t *)(puVar13 + -0x10b0) = off;
  *(int *)(puVar13 + -0x109c) = num;
  *(undefined8 *)(puVar13 + -0x10b8) = *(undefined8 *)(puVar13 + 0x3058);
  *(undefined8 *)(puVar13 + 0x2ff0) = *(undefined8 *)(in_FS_OFFSET + 0x28);
  lVar8 = 0x38;
  if (clazz == 1) {
    lVar8 = 0x20;
  }
  *(long *)(puVar13 + -0x10a8) = lVar8;
  if (lVar8 == *(long *)(puVar13 + 0x3038)) {
    if (num == 0) {
      *(undefined8 *)(puVar13 + -0x10d0) = 0x11271b;
      wVar4 = file_printf(ms,", %s linked","statically");
      if (wVar4 != L'\xffffffff') {
        iVar5 = 0;
        goto LAB_001125b1;
      }
    }
    else {
      puVar9 = puVar13 + -0x1058;
      if (clazz == 1) {
        puVar9 = puVar13 + -0x1078;
      }
      vbuf = puVar13 + -0x1018;
      *(undefined **)(puVar13 + -0x1098) = puVar9;
      *(undefined1 **)(puVar13 + -0x1088) = &DAT_0011ddf7;
      *(char **)(puVar13 + -0x1090) = "statically";
      do {
        pcVar11 = *(char **)(puVar13 + -0x1098);
        *(undefined8 *)(puVar13 + -0x10d0) = 0x11210d;
        lVar8 = __pread_chk((ulong)(uint)fd,pcVar11,*(undefined8 *)(puVar13 + -0x10a8),
                            *(undefined8 *)(puVar13 + -0x10b0),0x38);
        uVar2 = (uint32_t)pcVar11;
        if (clazz == 1) {
          if (lVar8 < 0x20) goto LAB_00112660;
          uVar3 = *(uint32_t *)(puVar13 + -0x1078);
          *(long *)(puVar13 + -0x10b0) = *(long *)(puVar13 + -0x10b0) + *(long *)(puVar13 + 0x3038);
          if (swap == 0) {
            if (uVar3 != 3) {
              if (uVar3 == 4) goto LAB_001124d0;
              if (uVar3 == 2) goto LAB_00112338;
              if (*(long *)(puVar13 + 0x3040) == -1) goto LAB_001122da;
              if ((long)(ulong)*(uint *)(puVar13 + -0x1074) <= *(long *)(puVar13 + 0x3040))
              goto LAB_0011238c;
              goto LAB_00112208;
            }
            uVar7 = *(uint *)(puVar13 + -0x1068);
LAB_00112614:
            *(undefined8 *)(puVar13 + -0x10c8) = 4;
LAB_0011261c:
            if (0x1fff < uVar7) {
              uVar12 = 0x2000;
              uVar10 = (uint64_t)*(uint *)(puVar13 + -0x1074);
              goto LAB_00112496;
            }
LAB_00112628:
            uVar12 = (ulong)uVar7;
            uVar7 = *(uint *)(puVar13 + -0x1074);
joined_r0x00112630:
            if (swap == 0) {
              uVar10 = (uint64_t)uVar7;
            }
            else {
              *(ulong *)(puVar13 + -0x1080) = uVar12;
              *(undefined8 *)(puVar13 + -0x10d0) = 0x112640;
              uVar2 = getu32(uVar7,uVar2);
              uVar12 = *(ulong *)(puVar13 + -0x1080);
              uVar10 = (uint64_t)uVar2;
            }
LAB_00112496:
            *(undefined8 *)(puVar13 + -0x10d0) = 0x1124a7;
            puVar9 = vbuf;
            uVar12 = __pread_chk(fd,vbuf,uVar12,uVar10,0x2000);
            uVar2 = (uint32_t)puVar9;
            if (uVar12 != 0xffffffffffffffff) {
              if (clazz == 1) {
                uVar3 = *(uint32_t *)(puVar13 + -0x1078);
              }
              else {
                uVar3 = *(uint32_t *)(puVar13 + -0x1058);
              }
              goto LAB_001122e5;
            }
            goto LAB_00112660;
          }
          *(uint32_t *)(puVar13 + -0x10c8) = uVar3;
          *(undefined8 *)(puVar13 + -0x10d0) = 0x1122b0;
          uVar6 = getu32(uVar3,uVar2);
          uVar2 = (uint32_t)pcVar11;
          if (uVar6 == 3) {
            uVar7 = *(uint *)(puVar13 + -0x1068);
LAB_0011252e:
            *(undefined8 *)(puVar13 + -0x10c8) = 4;
LAB_00112536:
            *(undefined8 *)(puVar13 + -0x10d0) = 0x11253b;
            uVar7 = getu32(uVar7,uVar2);
            if (uVar7 < 0x2000) goto LAB_00112628;
LAB_00112548:
            uVar7 = *(uint *)(puVar13 + -0x1074);
            uVar12 = 0x2000;
            goto joined_r0x00112630;
          }
          if (uVar6 == 4) {
LAB_001124d0:
            if (*(int *)(puVar13 + 0x3048) == 0) {
              uVar7 = *(uint *)(puVar13 + -0x105c);
              if (uVar7 == 0) {
LAB_00112522:
                uVar7 = *(uint *)(puVar13 + -0x1068);
                if (swap == 0) goto LAB_00112614;
                goto LAB_0011252e;
              }
              if (swap != 0) {
                *(undefined8 *)(puVar13 + -0x10d0) = 0x1126bb;
                uVar2 = getu32(uVar7,uVar2);
                *(ulong *)(puVar13 + -0x10c8) = (ulong)uVar2;
                if (0x7ffffffb < uVar2 - 4) goto LAB_00112504;
                uVar7 = *(uint *)(puVar13 + -0x1068);
                goto LAB_00112536;
              }
              *(ulong *)(puVar13 + -0x10c8) = (ulong)uVar7;
              if (uVar7 - 4 < 0x7ffffffc) {
                uVar7 = *(uint *)(puVar13 + -0x1068);
                goto LAB_0011261c;
              }
LAB_00112504:
              uVar2 = 0x11e708;
              *(undefined8 *)(puVar13 + -0x10d0) = 0x112519;
              wVar4 = file_printf(ms,", invalid note alignment 0x%lx",
                                  *(undefined8 *)(puVar13 + -0x10c8));
              if (wVar4 != L'\xffffffff') goto LAB_00112522;
              goto LAB_00112727;
            }
          }
          else {
            uVar3 = *(uint32_t *)(puVar13 + -0x10c8);
            if (uVar6 == 2) goto LAB_00112338;
            if (*(long *)(puVar13 + 0x3040) == -1) goto LAB_001122da;
            *(uint32_t *)(puVar13 + -0x10c8) = uVar3;
            *(undefined8 *)(puVar13 + -0x10d0) = 0x1126ed;
            uVar3 = getu32(*(int *)(puVar13 + -0x1074),uVar2);
            iVar5 = *(int *)(puVar13 + -0x10c8);
            if ((long)(ulong)uVar3 <= *(long *)(puVar13 + 0x3040)) goto LAB_00112190;
          }
        }
        else {
          if (lVar8 < 0x38) {
LAB_00112660:
            *(undefined8 *)(puVar13 + -0x10d0) = 0x112668;
            file_badread(ms);
            iVar5 = -1;
            goto LAB_001125b1;
          }
          pcVar11 = *(char **)(puVar13 + 0x3038);
          uVar3 = *(uint32_t *)(puVar13 + -0x1058);
          *(char **)(puVar13 + -0x10b0) = pcVar11 + *(long *)(puVar13 + -0x10b0);
          if (swap == 0) {
            if (uVar3 == 3) {
              uVar12 = *(ulong *)(puVar13 + -0x1038);
LAB_00112568:
              *(undefined8 *)(puVar13 + -0x10c8) = 4;
LAB_00112570:
              uVar2 = (uint32_t)pcVar11;
              if (uVar12 < 0x2000) {
                uVar10 = *(uint64_t *)(puVar13 + -0x1050);
              }
              else {
                if (clazz == 1) goto LAB_00112548;
                uVar10 = *(uint64_t *)(puVar13 + -0x1050);
                uVar12 = 0x2000;
              }
              goto LAB_00112496;
            }
            if (uVar3 == 4) goto LAB_001123f0;
            if (uVar3 == 2) goto LAB_00112338;
            if (*(long *)(puVar13 + 0x3040) == -1) goto LAB_001122da;
            if (*(long *)(puVar13 + 0x3040) < *(long *)(puVar13 + -0x1050)) goto LAB_00112208;
LAB_0011238c:
            if (uVar3 == 3) goto LAB_00112396;
LAB_001121a4:
            *(undefined8 *)(puVar13 + -0x10c8) = 4;
            uVar12 = 0;
          }
          else {
            *(uint32_t *)(puVar13 + -0x10c8) = uVar3;
            *(undefined8 *)(puVar13 + -0x10d0) = 0x112146;
            uVar2 = getu32(uVar3,(uint32_t)pcVar11);
            if (uVar2 == 3) {
              uVar12 = *(ulong *)(puVar13 + -0x1038);
LAB_0011245b:
              iVar5 = (int)uVar12;
              *(undefined8 *)(puVar13 + -0x10c8) = 4;
LAB_00112463:
              *(undefined8 *)(puVar13 + -0x10d0) = 0x11246b;
              uVar10 = getu64(iVar5,(uint64_t)pcVar11);
              if (uVar10 < 0x2000) {
                iVar5 = (int)*(undefined8 *)(puVar13 + -0x1050);
              }
              else {
                iVar5 = (int)*(undefined8 *)(puVar13 + -0x1050);
                uVar10 = 0x2000;
              }
              *(uint64_t *)(puVar13 + -0x1080) = uVar10;
              *(undefined8 *)(puVar13 + -0x10d0) = 0x11248e;
              uVar10 = getu64(iVar5,(uint64_t)pcVar11);
              uVar12 = *(ulong *)(puVar13 + -0x1080);
              goto LAB_00112496;
            }
            if (uVar2 == 4) {
LAB_001123f0:
              if (*(int *)(puVar13 + 0x3048) != 0) goto LAB_00112208;
              lVar8 = *(long *)(puVar13 + -0x1028);
              *(long *)(puVar13 + -0x10c8) = lVar8;
              if (lVar8 == 0) {
LAB_0011244b:
                uVar12 = *(ulong *)(puVar13 + -0x1038);
                if (swap == 0) goto LAB_00112568;
                goto LAB_0011245b;
              }
              if (swap != 0) {
                *(undefined8 *)(puVar13 + -0x10d0) = 0x112680;
                uVar10 = getu64((int)lVar8,(uint64_t)pcVar11);
                *(uint64_t *)(puVar13 + -0x10c8) = uVar10;
                if (((uVar10 & 0x80000000) != 0) || (uVar10 < 4)) goto LAB_0011242d;
                iVar5 = (int)*(undefined8 *)(puVar13 + -0x1038);
                goto LAB_00112463;
              }
              if (((*(ulong *)(puVar13 + -0x10c8) & 0x80000000) == 0) &&
                 (3 < *(ulong *)(puVar13 + -0x10c8))) {
                uVar12 = *(ulong *)(puVar13 + -0x1038);
                goto LAB_00112570;
              }
LAB_0011242d:
              pcVar11 = ", invalid note alignment 0x%lx";
              *(undefined8 *)(puVar13 + -0x10d0) = 0x112442;
              wVar4 = file_printf(ms,", invalid note alignment 0x%lx",
                                  *(undefined8 *)(puVar13 + -0x10c8));
              if (wVar4 != L'\xffffffff') goto LAB_0011244b;
              goto LAB_00112727;
            }
            uVar3 = *(uint32_t *)(puVar13 + -0x10c8);
            if (uVar2 == 2) {
LAB_00112338:
              *(char **)(puVar13 + -0x1090) = "dynamically";
              goto LAB_00112208;
            }
            if (*(long *)(puVar13 + 0x3040) != -1) {
              *(uint32_t *)(puVar13 + -0x10c8) = uVar3;
              *(undefined8 *)(puVar13 + -0x10d0) = 0x112182;
              uVar10 = getu64((int)*(undefined8 *)(puVar13 + -0x1050),(uint64_t)pcVar11);
              uVar2 = (uint32_t)pcVar11;
              iVar5 = *(int *)(puVar13 + -0x10c8);
              if ((long)uVar10 <= *(long *)(puVar13 + 0x3040)) {
LAB_00112190:
                *(undefined8 *)(puVar13 + -0x10d0) = 0x112198;
                uVar3 = getu32(iVar5,uVar2);
                if (uVar3 != 3) goto LAB_001121a4;
LAB_00112396:
                *(char **)(puVar13 + -0x1088) = "*empty*";
              }
              goto LAB_00112208;
            }
LAB_001122da:
            uVar2 = (uint32_t)pcVar11;
            *(undefined8 *)(puVar13 + -0x10c8) = 4;
            uVar12 = 0;
LAB_001122e5:
            if (swap != 0) {
              *(undefined8 *)(puVar13 + -0x10d0) = 0x1122f1;
              uVar3 = getu32(uVar3,uVar2);
            }
            if (uVar3 == 3) {
              *(char **)(puVar13 + -0x1088) = "*empty*";
              if ((uVar12 != 0) && (puVar13[-0x1018] != '\0')) {
                puVar13[uVar12 - 0x1019] = 0;
                *(undefined **)(puVar13 + -0x1088) = vbuf;
              }
              goto LAB_00112208;
            }
          }
          offset = 0;
          if (uVar3 == 4) {
            do {
              if (uVar12 <= offset) break;
              *(undefined8 *)(puVar13 + -0x10d8) = 0;
              *(undefined8 *)(puVar13 + -0x10e0) = 0;
              *(undefined8 *)(puVar13 + -0x10e8) = 0;
              *(ulong *)(puVar13 + -0x10f0) = (ulong)(uint)fd;
              *(undefined8 *)(puVar13 + -0x10f8) = *(undefined8 *)(puVar13 + -0x10b8);
              *(undefined8 *)(puVar13 + -0x1100) = *(undefined8 *)(puVar13 + -0x10c0);
              *(undefined8 *)(puVar13 + -0x1108) = *(undefined8 *)(puVar13 + -0x10c8);
              *(undefined8 *)(puVar13 + -0x1110) = 0x1121f4;
              offset = donote(ms,vbuf,offset,uVar12,clazz,swap,*(size_t *)(puVar13 + -0x1108),
                              *(int **)(puVar13 + -0x1100),*(uint16_t **)(puVar13 + -0x10f8),
                              *(int *)(puVar13 + -0x10f0),*(off_t *)(puVar13 + -0x10e8),
                              *(int *)(puVar13 + -0x10e0),*(off_t *)(puVar13 + -0x10d8));
            } while (offset != 0);
          }
        }
LAB_00112208:
        piVar1 = (int *)(puVar13 + -0x109c);
        *piVar1 = *piVar1 + -1;
      } while (*piVar1 != 0);
      *(undefined8 *)(puVar13 + -0x10d0) = 0x112229;
      wVar4 = file_printf(ms,", %s linked",*(undefined8 *)(puVar13 + -0x1090));
      if (wVar4 != L'\xffffffff') {
        iVar5 = 0;
        if (**(char **)(puVar13 + -0x1088) != '\0') {
          *(undefined8 *)(puVar13 + -0x10d0) = 0x112257;
          pcVar11 = file_printable(puVar13 + 0xfe8,0x2000,*(char **)(puVar13 + -0x1088));
          *(undefined8 *)(puVar13 + -0x10d0) = 0x11226b;
          wVar4 = file_printf(ms,", interpreter %s",pcVar11);
          iVar5 = -(uint)(wVar4 == L'\xffffffff');
        }
        goto LAB_001125b1;
      }
    }
LAB_00112727:
    iVar5 = -1;
  }
  else {
    *(undefined8 *)(puVar13 + -0x10d0) = 0x1125a6;
    wVar4 = file_printf(ms,", corrupted program header size");
    iVar5 = -(uint)(wVar4 == L'\xffffffff');
  }
LAB_001125b1:
  if (*(long *)(puVar13 + 0x2ff0) == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar5;
  }
                    // WARNING: Subroutine does not return
  *(undefined8 *)(puVar13 + -0x10d0) = 0x112756;
  __stack_chk_fail();
}



int doshn(magic_set *ms,int clazz,int swap,int fd,off_t off,int num,size_t size,off_t fsize,int mach
         ,int strtab,int *flags,uint16_t *notecount)

{
  long lVar1;
  bool bVar2;
  bool bVar3;
  uint uVar4;
  Elf64_Word EVar5;
  uint32_t uVar6;
  wchar_t wVar7;
  uint uVar8;
  Elf32_Off EVar9;
  Elf32_Word EVar10;
  int iVar11;
  long lVar12;
  ssize_t sVar13;
  Elf64_Off EVar14;
  Elf64_Off EVar15;
  Elf64_Shdr *pEVar16;
  uint64_t uVar17;
  size_t size_00;
  size_t offset;
  ulong uVar18;
  __off_t _Var19;
  long lVar20;
  uint64_t uVar21;
  anon_union_8_2_f73d1a54_for_c_un aVar22;
  anon_union_8_2_f73d1a54_for_c_un aVar23;
  anon_union_8_2_f73d1a54_for_c_un aVar24;
  wchar_t *pwVar25;
  undefined1 *puVar26;
  cap_desc_t *pcVar27;
  uint32_t value;
  char *pcVar28;
  long in_FS_OFFSET;
  int local_170;
  ulong local_168;
  Elf64_Shdr *local_160;
  long local_158;
  ulong local_140;
  ulong local_130;
  ulong local_128;
  undefined8 uStack_118;
  Elf32_Cap cap32;
  Elf64_Cap cap64;
  Elf32_Shdr sh32;
  Elf64_Shdr sh64;
  char cbuf [16];
  char name [50];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  if (clazz == 1) {
    if (size == 0x28) {
      local_160 = (Elf64_Shdr *)&sh32;
      pcVar28 = (char *)local_160;
      lVar12 = __pread_chk(fd,local_160,0x28,off + (long)strtab * 0x28,0x40);
      if (0x27 < lVar12) {
        EVar9 = sh32.sh_offset;
        if (swap != 0) {
          EVar9 = getu32(sh32.sh_offset,(uint32_t)pcVar28);
        }
        local_168 = (ulong)EVar9;
        local_158 = 0x28;
        goto LAB_0011282e;
      }
LAB_00112fb0:
      file_badread(ms);
      iVar11 = -1;
      goto LAB_00112c5b;
    }
  }
  else if (size == 0x40) {
    local_160 = &sh64;
    pcVar28 = (char *)local_160;
    lVar12 = __pread_chk(fd,local_160,0x40,(long)strtab * 0x40 + off,0x40);
    if (lVar12 < 0x40) goto LAB_00112fb0;
    local_168 = sh64.sh_offset;
    if (swap != 0) {
      local_168 = getu64((int)sh64.sh_offset,(uint64_t)pcVar28);
    }
    local_158 = 0x40;
LAB_0011282e:
    if (num == 0) {
      wVar7 = file_printf(ms,", %sstripped",&DAT_0011ddf7);
      if (wVar7 != L'\xffffffff') {
        iVar11 = 0;
        goto LAB_00112c5b;
      }
    }
    else {
      local_128 = 0;
      bVar2 = true;
      local_130 = 0;
      local_140 = 0;
      local_170 = num;
      do {
        uVar4 = sh32.sh_name;
        if (clazz != 1) {
          uVar4 = sh64.sh_name;
        }
        if (swap != 0) {
          uVar4 = getu32(uVar4,(uint32_t)pcVar28);
        }
        sVar13 = pread(fd,name,0x31,uVar4 + local_168);
        if (sVar13 == -1) goto LAB_00112fb0;
        name[sVar13] = '\0';
        bVar3 = bVar2;
        if ((name._0_8_ == 0x695f67756265642e) && (bVar3 = false, name._8_4_ != 0x6f666e)) {
          bVar3 = bVar2;
        }
        bVar2 = bVar3;
        pcVar28 = (char *)local_160;
        lVar12 = __pread_chk(fd,local_160,size,off,0x40);
        if (lVar12 < local_158) goto LAB_00112fb0;
        off = off + size;
        if (clazz == 1) {
          EVar10 = sh32.sh_type;
          if (swap != 0) goto LAB_00112968;
          EVar5 = sh32.sh_type;
          if (sh32.sh_type == 2) goto LAB_00112eb8;
LAB_0011297d:
          if (fsize != -1) {
            if (clazz == 1) {
              EVar14 = (Elf64_Off)sh32.sh_offset;
              if (swap != 0) {
                uVar6 = getu32(sh32.sh_offset,(uint32_t)pcVar28);
                EVar14 = (Elf64_Off)uVar6;
              }
            }
            else {
              EVar14 = sh64.sh_offset;
              if (swap != 0) {
                EVar14 = getu64((int)sh64.sh_offset,(uint64_t)pcVar28);
              }
            }
            if (fsize < (long)EVar14) goto LAB_00112b1e;
          }
          EVar9 = sh32.sh_offset;
          iVar11 = (int)sh64.sh_offset;
          if (EVar5 == 7) {
            if (clazz == 1) {
              EVar14 = (Elf64_Off)sh32.sh_size;
              EVar15 = (Elf64_Off)sh32.sh_offset;
              if (swap != 0) {
                uVar6 = getu32(sh32.sh_size,(uint32_t)pcVar28);
                EVar14 = (Elf64_Off)uVar6;
                uVar6 = getu32(EVar9,(uint32_t)pcVar28);
                EVar15 = (Elf64_Off)uVar6;
              }
            }
            else {
              EVar14 = sh64.sh_size;
              EVar15 = sh64.sh_offset;
              if (swap != 0) {
                EVar14 = getu64((int)sh64.sh_size,(uint64_t)pcVar28);
                EVar15 = getu64(iVar11,(uint64_t)pcVar28);
              }
            }
            if ((ulong)fsize < EVar15 + EVar14) {
              wVar7 = file_printf(ms,", note offset/size 0x%jx+0x%jx exceeds file size 0x%jx",EVar15
                                  ,EVar14,fsize);
              iVar11 = -(uint)(wVar7 == L'\xffffffff');
              goto LAB_00112c5b;
            }
            pEVar16 = (Elf64_Shdr *)malloc(EVar14);
            if (pEVar16 == (Elf64_Shdr *)0x0) {
              pwVar25 = __errno_location();
              file_error(ms,*pwVar25,"Cannot allocate memory for note");
              iVar11 = -1;
              goto LAB_00112c5b;
            }
            if (clazz == 1) {
              if (swap == 0) {
                pcVar28 = (char *)pEVar16;
                sVar13 = pread(fd,pEVar16,EVar14,(ulong)sh32.sh_offset);
                uVar17 = (uint64_t)sh32.sh_size;
              }
              else {
                uVar6 = getu32(sh32.sh_offset,(uint32_t)pcVar28);
                pcVar28 = (char *)pEVar16;
                sVar13 = pread(fd,pEVar16,EVar14,(ulong)uVar6);
                uVar6 = getu32(sh32.sh_size,(uint32_t)pcVar28);
                uVar17 = (uint64_t)uVar6;
              }
            }
            else if (swap == 0) {
              pcVar28 = (char *)pEVar16;
              sVar13 = pread(fd,pEVar16,EVar14,sh64.sh_offset);
              uVar17 = sh64.sh_size;
            }
            else {
              uVar17 = getu64((int)sh64.sh_offset,(uint64_t)pcVar28);
              pcVar28 = (char *)pEVar16;
              sVar13 = pread(fd,pEVar16,EVar14,uVar17);
              uVar17 = getu64((int)sh64.sh_size,(uint64_t)pcVar28);
            }
            if (sVar13 < (long)uVar17) {
              file_badread(ms);
              free(pEVar16);
              iVar11 = -1;
              goto LAB_00112c5b;
            }
            offset = 0;
            do {
              if (clazz == 1) {
                if (swap == 0) {
                  size_00 = (ulong)sh32.sh_size;
                }
                else {
                  uVar6 = getu32(sh32.sh_size,(uint32_t)pcVar28);
                  size_00 = (ulong)uVar6;
                }
              }
              else {
                size_00 = sh64.sh_size;
                if (swap != 0) {
                  size_00 = getu64((int)sh64.sh_size,(uint64_t)pcVar28);
                }
              }
            } while (((long)offset < (long)size_00) &&
                    (pcVar28 = (char *)pEVar16,
                    offset = donote(ms,pEVar16,offset,size_00,clazz,swap,4,flags,notecount,fd,0,0,0)
                    , offset != 0));
            free(pEVar16);
          }
          else if ((((EVar5 == 0x6ffffff5) && ((uint)mach < 0x3f)) &&
                   ((1L << ((byte)mach & 0x3f) & 0x400408000000000cU) != 0)) && (local_140 < 6)) {
            if (clazz == 1) {
              if (swap != 0) {
                EVar9 = getu32(sh32.sh_offset,(uint32_t)pcVar28);
              }
              pEVar16 = (Elf64_Shdr *)(ulong)EVar9;
            }
            else {
              pEVar16 = (Elf64_Shdr *)sh64.sh_offset;
              if (swap != 0) {
                pEVar16 = (Elf64_Shdr *)getu64(iVar11,(uint64_t)pcVar28);
              }
            }
            pcVar28 = (char *)pEVar16;
            _Var19 = lseek(fd,(__off_t)pcVar28,0);
            if (_Var19 != -1) {
              uVar17 = 0;
LAB_00112d00:
              if (clazz == 1) goto LAB_00112e40;
LAB_00112d09:
              uVar17 = uVar17 + 0x10;
              EVar14 = sh64.sh_size;
              if (swap != 0) {
                EVar14 = getu64((int)sh64.sh_size,(uint64_t)pcVar28);
              }
              lVar12 = 0x10;
              do {
                if ((long)EVar14 < (long)uVar17) goto LAB_00112b1e;
                pcVar28 = cbuf;
                lVar20 = __read_chk(fd,(Elf64_Shdr *)cbuf,lVar12,0x10);
                if ((ulong)(clazz != 1) * 8 + 8 != lVar20) {
                  file_badread(ms);
                  goto LAB_0011321d;
                }
                if (cbuf[0] == 'A') goto LAB_00112b1e;
                uVar4 = (uint)lVar12;
                if (clazz == 1) {
                  *(undefined8 *)((long)&uStack_118 + lVar12) = *(undefined8 *)(cbuf + lVar12 + -8);
                  if (7 < uVar4 - 1) {
                    uVar8 = 0;
                    do {
                      uVar18 = (ulong)uVar8;
                      uVar8 = uVar8 + 8;
                      pcVar28 = *(char **)((long)&((Elf64_Shdr *)cbuf)->sh_name + uVar18);
                      *(char **)((long)&cap32.c_tag + uVar18) = pcVar28;
                    } while (uVar8 < uVar4 - 8);
                  }
                  if (swap == 0) {
                    if (cap32.c_tag == 1) {
                      aVar23.c_val._4_4_ = 0;
                      aVar23.c_val._0_4_ = cap32.c_un.c_val;
                      goto LAB_0011314d;
                    }
                    if (cap32.c_tag == 2) {
                      aVar24.c_val._4_4_ = 0;
                      aVar24.c_val._0_4_ = cap32.c_un.c_val;
                      goto LAB_0011316d;
                    }
                    uVar21 = (uint64_t)cap32.c_tag;
                    if (cap32.c_tag != 0) {
                      aVar22.c_val._4_4_ = 0;
                      aVar22.c_val._0_4_ = cap32.c_un.c_val;
                      goto LAB_00112de0;
                    }
                  }
                  else {
                    uVar6 = getu32(cap32.c_tag,(uint32_t)pcVar28);
                    value = (uint32_t)pcVar28;
                    if (uVar6 == 1) {
                      aVar23.c_val._0_4_ = getu32(cap32.c_un.c_val,value);
                      aVar23.c_val._4_4_ = 0;
                      goto LAB_0011314d;
                    }
                    if (uVar6 == 2) {
                      aVar24.c_val._0_4_ = getu32(cap32.c_un.c_val,value);
                      aVar24.c_val._4_4_ = 0;
                      goto LAB_0011316d;
                    }
                    if (uVar6 != 0) {
                      uVar21 = (uint64_t)uVar6;
                      uVar6 = getu32(cap32.c_un.c_val,value);
                      aVar22.c_val._4_4_ = 0;
                      aVar22.c_val._0_4_ = uVar6;
                      goto LAB_00112de0;
                    }
                  }
                }
                else {
                  uVar8 = 0;
                  do {
                    uVar18 = (ulong)uVar8;
                    uVar8 = uVar8 + 8;
                    pcVar28 = *(char **)((long)&((Elf64_Shdr *)cbuf)->sh_name + uVar18);
                    *(char **)((long)&cap64.c_tag + uVar18) = pcVar28;
                  } while (uVar8 < uVar4);
                  if (swap == 0) {
                    aVar23 = cap64.c_un;
                    if (cap64.c_tag == 1) goto LAB_0011314d;
                    aVar24 = cap64.c_un;
                    if (cap64.c_tag == 2) goto LAB_0011316d;
                    aVar22 = cap64.c_un;
                    uVar21 = cap64.c_tag;
                    if (cap64.c_tag == 0) goto LAB_00112d00;
                  }
                  else {
                    uVar21 = getu64((int)cap64.c_tag,(uint64_t)pcVar28);
                    iVar11 = (int)cap64.c_un.c_val;
                    if (uVar21 == 1) {
                      aVar23.c_val = getu64(iVar11,(uint64_t)pcVar28);
LAB_0011314d:
                      local_130 = local_130 | aVar23.c_val;
                      goto LAB_00112d00;
                    }
                    if (uVar21 == 2) {
                      aVar24.c_val = getu64(iVar11,(uint64_t)pcVar28);
LAB_0011316d:
                      local_128 = local_128 | aVar24.c_val;
                      goto LAB_00112d00;
                    }
                    if (uVar21 == 0) goto LAB_00112d00;
                    aVar22.c_val = getu64(iVar11,(uint64_t)pcVar28);
                  }
LAB_00112de0:
                  pcVar28 = ", with unknown capability 0x%llx = 0x%llx";
                  wVar7 = file_printf(ms,", with unknown capability 0x%llx = 0x%llx",uVar21,
                                      aVar22.c_val);
                  if (wVar7 == L'\xffffffff') goto LAB_0011321d;
                  uVar18 = local_140 + 1;
                  if (2 < local_140) {
                    if (clazz == 1) {
                      EVar10 = sh32.sh_size;
                      if (swap != 0) {
                        EVar10 = getu32(sh32.sh_size,(uint32_t)pcVar28);
                      }
                      uVar17 = (uint64_t)EVar10;
                      local_140 = uVar18;
                      goto LAB_00112e40;
                    }
                    uVar17 = sh64.sh_size;
                    if (swap != 0) {
                      uVar17 = getu64((int)sh64.sh_size,(uint64_t)pcVar28);
                    }
                  }
                  local_140 = uVar18;
                  if (clazz != 1) goto LAB_00112d09;
                }
LAB_00112e40:
                uVar17 = uVar17 + 8;
                uVar4 = sh32.sh_size;
                if (swap != 0) {
                  uVar4 = getu32(sh32.sh_size,(uint32_t)pcVar28);
                }
                EVar14 = (Elf64_Off)uVar4;
                lVar12 = 8;
              } while( true );
            }
            file_badseek(ms);
            iVar11 = -1;
            goto LAB_00112c5b;
          }
        }
        else {
          EVar10 = sh64.sh_type;
          EVar5 = sh64.sh_type;
          if (swap != 0) {
LAB_00112968:
            EVar5 = getu32(EVar10,(uint32_t)pcVar28);
          }
          if (EVar5 != 2) goto LAB_0011297d;
LAB_00112eb8:
          bVar2 = false;
        }
LAB_00112b1e:
        local_170 = local_170 + -1;
      } while (local_170 != 0);
      puVar26 = &DAT_0011ddf7;
      if (!bVar2) {
        puVar26 = &DAT_0011e299;
      }
      wVar7 = file_printf(ms,", %sstripped",puVar26);
      if (wVar7 != L'\xffffffff') {
        if (local_130 == 0) {
LAB_00112bdb:
          if (local_128 != 0) {
            if ((local_128 & 2) != 0) {
              pcVar28 = ", uses frame pointer";
              if ((local_128 & 1) == 0) {
                pcVar28 = ", not known to use frame pointer";
              }
              wVar7 = file_printf(ms,pcVar28);
              if (wVar7 == L'\xffffffff') goto LAB_0011321d;
            }
            if ((local_128 & 0xfffffffffffffffc) != 0) {
              wVar7 = file_printf(ms,", with unknown software capability 0x%llx");
              iVar11 = -(uint)(wVar7 == L'\xffffffff');
              goto LAB_00112c5b;
            }
          }
          iVar11 = 0;
          goto LAB_00112c5b;
        }
        if ((uint)mach < 0x3f) {
          uVar18 = 1L << ((byte)mach & 0x3f);
          if ((uVar18 & 0x4004000000000008) == 0) {
            if ((uVar18 & 0x80000040004) == 0) goto LAB_00112ba2;
            wVar7 = file_printf(ms,", uses");
            if (wVar7 != L'\xffffffff') {
              pcVar28 = "MUL32";
              pcVar27 = cap_desc_sparc;
              goto LAB_001132dd;
            }
          }
          else {
            wVar7 = file_printf(ms,", uses");
            if (wVar7 != L'\xffffffff') {
              pcVar28 = "FPU";
              pcVar27 = cap_desc_386;
LAB_001132dd:
              do {
                if ((pcVar27->cd_mask & local_130) != 0) {
                  wVar7 = file_printf(ms," %s",pcVar28);
                  if (wVar7 == L'\xffffffff') goto LAB_0011321d;
                  local_130 = local_130 & ~pcVar27->cd_mask;
                }
                pcVar28 = pcVar27[1].cd_name;
                pcVar27 = pcVar27 + 1;
              } while (pcVar28 != (char *)0x0);
              pcVar28 = " unknown hardware capability 0x%llx";
              if (local_130 == 0) goto LAB_00112bdb;
              goto LAB_00112bc8;
            }
          }
        }
        else {
LAB_00112ba2:
          wVar7 = file_printf(ms,", uses");
          if (wVar7 != L'\xffffffff') {
            pcVar28 = " hardware capability 0x%llx";
LAB_00112bc8:
            wVar7 = file_printf(ms,pcVar28,local_130);
            if (wVar7 != L'\xffffffff') goto LAB_00112bdb;
          }
        }
      }
    }
LAB_0011321d:
    iVar11 = -1;
    goto LAB_00112c5b;
  }
  wVar7 = file_printf(ms,", corrupted section header size");
  iVar11 = -(uint)(wVar7 == L'\xffffffff');
LAB_00112c5b:
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar11;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int file_tryelf(magic_set *ms,int fd,uchar *buf,size_t nbytes)

{
  byte bVar1;
  long lVar2;
  undefined uVar3;
  undefined uVar17;
  ushort uVar4;
  ushort uVar5;
  ushort uVar6;
  ushort uVar7;
  ushort uVar8;
  int iVar9;
  wchar_t wVar10;
  uint swap;
  uint swap_00;
  uint32_t uVar11;
  uint uVar12;
  __off_t _Var13;
  int *piVar14;
  uint64_t uVar16;
  undefined uVar20;
  ushort uVar18;
  char cVar21;
  ulong uVar19;
  ushort uVar22;
  undefined uVar24;
  uint swap_01;
  char *pcVar23;
  __off_t fsize;
  uint value;
  long in_FS_OFFSET;
  uint64_t local_108;
  uint16_t notecount;
  int flags;
  stat st;
  ulong uVar15;
  
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  flags = 0;
  if (((((ms->flags & 0x1000c10U) != 0) || (*buf != '\x7f')) || ((buf[1] != 'E' && (buf[1] != 'O')))
      ) || ((buf[2] != 'L' || (buf[3] != 'F')))) {
LAB_001133f1:
    iVar9 = 0;
    goto LAB_001133f3;
  }
  _Var13 = lseek(fd,0,0);
  if ((_Var13 == -1) && (piVar14 = __errno_location(), *piVar14 == 0x1d)) {
    fd = file_pipe2file(ms,fd,buf,nbytes);
  }
  iVar9 = __fxstat(1,fd,(stat *)&st);
  if (iVar9 == -1) {
    file_badread(ms);
    iVar9 = -1;
    goto LAB_001133f3;
  }
  fsize = st.st_size;
  if (((st.st_mode & 0xf000) != 0x8000) && (st.st_size == 0)) {
    fsize = -1;
  }
  bVar1 = buf[4];
  if (bVar1 == 1) {
    if (nbytes < 0x35) goto LAB_001133f1;
    uVar18 = *(ushort *)(buf + 0x32);
    uVar5 = *(ushort *)(buf + 0x2e);
    uVar6 = *(ushort *)(buf + 0x10);
    uVar4 = *(ushort *)(buf + 0x12);
    swap_00 = *(uint *)(buf + 0x1c);
    swap = *(uint *)(buf + 0x20);
    uVar22 = *(ushort *)(buf + 0x2a);
    uVar7 = *(ushort *)(buf + 0x2c);
    uVar19 = (ulong)uVar7;
    uVar8 = *(ushort *)(buf + 0x30);
    uVar15 = (ulong)uVar8;
    notecount = ms->elf_notes_max;
    swap_01 = (uint)(buf[5] != '\x01');
    if (buf[5] == '\x01') {
      if (3 < uVar6) {
        if (uVar6 == 4) {
          uVar12 = (uint)uVar7;
          if (uVar7 <= ms->elf_phnum_max) {
            flags = flags | 0x100;
            goto LAB_001138a9;
          }
LAB_00113bf5:
          uVar15 = (ulong)uVar12;
          pcVar23 = "program headers";
          goto LAB_0011397e;
        }
        goto LAB_0011363d;
      }
      if (uVar6 < 2) {
        if (uVar6 != 1) goto LAB_0011363d;
      }
      else {
        if (ms->elf_phnum_max < uVar7) goto LAB_00113c03;
        if (ms->elf_shnum_max < uVar8) goto LAB_00113c4c;
        iVar9 = dophn_exec(ms,1,0,fd,(ulong)swap_00,(uint)uVar7,(ulong)uVar22,fsize,(uint)uVar8,
                           &flags,&notecount);
        if (iVar9 == -1) goto LAB_00113814;
      }
      uVar12 = (uint)uVar8;
      if (ms->elf_shnum_max < uVar8) {
LAB_00113c26:
        uVar15 = (ulong)uVar12;
        pcVar23 = "section headers";
        goto LAB_0011397e;
      }
LAB_00113762:
      local_108 = (uint64_t)swap;
      iVar9 = 1;
LAB_00113628:
      iVar9 = doshn(ms,iVar9,swap_01,fd,local_108,uVar12,(ulong)uVar5,fsize,(uint)uVar4,(uint)uVar18
                    ,&flags,&notecount);
joined_r0x0011380e:
      if (iVar9 == -1) {
LAB_00113814:
        iVar9 = -1;
        goto LAB_001133f3;
      }
      goto LAB_0011363d;
    }
    uVar6 = CONCAT11((char)uVar6,(char)(uVar6 >> 8));
    uVar20 = (undefined)(uVar7 >> 8);
    value = (uint)uVar22;
    uVar24 = (undefined)(uVar22 >> 8);
    if (3 < uVar6) {
      if (uVar6 != 4) goto LAB_0011363d;
      uVar6 = CONCAT11((char)uVar7,uVar20);
      if (ms->elf_phnum_max < uVar6) {
LAB_00113bf2:
        uVar12 = (uint)uVar6;
        goto LAB_00113bf5;
      }
      flags = flags | 0x100;
      uVar12 = (uint)uVar6;
      uVar22 = CONCAT11((char)uVar22,uVar24);
      swap_00 = getu32(swap_00,value);
LAB_001138a9:
      uVar16 = (uint64_t)swap_00;
      iVar9 = 1;
LAB_001137ff:
      iVar9 = dophn_core(ms,iVar9,swap_01,fd,uVar16,uVar12,(ulong)uVar22,fsize,&flags,&notecount);
      goto joined_r0x0011380e;
    }
    uVar3 = (undefined)(uVar8 >> 8);
    if (uVar6 < 2) {
      if (uVar6 != 1) goto LAB_0011363d;
LAB_001136e2:
      uVar6 = CONCAT11((char)uVar8,uVar3);
      if (ms->elf_shnum_max < uVar6) {
        uVar12 = (uint)uVar6;
        goto LAB_00113c26;
      }
      uVar12 = (uint)uVar6;
      uVar18 = CONCAT11((char)uVar18,(char)(uVar18 >> 8));
      uVar4 = CONCAT11((char)uVar4,(char)(uVar4 >> 8));
      cVar21 = (char)(uVar5 >> 8);
      uVar5 = CONCAT11((char)uVar5,cVar21);
      swap = getu32(swap,(int)cVar21);
      goto LAB_00113762;
    }
    uVar6 = CONCAT11((char)uVar7,uVar20);
    uVar19 = (ulong)uVar6;
    if (uVar6 <= ms->elf_phnum_max) {
      uVar7 = CONCAT11((char)uVar8,uVar3);
      uVar15 = (ulong)(uint)uVar7;
      if (ms->elf_shnum_max < uVar7) {
LAB_00113c4c:
        pcVar23 = "section";
        goto LAB_0011397e;
      }
      uVar11 = getu32(swap_00,value);
      iVar9 = dophn_exec(ms,1,1,fd,(ulong)uVar11,(uint)uVar6,(ulong)CONCAT11((char)uVar22,uVar24),
                         fsize,(uint)uVar7,&flags,&notecount);
      if (iVar9 != -1) goto LAB_001136e2;
      goto LAB_00113814;
    }
LAB_00113c03:
    pcVar23 = "program";
    uVar15 = uVar19;
  }
  else {
    if (bVar1 != 2) {
      wVar10 = file_printf(ms,", unknown class %d",(ulong)bVar1);
      iVar9 = -(uint)(wVar10 == L'\xffffffff');
      goto LAB_001133f3;
    }
    if (nbytes < 0x41) goto LAB_001133f1;
    local_108 = *(uint64_t *)(buf + 0x28);
    uVar6 = *(ushort *)(buf + 0x10);
    uVar4 = *(ushort *)(buf + 0x12);
    uVar16 = *(uint64_t *)(buf + 0x20);
    uVar22 = *(ushort *)(buf + 0x36);
    uVar15 = (ulong)uVar22;
    uVar5 = *(ushort *)(buf + 0x3a);
    uVar7 = *(ushort *)(buf + 0x38);
    uVar19 = (ulong)uVar7;
    uVar8 = *(ushort *)(buf + 0x3c);
    uVar18 = *(ushort *)(buf + 0x3e);
    notecount = ms->elf_notes_max;
    swap_01 = (uint)(buf[5] != '\x01');
    if (buf[5] == '\x01') {
      if (uVar6 < 4) {
        if (uVar6 < 2) {
          if (uVar6 != 1) goto LAB_0011363d;
        }
        else {
          if (ms->elf_phnum_max < uVar7) goto LAB_00113c03;
          if (ms->elf_shnum_max < uVar8) goto LAB_00113c3a;
          iVar9 = dophn_exec(ms,2,0,fd,uVar16,(uint)uVar7,uVar15,fsize,(uint)uVar8,&flags,&notecount
                            );
          if (iVar9 == -1) goto LAB_00113814;
        }
        if (ms->elf_shnum_max < uVar8) goto LAB_00113c13;
        goto LAB_00113606;
      }
      if (uVar6 == 4) {
        uVar12 = (uint)uVar7;
        if (ms->elf_phnum_max < uVar7) goto LAB_00113bf5;
        flags = flags | 0x100;
        goto LAB_001137e2;
      }
    }
    else {
      uVar6 = CONCAT11((char)uVar6,(char)(uVar6 >> 8));
      uVar20 = (undefined)(uVar7 >> 8);
      uVar24 = (undefined)(uVar22 >> 8);
      if (uVar6 < 4) {
        uVar3 = (undefined)uVar8;
        uVar17 = (undefined)(uVar8 >> 8);
        if (uVar6 < 2) {
          if (uVar6 != 1) goto LAB_0011363d;
        }
        else {
          uVar6 = CONCAT11((char)uVar7,uVar20);
          uVar19 = (ulong)uVar6;
          if (ms->elf_phnum_max < uVar6) goto LAB_00113c03;
          uVar8 = CONCAT11(uVar3,uVar17);
          if (ms->elf_shnum_max < uVar8) {
LAB_00113c3a:
            pcVar23 = "section";
            uVar15 = (ulong)uVar8;
            goto LAB_0011397e;
          }
          uVar16 = getu64((int)uVar16,uVar15);
          iVar9 = dophn_exec(ms,2,1,fd,uVar16,(uint)uVar6,(ulong)CONCAT11((char)uVar22,uVar24),fsize
                             ,(uint)uVar8,&flags,&notecount);
          if (iVar9 == -1) goto LAB_00113814;
        }
        uVar8 = CONCAT11(uVar3,uVar17);
        if (ms->elf_shnum_max < uVar8) {
LAB_00113c13:
          pcVar23 = "section headers";
          uVar15 = (ulong)uVar8;
          goto LAB_0011397e;
        }
        uVar18 = CONCAT11((char)uVar18,(char)(uVar18 >> 8));
        uVar4 = CONCAT11((char)uVar4,(char)(uVar4 >> 8));
        cVar21 = (char)(uVar5 >> 8);
        uVar5 = CONCAT11((char)uVar5,cVar21);
        local_108 = getu64((int)local_108,(ulong)(uint)(int)cVar21);
LAB_00113606:
        uVar12 = (uint)uVar8;
        iVar9 = 2;
        goto LAB_00113628;
      }
      if (uVar6 == 4) {
        uVar6 = CONCAT11((char)uVar7,uVar20);
        if (ms->elf_phnum_max < uVar6) goto LAB_00113bf2;
        flags = flags | 0x100;
        uVar12 = (uint)uVar6;
        uVar22 = CONCAT11((char)uVar22,uVar24);
        uVar16 = getu64((int)uVar16,uVar15);
LAB_001137e2:
        iVar9 = 2;
        goto LAB_001137ff;
      }
    }
LAB_0011363d:
    if (notecount != 0) {
      iVar9 = 1;
      goto LAB_001133f3;
    }
    pcVar23 = "notes";
    uVar15 = (ulong)ms->elf_notes_max;
  }
LAB_0011397e:
  wVar10 = file_printf(ms,", too many %s (%u)",pcVar23,uVar15);
  iVar9 = -(uint)(wVar10 == L'\xffffffff');
LAB_001133f3:
  if (lVar2 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar9;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void file_magwarn(magic_set *ms,char *f,...)

{
  long lVar1;
  char in_AL;
  undefined8 in_RCX;
  undefined8 in_RDX;
  undefined8 in_R8;
  undefined8 in_R9;
  long in_FS_OFFSET;
  undefined8 in_XMM0_Qa;
  undefined8 in_XMM1_Qa;
  undefined8 in_XMM2_Qa;
  undefined8 in_XMM3_Qa;
  undefined8 in_XMM4_Qa;
  undefined8 in_XMM5_Qa;
  undefined8 in_XMM6_Qa;
  undefined8 in_XMM7_Qa;
  va_list va;
  undefined local_c8 [16];
  undefined8 local_b8;
  undefined8 local_b0;
  undefined8 local_a8;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_88;
  undefined8 local_78;
  undefined8 local_68;
  undefined8 local_58;
  undefined8 local_48;
  undefined8 local_38;
  undefined8 local_28;
  
  if (in_AL != '\0') {
    local_98 = in_XMM0_Qa;
    local_88 = in_XMM1_Qa;
    local_78 = in_XMM2_Qa;
    local_68 = in_XMM3_Qa;
    local_58 = in_XMM4_Qa;
    local_48 = in_XMM5_Qa;
    local_38 = in_XMM6_Qa;
    local_28 = in_XMM7_Qa;
  }
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  local_b8 = in_RDX;
  local_b0 = in_RCX;
  local_a8 = in_R8;
  local_a0 = in_R9;
  fflush(_stdout);
  if (ms->file != (char *)0x0) {
    __fprintf_chk(_stderr,1,"%s, %lu: ",ms->file,ms->line);
  }
  fwrite("Warning: ",1,9,_stderr);
  va[0].overflow_arg_area = &stack0x00000008;
  va[0].gp_offset = 0x10;
  va[0].reg_save_area = local_c8;
  va[0].fp_offset = 0x30;
  __vfprintf_chk(_stderr,1,f,va);
  fputc(10,_stderr);
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



char * file_fmttime(uint64_t v,int flags,char *buf)

{
  long lVar1;
  tm *__tp;
  char *__s;
  size_t sVar2;
  long in_FS_OFFSET;
  time_t t;
  tm tmz;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  t = v;
  if ((flags & 2U) != 0) {
    cdf_timestamp_to_timespec((timespec *)&tmz,v);
    t._0_4_ = tmz.tm_sec;
    t._4_4_ = tmz.tm_min;
  }
  if ((flags & 1U) == 0) {
    __tp = gmtime_r(&t,(tm *)&tmz);
  }
  else {
    __tp = localtime_r(&t,(tm *)&tmz);
  }
  if ((__tp == (tm *)0x0) || (__s = asctime_r(__tp,buf), __s == (char *)0x0)) {
    builtin_strncpy(buf,"*Invalid time*",0xf);
  }
  else {
    sVar2 = strcspn(__s,"\n");
    __s[sVar2] = '\0';
    buf = __s;
  }
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return buf;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Type propagation algorithm not settling
// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void file_mdump(magic *m)

{
  long lVar1;
  byte bVar2;
  uint uVar3;
  char *pcVar4;
  char *pcVar5;
  int flags;
  uint64_t v;
  long in_FS_OFFSET;
  double dVar6;
  char tbuf [26];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  __fprintf_chk(_stderr,1,"%u: %.*s %u",m->lineno,(m->cont_level & 7) + 1,">>>>>>>>",m->offset);
  bVar2 = m->flag;
  if ((bVar2 & 1) != 0) {
    pcVar4 = "*bad in_type*";
    if ((ulong)m->in_type < 0x31) {
      pcVar4 = *(char **)(file_names + (ulong)m->in_type * 8);
    }
    __fprintf_chk(_stderr,1,&DAT_0011e88b,pcVar4);
    bVar2 = m->in_op;
    if ((bVar2 & 0x40) != 0) {
      fputc(0x7e,_stderr);
      bVar2 = m->in_op;
    }
    __fprintf_chk(_stderr,1,&DAT_0011e890,(int)"&|^+-*/%"[bVar2 & 7],m->in_offset);
    bVar2 = m->flag;
  }
  pcVar4 = "*bad type";
  if ((ulong)m->type < 0x31) {
    pcVar4 = *(char **)(file_names + (ulong)m->type * 8);
  }
  pcVar5 = "u";
  if ((bVar2 & 8) == 0) {
    pcVar5 = "";
  }
  __fprintf_chk(_stderr,1,&DAT_0011e897,pcVar5,pcVar4);
  if ((m->mask_op & 0x40) != 0) {
    fputc(0x7e,_stderr);
  }
  if ((m->type < 0x2f) && ((0x6200001e2020U >> ((ulong)m->type & 0x3f) & 1) != 0)) {
    if ((m->_u)._s._flags != 0) {
      fputc(0x2f,_stderr);
      uVar3 = (m->_u)._s._flags;
      if ((uVar3 & 1) != 0) {
        fputc(0x57,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 2) != 0) {
        fputc(0x77,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 4) != 0) {
        fputc(99,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 8) != 0) {
        fputc(0x43,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x10) != 0) {
        fputc(0x73,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x20) != 0) {
        fputc(0x74,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x40) != 0) {
        fputc(0x62,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x80) != 0) {
        fputc(0x42,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x100) != 0) {
        fputc(0x48,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x200) != 0) {
        fputc(0x68,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x400) != 0) {
        fputc(0x4c,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x800) != 0) {
        fputc(0x6c,_stderr);
        uVar3 = (m->_u)._s._flags;
      }
      if ((uVar3 & 0x1000) != 0) {
        fputc(0x4a,_stderr);
      }
    }
    if ((m->_u)._s._count != 0) {
      __fprintf_chk(_stderr,1,&DAT_0011e89d);
    }
  }
  else {
    fputc((int)"&|^+-*/%"[m->mask_op & 7],_stderr);
    if ((m->_u)._mask != 0) {
      __fprintf_chk(_stderr,1,"%.8llx");
    }
  }
  __fprintf_chk(_stderr,1,&DAT_0011e8a8,m->reln);
  if (m->reln == 'x') goto switchD_00114069_caseD_3;
  if (false) {
switchD_00114069_caseD_0:
    __fprintf_chk(_stderr,1,"*bad type %d*");
    goto switchD_00114069_caseD_3;
  }
  switch(m->type) {
  default:
    goto switchD_00114069_caseD_0;
  case '\x01':
  case '\x02':
  case '\x04':
  case '\a':
  case '\b':
  case '\n':
  case '\v':
  case '\x17':
  case ')':
    __fprintf_chk(_stderr,1,"%d",(m->value).l);
    break;
  case '\x03':
    break;
  case '\x05':
  case '\r':
  case '\x11':
  case '\x12':
  case '\x13':
  case '\x14':
    file_showstr((FILE *)_stderr,(m->value).s,(ulong)m->vallen);
    break;
  case '\x06':
  case '\t':
  case '\f':
  case '\x15':
    v = (uint64_t)(m->value).l;
    flags = 0;
    goto LAB_00114078;
  case '\x0e':
  case '\x0f':
  case '\x10':
  case '\x16':
    v = (uint64_t)(m->value).l;
    goto LAB_001141f6;
  case '\x18':
  case '\x19':
  case '\x1a':
    __fprintf_chk(_stderr,1,&DAT_0011e8ac,(m->value).q);
    break;
  case '\x1b':
  case '\x1c':
  case '\x1d':
    v = (m->value).q;
    flags = 0;
    goto LAB_00114078;
  case '\x1e':
  case '\x1f':
  case ' ':
    v = (m->value).q;
LAB_001141f6:
    flags = 1;
    goto LAB_00114078;
  case '!':
  case '\"':
  case '#':
    dVar6 = (double)(m->value).f;
    goto LAB_00114225;
  case '$':
  case '%':
  case '&':
    dVar6 = (double)(m->value).q;
LAB_00114225:
    __fprintf_chk(dVar6,_stderr,1,&DAT_0011e8b1);
    break;
  case '*':
  case '+':
  case ',':
    v = (m->value).q;
    flags = 2;
LAB_00114078:
    pcVar4 = file_fmttime(v,flags,tbuf);
    __fprintf_chk(_stderr,1,&DAT_0011e88c,pcVar4);
    break;
  case '-':
  case '.':
  case '0':
    __fprintf_chk(_stderr,1,"\'%s\'",&m->value);
  }
switchD_00114069_caseD_3:
  __fprintf_chk(_stderr,1,",\"%s\"]\n",m->desc);
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int bad_link(magic_set *ms,int err,char *buf)

{
  uint uVar1;
  wchar_t wVar2;
  
  uVar1 = ms->flags;
  if (((uVar1 & 0x10) != 0) && (wVar2 = file_printf(ms,"inode/symlink"), wVar2 == L'\xffffffff')) {
    return -1;
  }
  if ((uVar1 & 0x410) == 0) {
    if ((*(byte *)((long)&ms->flags + 1) & 2) != 0) {
      file_error(ms,err,"broken symbolic link to %s",buf);
      return -1;
    }
    wVar2 = file_printf(ms,"broken symbolic link to %s",buf);
    if (wVar2 == L'\xffffffff') {
      return -1;
    }
  }
  return 1;
}



int handle_mime(magic_set *ms,int mime,char *str)

{
  int iVar1;
  wchar_t wVar2;
  
  if ((mime & 0x10U) == 0) {
    if ((mime & 0x400U) != 0) {
LAB_0011457e:
      wVar2 = file_printf(ms,"binary");
      return -(uint)(wVar2 == L'\xffffffff');
    }
LAB_00114545:
    iVar1 = 0;
  }
  else {
    wVar2 = file_printf(ms,"inode/%s");
    if (wVar2 != L'\xffffffff') {
      if ((mime & 0x400U) == 0) goto LAB_00114545;
      wVar2 = file_printf(ms,"; charset=");
      if (wVar2 != L'\xffffffff') goto LAB_0011457e;
    }
    iVar1 = -1;
  }
  return iVar1;
}



int file_fsmagic(magic_set *ms,char *fn,stat *sb)

{
  byte bVar1;
  ulong uVar2;
  undefined *puVar3;
  int iVar4;
  wchar_t wVar5;
  uint uVar6;
  uint uVar7;
  wchar_t *pwVar8;
  char *pcVar9;
  ssize_t sVar10;
  char *pcVar11;
  int *piVar12;
  uint uVar13;
  undefined *puVar14;
  char *pcVar15;
  uint uVar16;
  uint uVar17;
  long in_FS_OFFSET;
  stat tstatbuf;
  char buf [8196];
  char buf2 [16388];
  
  puVar3 = &stack0xffffffffffffffd0;
  do {
    puVar14 = puVar3;
    *(undefined8 *)(puVar14 + -0x1000) = *(undefined8 *)(puVar14 + -0x1000);
    puVar3 = puVar14 + -0x1000;
  } while (puVar14 + -0x1000 != buf + 0x28);
  uVar13 = ms->flags;
  *(undefined8 *)(puVar14 + 0x4ff0) = *(undefined8 *)(in_FS_OFFSET + 0x28);
  if (((uVar13 & 0x1000800) != 0) || (fn == (char *)0x0)) {
    uVar16 = 0;
    goto LAB_00114663;
  }
  if ((uVar13 & 2) == 0) {
    *(undefined8 *)(puVar14 + -0x10d0) = 0x114695;
    iVar4 = __lxstat(1,fn,(stat *)sb);
  }
  else {
    *(undefined8 *)(puVar14 + -0x10d0) = 0x114621;
    iVar4 = __xstat(1,fn,(stat *)sb);
  }
  if (iVar4 != 0) {
    *(undefined8 *)(puVar14 + -0x10d0) = 0x11462e;
    pwVar8 = __errno_location();
    wVar5 = *pwVar8;
    if ((*(byte *)((long)&ms->flags + 1) & 2) == 0) {
      *(undefined8 *)(puVar14 + -0x10d0) = 0x11463f;
      pcVar9 = strerror(wVar5);
      *(undefined8 *)(puVar14 + -0x10d0) = 0x114659;
      wVar5 = file_printf(ms,"cannot open `%s\' (%s)",fn,pcVar9);
      uVar16 = -(uint)(wVar5 == L'\xffffffff');
    }
    else {
      uVar16 = 0xffffffff;
      *(undefined8 *)(puVar14 + -0x10d0) = 0x114d2c;
      file_error(ms,wVar5,"cannot stat `%s\'",fn);
    }
    goto LAB_00114663;
  }
  uVar7 = sb->st_mode;
  uVar13 = uVar13 & 0x410;
  uVar16 = 0;
  if (uVar13 == 0) {
    if ((uVar7 & 0x800) == 0) {
      if ((uVar7 & 0x400) == 0) {
        uVar17 = 1;
        pcVar9 = "";
        if ((uVar7 & 0x200) == 0) {
          uVar6 = uVar7 & 0xf000;
          if (uVar6 == 0x4000) {
LAB_00114787:
            pcVar15 = "%sdirectory";
          }
          else {
            if (0x4000 < uVar6) {
              uVar17 = uVar16;
              if (uVar6 == 0xa000) goto LAB_00114963;
              if (0xa000 < uVar6) {
                if (uVar6 != 0xc000) goto LAB_00114a50;
                goto LAB_001148b9;
              }
              if (uVar6 != 0x6000) goto LAB_001147b0;
              uVar17 = ms->flags & 8;
              if (uVar17 != 0) goto LAB_00114663;
              goto LAB_00114ba1;
            }
            if (uVar6 != 0x1000) {
              if (uVar6 != 0x2000) goto LAB_00114a50;
              uVar17 = ms->flags & 8;
              if (uVar17 != 0) goto LAB_00114663;
              goto LAB_00114b34;
            }
            bVar1 = *(byte *)&ms->flags;
joined_r0x00114c20:
            if ((bVar1 & 8) != 0) goto LAB_001146f1;
            pcVar15 = "%sfifo (named pipe)";
          }
          goto LAB_00114791;
        }
LAB_00114738:
        *(undefined8 *)(puVar14 + -0x10d0) = 0x114749;
        wVar5 = file_printf(ms,"%ssticky",pcVar9);
        if (wVar5 != L'\xffffffff') {
          uVar7 = sb->st_mode;
          goto LAB_00114752;
        }
      }
      else {
        uVar17 = 1;
        pcVar9 = "";
LAB_0011483d:
        *(undefined8 *)(puVar14 + -0x10d0) = 0x11484e;
        wVar5 = file_printf(ms,"%ssetgid",pcVar9);
        if (wVar5 != L'\xffffffff') {
          uVar7 = sb->st_mode;
          goto LAB_0011485b;
        }
      }
    }
    else {
      *(undefined8 *)(puVar14 + -0x10d0) = 0x114928;
      wVar5 = file_printf(ms,"%ssetuid",&DAT_0011ddf7);
      if (wVar5 != L'\xffffffff') {
        uVar7 = sb->st_mode;
        uVar17 = 2;
        pcVar9 = ", ";
        if ((uVar7 & 0x400) != 0) goto LAB_0011483d;
        uVar17 = 1;
LAB_0011485b:
        if ((uVar7 & 0x200) != 0) {
          uVar17 = uVar17 + 1;
          pcVar9 = ", ";
          goto LAB_00114738;
        }
LAB_00114752:
        uVar7 = uVar7 & 0xf000;
        if (uVar7 != 0x6000) {
          if (uVar7 < 0x6001) {
            if (uVar7 == 0x2000) {
              if ((*(byte *)&ms->flags & 8) == 0) {
LAB_00114b34:
                uVar2 = sb->st_rdev;
                fn = (char *)(ulong)((uint)(uVar2 >> 0x20) & 0xfffff000 | (uint)(uVar2 >> 8) & 0xfff
                                    );
                pcVar9 = "";
                if (uVar17 != 0) {
                  pcVar9 = ", ";
                }
                pcVar15 = (char *)(ulong)((uint)uVar2 & 0xff | (uint)((uVar2 >> 0x14) << 8));
                pcVar11 = "%scharacter special (%ld/%ld)";
                goto LAB_00114af0;
              }
              goto LAB_001148ed;
            }
            pcVar9 = ", ";
            if (uVar7 == 0x4000) goto LAB_00114787;
            if (uVar7 == 0x1000) {
              pcVar9 = ", ";
              bVar1 = *(byte *)&ms->flags;
              goto joined_r0x00114c20;
            }
          }
          else {
            if (uVar7 == 0xa000) goto LAB_00114963;
            pcVar9 = ", ";
            if (uVar7 == 0xc000) {
LAB_001148b9:
              pcVar15 = "%ssocket";
              goto LAB_00114791;
            }
            if (uVar7 == 0x8000) {
              if ((*(byte *)&ms->flags & 8) == 0) {
                if (sb->st_size == 0) goto LAB_00114c10;
                if (uVar17 == 0) goto LAB_00114663;
              }
              goto LAB_001148ed;
            }
          }
LAB_00114a50:
          *(undefined8 *)(puVar14 + -0x10d0) = 0x114a63;
          file_error(ms,L'\0',"invalid mode 0%o");
          uVar16 = 0xffffffff;
          goto LAB_00114663;
        }
        if ((*(byte *)&ms->flags & 8) != 0) {
LAB_001148ed:
          *(undefined8 *)(puVar14 + -0x10d0) = 0x114901;
          wVar5 = file_printf(ms," ");
          uVar16 = -(uint)(wVar5 == L'\xffffffff');
          goto LAB_00114663;
        }
LAB_00114ba1:
        uVar2 = sb->st_rdev;
        fn = (char *)(ulong)((uint)(uVar2 >> 0x20) & 0xfffff000 | (uint)(uVar2 >> 8) & 0xfff);
        pcVar9 = "";
        if (uVar17 != 0) {
          pcVar9 = ", ";
        }
        pcVar15 = (char *)(ulong)((uint)uVar2 & 0xff | (uint)((uVar2 >> 0x14) << 8));
        pcVar11 = "%sblock special (%ld/%ld)";
LAB_00114af0:
        *(undefined8 *)(puVar14 + -0x10d0) = 0x114afa;
        wVar5 = file_printf(ms,pcVar11,pcVar9,fn,pcVar15);
        if (wVar5 == L'\xffffffff') goto LAB_001147a4;
        goto LAB_001146f1;
      }
    }
  }
  else {
    uVar6 = uVar7 & 0xf000;
    if (uVar6 == 0x6000) {
      if ((*(byte *)&ms->flags & 8) != 0) goto LAB_00114663;
      pcVar9 = "blockdevice";
LAB_001146de:
      *(undefined8 *)(puVar14 + -0x10d0) = 0x1146e8;
      wVar5 = handle_mime(ms,uVar13,pcVar9);
    }
    else {
      if (uVar6 < 0x6001) {
        if (uVar6 == 0x2000) {
          if ((*(byte *)&ms->flags & 8) != 0) goto LAB_00114663;
          pcVar9 = "chardevice";
        }
        else {
          pcVar9 = "directory";
          if (uVar6 != 0x4000) {
            if (uVar6 != 0x1000) goto LAB_00114a50;
            if ((*(byte *)&ms->flags & 8) != 0) goto LAB_001146f1;
            pcVar9 = "fifo";
          }
        }
        goto LAB_001146de;
      }
      uVar17 = uVar16;
      if (uVar6 == 0xa000) {
LAB_00114963:
        pcVar9 = puVar14 + -0x1028;
        *(undefined8 *)(puVar14 + -0x10d0) = 0x11497b;
        sVar10 = readlink(fn,pcVar9,0x1fff);
        if (sVar10 < 1) {
          if ((*(byte *)((long)&ms->flags + 1) & 2) != 0) {
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114d5c;
            pwVar8 = __errno_location();
            wVar5 = *pwVar8;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114d72;
            file_error(ms,wVar5,"unreadable symlink `%s\'",fn);
            goto LAB_001147a4;
          }
          if (uVar13 == 0) {
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114ac7;
            piVar12 = __errno_location();
            iVar4 = *piVar12;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114ace;
            pcVar15 = strerror(iVar4);
            pcVar9 = "";
            pcVar11 = "%sunreadable symlink `%s\' (%s)";
            if (uVar17 != 0) {
              pcVar9 = ", ";
            }
            goto LAB_00114af0;
          }
LAB_00114c04:
          pcVar9 = "symlink";
          goto LAB_001146de;
        }
        puVar14[sVar10 + -0x1028] = 0;
        if (puVar14[-0x1028] == '/') {
          *(undefined8 *)(puVar14 + -0x10d0) = 0x114cc7;
          iVar4 = __xstat(1,pcVar9,(stat *)(puVar14 + -0x10b8));
joined_r0x00114cc9:
          if (iVar4 < 0) {
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114cd0;
            piVar12 = __errno_location();
            iVar4 = *piVar12;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114cdd;
            uVar16 = bad_link(ms,iVar4,pcVar9);
            goto LAB_00114663;
          }
          uVar16 = ms->flags & 2;
          if (uVar16 != 0) {
            ms->flags = uVar16;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114cf3;
            pcVar9 = magic_file(ms,pcVar9);
            ms->flags = ms->flags | 2;
            if (pcVar9 != (char *)0x0) goto LAB_001146f1;
            goto LAB_001147a4;
          }
          if (uVar13 != 0) goto LAB_00114c04;
          pcVar15 = "";
          pcVar11 = "%ssymbolic link to %s";
          if (uVar17 != 0) {
            pcVar15 = ", ";
          }
        }
        else {
          *(undefined8 *)(puVar14 + -0x10d0) = 0x1149a7;
          pcVar11 = strrchr(fn,0x2f);
          pcVar15 = pcVar9;
          if (pcVar11 == (char *)0x0) {
LAB_00114c6e:
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114c7d;
            iVar4 = __xstat(1,pcVar15,(stat *)(puVar14 + -0x10b8));
            goto joined_r0x00114cc9;
          }
          if ((long)pcVar11 - (long)fn < 0x2000) {
            *(undefined **)(puVar14 + -0x10c0) = puVar14 + 0xfe8;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114c48;
            strlcpy(puVar14 + 0xfe8,fn,0x4004);
            pcVar15 = *(char **)(puVar14 + -0x10c0);
            puVar14[((long)pcVar11 - (long)fn) + 0xfe9] = 0;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114c66;
            strlcat(pcVar15,pcVar9,0x4004);
            pcVar15 = *(char **)(puVar14 + -0x10c0);
            goto LAB_00114c6e;
          }
          if ((*(byte *)((long)&ms->flags + 1) & 2) != 0) {
            uVar16 = 0xffffffff;
            *(undefined8 *)(puVar14 + -0x10d0) = 0x114d4d;
            file_error(ms,L'\0',"path too long: `%s\'",pcVar9);
            goto LAB_00114663;
          }
          pcVar9 = "x-path-too-long";
          if (uVar13 != 0) goto LAB_001146de;
          pcVar15 = "";
          pcVar11 = "%spath too long: `%s\'";
          pcVar9 = fn;
          if (uVar17 != 0) {
            pcVar15 = ", ";
          }
        }
        *(undefined8 *)(puVar14 + -0x10d0) = 0x114a04;
        wVar5 = file_printf(ms,pcVar11,pcVar15,pcVar9);
      }
      else {
        pcVar9 = "socket";
        if (uVar6 == 0xc000) goto LAB_001146de;
LAB_001147b0:
        if ((uVar7 & 0xf000) != 0x8000) goto LAB_00114a50;
        if (((*(byte *)&ms->flags & 8) != 0) || (sb->st_size != 0)) goto LAB_00114663;
        pcVar9 = "";
        if (uVar13 != 0) {
          pcVar9 = "x-empty";
          goto LAB_001146de;
        }
LAB_00114c10:
        pcVar15 = "%sempty";
LAB_00114791:
        *(undefined8 *)(puVar14 + -0x10d0) = 0x11479b;
        wVar5 = file_printf(ms,pcVar15,pcVar9);
      }
    }
    if (wVar5 != L'\xffffffff') {
LAB_001146f1:
      uVar16 = 1;
      goto LAB_00114663;
    }
  }
LAB_001147a4:
  uVar16 = 0xffffffff;
LAB_00114663:
  if (*(long *)(puVar14 + 0x4ff0) == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar16;
  }
                    // WARNING: Subroutine does not return
  *(undefined8 *)(puVar14 + -0x10d0) = 0x114d57;
  __stack_chk_fail();
}



wchar_t file_regexec(file_regex_t *rx,char *str,size_t nmatch,regmatch_t *pmatch,wchar_t eflags)

{
                    // WARNING: Subroutine does not return
  __assert_fail("rx->rc == 0","funcs.c",0x1fe,"file_regexec");
}



void file_error(magic_set *ms,wchar_t error,char *f,...)

{
  long lVar1;
  char in_AL;
  char *pcVar2;
  undefined8 in_RCX;
  undefined8 in_R8;
  undefined8 in_R9;
  long in_FS_OFFSET;
  undefined8 in_XMM0_Qa;
  undefined8 in_XMM1_Qa;
  undefined8 in_XMM2_Qa;
  undefined8 in_XMM3_Qa;
  undefined8 in_XMM4_Qa;
  undefined8 in_XMM5_Qa;
  undefined8 in_XMM6_Qa;
  undefined8 in_XMM7_Qa;
  va_list va;
  undefined local_c8 [24];
  undefined8 local_b0;
  undefined8 local_a8;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_88;
  undefined8 local_78;
  undefined8 local_68;
  undefined8 local_58;
  undefined8 local_48;
  undefined8 local_38;
  undefined8 local_28;
  
  if (in_AL != '\0') {
    local_98 = in_XMM0_Qa;
    local_88 = in_XMM1_Qa;
    local_78 = in_XMM2_Qa;
    local_68 = in_XMM3_Qa;
    local_58 = in_XMM4_Qa;
    local_48 = in_XMM5_Qa;
    local_38 = in_XMM6_Qa;
    local_28 = in_XMM7_Qa;
  }
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  va[0].overflow_arg_area = &stack0x00000008;
  va[0].gp_offset = 0x18;
  va[0].reg_save_area = local_c8;
  va[0].fp_offset = 0x30;
  local_b0 = in_RCX;
  local_a8 = in_R8;
  local_a0 = in_R9;
  if ((*(byte *)&ms->event_flags & 1) == 0) {
    pcVar2 = (ms->o).buf;
    if ((pcVar2 != (char *)0x0) && (*pcVar2 != '\0')) {
      file_printf(ms," ");
    }
    file_vprintf(ms,f,va);
    if (L'\0' < error) {
      pcVar2 = strerror(error);
      file_printf(ms," (%s)",pcVar2);
    }
    ms->event_flags = ms->event_flags | 1;
    ms->error = error;
  }
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t file_vprintf(magic_set *ms,char *fmt,__va_list_tag *ap)

{
  int iVar1;
  wchar_t *pwVar2;
  wchar_t wVar3;
  long in_FS_OFFSET;
  char *local_30;
  char *newstr;
  long local_20;
  
  local_20 = *(long *)(in_FS_OFFSET + 0x28);
  if ((ms->event_flags & 1U) != 0) {
    wVar3 = L'\0';
    goto LAB_00114f09;
  }
  iVar1 = __vasprintf_chk(&local_30,1,fmt,ap);
  if (iVar1 < 0) {
LAB_00114f99:
    pwVar2 = __errno_location();
    wVar3 = L'\xffffffff';
    file_error(ms,*pwVar2,"vasprintf failed");
  }
  else {
    if ((ms->o).buf != (char *)0x0) {
      iVar1 = __asprintf_chk(&newstr,1,&DAT_0011e898);
      free(local_30);
      if (iVar1 < 0) goto LAB_00114f99;
      free((ms->o).buf);
      local_30 = newstr;
    }
    (ms->o).buf = local_30;
    wVar3 = L'\0';
  }
LAB_00114f09:
  if (local_20 == *(long *)(in_FS_OFFSET + 0x28)) {
    return wVar3;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t file_printf(magic_set *ms,char *fmt,...)

{
  long lVar1;
  char in_AL;
  wchar_t wVar2;
  undefined8 in_RCX;
  undefined8 in_RDX;
  undefined8 in_R8;
  undefined8 in_R9;
  long in_FS_OFFSET;
  undefined8 in_XMM0_Qa;
  undefined8 in_XMM1_Qa;
  undefined8 in_XMM2_Qa;
  undefined8 in_XMM3_Qa;
  undefined8 in_XMM4_Qa;
  undefined8 in_XMM5_Qa;
  undefined8 in_XMM6_Qa;
  undefined8 in_XMM7_Qa;
  va_list ap;
  undefined local_b8 [16];
  undefined8 local_a8;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_90;
  undefined8 local_88;
  undefined8 local_78;
  undefined8 local_68;
  undefined8 local_58;
  undefined8 local_48;
  undefined8 local_38;
  undefined8 local_28;
  undefined8 local_18;
  
  if (in_AL != '\0') {
    local_88 = in_XMM0_Qa;
    local_78 = in_XMM1_Qa;
    local_68 = in_XMM2_Qa;
    local_58 = in_XMM3_Qa;
    local_48 = in_XMM4_Qa;
    local_38 = in_XMM5_Qa;
    local_28 = in_XMM6_Qa;
    local_18 = in_XMM7_Qa;
  }
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  ap[0].overflow_arg_area = &stack0x00000008;
  ap[0].gp_offset = 0x10;
  ap[0].reg_save_area = local_b8;
  ap[0].fp_offset = 0x30;
  local_a8 = in_RDX;
  local_a0 = in_RCX;
  local_98 = in_R8;
  local_90 = in_R9;
  wVar2 = file_vprintf(ms,fmt,ap);
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return wVar2;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t checkdone(magic_set *ms,wchar_t *rv)

{
  wchar_t wVar1;
  
  wVar1 = file_printf(ms,"\n- ");
  if (wVar1 == L'\xffffffff') {
    *rv = L'\xffffffff';
  }
  return L'\0';
}



void file_magerror(magic_set *ms,char *f,...)

{
  long lVar1;
  size_t sVar2;
  char *__ptr;
  char in_AL;
  undefined8 in_RCX;
  undefined8 in_RDX;
  undefined8 in_R8;
  undefined8 in_R9;
  long in_FS_OFFSET;
  undefined8 in_XMM0_Qa;
  undefined8 in_XMM1_Qa;
  undefined8 in_XMM2_Qa;
  undefined8 in_XMM3_Qa;
  undefined8 in_XMM4_Qa;
  undefined8 in_XMM5_Qa;
  undefined8 in_XMM6_Qa;
  undefined8 in_XMM7_Qa;
  va_list va;
  undefined local_c8 [16];
  undefined8 local_b8;
  undefined8 local_b0;
  undefined8 local_a8;
  undefined8 local_a0;
  undefined8 local_98;
  undefined8 local_88;
  undefined8 local_78;
  undefined8 local_68;
  undefined8 local_58;
  undefined8 local_48;
  undefined8 local_38;
  undefined8 local_28;
  
  if (in_AL != '\0') {
    local_98 = in_XMM0_Qa;
    local_88 = in_XMM1_Qa;
    local_78 = in_XMM2_Qa;
    local_68 = in_XMM3_Qa;
    local_58 = in_XMM4_Qa;
    local_48 = in_XMM5_Qa;
    local_38 = in_XMM6_Qa;
    local_28 = in_XMM7_Qa;
  }
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  va[0].overflow_arg_area = &stack0x00000008;
  va[0].gp_offset = 0x10;
  va[0].reg_save_area = local_c8;
  va[0].fp_offset = 0x30;
  local_b8 = in_RDX;
  local_b0 = in_RCX;
  local_a8 = in_R8;
  local_a0 = in_R9;
  if ((*(byte *)&ms->event_flags & 1) == 0) {
    sVar2 = ms->line;
    __ptr = (ms->o).buf;
    if (sVar2 != 0) {
      free(__ptr);
      (ms->o).buf = (char *)0x0;
      file_printf(ms,"line %zu:",sVar2);
      __ptr = (ms->o).buf;
    }
    if ((__ptr != (char *)0x0) && (*__ptr != '\0')) {
      file_printf(ms," ");
    }
    file_vprintf(ms,f,va);
    ms->event_flags = ms->event_flags | 1;
    ms->error = 0;
  }
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return;
}



void file_oomem(magic_set *ms,size_t len)

{
  wchar_t *pwVar1;
  
  pwVar1 = __errno_location();
  file_error(ms,*pwVar1,"cannot allocate %zu bytes",len);
  return;
}



void file_badseek(magic_set *ms)

{
  wchar_t *pwVar1;
  
  pwVar1 = __errno_location();
  file_error(ms,*pwVar1,"error seeking");
  return;
}



void file_badread(magic_set *ms)

{
  wchar_t *pwVar1;
  
  pwVar1 = __errno_location();
  file_error(ms,*pwVar1,"error reading");
  return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

wchar_t file_buffer(magic_set *ms,wchar_t fd,char *inname,void *buf,size_t nb)

{
  wchar_t wVar1;
  wchar_t wVar2;
  int text;
  uint uVar3;
  char *pcVar4;
  char *pcVar5;
  long in_FS_OFFSET;
  wchar_t rv;
  unichar *u8buf;
  size_t ulen;
  char *code;
  char *code_mime;
  char *ftype;
  long local_40;
  
  uVar3 = ms->flags;
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  rv = L'\0';
  u8buf = (unichar *)0x0;
  code = (char *)0x0;
  code_mime = "binary";
  ftype = (char *)0x0;
  if (nb == 0) {
    pcVar4 = "empty";
    pcVar5 = "application/x-empty";
LAB_001153f3:
    if ((uVar3 & 0x410) == 0) {
      pcVar5 = "UNKNUNKN";
      if ((uVar3 & 0x800) == 0) {
        pcVar5 = pcVar4;
        if ((uVar3 & 0x1000000) == 0) goto LAB_0011548f;
        pcVar5 = "???";
      }
      wVar1 = file_printf(ms,pcVar5);
joined_r0x0011551c:
      if (wVar1 == L'\xffffffff') {
        rv = L'\xffffffff';
      }
      uVar3 = ms->flags;
      wVar1 = L'\x01';
      goto LAB_001154b6;
    }
    if ((uVar3 & 0x10) != 0) {
LAB_0011548f:
      wVar1 = file_printf(ms,"%s",pcVar5);
      goto joined_r0x0011551c;
    }
    wVar1 = L'\x01';
    if ((uVar3 & 0x400) == 0) goto LAB_0011542e;
  }
  else {
    if (nb == 1) {
      pcVar4 = "very short file (no magic)";
      pcVar5 = "application/octet-stream";
      goto LAB_001153f3;
    }
    text = 0;
    if ((uVar3 & 0x200000) == 0) {
      text = file_encoding(ms,(uchar *)buf,nb,&u8buf,&ulen,&code,&code_mime,&ftype);
      uVar3 = ms->flags;
    }
    if ((uVar3 & 0x1000) == 0) {
      wVar1 = file_zmagic(ms,fd,inname,(uchar *)buf,nb);
      if ((*(byte *)&ms->flags & 1) != 0) {
        __fprintf_chk(_stderr,1,"[try zmagic %d]\n");
      }
      if (wVar1 != L'\0') goto LAB_0011542e;
      uVar3 = ms->flags;
    }
    wVar1 = L'\0';
    if ((uVar3 & 0x2000) == 0) {
      wVar1 = file_is_tar(ms,(uchar *)buf,nb);
      uVar3 = ms->flags;
      if ((uVar3 & 1) != 0) {
        __fprintf_chk(_stderr,1,"[try tar %d]\n");
        uVar3 = ms->flags;
      }
      if (wVar1 == L'\0') goto LAB_0011533a;
      if ((uVar3 & 0x20) != 0) {
        wVar2 = checkdone(ms,&rv);
        uVar3 = ms->flags;
        if (wVar2 == L'\0') goto LAB_0011533a;
      }
      goto LAB_001154b6;
    }
LAB_0011533a:
    if ((uVar3 & 0x40000) == 0) {
      wVar1 = file_trycdf(ms,fd,(uchar *)buf,nb);
      uVar3 = ms->flags;
      if ((uVar3 & 1) != 0) {
        __fprintf_chk(_stderr,1,"[try cdf %d]\n");
        uVar3 = ms->flags;
      }
      if (wVar1 == L'\0') goto LAB_00115346;
      if ((uVar3 & 0x20) != 0) {
        wVar2 = checkdone(ms,&rv);
        uVar3 = ms->flags;
        if (wVar2 == L'\0') goto LAB_00115346;
      }
    }
    else {
LAB_00115346:
      if ((uVar3 & 0x4000) == 0) {
        wVar1 = file_softmagic(ms,(uchar *)buf,nb,(uint16_t *)0x0,(uint16_t *)0x0,0x20,text);
        uVar3 = ms->flags;
      }
      if ((uVar3 & 1) != 0) {
        __fprintf_chk(_stderr,1,"[try softmagic %d]\n",wVar1);
        uVar3 = ms->flags;
      }
      if (wVar1 == L'\0') {
LAB_001153d9:
        pcVar4 = "data";
        pcVar5 = "application/octet-stream";
        if ((uVar3 & 0x20000) != 0) goto LAB_001153f3;
        wVar1 = file_ascmagic(ms,(uchar *)buf,nb,text);
        uVar3 = ms->flags;
        if ((uVar3 & 1) != 0) {
          __fprintf_chk(_stderr,1,"[try ascmagic %d]\n",wVar1);
          uVar3 = ms->flags;
        }
        if (wVar1 == L'\0') {
LAB_0011563e:
          pcVar4 = "data";
          pcVar5 = "application/octet-stream";
          goto LAB_001153f3;
        }
        if ((uVar3 & 0x20) != 0) {
          wVar2 = checkdone(ms,&rv);
          uVar3 = ms->flags;
          if (wVar2 == L'\0') goto LAB_0011563e;
        }
      }
      else {
        if (((((uVar3 & 0x10000) == 0) && (wVar1 == L'\x01')) && (5 < nb)) && (fd != L'\xffffffff'))
        {
          wVar1 = file_tryelf(ms,fd,(uchar *)buf,nb);
          uVar3 = ms->flags;
          if ((uVar3 & 1) != 0) {
            __fprintf_chk(_stderr,1,"[try elf %d]\n",wVar1);
            uVar3 = ms->flags;
          }
        }
        if ((uVar3 & 0x20) != 0) {
          wVar2 = checkdone(ms,&rv);
          uVar3 = ms->flags;
          if (wVar2 == L'\0') goto LAB_001153d9;
        }
      }
    }
LAB_001154b6:
    if ((uVar3 & 0x400) == 0) goto LAB_0011542e;
    if (((uVar3 & 0x10) != 0) && (wVar2 = file_printf(ms,"; charset="), wVar2 == L'\xffffffff')) {
      rv = L'\xffffffff';
    }
  }
  wVar2 = file_printf(ms,"%s",code_mime);
  if (wVar2 == L'\xffffffff') {
    rv = L'\xffffffff';
  }
LAB_0011542e:
  free(u8buf);
  if (rv != L'\0') {
    wVar1 = rv;
  }
  if (local_40 == *(long *)(in_FS_OFFSET + 0x28)) {
    return wVar1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t file_reset(magic_set *ms)

{
  char *pcVar1;
  
  if (ms->mlist[0] != (mlist *)0x0) {
    pcVar1 = (ms->o).buf;
    if (pcVar1 != (char *)0x0) {
      free(pcVar1);
      (ms->o).buf = (char *)0x0;
    }
    pcVar1 = (ms->o).pbuf;
    if (pcVar1 != (char *)0x0) {
      free(pcVar1);
      (ms->o).pbuf = (char *)0x0;
    }
    ms->event_flags = ms->event_flags & 0xfffffffe;
    ms->error = -1;
    return L'\0';
  }
  file_error(ms,L'\0',"no magic files loaded");
  return L'\xffffffff';
}



char * file_getbuffer(magic_set *ms)

{
  size_t __size;
  long lVar1;
  int iVar2;
  size_t sVar3;
  char *pcVar4;
  long *plVar5;
  char *pcVar6;
  byte *pbVar7;
  byte *pbVar8;
  byte *pbVar9;
  byte bVar10;
  byte *pbVar11;
  long in_FS_OFFSET;
  wchar_t nextchar;
  mbstate_t state;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  if ((*(byte *)&ms->event_flags & 1) == 0) {
    pcVar4 = (ms->o).buf;
    if (((*(byte *)((long)&ms->flags + 1) & 1) == 0) && (pcVar4 != (char *)0x0)) {
      sVar3 = strlen(pcVar4);
      if (sVar3 < 0x4000000000000000) {
        __size = sVar3 * 4 + 1;
        pcVar4 = (char *)realloc((ms->o).pbuf,__size);
        if (pcVar4 == (char *)0x0) {
          file_oomem(ms,__size);
          pcVar4 = (char *)0x0;
        }
        else {
          state.__count = 0;
          state.__value = (anon_union_4_2_91654ee9_for___value)0x0;
          pbVar7 = (byte *)(ms->o).buf;
          (ms->o).pbuf = pcVar4;
          pbVar8 = pbVar7 + sVar3;
          if (pbVar7 < pbVar8) {
            do {
              while( true ) {
                sVar3 = mbrtowc(&nextchar,(char *)pbVar7,(long)pbVar8 - (long)pbVar7,
                                (mbstate_t *)&state);
                if (0xfffffffffffffffd < sVar3) {
                  *pcVar4 = '\0';
                  pbVar8 = (byte *)(ms->o).buf;
                  pbVar7 = (byte *)(ms->o).pbuf;
                  bVar10 = *pbVar8;
                  if (bVar10 != 0) {
                    plVar5 = (long *)FUN_00104d70();
                    do {
                      pbVar9 = pbVar8 + 1;
                      if ((*(byte *)(*plVar5 + 1 + (ulong)bVar10 * 2) & 0x40) == 0) {
                        *pbVar7 = 0x5c;
                        pbVar7[1] = (*pbVar8 >> 6) + 0x30;
                        pbVar7[2] = ((byte)((uint)(int)(char)*pbVar8 >> 3) & 7) + 0x30;
                        pbVar7[3] = (*pbVar8 & 7) + 0x30;
                        bVar10 = *pbVar9;
                        pbVar7 = pbVar7 + 4;
                      }
                      else {
                        *pbVar7 = bVar10;
                        bVar10 = *pbVar9;
                        pbVar7 = pbVar7 + 1;
                      }
                      pbVar8 = pbVar9;
                    } while (bVar10 != 0);
                  }
                  *pbVar7 = 0;
                  pcVar4 = (ms->o).pbuf;
                  goto LAB_001159c0;
                }
                iVar2 = iswprint(nextchar);
                if (iVar2 == 0) break;
                memcpy(pcVar4,pbVar7,sVar3);
                pcVar4 = pcVar4 + sVar3;
                pbVar7 = pbVar7 + sVar3;
LAB_00115914:
                if (pbVar8 <= pbVar7) goto LAB_001159a9;
              }
              pbVar9 = pbVar7 + sVar3;
              pcVar6 = pcVar4;
              if (sVar3 == 0) goto LAB_00115914;
              do {
                *pcVar6 = '\\';
                pbVar11 = pbVar7 + 1;
                pcVar6[1] = (*pbVar7 >> 6) + 0x30;
                pcVar6[2] = ((byte)((uint)(int)(char)*pbVar7 >> 3) & 7) + 0x30;
                pcVar6[3] = (*pbVar7 & 7) + 0x30;
                pcVar6 = pcVar6 + 4;
                pbVar7 = pbVar11;
              } while (pbVar9 != pbVar11);
              pcVar4 = pcVar4 + sVar3 * 4;
            } while (pbVar11 < pbVar8);
          }
LAB_001159a9:
          *pcVar4 = '\0';
          pcVar4 = (ms->o).pbuf;
        }
      }
      else {
        pcVar4 = (char *)0x0;
        file_oomem(ms,sVar3);
      }
    }
  }
  else {
    pcVar4 = (char *)0x0;
  }
LAB_001159c0:
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return pcVar4;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t file_check_mem(magic_set *ms,uint level)

{
  ulong uVar1;
  level_info *__ptr;
  size_t __size;
  
  uVar1 = (ulong)level;
  __ptr = (ms->c).li;
  if ((ms->c).len <= uVar1) {
    (ms->c).len = (ulong)(level + 0x14);
    __size = (ulong)(level + 0x14) << 4;
    if (__ptr == (level_info *)0x0) {
      __ptr = (level_info *)malloc(__size);
    }
    else {
      __ptr = (level_info *)realloc(__ptr,__size);
    }
    (ms->c).li = __ptr;
    if (__ptr == (level_info *)0x0) {
      file_oomem(ms,__size);
      return L'\xffffffff';
    }
  }
  __ptr[uVar1].got_match = 0;
  __ptr[uVar1].last_match = 0;
  __ptr[uVar1].last_cond = 0;
  return L'\0';
}



size_t file_printedlen(magic_set *ms)

{
  char *__s;
  size_t sVar1;
  
  __s = (ms->o).buf;
  if (__s != (char *)0x0) {
    sVar1 = strlen(__s);
    return sVar1;
  }
  return 0;
}



wchar_t file_regcomp(file_regex_t *rx,char *pat,wchar_t flags)

{
  wchar_t wVar1;
  __locale_t p_Var2;
  
  p_Var2 = newlocale(1,"C",(__locale_t)0x0);
  rx->c_lc_ctype = (locale_t)p_Var2;
  if (p_Var2 == (__locale_t)0x0) {
                    // WARNING: Subroutine does not return
    __assert_fail("rx->c_lc_ctype != NULL","funcs.c",0x1ef,"file_regcomp");
  }
  p_Var2 = uselocale(p_Var2);
  rx->old_lc_ctype = (locale_t)p_Var2;
  if (p_Var2 != (__locale_t)0x0) {
    rx->pat = pat;
    wVar1 = regcomp((regex_t *)&rx->rx,pat,flags);
    rx->rc = wVar1;
    return wVar1;
  }
                    // WARNING: Subroutine does not return
  __assert_fail("rx->old_lc_ctype != NULL","funcs.c",0x1f1,"file_regcomp");
}



wchar_t file_regexec(file_regex_t *rx,char *str,size_t nmatch,regmatch_t *pmatch,wchar_t eflags)

{
  wchar_t wVar1;
  wchar_t extraout_EAX;
  
  if (rx->rc == 0) {
    wVar1 = regexec((regex_t *)&rx->rx,str,nmatch,(regmatch_t *)pmatch,eflags);
    return wVar1;
  }
  file_regexec(rx,str,nmatch,pmatch,eflags);
  if (rx->rc == 0) {
    regfree((regex_t *)&rx->rx);
  }
  uselocale((__locale_t)rx->old_lc_ctype);
  freelocale((__locale_t)rx->c_lc_ctype);
  return extraout_EAX;
}



void file_regfree(file_regex_t *rx)

{
  if (rx->rc == 0) {
    regfree((regex_t *)&rx->rx);
  }
  uselocale((__locale_t)rx->old_lc_ctype);
  freelocale((__locale_t)rx->c_lc_ctype);
  return;
}



void file_regerror(file_regex_t *rx,wchar_t rc,magic_set *ms)

{
  long lVar1;
  long in_FS_OFFSET;
  char errmsg [512];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  regerror(rc,(regex_t *)&rx->rx,errmsg,0x200);
  file_magerror(ms,"regex error %d for `%s\', (%s)",(ulong)(uint)rc,rx->pat,errmsg);
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



wchar_t file_replace(magic_set *ms,char *pat,char *rep)

{
  long lVar1;
  wchar_t wVar2;
  int iVar3;
  regmatch_t *in_RCX;
  size_t extraout_RDX;
  size_t extraout_RDX_00;
  size_t nmatch;
  char *__string;
  magic_set *rx_00;
  wchar_t in_R8D;
  regmatch_t *prVar4;
  wchar_t wVar5;
  long in_FS_OFFSET;
  regmatch_t rm;
  file_regex_t rx;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  rx_00 = (magic_set *)&rx;
  wVar2 = file_regcomp(&rx,pat,L'\x01');
  if (wVar2 == L'\0') {
    __string = (ms->o).buf;
    nmatch = extraout_RDX;
    if (rx.rc == 0) {
      wVar5 = L'\0';
      do {
        iVar3 = regexec((regex_t *)&rx.rx,__string,1,(regmatch_t *)&rm,0);
        if (iVar3 != 0) goto LAB_00115ddb;
        in_RCX = (regmatch_t *)&DAT_0011ddf7;
        (ms->o).buf[rm.rm_so] = '\0';
        if (rm.rm_eo != 0) {
          in_RCX = (regmatch_t *)((ms->o).buf + rm.rm_eo);
        }
        rx_00 = ms;
        prVar4 = in_RCX;
        wVar2 = file_printf(ms,"%s%s",rep);
        in_R8D = (wchar_t)prVar4;
        if (wVar2 == L'\xffffffff') {
          wVar5 = L'\xffffffff';
          goto LAB_00115ddb;
        }
        __string = (ms->o).buf;
        wVar5 = wVar5 + L'\x01';
        nmatch = extraout_RDX_00;
      } while (rx.rc == 0);
    }
    file_regexec((file_regex_t *)rx_00,__string,nmatch,in_RCX,in_R8D);
  }
  else {
    wVar5 = L'\xffffffff';
    file_regerror(&rx,wVar2,ms);
LAB_00115ddb:
    file_regfree(&rx);
    if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
      return wVar5;
    }
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



file_pushbuf_t * file_push_buffer(magic_set *ms)

{
  uint32_t uVar1;
  char *pcVar2;
  file_pushbuf_t *pfVar3;
  
  if ((*(byte *)&ms->event_flags & 1) == 0) {
    pfVar3 = (file_pushbuf_t *)malloc(0x10);
    if (pfVar3 != (file_pushbuf_t *)0x0) {
      pcVar2 = (ms->o).buf;
      (ms->o).buf = (char *)0x0;
      pfVar3->buf = pcVar2;
      uVar1 = ms->offset;
      ms->offset = 0;
      pfVar3->offset = uVar1;
    }
    return pfVar3;
  }
  return (file_pushbuf_t *)0x0;
}



char * file_pop_buffer(magic_set *ms,file_pushbuf_t *pb)

{
  uint32_t uVar1;
  char *pcVar2;
  
  if ((*(byte *)&ms->event_flags & 1) == 0) {
    uVar1 = pb->offset;
    pcVar2 = (ms->o).buf;
    (ms->o).buf = pb->buf;
    ms->offset = uVar1;
    free(pb);
    return pcVar2;
  }
  free(pb->buf);
  free(pb);
  return (char *)0x0;
}



char * file_printable(char *buf,size_t bufsiz,char *str)

{
  byte *pbVar1;
  byte bVar2;
  long *plVar3;
  byte *pbVar4;
  byte *pbVar5;
  
  pbVar1 = (byte *)(buf + (bufsiz - 1));
  pbVar5 = (byte *)buf;
  if (buf < pbVar1) {
    do {
      while( true ) {
        bVar2 = *str;
        if (bVar2 == 0) goto LAB_00115f8f;
        plVar3 = (long *)FUN_00104d70();
        if ((*(byte *)(*plVar3 + 1 + (ulong)bVar2 * 2) & 0x40) == 0) break;
        *pbVar5 = bVar2;
        pbVar5 = pbVar5 + 1;
        str = (char *)((byte *)str + 1);
        if (pbVar1 <= pbVar5) goto LAB_00115f8f;
      }
      if (pbVar1 + -3 <= pbVar5) break;
      *pbVar5 = 0x5c;
      pbVar4 = pbVar5 + 4;
      pbVar5[1] = ((byte)*str >> 6) + 0x30;
      pbVar5[2] = ((byte)*str >> 3 & 7) + 0x30;
      pbVar5[3] = (*str & 7U) + 0x30;
      pbVar5 = pbVar4;
      str = (char *)((byte *)str + 1);
    } while (pbVar4 < pbVar1);
  }
LAB_00115f8f:
  *pbVar5 = 0;
  return buf;
}



uint32_t getlength(uint8_t *c,size_t *p,size_t l)

{
  byte bVar1;
  ulong uVar2;
  long lVar3;
  ulong uVar4;
  size_t sVar5;
  uint uVar6;
  
  uVar2 = *p;
  if (l <= uVar2) {
    return 0xffffffff;
  }
  *p = uVar2 + 1;
  bVar1 = c[uVar2];
  uVar6 = (uint)bVar1;
  if ((char)bVar1 < '\0') {
    uVar6 = bVar1 & 0x7f;
    if (l <= (ulong)(bVar1 & 0x7f) + uVar2 + 1) {
      return 0xffffffff;
    }
    if ((char)uVar6 != '\0') {
      sVar5 = uVar2 + 2;
      uVar4 = 0;
      do {
        *p = sVar5;
        lVar3 = sVar5 - 1;
        sVar5 = sVar5 + 1;
        uVar4 = uVar4 << 8 | (ulong)c[lVar3];
      } while (sVar5 != uVar2 + 3 + (ulong)(uVar6 - 1 & 0xff));
      return (uint32_t)uVar4;
    }
    uVar6 = 0;
  }
  return uVar6;
}



// WARNING: Unknown calling convention

uint32_t gettag(uint8_t *c,size_t *p,size_t l)

{
  ulong uVar1;
  uint32_t uVar2;
  
  uVar1 = *p;
  if (uVar1 < l) {
    *p = uVar1 + 1;
    if ((c[uVar1] & 0x1f) != 0x1f) {
      return (uint32_t)(c[uVar1] & 0x1f);
    }
    uVar2 = 0x1f;
    uVar1 = uVar1 + 1;
    while (uVar1 < l) {
      if (-1 < (char)c[uVar1]) {
        return uVar2;
      }
      *p = uVar1 + 1;
      uVar2 = uVar2 * 0x80 + -0x80 + (uint)c[uVar1];
      uVar1 = uVar1 + 1;
    }
  }
  return 0xffffffff;
}



int32_t der_offs(magic_set *ms,magic *m,size_t nbytes)

{
  uint32_t uVar1;
  size_t sVar2;
  size_t l;
  size_t *p;
  uint8_t *c;
  long in_FS_OFFSET;
  size_t offs;
  long local_10;
  
  p = &offs;
  sVar2 = (ms->search).s_len;
  c = (uint8_t *)(ms->search).s;
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  offs = 0;
  if (sVar2 == 0) {
    sVar2 = nbytes;
  }
  uVar1 = gettag(c,&offs,sVar2);
  if (uVar1 != 0xffffffff) {
    uVar1 = getlength(c,p,l);
    if (uVar1 != 0xffffffff) {
      sVar2 = (m->offset + ms->offset) + offs;
      offs = sVar2;
      if (m->cont_level == 0) goto LAB_00116122;
      if (uVar1 + sVar2 <= nbytes) {
        (ms->c).li[(ulong)m->cont_level - 1].off = uVar1 + (int)sVar2;
        goto LAB_00116122;
      }
    }
  }
  sVar2 = 0xffffffff;
LAB_00116122:
  if (local_10 == *(long *)(in_FS_OFFSET + 0x28)) {
    return (int32_t)sVar2;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int der_cmp(magic_set *ms,magic *m)

{
  byte bVar1;
  long lVar2;
  uint32_t uVar3;
  uint32_t uVar4;
  uint uVar5;
  uint uVar6;
  int iVar7;
  long *plVar8;
  ulong uVar9;
  size_t l;
  uint *puVar10;
  uint *puVar11;
  size_t __n;
  byte *pbVar12;
  byte *__s2;
  size_t *p;
  uint8_t *puVar13;
  ulong uVar14;
  uint8_t *puVar15;
  long in_FS_OFFSET;
  bool bVar16;
  size_t offs;
  char buf [128];
  
  puVar15 = (uint8_t *)(ms->search).s;
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  p = &offs;
  offs = 0;
  puVar13 = puVar15;
  uVar3 = gettag(puVar15,p,(ms->search).s_len);
  if ((uVar3 == 0xffffffff) || (uVar4 = getlength(puVar13,p,l), uVar4 == 0xffffffff)) {
    iVar7 = -1;
  }
  else {
    if (uVar3 < 0x1f) {
      strlcpy(buf,der__tag[uVar3],0x80);
      bVar1 = *(byte *)&ms->flags;
    }
    else {
      __snprintf_chk(buf,0x80,1,0x80,&DAT_0011eddf,uVar3);
      bVar1 = *(byte *)&ms->flags;
    }
    if ((bVar1 & 1) != 0) {
      __fprintf_chk(_stderr,1,"%s: tag %p got=%s exp=%s\n","der_cmp",puVar15,buf,&m->value);
    }
    puVar11 = (uint *)buf;
    do {
      puVar10 = puVar11;
      uVar5 = *puVar10 + 0xfefefeff & ~*puVar10;
      uVar6 = uVar5 & 0x80808080;
      puVar11 = puVar10 + 1;
    } while (uVar6 == 0);
    bVar16 = (uVar5 & 0x8080) == 0;
    if (bVar16) {
      uVar6 = uVar6 >> 0x10;
    }
    if (bVar16) {
      puVar11 = (uint *)((long)puVar10 + 6);
    }
    __n = (long)puVar11 + ((-3 - (ulong)CARRY1((byte)uVar6,(byte)uVar6)) - (long)buf);
    iVar7 = strncmp(buf,(m->value).s,__n);
    pbVar12 = (byte *)((m->value).s + __n);
    if (iVar7 == 0) {
LAB_0011624e:
      bVar1 = *pbVar12;
      if (bVar1 != 0) {
        if (bVar1 == 0x3d) {
          __s2 = pbVar12 + 1;
          puVar15 = puVar15 + offs;
          if ((uVar3 < 0x18) && ((1L << ((byte)uVar3 & 0x3f) & 0xc81000U) != 0)) {
            __snprintf_chk(buf,0x80,1,0x80,"%.*s",uVar4,puVar15);
          }
          else if (uVar4 != 0) {
            uVar6 = 0;
            puVar13 = puVar15 + (ulong)(uVar4 - 1) + 1;
            do {
              if (uVar6 < 0x7e) {
                __snprintf_chk((ulong)uVar6 + (long)buf,0x80 - (ulong)uVar6,1,0xffffffffffffffff,
                               &DAT_0011edfd,*puVar15);
              }
              puVar15 = puVar15 + 1;
              uVar6 = uVar6 + 2;
            } while (puVar13 != puVar15);
          }
          if ((*(byte *)&ms->flags & 1) != 0) {
            __fprintf_chk(_stderr,1,"%s: data %s %s\n","der_cmp",buf,__s2);
          }
          iVar7 = strcmp(buf,(char *)__s2);
          if ((iVar7 == 0) || ((*__s2 == 0x78 && (pbVar12[2] == 0)))) {
            strlcpy((ms->ms_value).s,buf,0x60);
            iVar7 = 1;
            goto LAB_001162f5;
          }
        }
        else {
          plVar8 = (long *)FUN_00104d70();
          uVar9 = (ulong)bVar1;
          if ((*(byte *)(*plVar8 + 1 + uVar9 * 2) & 8) != 0) goto code_r0x0011641b;
        }
        goto LAB_001163e8;
      }
      iVar7 = 1;
      goto LAB_001162f5;
    }
LAB_001163e8:
    iVar7 = 0;
  }
LAB_001162f5:
  if (lVar2 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar7;
code_r0x0011641b:
  uVar14 = 0;
  do {
    pbVar12 = pbVar12 + 1;
    uVar14 = (long)(char)uVar9 + -0x30 + uVar14 * 10;
    uVar9 = (ulong)*pbVar12;
  } while ((*(byte *)(*plVar8 + 1 + uVar9 * 2) & 8) != 0);
  if ((*(byte *)&ms->flags & 1) != 0) {
    __fprintf_chk(_stderr,1,"%s: len %zu %u\n","der_cmp",uVar14,uVar4);
  }
  if (uVar4 != uVar14) goto code_r0x00116450;
  goto LAB_0011624e;
code_r0x00116450:
  iVar7 = 0;
  goto LAB_001162f5;
}



ssize_t cdf_read(cdf_info_t *info,off_t off,void *buf,size_t len)

{
  size_t sVar1;
  int *piVar2;
  
  if ((info->i_buf != (uchar *)0x0) && (off + len <= info->i_len)) {
    memcpy(buf,info->i_buf + off,len);
    return len;
  }
  if (info->i_fd == -1) {
    piVar2 = __errno_location();
    *piVar2 = 0x16;
    return -1;
  }
  sVar1 = pread(info->i_fd,buf,len,off);
  if (len == sVar1) {
    return sVar1;
  }
  return -1;
}



// DWARF original prototype: size_t cdf_check_stream(cdf_stream_t * sst, cdf_header_t * h,
// cdf_stream_t * sst)

size_t cdf_check_stream(cdf_stream_t *sst,cdf_header_t *h,cdf_stream_t *sst_1)

{
                    // WARNING: Subroutine does not return
  __assert_fail("ss == sst->sst_ss","cdf.c",0x11d,"cdf_check_stream");
}



int cdf_check_stream_offset(cdf_stream_t *sst,cdf_header_t *h,void *p,size_t tail,int line)

{
  int iVar1;
  int *piVar2;
  byte bVar3;
  cdf_stream_t *sst_1;
  ushort uVar4;
  undefined2 uVar5;
  long in_FS_OFFSET;
  
  uVar4 = (ushort)sst;
  uVar5 = (undefined2)((ulong)sst >> 0x10);
  sst_1 = (cdf_stream_t *)((long)p + tail);
  if (sst->sst_dirlen < (ulong)h->h_min_size_standard_stream) {
    bVar3 = (byte)h->h_short_sec_size_p2;
  }
  else {
    bVar3 = (byte)h->h_sec_size_p2;
  }
  if (sst->sst_ss == (long)(1 << (bVar3 & 0x1f))) {
    if ((sst_1 < (cdf_stream_t *)sst->sst_tab) ||
       (iVar1 = 0, sst->sst_ss * sst->sst_len < (ulong)((long)sst_1 - (long)sst->sst_tab))) {
      piVar2 = __errno_location();
      *piVar2 = 0x16;
      iVar1 = -1;
    }
    return iVar1;
  }
  cdf_check_stream(sst,h,sst_1);
  if (cdf_bo.u == 0x1020304) {
    uVar4 = uVar4 << 8 | uVar4 >> 8;
  }
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return CONCAT22(uVar5,uVar4);
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



uint16_t cdf_tole2(uint16_t sv)

{
  undefined8 in_RSI;
  undefined2 in_register_0000003a;
  undefined4 uVar1;
  long in_FS_OFFSET;
  uint16_t rv;
  
  uVar1 = CONCAT22(in_register_0000003a,sv);
  if (cdf_bo.u == 0x1020304) {
    uVar1 = CONCAT22(in_register_0000003a,sv << 8 | sv >> 8);
  }
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return (uint16_t)uVar1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail(uVar1,in_RSI,0);
}



uint32_t cdf_tole4(uint32_t sv)

{
  uint32_t uVar1;
  undefined8 in_RSI;
  long in_FS_OFFSET;
  uint32_t rv;
  
  uVar1 = sv;
  if (cdf_bo.u == 0x1020304) {
    uVar1 = sv >> 0x18 | (sv & 0xff0000) >> 8 | (sv & 0xff00) << 8 | sv << 0x18;
  }
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail(sv,in_RSI,0);
}



uint64_t cdf_tole8(uint64_t sv)

{
  uint64_t uVar1;
  undefined8 in_RSI;
  long in_FS_OFFSET;
  uint64_t rv;
  
  uVar1 = sv;
  if (cdf_bo.u == 0x1020304) {
    uVar1 = sv >> 0x38 | (sv & 0xff000000000000) >> 0x28 | (sv & 0xff0000000000) >> 0x18 |
            (sv & 0xff00000000) >> 8 | (sv & 0xff000000) << 8 | (sv & 0xff0000) << 0x18 |
            (sv & 0xff00) << 0x28 | sv << 0x38;
  }
  if (*(long *)(in_FS_OFFSET + 0x28) == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar1;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail(sv,in_RSI,0);
}



void cdf_swap_header(cdf_header_t *h)

{
  uint32_t uVar1;
  cdf_secid_t cVar2;
  undefined4 uVar3;
  long lVar4;
  uint64_t uVar5;
  anon_union_4_2_94730243 aVar6;
  uint32_t uVar7;
  cdf_header_t *pcVar8;
  long in_FS_OFFSET;
  uint64_t rv;
  
  aVar6.s = cdf_bo.s;
  lVar4 = *(long *)(in_FS_OFFSET + 0x28);
  uVar7 = h->h_num_sectors_in_master_sat;
  if (cdf_bo.u == 0x1020304) {
    uVar5 = h->h_magic;
    h->h_magic = CONCAT17((char)uVar5,
                          CONCAT16((char)(uVar5 >> 8),
                                   CONCAT15((char)(uVar5 >> 0x10),
                                            CONCAT14((char)(uVar5 >> 0x18),
                                                     CONCAT13((char)(uVar5 >> 0x20),
                                                              CONCAT12((char)(uVar5 >> 0x28),
                                                                       CONCAT11((char)(uVar5 >> 0x30
                                                                                      ),(char)(uVar5
                                                                                              >> 
                                                  0x38))))))));
    uVar5 = h->h_uuid[0];
    h->h_uuid[0] = CONCAT17((char)uVar5,
                            CONCAT16((char)(uVar5 >> 8),
                                     CONCAT15((char)(uVar5 >> 0x10),
                                              CONCAT14((char)(uVar5 >> 0x18),
                                                       CONCAT13((char)(uVar5 >> 0x20),
                                                                CONCAT12((char)(uVar5 >> 0x28),
                                                                         CONCAT11((char)(uVar5 >> 
                                                  0x30),(char)(uVar5 >> 0x38))))))));
    uVar5 = h->h_uuid[1];
    h->h_uuid[1] = CONCAT17((char)uVar5,
                            CONCAT16((char)(uVar5 >> 8),
                                     CONCAT15((char)(uVar5 >> 0x10),
                                              CONCAT14((char)(uVar5 >> 0x18),
                                                       CONCAT13((char)(uVar5 >> 0x20),
                                                                CONCAT12((char)(uVar5 >> 0x28),
                                                                         CONCAT11((char)(uVar5 >> 
                                                  0x30),(char)(uVar5 >> 0x38))))))));
    h->h_revision = CONCAT11((char)h->h_revision,(char)(h->h_revision >> 8));
    h->h_version = CONCAT11((char)h->h_version,(char)(h->h_version >> 8));
    h->h_byte_order = CONCAT11((char)h->h_byte_order,(char)(h->h_byte_order >> 8));
    h->h_sec_size_p2 = CONCAT11((char)h->h_sec_size_p2,(char)(h->h_sec_size_p2 >> 8));
    h->h_short_sec_size_p2 =
         CONCAT11((char)h->h_short_sec_size_p2,(char)(h->h_short_sec_size_p2 >> 8));
    uVar1 = h->h_num_sectors_in_sat;
    h->h_num_sectors_in_sat =
         CONCAT13((char)uVar1,
                  CONCAT12((char)(uVar1 >> 8),CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18)))
                 );
    uVar1 = h->h_secid_first_directory;
    h->h_secid_first_directory =
         CONCAT13((char)uVar1,
                  CONCAT12((char)(uVar1 >> 8),CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18)))
                 );
    uVar1 = h->h_min_size_standard_stream;
    h->h_min_size_standard_stream =
         CONCAT13((char)uVar1,
                  CONCAT12((char)(uVar1 >> 8),CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18)))
                 );
    cVar2 = h->h_secid_first_sector_in_short_sat;
    h->h_secid_first_sector_in_short_sat =
         CONCAT13((char)cVar2,
                  CONCAT12((char)((uint)cVar2 >> 8),
                           CONCAT11((char)((uint)cVar2 >> 0x10),(char)((uint)cVar2 >> 0x18))));
    uVar1 = h->h_num_sectors_in_short_sat;
    h->h_num_sectors_in_short_sat =
         CONCAT13((char)uVar1,
                  CONCAT12((char)(uVar1 >> 8),CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18)))
                 );
    cVar2 = h->h_secid_first_sector_in_master_sat;
    h->h_secid_first_sector_in_master_sat =
         CONCAT13((char)cVar2,
                  CONCAT12((char)((uint)cVar2 >> 8),
                           CONCAT11((char)((uint)cVar2 >> 0x10),(char)((uint)cVar2 >> 0x18))));
    uVar7 = CONCAT13((char)uVar7,
                     CONCAT12((char)(uVar7 >> 8),
                              CONCAT11((char)(uVar7 >> 0x10),(char)(uVar7 >> 0x18))));
  }
  h->h_num_sectors_in_master_sat = uVar7;
  pcVar8 = (cdf_header_t *)h->h_master_sat;
  do {
    uVar3 = *(undefined4 *)&pcVar8->h_magic;
    if (aVar6.u == 0x1020304) {
      uVar3 = CONCAT13((char)uVar3,
                       CONCAT12((char)((uint)uVar3 >> 8),
                                CONCAT11((char)((uint)uVar3 >> 0x10),(char)((uint)uVar3 >> 0x18))));
    }
    *(undefined4 *)&pcVar8->h_magic = uVar3;
    pcVar8 = (cdf_header_t *)((long)&pcVar8->h_magic + 4);
  } while (h + 1 != pcVar8);
  if (lVar4 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Unknown calling convention

void cdf_unpack_header(cdf_header_t *h,char *buf)

{
  uint64_t uVar1;
  long lVar2;
  
  h->h_magic = *(uint64_t *)buf;
  uVar1 = *(uint64_t *)(buf + 0x10);
  h->h_uuid[0] = *(uint64_t *)(buf + 8);
  h->h_uuid[1] = uVar1;
  h->h_revision = *(uint16_t *)(buf + 0x18);
  h->h_version = *(uint16_t *)(buf + 0x1a);
  h->h_byte_order = *(uint16_t *)(buf + 0x1c);
  h->h_sec_size_p2 = *(uint16_t *)(buf + 0x1e);
  h->h_short_sec_size_p2 = *(uint16_t *)(buf + 0x20);
  *(undefined8 *)h->h_unused0 = *(undefined8 *)(buf + 0x22);
  *(undefined2 *)(h->h_unused0 + 8) = *(undefined2 *)(buf + 0x2a);
  h->h_num_sectors_in_sat = *(uint32_t *)(buf + 0x2c);
  h->h_secid_first_directory = *(uint32_t *)(buf + 0x30);
  *(undefined4 *)h->h_unused1 = *(undefined4 *)(buf + 0x34);
  h->h_min_size_standard_stream = *(uint32_t *)(buf + 0x38);
  h->h_secid_first_sector_in_short_sat = *(cdf_secid_t *)(buf + 0x3c);
  h->h_num_sectors_in_short_sat = *(uint32_t *)(buf + 0x40);
  h->h_secid_first_sector_in_master_sat = *(cdf_secid_t *)(buf + 0x44);
  h->h_num_sectors_in_master_sat = *(uint32_t *)(buf + 0x48);
  lVar2 = 0x4c;
  do {
    *(undefined4 *)((long)h->h_uuid + lVar2 + -8) = *(undefined4 *)(buf + lVar2);
    lVar2 = lVar2 + 4;
  } while (lVar2 != 0x200);
  return;
}



void cdf_swap_dir(cdf_directory_t *d)

{
  uint32_t uVar1;
  cdf_dirid_t cVar2;
  uint32_t uVar3;
  cdf_secid_t cVar4;
  long lVar5;
  uint64_t uVar6;
  cdf_timestamp_t cVar7;
  long in_FS_OFFSET;
  uint16_t rv;
  
  uVar1 = d->d_size;
  lVar5 = *(long *)(in_FS_OFFSET + 0x28);
  if (cdf_bo.u == 0x1020304) {
    d->d_namelen = CONCAT11((char)d->d_namelen,(char)(d->d_namelen >> 8));
    cVar2 = d->d_left_child;
    d->d_left_child =
         CONCAT13((char)cVar2,
                  CONCAT12((char)((uint)cVar2 >> 8),
                           CONCAT11((char)((uint)cVar2 >> 0x10),(char)((uint)cVar2 >> 0x18))));
    cVar2 = d->d_right_child;
    d->d_right_child =
         CONCAT13((char)cVar2,
                  CONCAT12((char)((uint)cVar2 >> 8),
                           CONCAT11((char)((uint)cVar2 >> 0x10),(char)((uint)cVar2 >> 0x18))));
    cVar2 = d->d_storage;
    d->d_storage = CONCAT13((char)cVar2,
                            CONCAT12((char)((uint)cVar2 >> 8),
                                     CONCAT11((char)((uint)cVar2 >> 0x10),
                                              (char)((uint)cVar2 >> 0x18))));
    uVar6 = d->d_storage_uuid[0];
    d->d_storage_uuid[0] =
         CONCAT17((char)uVar6,
                  CONCAT16((char)(uVar6 >> 8),
                           CONCAT15((char)(uVar6 >> 0x10),
                                    CONCAT14((char)(uVar6 >> 0x18),
                                             CONCAT13((char)(uVar6 >> 0x20),
                                                      CONCAT12((char)(uVar6 >> 0x28),
                                                               CONCAT11((char)(uVar6 >> 0x30),
                                                                        (char)(uVar6 >> 0x38))))))))
    ;
    uVar6 = d->d_storage_uuid[1];
    d->d_storage_uuid[1] =
         CONCAT17((char)uVar6,
                  CONCAT16((char)(uVar6 >> 8),
                           CONCAT15((char)(uVar6 >> 0x10),
                                    CONCAT14((char)(uVar6 >> 0x18),
                                             CONCAT13((char)(uVar6 >> 0x20),
                                                      CONCAT12((char)(uVar6 >> 0x28),
                                                               CONCAT11((char)(uVar6 >> 0x30),
                                                                        (char)(uVar6 >> 0x38))))))))
    ;
    uVar3 = d->d_flags;
    d->d_flags = CONCAT13((char)uVar3,
                          CONCAT12((char)(uVar3 >> 8),
                                   CONCAT11((char)(uVar3 >> 0x10),(char)(uVar3 >> 0x18))));
    cVar7 = d->d_created;
    d->d_created = CONCAT17((char)cVar7,
                            CONCAT16((char)((ulong)cVar7 >> 8),
                                     CONCAT15((char)((ulong)cVar7 >> 0x10),
                                              CONCAT14((char)((ulong)cVar7 >> 0x18),
                                                       CONCAT13((char)((ulong)cVar7 >> 0x20),
                                                                CONCAT12((char)((ulong)cVar7 >> 0x28
                                                                               ),CONCAT11((char)((
                                                  ulong)cVar7 >> 0x30),(char)((ulong)cVar7 >> 0x38))
                                                  ))))));
    cVar7 = d->d_modified;
    d->d_modified =
         CONCAT17((char)cVar7,
                  CONCAT16((char)((ulong)cVar7 >> 8),
                           CONCAT15((char)((ulong)cVar7 >> 0x10),
                                    CONCAT14((char)((ulong)cVar7 >> 0x18),
                                             CONCAT13((char)((ulong)cVar7 >> 0x20),
                                                      CONCAT12((char)((ulong)cVar7 >> 0x28),
                                                               CONCAT11((char)((ulong)cVar7 >> 0x30)
                                                                        ,(char)((ulong)cVar7 >> 0x38
                                                                               ))))))));
    cVar4 = d->d_stream_first_sector;
    d->d_stream_first_sector =
         CONCAT13((char)cVar4,
                  CONCAT12((char)((uint)cVar4 >> 8),
                           CONCAT11((char)((uint)cVar4 >> 0x10),(char)((uint)cVar4 >> 0x18))));
    uVar1 = CONCAT13((char)uVar1,
                     CONCAT12((char)(uVar1 >> 8),
                              CONCAT11((char)(uVar1 >> 0x10),(char)(uVar1 >> 0x18))));
  }
  d->d_size = uVar1;
  if (lVar5 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



void cdf_swap_class(cdf_classid_t *d)

{
  uint16_t uVar1;
  uint32_t uVar2;
  long lVar3;
  undefined2 uVar4;
  long in_FS_OFFSET;
  uint32_t rv;
  
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  uVar1 = d->cl_word[1];
  rv._0_2_ = uVar1;
  if (cdf_bo.u == 0x1020304) {
    uVar2 = d->cl_dword;
    uVar4 = CONCAT11((char)uVar2,(char)(uVar2 >> 8));
    rv._0_2_ = CONCAT11((char)(uVar2 >> 0x10),(char)(uVar2 >> 0x18));
    rv = CONCAT22(uVar4,(uint16_t)rv);
    d->cl_dword = rv;
    rv = CONCAT31(CONCAT21(uVar4,(char)d->cl_word[0]),(char)(d->cl_word[0] >> 8));
    d->cl_word[0] = (uint16_t)rv;
    rv = CONCAT31(CONCAT21(uVar4,(char)uVar1),(char)(uVar1 >> 8));
  }
  d->cl_word[1] = (uint16_t)rv;
  if (lVar3 == *(long *)(in_FS_OFFSET + 0x28)) {
    return;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



// WARNING: Unknown calling convention

void cdf_unpack_dir(cdf_directory_t *d,char *buf)

{
  undefined8 uVar1;
  uint64_t uVar2;
  
  uVar1 = *(undefined8 *)(buf + 8);
  *(undefined8 *)d->d_name = *(undefined8 *)buf;
  *(undefined8 *)(d->d_name + 4) = uVar1;
  uVar1 = *(undefined8 *)(buf + 0x18);
  *(undefined8 *)(d->d_name + 8) = *(undefined8 *)(buf + 0x10);
  *(undefined8 *)(d->d_name + 0xc) = uVar1;
  uVar1 = *(undefined8 *)(buf + 0x28);
  *(undefined8 *)(d->d_name + 0x10) = *(undefined8 *)(buf + 0x20);
  *(undefined8 *)(d->d_name + 0x14) = uVar1;
  uVar1 = *(undefined8 *)(buf + 0x38);
  *(undefined8 *)(d->d_name + 0x18) = *(undefined8 *)(buf + 0x30);
  *(undefined8 *)(d->d_name + 0x1c) = uVar1;
  d->d_namelen = *(uint16_t *)(buf + 0x40);
  d->d_type = buf[0x42];
  d->d_color = buf[0x43];
  d->d_left_child = *(cdf_dirid_t *)(buf + 0x44);
  d->d_right_child = *(cdf_dirid_t *)(buf + 0x48);
  d->d_storage = *(cdf_dirid_t *)(buf + 0x4c);
  uVar2 = *(uint64_t *)(buf + 0x58);
  d->d_storage_uuid[0] = *(uint64_t *)(buf + 0x50);
  d->d_storage_uuid[1] = uVar2;
  d->d_flags = *(uint32_t *)(buf + 0x60);
  d->d_created = *(cdf_timestamp_t *)(buf + 100);
  d->d_modified = *(cdf_timestamp_t *)(buf + 0x6c);
  d->d_stream_first_sector = *(cdf_secid_t *)(buf + 0x74);
  d->d_size = *(uint32_t *)(buf + 0x78);
  d->d_unused0 = *(uint32_t *)(buf + 0x7c);
  return;
}



int cdf_read_header(cdf_info_t *info,cdf_header_t *h)

{
  long lVar1;
  int iVar2;
  ssize_t sVar3;
  int *piVar4;
  cdf_header_t *h_00;
  long in_FS_OFFSET;
  char buf [512];
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  cdf_bo.u = 0x4030201;
  sVar3 = cdf_read(info,0,buf,0x200);
  if (sVar3 == -1) {
    iVar2 = -1;
  }
  else {
    h_00 = h;
    cdf_unpack_header(h,buf);
    cdf_swap_header(h_00);
    if (((h->h_magic == 0xe11ab1a1e011cfd0) && (h->h_sec_size_p2 < 0x15)) &&
       (h->h_short_sec_size_p2 < 0x15)) {
      iVar2 = 0;
    }
    else {
      piVar4 = __errno_location();
      *piVar4 = 0x16;
      iVar2 = -1;
    }
  }
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar2;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



ssize_t cdf_read_sector(cdf_info_t *info,void *buf,size_t offs,size_t len,cdf_header_t *h,
                       cdf_secid_t id)

{
  ssize_t sVar1;
  size_t len_00;
  
  len_00 = (size_t)(1 << ((byte)h->h_sec_size_p2 & 0x1f));
  if (len_00 == len) {
    sVar1 = cdf_read(info,((long)id + 1) * len_00,(void *)(offs + (long)buf),len_00);
    return sVar1;
  }
                    // WARNING: Subroutine does not return
  __assert_fail("ss == len","cdf.c",0x173,"cdf_read_sector");
}



ssize_t cdf_read_short_sector
                  (cdf_stream_t *sst,void *buf,size_t offs,size_t len,cdf_header_t *h,cdf_secid_t id
                  )

{
  int *piVar1;
  size_t __n;
  
  __n = (size_t)(1 << ((byte)h->h_short_sec_size_p2 & 0x1f));
  if (__n == len) {
    if ((long)(1 << ((byte)h->h_sec_size_p2 & 0x1f)) * sst->sst_len < (long)id * __n + __n) {
      piVar1 = __errno_location();
      *piVar1 = 0x16;
      __n = 0xffffffffffffffff;
    }
    else {
      memcpy((void *)((long)buf + offs),(void *)((long)sst->sst_tab + (long)id * __n),__n);
    }
    return __n;
  }
                    // WARNING: Subroutine does not return
  __assert_fail("ss == len","cdf.c",0x17d,"cdf_read_short_sector");
}



int cdf_read_sat(cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat)

{
  long lVar1;
  uint32_t uVar2;
  long lVar3;
  undefined auVar4 [16];
  int iVar5;
  ulong uVar6;
  ulong uVar7;
  cdf_secid_t *pcVar8;
  void *buf;
  ulong uVar9;
  size_t sVar10;
  int *piVar11;
  size_t __nmemb;
  ulong __size;
  size_t offs;
  size_t sVar12;
  long in_FS_OFFSET;
  ulong local_58;
  uint32_t rv;
  
  uVar9 = 0;
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  __size = (ulong)(1 << ((byte)h->h_sec_size_p2 & 0x1f));
  uVar6 = (__size >> 2) - 1;
  do {
    if (h->h_master_sat[uVar9] == -1) break;
    uVar9 = uVar9 + 1;
  } while (uVar9 != 0x6d);
  auVar4._8_8_ = 0;
  auVar4._0_8_ = __size * 4;
  uVar7 = SUB168((ZEXT816(0) << 0x40 | ZEXT816(0xffffffff)) / auVar4,0);
  if (((uVar6 == 0) || ((ulong)h->h_num_sectors_in_master_sat <= uVar7 / uVar6)) && (uVar9 <= uVar7)
     ) {
    __nmemb = uVar9 + h->h_num_sectors_in_master_sat * uVar6;
    sat->sat_len = __nmemb;
    pcVar8 = (cdf_secid_t *)calloc(__nmemb,__size);
    sat->sat_tab = pcVar8;
    if (pcVar8 == (cdf_secid_t *)0x0) {
      iVar5 = -1;
    }
    else {
      sVar10 = 0;
      sVar12 = 0;
      do {
        if (h->h_master_sat[sVar12] < 0) break;
        uVar9 = cdf_read_sector(info,sat->sat_tab,sVar10,__size,h,h->h_master_sat[sVar12]);
        if (uVar9 != __size) goto LAB_00117270;
        sVar12 = sVar12 + 1;
        sVar10 = sVar10 + __size;
      } while (sVar12 != 0x6d);
      buf = calloc(1,__size);
      if (buf == (void *)0x0) {
LAB_00117270:
        pcVar8 = sat->sat_tab;
      }
      else {
        rv = h->h_secid_first_sector_in_master_sat;
        if ((h->h_num_sectors_in_master_sat == 0) || ((int)rv < 0)) {
LAB_0011725b:
          sat->sat_len = sVar12;
          free(buf);
          iVar5 = 0;
          goto LAB_00117280;
        }
        local_58 = 0;
        do {
          uVar9 = cdf_read_sector(info,buf,0,__size,h,rv);
          if (uVar9 != __size) {
LAB_0011733b:
            pcVar8 = sat->sat_tab;
            goto LAB_0011733e;
          }
          if (uVar6 != 0) {
            sVar10 = uVar6 + sVar12;
            offs = __size * sVar12;
            lVar1 = sVar12 * -4;
            do {
              uVar2 = *(uint32_t *)((long)buf + sVar12 * 4 + lVar1);
              rv = uVar2;
              if (cdf_bo.u == 0x1020304) {
                rv._0_2_ = CONCAT11((char)(uVar2 >> 0x10),(char)(uVar2 >> 0x18));
                rv._3_1_ = (undefined)uVar2;
                rv._0_3_ = CONCAT12((char)(uVar2 >> 8),(undefined2)rv);
              }
              if ((int)rv < 0) goto LAB_0011725b;
              pcVar8 = sat->sat_tab;
              if (sat->sat_len <= sVar12) goto LAB_00117320;
              uVar9 = cdf_read_sector(info,pcVar8,offs,__size,h,rv);
              if (uVar9 != __size) goto LAB_0011733b;
              sVar12 = sVar12 + 1;
              offs = offs + __size;
            } while (sVar10 != sVar12);
          }
          uVar2 = *(uint32_t *)((long)buf + uVar6 * 4);
          rv = uVar2;
          if (cdf_bo.u == 0x1020304) {
            rv._0_2_ = CONCAT11((char)(uVar2 >> 0x10),(char)(uVar2 >> 0x18));
            rv._3_1_ = (undefined)uVar2;
            rv._0_3_ = CONCAT12((char)(uVar2 >> 8),(undefined2)rv);
          }
          local_58 = local_58 + 1;
          if ((h->h_num_sectors_in_master_sat <= local_58) || ((int)rv < 0)) goto LAB_0011725b;
        } while (local_58 != 10000);
        pcVar8 = sat->sat_tab;
LAB_00117320:
        piVar11 = __errno_location();
        *piVar11 = 0x16;
LAB_0011733e:
        free(buf);
      }
      free(pcVar8);
      iVar5 = -1;
    }
  }
  else {
    piVar11 = __errno_location();
    *piVar11 = 0x16;
    iVar5 = -1;
  }
LAB_00117280:
  if (lVar3 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar5;
}



size_t cdf_count_chain(cdf_sat_t *sat,cdf_secid_t sid,size_t size)

{
  long lVar1;
  uint uVar2;
  uint uVar3;
  uint uVar4;
  undefined uVar5;
  long lVar6;
  int *piVar7;
  int iVar8;
  size_t sVar9;
  long in_FS_OFFSET;
  uint32_t rv;
  
  lVar6 = (long)sid;
  sVar9 = 0;
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  if (sid != -2) {
    if ((-1 < sid) && (iVar8 = (int)(size * sat->sat_len >> 2), sid < iVar8)) {
      do {
        rv = sat->sat_tab[lVar6];
        if (cdf_bo.u == 0x1020304) {
          uVar2 = rv >> 8;
          uVar5 = (undefined)rv;
          uVar3 = rv >> 0x18;
          uVar4 = rv >> 0x10;
          rv = CONCAT22(CONCAT11(uVar5,(char)uVar2),CONCAT11((char)uVar4,(char)uVar3));
        }
        lVar6 = (long)(int)rv;
        sVar9 = sVar9 + 1;
        if ((int)rv < 0) goto LAB_0011740a;
      } while (((int)rv < iVar8) && (sVar9 != 10000));
    }
    piVar7 = __errno_location();
    sVar9 = 0xffffffffffffffff;
    *piVar7 = 0x16;
  }
LAB_0011740a:
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return sVar9;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int cdf_read_long_sector_chain
              (cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_secid_t sid,size_t len,
              cdf_stream_t *scn)

{
  long lVar1;
  uint uVar2;
  uint uVar3;
  uint uVar4;
  int iVar5;
  ulong __nmemb;
  void *buf;
  size_t sVar6;
  int *piVar7;
  undefined uVar8;
  ulong uVar9;
  size_t offs;
  size_t size;
  long in_FS_OFFSET;
  uint32_t rv;
  
  size = (size_t)(1 << ((byte)h->h_sec_size_p2 & 0x1f));
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  scn->sst_tab = (void *)0x0;
  __nmemb = cdf_count_chain(sat,sid,size);
  scn->sst_dirlen = len;
  scn->sst_len = __nmemb;
  scn->sst_ss = size;
  if (__nmemb == 0xffffffffffffffff) {
LAB_001175e3:
    buf = scn->sst_tab;
  }
  else {
    buf = calloc(__nmemb,size);
    scn->sst_tab = buf;
    if (buf == (void *)0x0) {
      scn->sst_len = 0;
      iVar5 = -1;
      scn->sst_dirlen = 0;
      scn->sst_ss = 0;
      goto LAB_001175c4;
    }
    offs = 0;
    uVar9 = 0;
    if (sid < 0) {
LAB_001175c2:
      iVar5 = 0;
      goto LAB_001175c4;
    }
    while (uVar9 < __nmemb) {
      sVar6 = cdf_read_sector(info,buf,offs,size,h,sid);
      if (size != sVar6) {
        if ((scn->sst_len - 1 != uVar9) || ((long)sVar6 < 1)) goto LAB_001175e3;
        goto LAB_001175c2;
      }
      rv = sat->sat_tab[sid];
      if (cdf_bo.u == 0x1020304) {
        uVar2 = rv >> 8;
        uVar8 = (undefined)rv;
        uVar3 = rv >> 0x18;
        uVar4 = rv >> 0x10;
        rv = CONCAT22(CONCAT11(uVar8,(char)uVar2),CONCAT11((char)uVar4,(char)uVar3));
      }
      uVar9 = uVar9 + 1;
      if ((int)rv < 0) goto LAB_001175c2;
      buf = scn->sst_tab;
      offs = offs + size;
      if (uVar9 == 10000) break;
      sid = rv;
      __nmemb = scn->sst_len;
    }
  }
  piVar7 = __errno_location();
  *piVar7 = 0x16;
  scn->sst_len = 0;
  scn->sst_dirlen = 0;
  scn->sst_ss = 0;
  free(buf);
  scn->sst_tab = (void *)0x0;
  iVar5 = -1;
LAB_001175c4:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar5;
}



int cdf_read_short_sector_chain
              (cdf_header_t *h,cdf_sat_t *ssat,cdf_stream_t *sst,cdf_secid_t sid,size_t len,
              cdf_stream_t *scn)

{
  uint16_t uVar1;
  uint16_t uVar2;
  long lVar3;
  uint uVar4;
  uint uVar5;
  uint uVar6;
  int iVar7;
  ulong __nmemb;
  void *buf;
  size_t sVar8;
  int *piVar9;
  undefined uVar10;
  ulong uVar11;
  size_t __size;
  size_t offs;
  long in_FS_OFFSET;
  uint32_t rv;
  
  uVar1 = h->h_short_sec_size_p2;
  uVar2 = h->h_sec_size_p2;
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  scn->sst_tab = (void *)0x0;
  __size = (size_t)(1 << ((byte)uVar1 & 0x1f));
  __nmemb = cdf_count_chain(ssat,sid,(long)(1 << ((byte)uVar2 & 0x1f)));
  scn->sst_dirlen = len;
  scn->sst_len = __nmemb;
  scn->sst_ss = __size;
  if (__nmemb == 0xffffffffffffffff) {
LAB_001177a0:
    buf = scn->sst_tab;
  }
  else {
    buf = calloc(__nmemb,__size);
    scn->sst_tab = buf;
    if (buf == (void *)0x0) {
      scn->sst_len = 0;
      iVar7 = -1;
      scn->sst_dirlen = 0;
      scn->sst_ss = 0;
      goto LAB_00117774;
    }
    offs = 0;
    uVar11 = 0;
    if (sid < 0) {
LAB_00117798:
      iVar7 = 0;
      goto LAB_00117774;
    }
    while (uVar11 < __nmemb) {
      sVar8 = cdf_read_short_sector(sst,buf,offs,__size,h,sid);
      if (sVar8 != __size) goto LAB_001177a0;
      rv = ssat->sat_tab[sid];
      if (cdf_bo.u == 0x1020304) {
        uVar4 = rv >> 8;
        uVar10 = (undefined)rv;
        uVar5 = rv >> 0x18;
        uVar6 = rv >> 0x10;
        rv = CONCAT22(CONCAT11(uVar10,(char)uVar4),CONCAT11((char)uVar6,(char)uVar5));
      }
      uVar11 = uVar11 + 1;
      if ((int)rv < 0) goto LAB_00117798;
      buf = scn->sst_tab;
      offs = offs + __size;
      if (uVar11 == 10000) break;
      sid = rv;
      __nmemb = scn->sst_len;
    }
  }
  piVar9 = __errno_location();
  *piVar9 = 0x16;
  scn->sst_len = 0;
  scn->sst_dirlen = 0;
  scn->sst_ss = 0;
  free(buf);
  scn->sst_tab = (void *)0x0;
  iVar7 = -1;
LAB_00117774:
  if (lVar3 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar7;
}



int cdf_read_sector_chain
              (cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_sat_t *ssat,cdf_stream_t *sst,
              cdf_secid_t sid,size_t len,cdf_stream_t *scn)

{
  int iVar1;
  
  if ((len < h->h_min_size_standard_stream) && (sst->sst_tab != (void *)0x0)) {
    iVar1 = cdf_read_short_sector_chain(h,ssat,sst,sid,len,scn);
    return iVar1;
  }
  iVar1 = cdf_read_long_sector_chain(info,h,sat,sid,len,scn);
  return iVar1;
}



int cdf_read_dir(cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_dir_t *dir)

{
  uint32_t sid;
  long lVar1;
  int iVar2;
  size_t sVar3;
  cdf_directory_t *__ptr;
  char *buf;
  ulong uVar4;
  ulong uVar5;
  int *piVar6;
  long lVar7;
  long extraout_RDX;
  char *buf_00;
  ulong uVar8;
  long lVar9;
  ulong uVar10;
  long in_FS_OFFSET;
  size_t local_80;
  uint32_t rv;
  
  sid = h->h_secid_first_directory;
  uVar10 = (ulong)(1 << ((byte)h->h_sec_size_p2 & 0x1f));
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  sVar3 = cdf_count_chain(sat,sid,uVar10);
  if (sVar3 != 0xffffffffffffffff) {
    uVar8 = uVar10 >> 7;
    dir->dir_len = sVar3 * uVar8;
    __ptr = (cdf_directory_t *)calloc(sVar3 * uVar8,0x88);
    dir->dir_tab = __ptr;
    if (__ptr != (cdf_directory_t *)0x0) {
      buf = (char *)malloc(uVar10);
      if (buf == (char *)0x0) {
        free(__ptr);
        iVar2 = -1;
        goto LAB_001179ea;
      }
      if (sVar3 == 0) {
LAB_00117a10:
        free(buf);
        iVar2 = 0;
        goto LAB_001179ea;
      }
      local_80 = 0;
      uVar4 = 1;
      if (uVar8 != 0) {
        uVar4 = uVar8 + 1;
      }
      lVar9 = 0;
      do {
        uVar5 = cdf_read_sector(info,buf,0,uVar10,h,sid);
        if (uVar5 != uVar10) break;
        if (uVar8 != 0) {
          lVar7 = lVar9 * 0x88;
          buf_00 = buf;
          do {
            cdf_unpack_dir((cdf_directory_t *)((long)dir->dir_tab->d_name + lVar7),buf_00);
            buf_00 = (char *)(extraout_RDX + 0x80);
            lVar7 = lVar7 + 0x88;
          } while (buf + uVar8 * 0x80 != buf_00);
        }
        sid = sat->sat_tab[(int)sid];
        if (cdf_bo.u == 0x1020304) {
          rv._0_2_ = CONCAT11((char)(sid >> 0x10),(char)(sid >> 0x18));
          sid = CONCAT22(CONCAT11((char)sid,(char)(sid >> 8)),(undefined2)rv);
        }
        local_80 = local_80 + 1;
        if (sVar3 == local_80) {
          if ((cdf_bo.u == 0x1020304) && (dir->dir_len != 0)) {
            uVar10 = 0;
            do {
              uVar8 = uVar10 + 1;
              cdf_swap_dir(dir->dir_tab + uVar10);
              uVar10 = uVar8;
            } while (uVar8 < dir->dir_len);
            free(buf);
            iVar2 = 0;
            goto LAB_001179ea;
          }
          goto LAB_00117a10;
        }
        lVar9 = lVar9 + uVar8;
      } while (uVar4 < 10000);
      free(dir->dir_tab);
      free(buf);
      piVar6 = __errno_location();
      *piVar6 = 0x16;
    }
  }
  iVar2 = -1;
LAB_001179ea:
  if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar2;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int cdf_read_ssat(cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_sat_t *ssat)

{
  uint16_t uVar1;
  long lVar2;
  uint uVar3;
  uint uVar4;
  uint uVar5;
  int iVar6;
  size_t __nmemb;
  cdf_secid_t *buf;
  size_t sVar7;
  int *piVar8;
  undefined uVar9;
  ulong uVar10;
  size_t size;
  size_t offs;
  long in_FS_OFFSET;
  uint32_t rv;
  
  uVar1 = h->h_sec_size_p2;
  rv = h->h_secid_first_sector_in_short_sat;
  lVar2 = *(long *)(in_FS_OFFSET + 0x28);
  ssat->sat_tab = (cdf_secid_t *)0x0;
  size = (size_t)(1 << ((byte)uVar1 & 0x1f));
  __nmemb = cdf_count_chain(sat,rv,size);
  ssat->sat_len = __nmemb;
  if (__nmemb == 0xffffffffffffffff) {
    buf = ssat->sat_tab;
LAB_00117b85:
    piVar8 = __errno_location();
    *piVar8 = 0x16;
  }
  else {
    buf = (cdf_secid_t *)calloc(__nmemb,size);
    ssat->sat_tab = buf;
    if (buf != (cdf_secid_t *)0x0) {
      offs = 0;
      uVar10 = 0;
      if ((int)rv < 0) {
LAB_00117bd0:
        iVar6 = 0;
        goto LAB_00117ba7;
      }
      while (uVar10 < __nmemb) {
        sVar7 = cdf_read_sector(info,buf,offs,size,h,rv);
        if (sVar7 != size) {
          buf = ssat->sat_tab;
          goto LAB_00117b9a;
        }
        rv = sat->sat_tab[(int)rv];
        if (cdf_bo.u == 0x1020304) {
          uVar3 = rv >> 8;
          uVar9 = (undefined)rv;
          uVar4 = rv >> 0x18;
          uVar5 = rv >> 0x10;
          rv = CONCAT22(CONCAT11(uVar9,(char)uVar3),CONCAT11((char)uVar5,(char)uVar4));
        }
        uVar10 = uVar10 + 1;
        if ((int)rv < 0) goto LAB_00117bd0;
        buf = ssat->sat_tab;
        offs = offs + size;
        if (uVar10 == 10000) break;
        __nmemb = ssat->sat_len;
      }
      goto LAB_00117b85;
    }
  }
LAB_00117b9a:
  free(buf);
  iVar6 = -1;
LAB_00117ba7:
  if (lVar2 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar6;
}



int cdf_read_short_stream
              (cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_dir_t *dir,cdf_stream_t *scn,
              cdf_directory_t **root)

{
  cdf_secid_t sid;
  size_t sVar1;
  int iVar2;
  cdf_directory_t *pcVar3;
  size_t sVar4;
  
  sVar1 = dir->dir_len;
  *root = (cdf_directory_t *)0x0;
  if (sVar1 != 0) {
    pcVar3 = dir->dir_tab;
    sVar4 = 0;
    do {
      if (pcVar3->d_type == '\x05') {
        sid = pcVar3->d_stream_first_sector;
        *root = pcVar3;
        if (-1 < sid) {
          iVar2 = cdf_read_long_sector_chain(info,h,sat,sid,(ulong)pcVar3->d_size,scn);
          return iVar2;
        }
        break;
      }
      sVar4 = sVar4 + 1;
      pcVar3 = pcVar3 + 1;
    } while (sVar1 != sVar4);
  }
  scn->sst_tab = (void *)0x0;
  scn->sst_len = 0;
  scn->sst_dirlen = 0;
  scn->sst_ss = 0;
  return 0;
}



int cdf_find_stream(cdf_dir_t *dir,char *name,int type)

{
  long lVar1;
  size_t sVar2;
  size_t sVar3;
  int *piVar4;
  size_t sVar5;
  ushort uVar6;
  cdf_directory_t *pcVar7;
  ushort uVar8;
  long in_FS_OFFSET;
  bool bVar9;
  uint16_t rv;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  sVar2 = strlen(name);
  sVar3 = dir->dir_len;
  if (sVar3 != 0) {
    pcVar7 = dir->dir_tab + (sVar3 - 1);
    do {
      if ((uint)pcVar7->d_type == type) {
        sVar5 = 0;
        while( true ) {
          uVar8 = pcVar7->d_name[sVar5];
          uVar6 = uVar8;
          if (cdf_bo.u == 0x1020304) {
            uVar6 = uVar8 << 8 | uVar8 >> 8;
          }
          if ((int)name[sVar5] != (uint)uVar6) break;
          bVar9 = sVar2 == sVar5;
          sVar5 = sVar5 + 1;
          if (bVar9) goto LAB_00117d50;
        }
        if (cdf_bo.u == 0x1020304) {
          uVar8 = uVar8 << 8 | uVar8 >> 8;
        }
        if ((byte)name[sVar5] == uVar8) goto LAB_00117d50;
      }
      pcVar7 = pcVar7 + -1;
      sVar3 = sVar3 - 1;
    } while (sVar3 != 0);
  }
  piVar4 = __errno_location();
  *piVar4 = 3;
  sVar3 = 0;
LAB_00117d50:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return (int)sVar3;
}



int cdf_read_user_stream
              (cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_sat_t *ssat,cdf_stream_t *sst,
              cdf_dir_t *dir,char *name,cdf_stream_t *scn)

{
  int iVar1;
  
  iVar1 = cdf_find_stream(dir,name,2);
  if (0 < iVar1) {
    iVar1 = cdf_read_sector_chain
                      (info,h,sat,ssat,sst,dir->dir_tab[(long)iVar1 + -1].d_stream_first_sector,
                       (ulong)dir->dir_tab[(long)iVar1 + -1].d_size,scn);
    return iVar1;
  }
  scn->sst_tab = (void *)0x0;
  scn->sst_len = 0;
  scn->sst_dirlen = 0;
  scn->sst_ss = 0;
  return -1;
}



int cdf_read_summary_info
              (cdf_info_t *info,cdf_header_t *h,cdf_sat_t *sat,cdf_sat_t *ssat,cdf_stream_t *sst,
              cdf_dir_t *dir,cdf_stream_t *scn)

{
  int iVar1;
  
  iVar1 = cdf_read_user_stream(info,h,sat,ssat,sst,dir,"\x05SummaryInformation",scn);
  return iVar1;
}



int cdf_read_property_info
              (cdf_stream_t *sst,cdf_header_t *h,uint32_t offs,cdf_property_info_t **info,
              size_t *count,size_t *maxcount)

{
  uint *p;
  long lVar1;
  uint3 uVar2;
  anon_union_4_2_94730243 aVar3;
  uint16_t uVar4;
  int iVar5;
  uint32_t uVar6;
  uint64_t uVar7;
  int *piVar8;
  size_t sVar9;
  cdf_property_info_t *pcVar10;
  long lVar11;
  uint uVar12;
  uint *puVar13;
  ulong uVar14;
  cdf_property_info_t *pcVar15;
  anon_union_16_10_0598ddce_for_pi_val *paVar16;
  uint uVar17;
  size_t *psVar18;
  ulong uVar19;
  uint *puVar20;
  long lVar21;
  uint uVar22;
  long in_FS_OFFSET;
  cdf_property_info_t *local_90;
  ulong local_88;
  uint32_t rv;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  if (0x3fffffff < offs) goto LAB_00118462;
  puVar13 = (uint *)((long)sst->sst_tab + (ulong)offs);
  psVar18 = count;
  iVar5 = cdf_check_stream_offset(sst,h,puVar13,8,(int)count);
  aVar3 = cdf_bo;
  if (iVar5 == -1) goto LAB_00118240;
  uVar12 = *puVar13;
  if (cdf_bo.u == 0x1020304) {
    uVar12 = CONCAT13((char)uVar12,
                      CONCAT12((char)(uVar12 >> 8),
                               CONCAT11((char)(uVar12 >> 0x10),(char)(uVar12 >> 0x18))));
    if (0x1fffffff < uVar12) goto LAB_00118462;
    uVar22 = puVar13[1];
    uVar22 = CONCAT13((char)uVar22,
                      CONCAT12((char)(uVar22 >> 8),
                               CONCAT11((char)(uVar22 >> 0x10),(char)(uVar22 >> 0x18))));
LAB_00117ef5:
    if (0x2aaaaaa < uVar22) {
LAB_00118240:
      piVar8 = __errno_location();
      pcVar15 = *info;
      goto LAB_0011824d;
    }
    uVar14 = *maxcount;
    if (uVar14 == 0) {
      *maxcount = (ulong)uVar22;
      local_90 = (cdf_property_info_t *)malloc((ulong)uVar22 * 0x18);
    }
    else {
      pcVar15 = *info;
      if (0x2aaaaaa < uVar14) {
LAB_0011847a:
        piVar8 = __errno_location();
        goto LAB_0011824d;
      }
      *maxcount = uVar14 + uVar22;
      local_90 = (cdf_property_info_t *)realloc(pcVar15,(uVar14 + uVar22) * 0x18);
    }
    local_88 = (ulong)uVar22;
    if (local_90 != (cdf_property_info_t *)0x0) {
      sVar9 = *count;
      *info = local_90;
      local_90 = local_90 + sVar9;
      *count = sVar9 + local_88;
      p = (uint *)((long)sst->sst_tab + (ulong)offs + 8);
      puVar13 = (uint *)((long)puVar13 + (ulong)uVar12);
      iVar5 = cdf_check_stream_offset(sst,h,puVar13,0,(int)psVar18);
      if (iVar5 != -1) {
        if (uVar22 != 0) {
          uVar14 = 0;
          do {
            lVar21 = uVar14 * 2;
            iVar5 = cdf_check_stream_offset(sst,h,p,(lVar21 + 1) * 4,(int)psVar18);
            if (iVar5 == -1) goto LAB_00118240;
            uVar12 = p[lVar21 + 1];
            if (aVar3.u == 0x1020304) {
              puVar20 = (uint *)((long)p +
                                ((ulong)CONCAT13((char)uVar12,
                                                 CONCAT12((char)(uVar12 >> 8),
                                                          CONCAT11((char)(uVar12 >> 0x10),
                                                                   (char)(uVar12 >> 0x18)))) - 8));
              if ((puVar20 < p) || (puVar13 < puVar20)) goto LAB_00118240;
              uVar12 = p[lVar21];
              local_90[uVar14].pi_id =
                   CONCAT13((char)uVar12,
                            CONCAT12((char)(uVar12 >> 8),
                                     CONCAT11((char)(uVar12 >> 0x10),(char)(uVar12 >> 0x18))));
              uVar22 = *puVar20;
              uVar2 = CONCAT12((char)(uVar22 >> 8),
                               CONCAT11((char)(uVar22 >> 0x10),(char)(uVar22 >> 0x18)));
              uVar12 = CONCAT13((char)uVar22,uVar2);
              local_90[uVar14].pi_type = uVar12;
              uVar17 = uVar2 & 0x1000;
              if ((uVar22 & 0x100000) == 0) goto LAB_00118150;
              uVar22 = puVar20[1];
              uVar22 = CONCAT13((char)uVar22,
                                CONCAT12((char)(uVar22 >> 8),
                                         CONCAT11((char)(uVar22 >> 0x10),(char)(uVar22 >> 0x18))));
LAB_00118043:
              uVar19 = (ulong)uVar22;
              if (uVar19 == 0) goto LAB_00118240;
              lVar21 = 8;
              lVar11 = 2;
            }
            else {
              puVar20 = (uint *)((long)p + ((ulong)uVar12 - 8));
              if ((puVar20 < p) || (puVar13 < puVar20)) goto LAB_00118240;
              local_90[uVar14].pi_id = p[lVar21];
              uVar12 = *puVar20;
              local_90[uVar14].pi_type = uVar12;
              uVar17 = uVar12 & 0x1000;
              if (uVar17 != 0) {
                uVar22 = puVar20[1];
                goto LAB_00118043;
              }
LAB_00118150:
              lVar21 = 4;
              uVar19 = 1;
              lVar11 = 1;
            }
            pcVar15 = local_90 + uVar14;
            if (((uVar12 & 0xe000) != 0) || (false)) {
switchD_00118074_caseD_0:
              uVar14 = uVar14 + 1;
            }
            else {
              switch(uVar12 & 0xfff) {
              default:
                goto switchD_00118074_caseD_0;
              case 2:
                uVar14 = uVar14 + 1;
                if (uVar17 == 0) {
                  uVar4 = *(uint16_t *)((long)puVar20 + lVar21);
                  if (aVar3.u == 0x1020304) {
                    uVar4 = CONCAT11((char)uVar4,(char)(uVar4 >> 8));
                  }
                  (pcVar15->pi_val)._pi_u16 = uVar4;
                }
                break;
              case 3:
              case 4:
              case 0xb:
              case 0x13:
                uVar14 = uVar14 + 1;
                if (uVar17 == 0) {
                  uVar6 = *(uint32_t *)((long)puVar20 + lVar21);
                  if (aVar3.u == 0x1020304) {
                    uVar6 = CONCAT13((char)uVar6,
                                     CONCAT12((char)(uVar6 >> 8),
                                              CONCAT11((char)(uVar6 >> 0x10),(char)(uVar6 >> 0x18)))
                                    );
                  }
                  (pcVar15->pi_val)._pi_u32 = uVar6;
                }
                break;
              case 5:
              case 0x14:
              case 0x15:
              case 0x40:
                uVar14 = uVar14 + 1;
                if (uVar17 == 0) {
                  uVar7 = *(uint64_t *)((long)puVar20 + lVar21);
                  if (aVar3.u == 0x1020304) {
                    uVar7 = CONCAT17((char)uVar7,
                                     CONCAT16((char)(uVar7 >> 8),
                                              CONCAT15((char)(uVar7 >> 0x10),
                                                       CONCAT14((char)(uVar7 >> 0x18),
                                                                CONCAT13((char)(uVar7 >> 0x20),
                                                                         CONCAT12((char)(uVar7 >> 
                                                  0x28),CONCAT11((char)(uVar7 >> 0x30),
                                                                 (char)(uVar7 >> 0x38))))))));
                  }
                  (pcVar15->pi_val)._pi_u64 = uVar7;
                }
                break;
              case 0x1e:
              case 0x1f:
                if (uVar19 != 1) {
                  pcVar15 = *info;
                  if ((0x2aaaaaa < uVar19) || (0x2aaaaaa < *maxcount)) goto LAB_0011847a;
                  sVar9 = *maxcount + uVar19;
                  *maxcount = sVar9;
                  pcVar10 = (cdf_property_info_t *)realloc(pcVar15,sVar9 * 0x18);
                  if (pcVar10 == (cdf_property_info_t *)0x0) goto LAB_0011848c;
                  *info = pcVar10;
                  local_90 = (cdf_property_info_t *)
                             ((long)pcVar10 + ((long)local_90 - (long)pcVar15));
                }
                psVar18 = (size_t *)(ulong)aVar3.u;
                uVar19 = uVar19 + uVar14;
                paVar16 = &local_90[uVar14].pi_val;
                do {
                  if (local_88 <= uVar14) {
                    iVar5 = 0;
                    goto LAB_0011825d;
                  }
                  uVar12 = puVar20[lVar11];
                  if (aVar3.u == 0x1020304) {
                    uVar12 = CONCAT13((char)uVar12,
                                      CONCAT12((char)(uVar12 >> 8),
                                               CONCAT11((char)(uVar12 >> 0x10),
                                                        (char)(uVar12 >> 0x18))));
                  }
                  paVar16->_pi_u32 = uVar12;
                  *(long *)(&paVar16->_pi_u32 + 2) = (long)puVar20 + lVar21 + 4;
                  lVar11 = lVar11 + (ulong)((uVar12 + 1) - (uint)((uVar12 & 1) == 0) >> 1);
                  if (puVar13 <= (uint *)((long)puVar20 + lVar11)) goto LAB_00118240;
                  uVar14 = uVar14 + 1;
                  lVar21 = lVar11 * 4;
                  paVar16 = (anon_union_16_10_0598ddce_for_pi_val *)(&paVar16->_pi_u32 + 6);
                } while (uVar14 != uVar19);
              }
            }
          } while (uVar14 < local_88);
        }
        iVar5 = 0;
        goto LAB_0011825d;
      }
      goto LAB_00118240;
    }
LAB_0011848c:
    pcVar15 = *info;
  }
  else {
    if (uVar12 < 0x20000000) {
      uVar22 = puVar13[1];
      goto LAB_00117ef5;
    }
LAB_00118462:
    piVar8 = __errno_location();
    *piVar8 = 0x16;
    pcVar15 = *info;
LAB_0011824d:
    *piVar8 = 0x16;
  }
  free(pcVar15);
  iVar5 = -1;
LAB_0011825d:
  if (lVar1 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return iVar5;
}



int cdf_unpack_summary_info
              (cdf_stream_t *sst,cdf_header_t *h,cdf_summary_info_header_t *ssi,
              cdf_property_info_t **info,size_t *count)

{
  uint16_t uVar1;
  uint16_t uVar2;
  uint16_t uVar3;
  undefined4 uVar4;
  uint16_t *p;
  undefined8 uVar5;
  undefined8 uVar6;
  int iVar7;
  int line;
  long in_FS_OFFSET;
  uint32_t rv_4;
  size_t maxcount;
  long local_40;
  
  p = (uint16_t *)sst->sst_tab;
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  line = (int)(p + 0xe);
  iVar7 = cdf_check_stream_offset(sst,h,p,0x1c,line);
  if (iVar7 != -1) {
    iVar7 = cdf_check_stream_offset(sst,h,p + 0xe,0x14,line);
    if (iVar7 != -1) {
      uVar1 = *p;
      uVar2 = p[2];
      uVar3 = p[3];
      if (cdf_bo.u == 0x1020304) {
        maxcount = CONCAT71(CONCAT61(maxcount._2_6_,(char)uVar1),(char)(uVar1 >> 8));
        ssi->si_byte_order = (uint16_t)maxcount;
        maxcount = CONCAT71(CONCAT61(maxcount._2_6_,(char)uVar2),(char)(uVar2 >> 8));
        ssi->si_os_version = (uint16_t)maxcount;
        maxcount = CONCAT71(CONCAT61(maxcount._2_6_,(char)uVar3),(char)(uVar3 >> 8));
        uVar5 = *(undefined8 *)(p + 4);
        uVar6 = *(undefined8 *)(p + 8);
        ssi->si_os = (uint16_t)maxcount;
        (ssi->si_class).cl_dword = (int)uVar5;
        (ssi->si_class).cl_word[0] = (short)((ulong)uVar5 >> 0x20);
        (ssi->si_class).cl_word[1] = (short)((ulong)uVar5 >> 0x30);
        (ssi->si_class).cl_two[0] = (char)uVar6;
        (ssi->si_class).cl_two[1] = (char)((ulong)uVar6 >> 8);
        (ssi->si_class).cl_six[0] = (char)((ulong)uVar6 >> 0x10);
        (ssi->si_class).cl_six[1] = (char)((ulong)uVar6 >> 0x18);
        (ssi->si_class).cl_six[2] = (char)((ulong)uVar6 >> 0x20);
        (ssi->si_class).cl_six[3] = (char)((ulong)uVar6 >> 0x28);
        (ssi->si_class).cl_six[4] = (char)((ulong)uVar6 >> 0x30);
        (ssi->si_class).cl_six[5] = (char)((ulong)uVar6 >> 0x38);
        cdf_swap_class(&ssi->si_class);
        uVar4 = *(undefined4 *)(p + 0xc);
        maxcount._0_2_ = CONCAT11((char)((uint)uVar4 >> 0x10),(char)((uint)uVar4 >> 0x18));
        ssi->si_count = CONCAT22(CONCAT11((char)uVar4,(char)((uint)uVar4 >> 8)),(uint16_t)maxcount);
        uVar4 = *(undefined4 *)(p + 0x16);
        *count = 0;
        *info = (cdf_property_info_t *)0x0;
        rv_4 = CONCAT22(CONCAT11((char)uVar4,(char)((uint)uVar4 >> 8)),
                        CONCAT11((char)((uint)uVar4 >> 0x10),(char)((uint)uVar4 >> 0x18)));
      }
      else {
        ssi->si_os_version = uVar2;
        uVar5 = *(undefined8 *)(p + 4);
        uVar6 = *(undefined8 *)(p + 8);
        ssi->si_os = uVar3;
        ssi->si_byte_order = uVar1;
        (ssi->si_class).cl_dword = (int)uVar5;
        (ssi->si_class).cl_word[0] = (short)((ulong)uVar5 >> 0x20);
        (ssi->si_class).cl_word[1] = (short)((ulong)uVar5 >> 0x30);
        (ssi->si_class).cl_two[0] = (char)uVar6;
        (ssi->si_class).cl_two[1] = (char)((ulong)uVar6 >> 8);
        (ssi->si_class).cl_six[0] = (char)((ulong)uVar6 >> 0x10);
        (ssi->si_class).cl_six[1] = (char)((ulong)uVar6 >> 0x18);
        (ssi->si_class).cl_six[2] = (char)((ulong)uVar6 >> 0x20);
        (ssi->si_class).cl_six[3] = (char)((ulong)uVar6 >> 0x28);
        (ssi->si_class).cl_six[4] = (char)((ulong)uVar6 >> 0x30);
        (ssi->si_class).cl_six[5] = (char)((ulong)uVar6 >> 0x38);
        cdf_swap_class(&ssi->si_class);
        rv_4 = *(uint32_t *)(p + 0x16);
        ssi->si_count = *(uint32_t *)(p + 0xc);
        *count = 0;
        *info = (cdf_property_info_t *)0x0;
      }
      maxcount = 0;
      iVar7 = cdf_read_property_info(sst,h,rv_4,info,count,&maxcount);
      iVar7 = -(uint)(iVar7 == -1);
      goto LAB_0011858e;
    }
  }
  iVar7 = -1;
LAB_0011858e:
  if (local_40 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar7;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int cdf_unpack_catalog(cdf_header_t *h,cdf_stream_t *sst,cdf_catalog_t **cat)

{
  ushort uVar1;
  uint uVar2;
  undefined4 uVar3;
  long lVar4;
  anon_union_4_2_94730243 aVar5;
  int iVar6;
  cdf_catalog_t *pcVar7;
  ushort *puVar8;
  ushort *puVar9;
  ulong uVar10;
  byte bVar11;
  ushort *puVar12;
  ushort *puVar13;
  long lVar14;
  ulong uVar15;
  ushort *puVar16;
  ulong uVar17;
  undefined8 uVar18;
  ulong uVar19;
  ushort uVar20;
  long in_FS_OFFSET;
  uint16_t rv;
  
  aVar5.s = cdf_bo.s;
  lVar4 = *(long *)(in_FS_OFFSET + 0x28);
  if (sst->sst_dirlen < (ulong)h->h_min_size_standard_stream) {
    bVar11 = (byte)h->h_short_sec_size_p2;
  }
  else {
    bVar11 = (byte)h->h_sec_size_p2;
  }
  if (sst->sst_ss != (long)(1 << (bVar11 & 0x1f))) {
    cdf_check_stream((cdf_stream_t *)h,(cdf_header_t *)sst,(cdf_stream_t *)cat);
    goto LAB_00118a09;
  }
  puVar16 = (ushort *)sst->sst_tab;
  lVar14 = 0;
  puVar13 = (ushort *)(sst->sst_ss * sst->sst_len + (long)puVar16);
  while( true ) {
    uVar1 = *puVar16;
    if (cdf_bo.u == 0x1020304) {
      uVar1 = CONCAT11((char)uVar1,(char)(uVar1 >> 8));
    }
    if ((uVar1 == 0) || (puVar16 = (ushort *)((long)puVar16 + (ulong)uVar1), puVar13 < puVar16))
    break;
    lVar14 = lVar14 + 1;
  }
  if (lVar14 == 0) {
LAB_001189f2:
    iVar6 = -1;
  }
  else {
    uVar15 = lVar14 - 1;
    pcVar7 = (cdf_catalog_t *)malloc(uVar15 * 0x210 + 0x218);
    *cat = pcVar7;
    if (pcVar7 == (cdf_catalog_t *)0x0) goto LAB_001189f2;
    puVar8 = (ushort *)memset(pcVar7->cat_e,0,uVar15 * 0x210);
    puVar16 = (ushort *)sst->sst_tab;
    if (uVar15 == 0) {
      uVar10 = 0;
    }
    else {
      uVar10 = 0;
      puVar12 = puVar8;
      if (puVar16 + 1 <= puVar13) {
        uVar17 = 0;
        do {
          uVar1 = *puVar16;
          *puVar12 = uVar1;
          puVar9 = puVar8 + uVar17 * 0x108;
          if (aVar5.u == 0x1020304) {
            *puVar9 = CONCAT11((char)uVar1,(char)(uVar1 >> 8));
            if (puVar13 < puVar16 + 4) break;
            uVar3 = *(undefined4 *)(puVar16 + 2);
            *(undefined4 *)(puVar12 + 2) = uVar3;
            *(uint *)(puVar9 + 2) =
                 (uint)CONCAT11((char)((uint)uVar3 >> 0x10),(char)((uint)uVar3 >> 0x18));
            if (puVar13 < puVar16 + 8) break;
            uVar18 = *(undefined8 *)(puVar16 + 4);
            *(undefined8 *)(puVar12 + 4) = uVar18;
            uVar18 = CONCAT17((char)uVar18,
                              CONCAT16((char)((ulong)uVar18 >> 8),
                                       CONCAT15((char)((ulong)uVar18 >> 0x10),
                                                CONCAT14((char)((ulong)uVar18 >> 0x18),
                                                         CONCAT13((char)((ulong)uVar18 >> 0x20),
                                                                  CONCAT12((char)((ulong)uVar18 >>
                                                                                 0x28),
                                                                           CONCAT11((char)((ulong)
                                                  uVar18 >> 0x30),(char)((ulong)uVar18 >> 0x38))))))
                                      ));
          }
          else {
            *puVar9 = uVar1;
            if (puVar13 < puVar16 + 4) break;
            uVar2 = *(uint *)(puVar16 + 2);
            *(uint *)(puVar12 + 2) = uVar2;
            *(uint *)(puVar9 + 2) = uVar2 & 0xffff;
            if (puVar13 < puVar16 + 8) break;
            uVar18 = *(undefined8 *)(puVar16 + 4);
            *(undefined8 *)(puVar12 + 4) = uVar18;
          }
          *(undefined8 *)(puVar9 + 4) = uVar18;
          uVar1 = *puVar12;
          if (uVar1 < 0xe) {
            *puVar12 = 0;
            uVar19 = uVar17;
          }
          else {
            uVar20 = uVar1 - 0xe;
            *puVar12 = 0xff;
            if (uVar20 < 0xff) {
              uVar19 = (ulong)uVar20;
              *puVar12 = uVar20;
              if (puVar13 < puVar16 + uVar19 + 8) break;
              if (uVar20 != 0) goto LAB_0011886b;
            }
            else {
              if (puVar13 < puVar16 + 0x107) break;
              uVar19 = 0xff;
              uVar20 = 0xff;
LAB_0011886b:
              uVar10 = 0;
              do {
                puVar12[uVar10 + 8] = puVar16[uVar10 + 8];
                uVar10 = uVar10 + 1;
              } while (uVar10 < uVar19);
            }
            puVar12[(ulong)uVar20 + 8] = 0;
            uVar19 = uVar17 + 1;
            uVar10 = uVar17;
          }
          uVar17 = uVar19;
          if (uVar15 <= uVar17) goto LAB_001188a8;
          puVar16 = (ushort *)((long)puVar16 + (ulong)uVar1);
          puVar12 = puVar8 + uVar10 * 0x108;
        } while (puVar16 + 1 <= puVar13);
      }
      *puVar12 = 0;
    }
LAB_001188a8:
    pcVar7->cat_num = uVar10;
    iVar6 = 0;
  }
  if (lVar4 == *(long *)(in_FS_OFFSET + 0x28)) {
    return iVar6;
  }
LAB_00118a09:
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



int cdf_print_classid(char *buf,size_t buflen,cdf_classid_t *id)

{
  int iVar1;
  
  iVar1 = __snprintf_chk(buf,buflen,1,0xffffffffffffffff,
                         "%.8x-%.4x-%.4x-%.2x%.2x-%.2x%.2x%.2x%.2x%.2x%.2x",id->cl_dword,
                         id->cl_word[0],id->cl_word[1],id->cl_two[0],id->cl_two[1],id->cl_six[0],
                         id->cl_six[1],id->cl_six[2],id->cl_six[3],id->cl_six[4],id->cl_six[5]);
  return iVar1;
}



int cdf_print_property_name(char *buf,size_t bufsiz,uint32_t p)

{
  int iVar1;
  long lVar2;
  anon_struct_16_2_947320a1 *paVar3;
  uint32_t uVar4;
  
  paVar3 = vn;
  uVar4 = 1;
  lVar2 = 0;
  while( true ) {
    paVar3 = paVar3 + 1;
    if (p == uVar4) {
      iVar1 = snprintf(buf,bufsiz,"%s",vn[lVar2].n);
      return iVar1;
    }
    lVar2 = lVar2 + 1;
    if (lVar2 == 0x14) break;
    uVar4 = paVar3->v;
  }
  iVar1 = __snprintf_chk(buf,bufsiz,1,0xffffffffffffffff,&DAT_0011ef8a,p);
  return iVar1;
}



int cdf_print_elapsed_time(char *buf,size_t bufsiz,cdf_timestamp_t ts)

{
  long lVar1;
  long lVar2;
  long lVar3;
  int iVar4;
  ulong uVar5;
  size_t sVar6;
  ulong uVar7;
  char *pcVar8;
  int iVar9;
  
  lVar2 = ts / 10000000;
  lVar3 = lVar2 / 0x3c;
  lVar1 = (lVar3 / 0x3c) / 0x18;
  uVar5 = (lVar3 / 0x3c) % 0x18;
  if (lVar1 == 0) {
    iVar9 = 0;
    sVar6 = bufsiz;
    pcVar8 = buf;
    if (uVar5 == 0) goto LAB_00118b98;
  }
  else {
    iVar9 = __snprintf_chk(buf,bufsiz,1,0xffffffffffffffff,&DAT_0011ef8f,lVar1);
    uVar7 = (ulong)iVar9;
    if (bufsiz <= uVar7) {
      return iVar9;
    }
    sVar6 = bufsiz - uVar7;
    pcVar8 = buf + uVar7;
  }
  iVar4 = __snprintf_chk(pcVar8,sVar6,1,0xffffffffffffffff,"%.2d:",uVar5 & 0xffffffff);
  iVar9 = iVar9 + iVar4;
  uVar5 = (ulong)iVar9;
  if (bufsiz <= uVar5) {
    return iVar9;
  }
  sVar6 = bufsiz - uVar5;
  pcVar8 = buf + uVar5;
LAB_00118b98:
  iVar4 = __snprintf_chk(pcVar8,sVar6,1,0xffffffffffffffff,"%.2d:",
                         (int)lVar3 + (int)(lVar3 / 0x3c) * -0x3c);
  iVar9 = iVar9 + iVar4;
  uVar5 = (ulong)iVar9;
  if (uVar5 < bufsiz) {
    iVar4 = __snprintf_chk(buf + uVar5,bufsiz - uVar5,1,0xffffffffffffffff,&DAT_0011ef9a,
                           (int)lVar2 + (int)(lVar2 / 0x3c) * -0x3c);
    iVar9 = iVar9 + iVar4;
  }
  return iVar9;
}



char * cdf_u16tos8(char *buf,size_t len,uint16_t *p)

{
  size_t sVar1;
  char *pcVar2;
  
  sVar1 = 0;
  pcVar2 = buf;
  if (len != 0) {
    while( true ) {
      pcVar2 = buf + sVar1;
      if (p[sVar1] == 0) break;
      buf[sVar1] = (char)p[sVar1];
      sVar1 = sVar1 + 1;
      if (len == sVar1) {
        buf[len] = '\0';
        return buf;
      }
    }
  }
  *pcVar2 = '\0';
  return buf;
}



int cdf_timestamp_to_timespec(timespec *ts,cdf_timestamp_t t)

{
  long lVar1;
  uint uVar2;
  int iVar3;
  long lVar4;
  time_t tVar5;
  int *piVar6;
  ulong uVar7;
  int iVar8;
  ulong uVar9;
  int iVar10;
  long lVar11;
  uint uVar12;
  long in_FS_OFFSET;
  tm tm;
  
  lVar1 = *(long *)(in_FS_OFFSET + 0x28);
  ts->tv_nsec = (t % 10000000) * 100;
  lVar4 = (t / 10000000) / 0x3c;
  iVar3 = (int)lVar4;
  tm.tm_sec = (int)(t / 10000000) + iVar3 * -0x3c;
  lVar4 = lVar4 / 0x3c;
  iVar10 = (int)lVar4;
  tm.tm_min = iVar3 + iVar10 * -0x3c;
  lVar4 = lVar4 / 0x18;
  tm.tm_hour = iVar10 + (int)lVar4 * -0x18;
  iVar3 = (int)(t / 0x11ed178c6c000);
  uVar12 = iVar3 + 0x641;
  if ((int)uVar12 < 0x642) {
    lVar11 = -1;
  }
  else {
    iVar10 = 0;
    uVar2 = 0x641;
    do {
      iVar8 = 0x16d;
      if ((uVar2 & 3) == 0) {
        iVar8 = 0x16e;
        if ((uVar2 * -0x3d70a3d7 >> 2 | uVar2 * 0x40000000) < 0x28f5c29) {
          iVar8 = ((uVar2 * -0x3d70a3d7 >> 4 | uVar2 * -0x70000000) < 0xa3d70b) + 0x16d;
        }
      }
      uVar2 = uVar2 + 1;
      iVar10 = iVar10 + iVar8;
    } while (uVar12 != uVar2);
    lVar11 = (long)(iVar10 + -1);
  }
  uVar7 = lVar4 - lVar11;
  uVar9 = uVar7 & 0xffffffff;
  iVar10 = 0x1f;
  lVar4 = 1;
  do {
    tm.tm_mday = (int)uVar7;
    if (lVar4 == 2) {
      if (((uVar12 & 3) == 0) && (((int)uVar12 % 100 != 0 || ((int)uVar12 % 400 == 0)))) {
        iVar10 = iVar10 + 1;
      }
      if (tm.tm_mday < iVar10) break;
      tm.tm_mday = tm.tm_mday - iVar10;
    }
    else if ((tm.tm_mday < iVar10) || (tm.tm_mday = tm.tm_mday - iVar10, lVar4 == 0xc)) break;
    uVar7 = (ulong)(uint)tm.tm_mday;
    iVar10 = mdays[lVar4];
    lVar4 = lVar4 + 1;
  } while( true );
  lVar4 = 0;
  iVar10 = 0x1f;
  do {
    uVar2 = (int)uVar9 - iVar10;
    uVar9 = (ulong)uVar2;
    if (lVar4 == 1) {
      if (((uVar12 & 3) == 0) && (((int)uVar12 % 100 != 0 || ((int)uVar12 % 400 == 0)))) {
        uVar9 = (ulong)(uVar2 - 1);
      }
      if ((int)uVar9 < 1) goto LAB_00118f95;
      lVar4 = 2;
    }
    else {
      if ((int)uVar2 < 1) goto LAB_00118f95;
      lVar4 = lVar4 + 1;
      if (lVar4 == 0xc) {
        lVar4 = 0xc;
LAB_00118f95:
        tm.tm_mon = (int)lVar4;
        tm.tm_year = iVar3 + -299;
        tm.tm_wday = 0;
        tm.tm_yday = 0;
        tm.tm_isdst = 0;
        tm.tm_zone = cdf_timestamp_to_timespec::UTC;
        tVar5 = mktime((tm *)&tm);
        ts->tv_sec = tVar5;
        if (tVar5 == -1) {
          piVar6 = __errno_location();
          *piVar6 = 0x16;
          iVar3 = -1;
        }
        else {
          iVar3 = 0;
        }
        if (lVar1 == *(long *)(in_FS_OFFSET + 0x28)) {
          return iVar3;
        }
                    // WARNING: Subroutine does not return
        __stack_chk_fail();
      }
    }
    iVar10 = mdays[lVar4];
  } while( true );
}



// WARNING: Unknown calling convention

int cdf_timespec_to_timestamp(cdf_timestamp_t *t,timespec *ts)

{
  return 0;
}



char * cdf_ctime(time_t *sec,char *buf)

{
  char *pcVar1;
  
  pcVar1 = ctime_r(sec,buf);
  if (pcVar1 != (char *)0x0) {
    return buf;
  }
  __snprintf_chk(buf,0x1a,1,0xffffffffffffffff,"*Bad* 0x%16.16llx\n",*sec);
  return buf;
}



char * cdf_app_to_mime(char *vbuf,nv *nv)

{
  __locale_t __dataset;
  __locale_t __dataset_00;
  char *pcVar1;
  
  __dataset = newlocale(1,"C",(__locale_t)0x0);
  if (__dataset == (__locale_t)0x0) {
                    // WARNING: Subroutine does not return
    __assert_fail("c_lc_ctype != NULL","readcdf.c",0x7b,"cdf_app_to_mime");
  }
  __dataset_00 = uselocale(__dataset);
  if (__dataset_00 == (__locale_t)0x0) {
                    // WARNING: Subroutine does not return
    __assert_fail("old_lc_ctype != NULL","readcdf.c",0x7d,"cdf_app_to_mime");
  }
  do {
    pcVar1 = nv->pattern;
    if (pcVar1 == (char *)0x0) {
LAB_00119101:
      uselocale(__dataset_00);
      freelocale(__dataset);
      return pcVar1;
    }
    pcVar1 = strcasestr(vbuf,pcVar1);
    if (pcVar1 != (char *)0x0) {
      pcVar1 = nv->mime;
      goto LAB_00119101;
    }
    nv = nv + 1;
  } while( true );
}



int file_trycdf(magic_set *ms,int fd,uchar *buf,size_t nbytes)

{
  byte bVar1;
  uint32_t uVar2;
  long lVar3;
  cdf_directory_t *pcVar4;
  uint16_t uVar5;
  int iVar6;
  wchar_t wVar7;
  uint uVar8;
  int *piVar9;
  long *plVar10;
  char *pcVar11;
  long lVar12;
  ulong uVar13;
  char *pcVar14;
  byte *pbVar15;
  nv *nv;
  uint16_t *p;
  sinfo *psVar16;
  ulong uVar17;
  cdf_property_info_t *pcVar18;
  ulong uVar19;
  long in_FS_OFFSET;
  double dVar20;
  cdf_stream_t *pcVar21;
  cdf_directory_t *local_7a8;
  cdf_directory_t *root_storage;
  cdf_property_info_t *info_1;
  size_t count;
  cdf_sat_t sat;
  cdf_sat_t ssat;
  cdf_dir_t dir;
  timespec ts;
  cdf_info_t info;
  cdf_stream_t sst;
  cdf_stream_t scn;
  cdf_summary_info_header_t si;
  cdf_header_t h;
  char buf_1 [64];
  char name [32];
  
  lVar3 = *(long *)(in_FS_OFFSET + 0x28);
  info.i_fd = fd;
  info.i_buf = buf;
  info.i_len = nbytes;
  if ((ms->flags & 0x1000800U) == 0) {
    iVar6 = cdf_read_header(&info,&h);
    if (iVar6 != -1) {
      iVar6 = cdf_read_sat(&info,&h,&sat);
      if (iVar6 == -1) {
        pcVar14 = "Can\'t read SAT";
LAB_001193e1:
        if ((ms->flags & 0x410U) == 0) {
          wVar7 = file_printf(ms,"Composite Document File V2 Document");
          if (wVar7 == L'\xffffffff') goto LAB_00119466;
          if (*pcVar14 == '\0') goto LAB_0011940d;
          wVar7 = file_printf(ms,", %s");
        }
        else {
          wVar7 = file_printf(ms,"application/CDFV2-unknown");
        }
        if (wVar7 != L'\xffffffff') goto LAB_0011940d;
      }
      else {
        iVar6 = cdf_read_ssat(&info,&h,&sat,&ssat);
        if (iVar6 == -1) {
          free(sat.sat_tab);
          pcVar14 = "Can\'t read SSAT";
          goto LAB_001193e1;
        }
        iVar6 = cdf_read_dir(&info,&h,&sat,&dir);
        if (iVar6 == -1) {
          free(ssat.sat_tab);
          free(sat.sat_tab);
          pcVar14 = "Can\'t read directory";
          goto LAB_001193e1;
        }
        iVar6 = cdf_read_short_stream(&info,&h,&sat,&dir,&sst,&root_storage);
        if (iVar6 == -1) {
          free(dir.dir_tab);
          free(ssat.sat_tab);
          free(sat.sat_tab);
          pcVar14 = "Cannot read short stream";
          goto LAB_001193e1;
        }
        iVar6 = cdf_read_user_stream(&info,&h,&sat,&ssat,&sst,&dir,"FileHeader",&scn);
        if (iVar6 == -1) {
LAB_0011934d:
          iVar6 = cdf_read_summary_info(&info,&h,&sat,&ssat,&sst,&dir,&scn);
          if (iVar6 == -1) {
            piVar9 = __errno_location();
            pcVar14 = "Cannot read summary info";
            if (*piVar9 == 3) {
              pcVar14 = "Catalog";
              pcVar21 = &scn;
              iVar6 = cdf_read_user_stream(&info,&h,&sat,&ssat,&sst,&dir,"Catalog",&scn);
              if (iVar6 == -1) {
LAB_00119b4e:
                pcVar14 = "EncryptedPackage";
                psVar16 = sectioninfo;
                do {
                  iVar6 = cdf_find_stream(&dir,pcVar14,psVar16->types[0]);
                  if (iVar6 < 1) {
                    pcVar14 = "mfbu_header";
                    lVar12 = 0;
                    goto LAB_00119bb9;
                  }
                  psVar16 = (sinfo *)((long)&psVar16->name + 4);
                  pcVar14 = *(char **)((long)psVar16 * 2 + -0x123bd0);
                } while (pcVar14 != (char *)0x0);
                lVar12 = 0;
                goto LAB_00119d72;
              }
              if ((ms->flags & 0x410U) == 0) {
                wVar7 = file_printf(ms,"Microsoft Thumbs.db [",pcVar14,pcVar21);
                if ((wVar7 == L'\xffffffff') ||
                   (iVar6 = cdf_unpack_catalog(&h,&scn,(cdf_catalog_t **)&ts), iVar6 == -1))
                goto LAB_00119b4e;
                uVar17 = *(ulong *)ts.tv_sec;
                if (1 < uVar17) {
                  p = (uint16_t *)(ts.tv_sec + 0x228);
                  uVar19 = 1;
                  do {
                    pcVar14 = ", ";
                    if (uVar17 - 1 == uVar19) {
                      pcVar14 = "]";
                    }
                    pcVar11 = cdf_u16tos8(name,(ulong)p[-8],p);
                    wVar7 = file_printf(ms,"%s%s",pcVar11,pcVar14);
                    if (wVar7 == L'\xffffffff') {
                      free((void *)ts.tv_sec);
                      goto LAB_00119b4e;
                    }
                    uVar19 = uVar19 + 1;
                    p = p + 0x108;
                    uVar17 = *(ulong *)ts.tv_sec;
                  } while (uVar19 < uVar17);
                }
                free((void *)ts.tv_sec);
              }
              else {
                wVar7 = file_printf(ms,"application/CDFV2",pcVar14,pcVar21);
                if (wVar7 == L'\xffffffff') goto LAB_00119b4e;
              }
              goto LAB_00119cb0;
            }
            goto LAB_00119392;
          }
          local_7a8 = root_storage;
          iVar6 = cdf_unpack_summary_info(&scn,&h,&si,&info_1,&count);
          if (iVar6 == -1) {
LAB_00119de9:
            free(scn.sst_tab);
            free(sst.sst_tab);
            free(dir.dir_tab);
            free(ssat.sat_tab);
            free(sat.sat_tab);
            pcVar14 = "Can\'t expand summary_info";
            goto LAB_001193e1;
          }
          if ((ms->flags & 0x410U) != 0) {
            if (root_storage == (cdf_directory_t *)0x0) {
              uVar17 = count;
              if (count != 0) goto LAB_001195b1;
LAB_0011997f:
              uVar17 = 0;
              free(info_1);
              do {
                pcVar4 = dir.dir_tab;
                if (dir.dir_len <= uVar17) {
                  uVar8 = ms->flags & 0x410;
                  if (uVar8 == 0) goto LAB_00119677;
                  pcVar14 = "vnd.ms-office";
                  goto LAB_00119a1e;
                }
                lVar12 = 0;
                do {
                  uVar5 = cdf_tole2(pcVar4[uVar17].d_name[lVar12]);
                  name[lVar12] = (char)uVar5;
                  lVar12 = lVar12 + 1;
                } while (lVar12 != 0x20);
                nv = name2mime;
                if ((ms->flags & 0x410U) == 0) {
                  nv = name2desc;
                }
                uVar17 = uVar17 + 1;
                pcVar14 = cdf_app_to_mime(name,nv);
              } while (pcVar14 == (char *)0x0);
              pcVar11 = "%s";
              if ((ms->flags & 0x410U) != 0) {
LAB_00119a1e:
                pcVar11 = "application/%s";
              }
              wVar7 = file_printf(ms,pcVar11,pcVar14);
              if (wVar7 == L'\xffffffff') goto LAB_00119466;
            }
            else {
LAB_0011992b:
              if (root_storage->d_storage_uuid[0] == 0xc1084) {
LAB_0011993d:
                if (root_storage->d_storage_uuid[1] != 0x46000000000000c0) goto LAB_001195a0;
                local_7a8 = (cdf_directory_t *)0x11f374;
              }
              else {
LAB_001195a0:
                local_7a8 = (cdf_directory_t *)0x0;
              }
LAB_001195a8:
              uVar17 = count;
              if (count != 0) {
LAB_001195b1:
                uVar19 = 0;
                pcVar18 = info_1;
                do {
                  cdf_print_property_name(buf_1,0x40,pcVar18->pi_id);
                  uVar2 = pcVar18->pi_type;
                  if (false) goto LAB_0011966d;
                  pcVar14 = name;
                  switch(uVar2) {
                  default:
                    goto LAB_0011966d;
                  case 1:
                  case 0x47:
                    break;
                  case 2:
                    if ((ms->flags & 0x410U) == 0) {
                      uVar13 = (ulong)(uint)(int)(pcVar18->pi_val)._pi_s16;
                      pcVar14 = ", %s: %hd";
LAB_0011980c:
                      wVar7 = file_printf(ms,pcVar14,buf_1,uVar13);
joined_r0x0011965e:
                      if (wVar7 == L'\xffffffff') goto LAB_0011966d;
                    }
                    break;
                  case 3:
                    if ((ms->flags & 0x410U) == 0) {
                      uVar13 = (ulong)(pcVar18->pi_val)._pi_u32;
                      pcVar14 = ", %s: %d";
                      goto LAB_0011980c;
                    }
                    break;
                  case 4:
                    if ((ms->flags & 0x410U) == 0) {
                      dVar20 = (double)(pcVar18->pi_val)._pi_f;
LAB_0011983f:
                      wVar7 = file_printf(ms,", %s: %g",dVar20,buf_1);
                      goto joined_r0x0011965e;
                    }
                    break;
                  case 5:
                    if ((ms->flags & 0x410U) == 0) {
                      dVar20 = (double)(pcVar18->pi_val)._pi_u64;
                      goto LAB_0011983f;
                    }
                    break;
                  case 0x13:
                    if ((ms->flags & 0x410U) == 0) {
                      uVar13 = (ulong)(pcVar18->pi_val)._pi_u32;
                      pcVar14 = ", %s: %u";
                      goto LAB_0011980c;
                    }
                    break;
                  case 0x1e:
                  case 0x1f:
                    if (1 < (pcVar18->pi_val)._pi_s32) {
                      pbVar15 = (byte *)(pcVar18->pi_val)._pi_str.s_buf;
                      iVar6 = (pcVar18->pi_val)._pi_s32 + -1;
                      lVar12 = 0;
                      do {
                        bVar1 = *pbVar15;
                        if (bVar1 == 0) break;
                        plVar10 = (long *)FUN_00104d70();
                        if ((*(byte *)(*plVar10 + 1 + (ulong)bVar1 * 2) & 0x40) != 0) {
                          name[lVar12] = bVar1;
                          lVar12 = lVar12 + 1;
                        }
                        pbVar15 = pbVar15 + (ulong)(uVar2 == 0x1f) + 1;
                        if (lVar12 == 0x400) {
                          lVar12 = 0x3ff;
                          break;
                        }
                        iVar6 = iVar6 + -1;
                      } while (iVar6 != -1);
                      name[lVar12] = '\0';
                      if ((ms->flags & 0x410U) == 0) {
                        if (name[0] != '\0') goto LAB_00119647;
                      }
                      else if ((local_7a8 == (cdf_directory_t *)0x0) && (pcVar18->pi_id == 0x12)) {
                        local_7a8 = (cdf_directory_t *)cdf_app_to_mime(name,app2mime);
                      }
                    }
                    break;
                  case 0x40:
                    lVar12 = (pcVar18->pi_val)._pi_tp;
                    if (lVar12 != 0) {
                      if (lVar12 < 1000000000000000) {
                        cdf_print_elapsed_time(name,0x40,lVar12);
                        uVar8 = ms->flags;
                      }
                      else {
                        cdf_timestamp_to_timespec(&ts,lVar12);
                        pcVar14 = cdf_ctime(&ts.tv_sec,name);
                        if ((pcVar14 != (char *)0x0) &&
                           (pcVar11 = strchr(pcVar14,10), pcVar11 != (char *)0x0)) {
                          *pcVar11 = '\0';
                        }
                        uVar8 = ms->flags;
                      }
                      if ((uVar8 & 0x410) == 0) {
LAB_00119647:
                        wVar7 = file_printf(ms,", %s: %s",buf_1,pcVar14);
                        goto joined_r0x0011965e;
                      }
                    }
                  }
                  uVar19 = uVar19 + 1;
                  pcVar18 = pcVar18 + 1;
                } while (uVar19 < uVar17);
              }
              if ((ms->flags & 0x410U) != 0) {
                if (local_7a8 == (cdf_directory_t *)0x0) goto LAB_0011997f;
                wVar7 = file_printf(ms,"application/%s",local_7a8);
                if (wVar7 == L'\xffffffff') {
LAB_0011966d:
                  free(info_1);
                  goto LAB_00119672;
                }
              }
LAB_00119706:
              free(info_1);
            }
            goto LAB_0011970b;
          }
          wVar7 = file_printf(ms,"Composite Document File V2 Document");
          if (wVar7 == L'\xffffffff') goto LAB_00119de9;
          pcVar14 = "Little";
          if (si.si_byte_order != 0xfffe) {
            pcVar14 = "Big";
          }
          wVar7 = file_printf(ms,", %s Endian",pcVar14);
          if (wVar7 != L'\xffffffff') {
            uVar17 = (ulong)(byte)(si.si_os_version >> 8);
            uVar19 = (ulong)(byte)si.si_os_version;
            if (si.si_os == 1) {
              pcVar14 = ", Os: MacOS, Version %d.%d";
              uVar13 = uVar19;
LAB_00119554:
              wVar7 = file_printf(ms,pcVar14,uVar17,uVar13);
            }
            else {
              if (si.si_os == 2) {
                pcVar14 = ", Os: Windows, Version %d.%d";
                uVar13 = uVar17;
                uVar17 = uVar19;
                goto LAB_00119554;
              }
              wVar7 = file_printf(ms,", Os %d, Version: %d.%d",(ulong)si.si_os,uVar19,uVar17);
            }
            if (wVar7 != L'\xffffffff') {
              if (root_storage == (cdf_directory_t *)0x0) goto LAB_001195a8;
              if (root_storage->d_storage_uuid[0] == 0xc1084) {
                if (root_storage->d_storage_uuid[1] == 0x46000000000000c0) {
                  wVar7 = file_printf(ms,", %s","MSI Installer");
                  if (wVar7 == L'\xffffffff') goto LAB_00119672;
                  if ((ms->flags & 0x410U) != 0) goto LAB_0011992b;
                }
                else if ((ms->flags & 0x410U) != 0) goto LAB_0011993d;
              }
              else if ((ms->flags & 0x410U) != 0) goto LAB_001195a0;
              if (count != 0) {
                local_7a8 = (cdf_directory_t *)0x0;
                uVar17 = count;
                goto LAB_001195b1;
              }
              goto LAB_00119706;
            }
          }
LAB_00119672:
          uVar8 = 0xfffffffe;
LAB_00119677:
          free(scn.sst_tab);
          free(sst.sst_tab);
          free(dir.dir_tab);
          free(ssat.sat_tab);
          free(sat.sat_tab);
          goto LAB_001191ca;
        }
                    // WARNING: Load size is inaccurate
        if (((scn.sst_dirlen < 0x11) ||
            (*(long *)((long)scn.sst_tab + 8) != 0x6c694620746e656d ||
             *scn.sst_tab != 0x75636f4420505748)) || (*(char *)((long)scn.sst_tab + 0x10) != 'e')) {
          free(scn.sst_tab);
          scn.sst_tab = (void *)0x0;
          scn.sst_len = 0;
          scn.sst_dirlen = 0;
          goto LAB_0011934d;
        }
        pcVar14 = "application/x-hwp";
        if ((ms->flags & 0x410U) == 0) {
          pcVar14 = "Hangul (Korean) Word Processor File 5.x";
        }
        wVar7 = file_printf(ms,pcVar14);
        if (wVar7 != L'\xffffffff') {
LAB_0011970b:
          uVar8 = 1;
          goto LAB_00119677;
        }
      }
LAB_00119466:
      uVar8 = 0xffffffff;
      goto LAB_001191ca;
    }
  }
  uVar8 = 0;
  goto LAB_001191ca;
  while( true ) {
    pcVar14 = sectioninfo[1].sections[lVar12 + 1];
    lVar12 = lVar12 + 1;
    if (pcVar14 == (char *)0x0) break;
LAB_00119bb9:
    iVar6 = cdf_find_stream(&dir,pcVar14,sectioninfo[1].types[lVar12]);
    if (iVar6 < 1) goto LAB_00119bc9;
  }
  lVar12 = 1;
LAB_00119d72:
  if ((ms->flags & 0x410U) == 0) {
    pcVar11 = "CDFV2 %s";
    pcVar14 = sectioninfo[lVar12].name;
  }
  else {
    pcVar11 = "application/CDFV2-%s";
    pcVar14 = sectioninfo[lVar12].mime;
  }
  wVar7 = file_printf(ms,pcVar11,pcVar14);
  if (wVar7 == L'\xffffffff') {
LAB_00119bc9:
    pcVar14 = "Cannot read section info";
LAB_00119392:
    free(sst.sst_tab);
    free(dir.dir_tab);
    free(ssat.sat_tab);
    free(sat.sat_tab);
    goto LAB_001193e1;
  }
LAB_00119cb0:
  free(sst.sst_tab);
  free(dir.dir_tab);
  free(ssat.sat_tab);
  free(sat.sat_tab);
LAB_0011940d:
  uVar8 = 1;
LAB_001191ca:
  if (lVar3 == *(long *)(in_FS_OFFSET + 0x28)) {
    return uVar8;
  }
                    // WARNING: Subroutine does not return
  __stack_chk_fail();
}



size_t strlcpy(char *dst,char *src,size_t siz)

{
  char cVar1;
  char *pcVar2;
  char *pcVar3;
  char *pcVar4;
  
  pcVar3 = src;
  if (siz != 0) {
    pcVar2 = src;
    pcVar3 = dst;
    pcVar4 = dst;
    if (siz != 1) {
      do {
        cVar1 = *pcVar2;
        pcVar2 = pcVar2 + 1;
        pcVar4 = pcVar3 + 1;
        *pcVar3 = cVar1;
        if (cVar1 == '\0') goto LAB_00119e83;
        pcVar3 = pcVar4;
      } while (dst + ~(ulong)pcVar4 + siz != (char *)0x0);
    }
    *pcVar4 = '\0';
    pcVar3 = pcVar2;
  }
  do {
    pcVar2 = pcVar3 + 1;
    if (*pcVar3 == '\0') break;
    pcVar2 = pcVar3 + 2;
    pcVar4 = pcVar3 + 1;
    pcVar3 = pcVar2;
  } while (*pcVar4 != '\0');
LAB_00119e83:
  return (size_t)(pcVar2 + (-1 - (long)src));
}



size_t strlcat(char *dst,char *src,size_t siz)

{
  char *pcVar1;
  size_t sVar2;
  char *pcVar3;
  long lVar4;
  char cVar5;
  char *pcVar6;
  
  if (siz == 0) {
    pcVar6 = (char *)0x0;
  }
  else {
    pcVar1 = dst;
    do {
      if (*pcVar1 == '\0') break;
      pcVar1 = pcVar1 + 1;
    } while (pcVar1 != dst + siz);
    pcVar6 = pcVar1 + -(long)dst;
    lVar4 = siz - (long)pcVar6;
    if (lVar4 != 0) {
      cVar5 = *src;
      pcVar3 = src;
      if (cVar5 != '\0') {
        do {
          if (lVar4 != 1) {
            *pcVar1 = cVar5;
            lVar4 = lVar4 + -1;
            pcVar1 = pcVar1 + 1;
          }
          cVar5 = pcVar3[1];
          pcVar3 = pcVar3 + 1;
        } while (cVar5 != '\0');
        pcVar6 = pcVar3 + ((long)pcVar6 - (long)src);
      }
      *pcVar1 = '\0';
      return (size_t)pcVar6;
    }
  }
  sVar2 = strlen(src);
  return (size_t)(pcVar6 + sVar2);
}



EFT get_next_format_from_precision(char **pf)

{
  int iVar1;
  EFT EVar2;
  char *pcVar3;
  int iVar4;
  char cVar5;
  char *pcVar6;
  int __c;
  int iVar7;
  int iVar8;
  
  pcVar3 = *pf;
  cVar5 = *pcVar3;
  if (cVar5 == 'l') {
    cVar5 = pcVar3[1];
    pcVar6 = pcVar3 + 1;
    if (cVar5 == '\0') {
      *pf = pcVar6;
      return FMTCHECK_UNKNOWN;
    }
    if (cVar5 == 'l') {
      cVar5 = pcVar3[2];
      pcVar3 = pcVar3 + 2;
      iVar7 = 0;
      iVar1 = 1;
LAB_00119f97:
      iVar4 = 0;
      pcVar6 = pcVar3;
      goto joined_r0x00119fdf;
    }
    iVar8 = 1;
LAB_0011a00d:
    __c = (int)cVar5;
    pcVar3 = strchr("diouxX",__c);
    if (pcVar3 != (char *)0x0) {
      if (iVar8 != 0) {
        *pf = pcVar6;
        return FMTCHECK_LONG;
      }
      goto LAB_0011a032;
    }
    iVar4 = 0;
    iVar1 = 0;
    iVar7 = 0;
  }
  else {
    if (cVar5 < 'm') {
      if (cVar5 != 'L') {
        if (cVar5 == 'h') {
          cVar5 = pcVar3[1];
          pcVar3 = pcVar3 + 1;
          iVar1 = 0;
          iVar7 = 1;
        }
        else {
          iVar1 = 0;
          iVar7 = 0;
        }
        goto LAB_00119f97;
      }
      cVar5 = pcVar3[1];
      pcVar6 = pcVar3 + 1;
      iVar1 = 0;
      iVar7 = 0;
      iVar4 = 1;
    }
    else {
      iVar8 = 0;
      pcVar6 = pcVar3;
      if (cVar5 != 'q') goto LAB_0011a00d;
      cVar5 = pcVar3[1];
      iVar4 = 0;
      iVar7 = 0;
      iVar1 = 1;
      pcVar6 = pcVar3 + 1;
    }
joined_r0x00119fdf:
    if (cVar5 == '\0') {
LAB_00119fa0:
      *pf = pcVar6;
      return FMTCHECK_UNKNOWN;
    }
    __c = (int)cVar5;
    pcVar3 = strchr("diouxX",__c);
    if (pcVar3 != (char *)0x0) {
      if (iVar4 == 0) {
        if (iVar1 != 0) {
          *pf = pcVar6;
          return FMTCHECK_QUAD;
        }
LAB_0011a032:
        *pf = pcVar6;
        return FMTCHECK_INT;
      }
      goto LAB_00119fa0;
    }
    iVar8 = 0;
  }
  if (cVar5 == 'n') {
    if (iVar4 == 0) {
      *pf = pcVar6;
      if (iVar7 != 0) {
        return FMTCHECK_SHORTPOINTER;
      }
      if (iVar8 == 0) {
        if (iVar1 == 0) {
          return FMTCHECK_INTPOINTER;
        }
        return FMTCHECK_QUADPOINTER;
      }
      return FMTCHECK_LONGPOINTER;
    }
LAB_0011a198:
    *pf = pcVar6;
    return FMTCHECK_UNKNOWN;
  }
  pcVar3 = strchr("DOU",__c);
  if (pcVar3 == (char *)0x0) {
    pcVar3 = strchr("eEfg",__c);
    if (pcVar3 == (char *)0x0) {
      if (cVar5 == 'c') {
        *pf = pcVar6;
        EVar2 = FMTCHECK_INT;
      }
      else {
        if (cVar5 != 's') {
          if (cVar5 != 'p') goto LAB_0011a198;
          *pf = pcVar6;
          goto joined_r0x0011a183;
        }
        *pf = pcVar6;
        EVar2 = FMTCHECK_STRING;
      }
      iVar1 = iVar7 + iVar8 + iVar1 + iVar4;
    }
    else {
      if (iVar4 != 0) {
        *pf = pcVar6;
        return FMTCHECK_LONGDOUBLE;
      }
      *pf = pcVar6;
      iVar1 = iVar7 + iVar8 + iVar1;
      EVar2 = FMTCHECK_DOUBLE;
    }
    if (iVar1 == 0) {
      return EVar2;
    }
  }
  else {
    *pf = pcVar6;
joined_r0x0011a183:
    if (iVar7 + iVar8 + iVar1 + iVar4 == 0) {
      return FMTCHECK_LONG;
    }
  }
  return FMTCHECK_UNKNOWN;
}



EFT get_next_format_from_width(char **pf)

{
  EFT EVar1;
  long *plVar2;
  char *pcVar3;
  byte bVar4;
  
  pcVar3 = *pf;
  if (*pcVar3 == '.') {
    bVar4 = pcVar3[1];
    pcVar3 = pcVar3 + 1;
    if (bVar4 == 0x2a) {
      *pf = pcVar3;
      EVar1 = FMTCHECK_PRECISION;
    }
    else {
      plVar2 = (long *)FUN_00104d70();
      while ((*(byte *)(*plVar2 + 1 + (ulong)bVar4 * 2) & 8) != 0) {
        bVar4 = pcVar3[1];
        pcVar3 = pcVar3 + 1;
      }
      if (bVar4 != 0) goto LAB_0011a2c6;
      *pf = pcVar3;
      EVar1 = FMTCHECK_UNKNOWN;
    }
    return EVar1;
  }
LAB_0011a2c6:
  *pf = pcVar3;
  EVar1 = get_next_format_from_precision(pf);
  return EVar1;
}



EFT get_next_format(char **pf,EFT eft)

{
  EFT EVar1;
  char *pcVar2;
  long *plVar3;
  byte bVar4;
  byte *pbVar5;
  
  pcVar2 = *pf;
  if (eft == FMTCHECK_WIDTH) {
    *pf = pcVar2 + 1;
  }
  else {
    if (eft == FMTCHECK_PRECISION) {
      *pf = pcVar2 + 1;
      EVar1 = get_next_format_from_precision(pf);
      return EVar1;
    }
    while( true ) {
      pcVar2 = strchr(pcVar2,0x25);
      if (pcVar2 == (char *)0x0) {
        *pf = (char *)0x0;
        return FMTCHECK_DONE;
      }
      bVar4 = pcVar2[1];
      pbVar5 = (byte *)(pcVar2 + 1);
      if (bVar4 == 0) {
        *pf = (char *)pbVar5;
        return FMTCHECK_UNKNOWN;
      }
      if (bVar4 != 0x25) break;
      pcVar2 = pcVar2 + 2;
    }
    do {
      pcVar2 = strchr("#0- +",(int)(char)bVar4);
      if (pcVar2 == (char *)0x0) {
        if (bVar4 == 0x2a) {
          *pf = (char *)pbVar5;
          return FMTCHECK_WIDTH;
        }
        bVar4 = *pbVar5;
        break;
      }
      bVar4 = pbVar5[1];
      pbVar5 = pbVar5 + 1;
    } while (bVar4 != 0);
    plVar3 = (long *)FUN_00104d70();
    while ((*(byte *)(*plVar3 + 1 + (ulong)bVar4 * 2) & 8) != 0) {
      bVar4 = pbVar5[1];
      pbVar5 = pbVar5 + 1;
    }
    *pf = (char *)pbVar5;
    if (bVar4 == 0) {
      return FMTCHECK_UNKNOWN;
    }
  }
  EVar1 = get_next_format_from_width(pf);
  return EVar1;
}



char * fmtcheck(char *f1,char *f2)

{
  EFT eft;
  EFT eft_00;
  char *pcVar1;
  long in_FS_OFFSET;
  char *f1p;
  char *f2p;
  long local_40;
  
  local_40 = *(long *)(in_FS_OFFSET + 0x28);
  pcVar1 = f2;
  if (f1 != (char *)0x0) {
    eft = FMTCHECK_START;
    eft_00 = FMTCHECK_START;
    f1p = f1;
    f2p = f2;
    do {
      eft_00 = get_next_format(&f1p,eft_00);
      pcVar1 = f1;
      if ((eft_00 == FMTCHECK_DONE) || (pcVar1 = f2, eft_00 == FMTCHECK_UNKNOWN)) break;
      eft = get_next_format(&f2p,eft);
    } while (eft_00 == eft);
  }
  if (local_40 != *(long *)(in_FS_OFFSET + 0x28)) {
                    // WARNING: Subroutine does not return
    __stack_chk_fail();
  }
  return pcVar1;
}



void _fini(void)

{
  return;
}


